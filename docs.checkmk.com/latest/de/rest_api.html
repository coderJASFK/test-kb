<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="description" content="Mit der Checkmk REST-API können Sie Aufgaben, die Sie sonst über die GUI erledigen, per HTTP-Anfragen vom Checkmk-Server ausführen lassen.">
<meta name="keywords" content="REST">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Die Checkmk REST-API">
<meta name="og:description" content="Mit der Checkmk REST-API können Sie Aufgaben, die Sie sonst über die GUI erledigen, per HTTP-Anfragen vom Checkmk-Server ausführen lassen.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Die Checkmk REST-API</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/latest/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/latest/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../latest/en/rest_api.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">latest (2.3.0)</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.1.0/de/rest_api.html">2.1.0</a><a class="dropdown-item" href="../../2.2.0/de/rest_api.html">2.2.0</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="release_notes.html">Release notes</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und Derivaten</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
<li>
<p><a href="install_azure.html">Installation aus dem Azure Marketplace</a></p>
</li>
<li>
<p><a href="install_aws.html">Installation aus dem AWS Marketplace</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="password_store.html">Passwortspeicher (Password store)</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk-Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="mkp_viewables.html">MKPs für GUI-Erweiterungen</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
<li>
<p><a href="hosts_autoregister.html">Automatisch Hosts erstellen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Regeln</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
<li>
<p><a href="notifications_ilert.html">Benachrichtigungen per ilert</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_teams.html">Benachrichtigungen per Microsoft Teams</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_signl4.html">Benachrichtigungen per SIGNL4</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_logfiles.html">Log-Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql_legacy.html">MSSQL mit dem Legacy-Plugin überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMware ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_gcp.html">Google Cloud Platform (GCP) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_openshift.html">OpenShift überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
<li>
<p><a href="robotmk.html">Checkmk Synthetic Monitoring mit Robotmk</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
<li>
<p><a href="custom_notes.html">Anmerkungen (Custom notes)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cse.html">Checkmk Enterprise</a></p>
</li>
<li>
<p><a href="cce.html">Checkmk Cloud</a></p>
</li>
<li>
<p><a href="managed.html">Checkmk MSP</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="apis_intro.html">Übersicht der API-Ressourcen</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Die Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_intro.html">Erweiterungen für Checkmk entwickeln</a></p>
</li>
<li>
<p><a href="devel_check_plugins.html">Agentenbasierte Check-Plugins schreiben</a></p>
</li>
<li>
<p><a href="devel_check_plugins_snmp.html">SNMP-basierte Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Die Checkmk REST-API</h1>
<div class="details">
<span id="revdate">Last modified on 09-Jul-2024</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.3.0/src/common/de/rest_api.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="heading_intro">
<span class="hidden-anchor sr-only" id="intro"></span>1. Einleitung</h2>
<div class="sectionbody">
<div class="paragraph"><p>Mit der Checkmk REST-API als Anwendungsprogrammierschnittstelle können Sie die Aufgaben, die Sie sonst in Checkmk über die GUI erledigen, per Kommando oder Skript mit HTTP-Anfragen an den Checkmk-Server übermitteln und ausführen lassen.</p></div>
<div class="paragraph"><p>Das <em>REST</em> im Namen der REST-API steht für <em>REpresentational State Transfer</em> und beschreibt eine Architektur für den Austausch von Daten auf verteilten Systemen — insbesondere für Web-Dienste.
Eine API, die gemäß der REST-Architektur implementiert ist, folgt bestimmten Prinzipien, z.B. dem Client-Server-Modell, der zustandslosen Kommunikation und einer einheitlichen Schnittstelle.
In der Praxis erfolgt die Umsetzung bevorzugt über das HTTP-Protokoll, wobei die Ressourcen per Uniform Resource Identifier (URI) angesprochen werden und auf diese mit HTTP-Methoden (GET, POST, PUT, DELETE) zugegriffen wird.</p></div>
<div class="paragraph"><p>Soviel zu den REST-Prinzipien.
Ihre Vorteile zeigen sich in den konkreten Features, die Ihnen die Checkmk REST-API bietet:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protokoll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Hypertext Transfer Protocol (<strong>HTTP/1.1</strong>) wird als Transportsystem für die Kommunikation genutzt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kodierung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Als Datenformat wird die JavaScript Object Notation (<strong>JSON</strong>) verwendet.
Die Nutzdaten (<em>payload</em>) der Antworten werden mit JSON serialisiert und in UTF-8 kodiert.
Datums- und Zeitangaben sind im <strong>ISO-8601</strong>-Format mit gültigen Zeitzoneninformationen kodiert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sprache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Englisch ist die Sprache für Labels, Identifiers und die API-Dokumentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentifizierung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Zugriff auf die API wird einem Client nur dann gestattet, wenn er die Berechtigung mittels <strong>HTTP-Authentifizierung</strong> (z.B. „Bearer“) nachgewiesen hat.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versionierung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die API ist versioniert und nutzt dabei eine Nummerierung nach dem Standard <strong>Semantic Versioning 2.x.</strong>
Details finden Sie im <a href="#versioning">Abschnitt zur Versionierung</a> weiter unten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dokumentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die API wird in einem maschinenlesbaren Schema und einem menschenlesbaren Format in englischer Sprache dokumentiert, mit allen Ressourcen, ihren Eingabe- und Ausgabeparametern und den zugehörigen Wertebereichen.
Die API ist mit der <strong>OpenAPI Specification (OAS) 3.x</strong> erstellt, einem API-Beschreibungsformat speziell für REST-APIs.
Das mit dieser Spezifikation erstellte API-Dokument wird für den Benutzer mit ReDoc angezeigt, einem responsiven Web-Design für OpenAPI-Dokumente.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beispiel-Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um die Verwendung zu demonstrieren, gibt es zu jeder Anfrage Beispiel-Code für verschiedene Anwendungen (z.B. für Curl und Httpie).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fehleranzeige</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die API sendet im Fehlerfall numerische <strong>HTTP-Status-Codes</strong> und eine Diagnosemeldung des Problems, die bei der Suche nach möglichen Ursachen für fehlerhafte Anfragen hilft.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST-API Klassifizierung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die API erfüllt alle vier Ebenen (0 bis 3) des <strong>Richardson Maturity Model (RMM)</strong>, mit dem beurteilt werden kann, wie viel REST in einer API steckt.
In Ebene 1 wird die Einführung von Ressourcen gefordert, damit über die API statt zu einem globalen Endpunkt zu individuellen Endpunkten kommuniziert werden kann.
Ebene 2 wird erfüllt, wenn für die Anfragen HTTP-Methoden verwendet werden.
Auf der (höchsten) Ebene 3 dokumentiert sich die API quasi selbst, indem der Server mit der Antwort auf eine Anfrage die nächsten möglichen Aktionen und die dabei anzusprechenden Ressourcen mitteilt, und es dem Client so ermöglicht, die verfügbare Funktionalität selbst zu entdecken.
Diese Bereitstellung von Zusatzinformationen wird auch „Hypermedia as the Engine of Application State“ (<strong>HATEOAS</strong>) genannt.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Neben diesen generellen Komfortfunktionen soll die REST-API die komplette Funktionalität abdecken, die Checkmk über die GUI und über Kommandoschnittstelle bietet.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Für Funktionen, die es nur in den kommerziellen Editionen gibt, wie z.B. Service Level Agreement (SLA) oder Agentenbäckerei, werden die zugehörigen Methoden der REST-API auch nur in diesen Editionen angeboten.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_api_doc">
<span class="hidden-anchor sr-only" id="api_doc"></span>2. Die API-Dokumentation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_versioning">
<span class="hidden-anchor sr-only" id="versioning"></span>2.1. Versionierung</h3>
<div class="paragraph"><p>Einer der Vorteile der REST-API ist, dass Software und Dokumentation aus der gleichen Quelle stammen: dem OpenAPI-Dokument.
Daher passt die API-Dokumentation stets zur Software und beschreibt genau das, was die API kann.
Daher ist es auch nicht nötig, den Referenzteil der verfügbaren Ressourcen, Methoden, Parameter etc. im Checkmk-Handbuch zu beschreiben:
stattdessen finden Sie die API-Dokumentation außerhalb dieses Handbuchs, direkt in Ihrer Checkmk-Instanz.</p></div>
<div class="paragraph"><p>Die API mit ihrer Dokumentation ist versioniert und nutzt dabei eine zweistufige Nummerierung im Format <code>X.Y</code>, wobei <code>X</code> für eine Major-Version steht und <code>Y</code> für eine Minor-Version.
Eine neue Minor-Version enthält nur rückwärtskompatible Änderungen, die keinen Einfluss auf bestehende Funktionen haben.
Eine neue Major-Version dagegen enthält Änderungen, die die API inkompatibel mit der vorherigen Major-Version machen (sogenannte <strong>breaking changes</strong>).
Die Versionsnummern der Major- und Minor-Versionen sind Bestandteil der URL, mit der eine Anfrage an den Server gesendet wird.
Die Checkmk REST-API nutzt zurzeit nicht die dritte Stufe (<code>.Z</code>) des Semantic-Versioning-Standards für eine Patch-Version.</p></div>
<div class="paragraph"><p>Beachten Sie, dass die REST-API einer anderen Versionierung folgt als die Checkmk-Software.
Da eine neue Major-Version der API dann notwendig ist, wenn es inkompatible API-Änderungen gibt, passt das in der Regel nicht zum Release-Zyklus der Checkmk-Software.</p></div>
<div class="paragraph"><p>Trotzdem ist die Zuordnung der Versionen von API-Dokumentation und Checkmk-Software sehr einfach, wie Sie im nächsten Kapitel erfahren.</p></div>
</div>
<div class="sect2">
<h3 id="heading_access">
<span class="hidden-anchor sr-only" id="access"></span>2.2. Zugriff</h3>
<div class="paragraph"><p>Die REST-API-Dokumentation steht im HTML-Format zur Ansicht im Web-Browser bereit.</p></div>
<div class="paragraph"><p>In der Checkmk-GUI öffnen Sie die API-Dokumentation über die Navigationsleiste mit <span class="guihint">Help &gt; Developer resources &gt; REST API documentation.</span>
Die API-Dokumentation wird in einem neuen Browser-Fenster (bzw. Browser-Tab) angezeigt.
Wir gehen darauf im nächsten Kapitel genauer ein.</p></div>
<div class="imageblock"><div class="content"><img src="../images/restapi_help_menu.png" alt="Help-Menü in der Navigationsleiste." width="60%"></div></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>Sicher ist Ihnen aufgefallen, dass es im <span class="guihint">Help</span>-Menü noch weitere Einträge zur REST-API gibt.
Mit <span class="guihint">REST API introduction</span> können Sie diesen Artikel öffnen.
Mit <span class="guihint">REST API interactive GUI</span> öffnen Sie eine weitere Sicht auf die REST-API.
<span class="guihint">GUI</span> heißt dieser Eintrag, weil Ihnen nicht nur die REST-API-Funktionen angezeigt werden, sondern weil Sie aus dem Browser heraus direkt mit der API interagieren können, indem Sie z.B. Anfragen an den Server senden.
Wir stellen die REST-API GUI als Alternative zur Ausführung per Skript im <a href="#rest_api_gui">Kapitel zur REST-API GUI</a> später vor.</p></div></td>
</tr></table></div>
</div>
<div class="sect2">
<h3 id="heading_structure">
<span class="hidden-anchor sr-only" id="structure"></span>2.3. Struktur und Inhalt</h3>
<div class="paragraph"><p>Die API-Dokumentation nutzt ein responsives Web-Design mit 3 Bereichen:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/restapi_redoc.png" alt="API-Dokumentation im responsiven Web-Design mit drei Bereichen."></div></div>
<div class="ulist"><ul>
<li><p>Der linke Navigationsbereich dient der Orientierung, der Suche und dem schnellen Sprung zur genauen Beschreibung der Einträge im mittleren Bereich.
Das Inhaltsverzeichnis enthält für jeden API-Endpunkt einen Eintrag.
Ein Endpunkt bezeichnet per URL die Ressource, die die API zur Verfügung stellt (z.B. Hosts), zusammen mit der Methode, um auf die Ressource zuzugreifen (z.B. GET zur Anzeige eines Hosts).
Die Endpunkte sind in mehrere Ordner organisiert.</p></li>
<li><p>Der mittlere Inhaltsbereich enthält die harten Fakten der Dokumentation:
alle Informationen zur Definition einer Anfrage (mit Parametern, Wertebereichen, Default-Werten und Beschreibungen) und die zugehörigen Antworten (ebenfalls mit allen Details).
Die möglichen Antworten werden in unterschiedlichen Farben dargestellt, je nachdem ob der zurückgelieferte <a href="#http-status-code">HTTP-Status-Code</a> Erfolg oder einen Fehler signalisiert.</p></li>
<li><p>Der rechte Beispielbereich (<span class="guihint">Request samples</span>) zeigt für den im Inhaltsbereich ausgewählten Endpunkt die Methode und die URL, gefolgt von mehreren Beispielen zu Anfragen:
die Payload im JSON-Format (falls relevant für den Endpunkt) und Code-Beispiele z.B. für Curl, Httpie, Python Requests und Python Urllib.
Dann folgen die Antworten passend zum HTTP-Status.
Alle Code-Beispiele können über den Knopf <span class="guihint">Copy</span> in die Zwischenablage kopiert werden.</p></li>
</ul></div>
<div class="paragraph"><p>Der Navigationsbereich ist scroll-synchronisiert zu den anderen beiden Bereichen, das heißt, wenn Sie im Inhaltsbereich nach oben oder unten scrollen, scrollt der Navigationsbereich automatisch zum passenden Eintrag des Inhaltsverzeichnisses mit.</p></div>
<div class="paragraph"><p>Das responsive Web-Design sorgt dafür, dass in einem Browser-Fenster mit geringer Breite der Beispielbereich verschwindet (dafür werden dann die Beispiele unterhalb der zugehörigen Methode angezeigt) und der Navigationsbereich in ein Menü umgewandelt wird.</p></div>
<div class="paragraph"><p>In allen Bereichen finden Sie Inhalte, die Sie ein- und ausblenden können, zum Beispiel im Navigationsbereich die Einträge für die Endpunkte und im Inhaltsbereich verschachtelte Parameter.
Durch Anklicken von <span class="guihint">&gt;</span> oder <span class="guihint">Expand all</span> blenden Sie die verborgenen Inhalte ein und mit <span class="guihint">∨</span> oder <span class="guihint">Collapse all</span> wieder aus.</p></div>
<div class="paragraph"><p>Wie Sie die API-Dokumentation nutzen können, um aus den Informationen konkrete Anfragen zu erstellen, an den Checkmk-Server zu senden, ausführen zu lassen und den Erfolg zu kontrollieren:
all das erfahren Sie im nächsten Kapitel.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_using_the_api">
<span class="hidden-anchor sr-only" id="using_the_api"></span>3. Die API nutzen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_auth">
<span class="hidden-anchor sr-only" id="auth"></span>3.1. Authentifizierung</h3>
<div class="paragraph"><p>Um von einem Client aus die REST-API des Checkmk-Servers nutzen zu können, muss der Client seine Identität nachweisen.
Die REST-API unterstützt die folgenden Methoden zur Authentifizierung: <strong>Bearer</strong>, <strong>Webserver</strong> und <strong>Cookie</strong> — in dieser Rangfolge.
Das heißt zum Beispiel, dass bei einer erfolgreichen Authentifizierung mit Bearer keine der anderen Methoden mehr geprüft wird.</p></div>
<div class="sect3">
<h4 id="heading_bearerauth">
<span class="hidden-anchor sr-only" id="bearerauth"></span>Bearer- oder Header-Authentifizierung</h4>
<div class="paragraph"><p>„Bearer“ bezeichnet den Träger oder Inhaber einer Identität.
Der Client authentisiert sich mit den Zugangsdaten eines auf dem Checkmk-Server eingerichteten Benutzers.
Idealerweise ist dies der sogenannte <a href="glossar.html#automation_user">Automationsbenutzer</a>, der in Checkmk für die Ausführung von Aktionen über eine API vorgesehen ist.
Die Bearer-Authentifizierung wird für die Verwendung in Skripten empfohlen.</p></div>
<div class="paragraph"><p>Für die Authentifizierung benötigen Sie den Benutzernamen und das zugehörige, sogenannte <em>automation secret for machine accounts</em>, das heißt das Passwort des Automationsbenutzers.
Beide Informationen müssen im Header jeder Anfrage an den Checkmk-Server übermittelt werden.
Bei einer neu erstellten <a href="glossar.html#site">Instanz</a> ist der Benutzer <code>automation</code> bereits angelegt.
Sie finden ihn, wie andere Benutzer auch, unter <span class="guihint">Setup &gt; Users &gt; Users.</span>
Achten Sie darauf, dass die Rollen und die damit verbundenen Berechtigungen für den Automationsbenutzer so gesetzt sind, dass sie die Ausführung Ihrer Anfragen erlauben.</p></div>
<div class="paragraph"><p>Für die in diesem Artikel vorgestellten Skripten wird immer der standardmäßig eingerichtete Automationsbenutzer als Beispiel genommen.</p></div>
</div>
<div class="sect3">
<h4 id="heading_webserverauth">
<span class="hidden-anchor sr-only" id="webserverauth"></span>Webserver-Authentifizierung</h4>
<div class="paragraph"><p>Bei der Webserver-Authentifizierung nutzt die REST-API die HTTP-Authentifizierung, die für den Webserver konfiguriert ist („Basic“ oder „Digest“).</p></div>
<div class="paragraph"><p>Diese Authentifizierungsmethode ist gedacht für große Checkmk-Installationen mit speziellen Anforderungen, die durch den Einsatz und die Konfiguration von Software-Modulen für die Authentifizierung des Apache Webservers realisiert werden.
Wenn Sie die Webserver-Authentifizierung nutzen möchten, müssen Sie den Apache Webserver der Checkmk-Instanz selbst neu konfigurieren.</p></div>
</div>
<div class="sect3">
<h4 id="heading_cookieauth">
<span class="hidden-anchor sr-only" id="cookieauth"></span>Cookie-Authentifizierung</h4>
<div class="paragraph"><p>Die Cookie-Authentifizierung ist ein Spezialfall der Authentifizierung per API-Schlüssel.
Jeder Checkmk-Benutzer, der in Checkmk angemeldet ist und dadurch ein HTTP Cookie zugewiesen bekommen hat, kann die REST-API nutzen.
Die Cookie-Authentifizierung dient zum Ausprobieren und Testen mit der <a href="#rest_api_gui">REST-API GUI</a>.
Ob Anfragen ausgeführt werden können, hängt davon ab, ob Ihr Checkmk-Benutzerkonto die entsprechenden Berechtigungen besitzt.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_http-status-code">
<span class="hidden-anchor sr-only" id="http-status-code"></span>3.2. HTTP-Status-Code</h3>
<div class="paragraph"><p>Die REST-API gibt zu jeder Anfrage den <a href="https://de.wikipedia.org/wiki/HTTP-Statuscode" target="_blank">HTTP-Status-Code</a> zurück, mit dem Sie überprüfen können, ob die Anfrage erfolgreich war.
Alle für die Anfrage möglichen HTTP-Status-Codes werden in der API-Dokumentation gelistet.</p></div>
<div class="paragraph"><p>Beachten Sie, dass der HTTP-Status-Code nur Auskunft über die erfolgreiche Übermittlung der Anfrage gibt, aber nicht über die erfolgreiche Ausführung.
Ausgeführt werden die Befehle auf dem Checkmk-Server mit <a href="glossar.html#livestatus">Livestatus.</a>
Um sicher zu sein, dass die Anfrage über die REST-API auch wirklich das bewirkt, was Sie beabsichtigt haben, müssen Sie die Erfolgskontrolle selbst übernehmen.
Die API-Dokumentation, die Sie mit <span class="guihint">Help &gt; Developer resources &gt; REST API interactive GUI</span> öffnen können, enthält im Abschnitt „Queries through the REST API“ ein Beispiel eines Skripts für diese Aufgabe.</p></div>
</div>
<div class="sect2">
<h3 id="heading_testing">
<span class="hidden-anchor sr-only" id="testing"></span>3.3. Die API lokal testen</h3>
<div class="paragraph"><p>Um die REST-API zu testen, bietet es sich an, die Anfragen direkt vom Checkmk-Server aus zu stellen, das heißt, in diesem Fall befinden sich der Client, der die Anfrage sendet, und der Server, der diese empfängt, auf dem gleichen Rechner.
Wenn Sie als Instanzbenutzer arbeiten, können Sie zudem lokale Variablen wie z.B. <code>$OMD_SITE</code> verwenden, die auf den Namen der Instanz verweist.</p></div>
<div class="paragraph"><p>In den folgenden einfachen Beispielen nutzen wir den in der API-Dokumentation enthaltenen Beispiel-Code für das Kommandozeilenprogramm Curl, das es ermöglicht, ohne Benutzerinteraktion Daten von oder zu einem Server zum Beispiel per HTTP zu übertragen.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>Insbesondere bei komplexen Anfragen kann es vorkommen, dass die Curl-Beispiele Inkonsistenzen enthalten und daher nicht immer verlässlich sind.
Mit <a href="https://httpie.io/" target="_blank">Httpie</a> steht eine Alternative zur Verfügung, die konsistent, leicht zu verstehen und gut für die Verwendung in Skripten geeignet ist.</p></div></td>
</tr></table></div>
<div class="paragraph"><p>Das <code>curl</code>-Kommando wird innerhalb eines Bash-Skripts ausgeführt.
Zur Vorbereitung erstellen Sie für jede der im nächsten Abschnitt auszuführenden Anfragen jeweils eine Skript-Datei, in die später der Beispiel-Code kopiert wird:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>touch<span class="tok-w"> </span>create_host.sh<span class="tok-w"> </span>service_discovery.sh<span class="tok-w"> </span>show_pending_changes.sh<span class="tok-w"> </span>activate_changes.sh
<span class="tok-gp">OMD[mysite]:~$ </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>create_host.sh<span class="tok-w"> </span>service_discovery.sh<span class="tok-w"> </span>show_pending_changes.sh<span class="tok-w"> </span>activate_changes.sh</code></pre></div></div>
<div class="paragraph"><p>Die REST-API gibt alle Antworten im JSON-Format einzeilig aus.
Da eine formatierte Ausgabe die Lesbarkeit doch erheblich erleichtert, wird in den folgenden Beispielen die einzeilige Ausgabe mehrzeilig formatiert dargestellt.
Zur Aufbereitung des JSON-Formats gibt es diverse Websites und Werkzeuge, zum Beispiel den Kommandozeilen-JSON-Prozessor <code>jq</code>.</p></div>
<div class="paragraph"><p>Bevor es los geht, sammeln Sie einige grundlegenden Informationen, die spezifisch für Ihre Checkmk-Konfiguration sind:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Beispielwert</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HOST_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des Checkmk-Servers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITE_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name der Checkmk-Instanz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USERNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>automation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des Automationsbenutzers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PASSWORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>theautomationsecret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passwort des Automationsbenutzers</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Diese Variablen werden im Beispiel-Code verwendet und müssen von Ihnen geändert werden, bevor Sie eine Anfrage absenden.
In der obigen Tabelle finden Sie auch die Beispielwerte, die im Folgenden verwendet werden.</p></div>
</div>
<div class="sect2">
<h3 id="heading_making_requests">
<span class="hidden-anchor sr-only" id="making_requests"></span>3.4. Anfragen stellen per Skript</h3>
<div class="paragraph"><p>Wir werden nun den Umgang mit der REST-API an einem übersichtlichen Beispiel demonstrieren:
Sie erstellen einen Host mit seinen Services mit insgesamt vier Anfragen.
Prinzipiell gehen Sie dabei genauso vor, wie Sie es auch mit der Checkmk-GUI tun würden:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Einen Host erstellen</p></li>
<li><p>Eine Service-Erkennung auf dem Host durchführen</p></li>
<li><p>Die ausstehenden Änderungen anzeigen</p></li>
<li><p>Die Änderungen aktivieren</p></li>
</ol></div>
<div class="sect3">
<h4 id="heading_create_host">
<span class="hidden-anchor sr-only" id="create_host"></span>Einen Host erstellen</h4>
<div class="paragraph"><p>Öffnen Sie die API-Dokumentation und suchen Sie im linken Navigationsbereich den Eintrag zum Erstellen eines Hosts (<span class="guihint">Create a host</span>):</p></div>
<div class="imageblock border"><div class="content"><img src="../images/restapi_redoc_2pane.png" alt="Der Eintrag in der API-Dokumentation zum Erstellen eines Hosts."></div></div>
<div class="paragraph"><p>Im mittleren Bereich sehen Sie die Details zur gewählten Anfrage: welche HTTP-Authentifizierung gefordert ist (diese ist identisch für alle Anfragen über die REST-API) und die notwendigen und optionalen Parameter. Notwendig (<em>required</em>) sind der Name des Hosts und der Ordner, in dem er angelegt werden soll.
Standardmäßig wird der Host im Hauptordner (<span class="guihint">Main</span>) erstellt.
Falls Sie den Host in einem anderen Ordner anlegen wollen, müssen Sie sich eventuell zuerst über eine andere API-Anfrage (<span class="guihint">Show all folders</span>) die existierenden Ordner anzeigen lassen, um die ID des gewünschten herauszufinden.</p></div>
<div class="paragraph"><p>In unserem Beispiel soll der Host <code>myhost123</code> mit der IP-Adresse <code>192.168.0.42</code> im Hauptordner erstellt werden.</p></div>
<div class="paragraph"><p>In der API-Dokumentation klicken Sie im rechten Beispielbereich auf den Knopf <span class="guihint">curl</span> und dann auf <span class="guihint">Copy</span> um den Curl-Beispiel-Code in die Zwischenablage zu kopieren.
Öffnen Sie das vorbereitete Skript <code>create_host.sh</code> und fügen Sie den Inhalt der Zwischenablage ein:</p></div>
<div class="listingblock">
<div class="title">create_host.sh</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash

# NOTE: We recommend all shell users to use the "httpie" examples instead.
#       `curl` should not be used for writing large scripts.
#       This code is provided for debugging purposes only.

HOST_NAME="localhost"
SITE_NAME="mysite"
PROTO="http" #[http|https]
API_URL="$PROTO://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"

USERNAME="automation"
PASSWORD="test123"

curl \
  --request POST \
  --write-out "\nxxx-status_code=%{http_code}\n" \
  --header "Authorization: Bearer $USERNAME $PASSWORD" \
  --header "Accept: application/json" \
  --header "Content-Type: application/json" \
  --data '{
          "attributes": {
            "ipaddress": "192.168.0.123"
          },
          "folder": "/",
          "host_name": "example.com"
        }' \
  "$API_URL/domain-types/host_config/collections/all"</code></pre></div>
</div>
<div class="paragraph"><p>Im ersten Teil des Beispiel-Codes finden Sie die Umgebungsvariablen, dann folgt das <code>curl</code>-Kommando mit der POST-Methode auf die Ressource, deren URL in der letzten Zeile steht.
Durch die Option <code>-write-out</code> wird abschließend eine Zeile mit dem <a href="#http-status-code">HTTP-Status-Code</a> ausgegeben.
Nach den Header-Zeilen (eine davon definiert die HTTP-Authentifizierung) folgt der Datenteil, in dem die Parameter für den neuen Host festgelegt werden.</p></div>
<div class="paragraph"><p>Beachten Sie, dass der Curl-Beispiel-Code mehr Parameter enthalten kann, als Sie im konkreten Fall vielleicht benötigen.
Für unser Beispiel ist dies aber nicht der Fall, und Sie müssen nur die beiden vorhandenen Parameter <code>host_name</code> und <code>ipaddress</code> ändern.</p></div>
<div class="paragraph"><p>Passen Sie nun den Beispiel-Code an, so dass das Resultat ungefähr so aussieht:</p></div>
<div class="listingblock">
<div class="title">create_host.sh</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash

# NOTE: We recommend all shell users to use the "httpie" examples instead.
#       `curl` should not be used for writing large scripts.
#       This code is provided for debugging purposes only.

<span class="hll">HOST_NAME="myserver"
</span><span class="hll">SITE_NAME="mysite"
</span>PROTO="http" #[http|https]
API_URL="$PROTO://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"

<span class="hll">USERNAME="automation"
</span><span class="hll">PASSWORD="theautomationsecret"
</span>
curl \
  --request POST \
  --write-out "\nxxx-status_code=%{http_code}\n" \
  --header "Authorization: Bearer $USERNAME $PASSWORD" \
  --header "Accept: application/json" \
  --header "Content-Type: application/json" \
  --data '{
          "attributes": {
<span class="hll">            "ipaddress": "192.168.0.42"
</span>          },
          "folder": "/",
<span class="hll">          "host_name": "myhost123"
</span>        }' \
  "$API_URL/domain-types/host_config/collections/all"</code></pre></div>
</div>
<div class="paragraph"><p>Führen Sie das Skript aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>./create_host.sh
<span class="tok-go">{</span>
<span class="tok-go">  "links":[</span>
<span class="tok-go">    {</span>
<span class="tok-go">      "domainType":"link",</span>
<span class="tok-go">      "rel":"self",</span>
<span class="tok-go">      "href":"http://myserver/mysite/check_mk/api/1.0/objects/host_config/myhost123",</span>
<span class="tok-go">      "method":"GET",</span>
<span class="tok-go">      "type":"application/json"</span>
<span class="tok-go">    },</span>
<span class="tok-go">...</span>
<span class="tok-go">    {</span>
<span class="tok-go">      "domainType":"link",</span>
<span class="tok-go">      "rel":"urn:com.checkmk:rels/folder_config",</span>
<span class="tok-go">      "href":"http://myserver/mysite/check_mk/api/1.0/objects/folder_config/~",</span>
<span class="tok-go">      "method":"GET",</span>
<span class="tok-go">      "type":"application/json",</span>
<span class="tok-go">      "title":"The folder config of the host."</span>
<span class="tok-go">    }</span>
<span class="tok-go">  ],</span>
<span class="tok-go">  "domainType":"host_config",</span>
<span class="hll"><span class="tok-go">  "id":"myhost123",</span>
</span><span class="hll"><span class="tok-go">  "title":"myhost123",</span>
</span><span class="tok-go">  "members":{</span>

<span class="tok-go">  },</span>
<span class="tok-go">  "extensions":{</span>
<span class="hll"><span class="tok-go">    "folder":"/",</span>
</span><span class="tok-go">    "attributes":{</span>
<span class="hll"><span class="tok-go">      "ipaddress":"192.168.0.42",</span>
</span><span class="tok-go">      "meta_data":{</span>
<span class="tok-go">        "created_at":"2024-07-03T12:55:29.165920+00:00",</span>
<span class="tok-go">        "updated_at":"2024-07-03T12:55:29.174520+00:00",</span>
<span class="tok-go">        "created_by":"automation"</span>
<span class="tok-go">      }</span>
<span class="tok-go">    },</span>
<span class="tok-go">    "effective_attributes":null,</span>
<span class="tok-go">    "is_cluster":false,</span>
<span class="tok-go">    "is_offline":false,</span>
<span class="tok-go">    "cluster_nodes":null</span>
<span class="tok-go">  }</span>
<span class="tok-go">}</span>
<span class="hll"><span class="tok-go">xxx-status_code=200</span>
</span></code></pre></div></div>
<div class="paragraph"><p>Zur Erinnerung: Die eine, durch die geschweiften Klammern begrenzte Zeile im JSON-Format wird hier mehrzeilig dargestellt.</p></div>
<div class="paragraph"><p>Die API liefert unter <code>links</code> eine Auswahl von (im obigen Beispiel gekürzten) Anfragen zurück, die auf den gerade erstellten Host angewendet werden können — wie es sich für eine REST-API gehört.
Abschließend liefert die API ID und Namen (<code>title</code>) des erstellten Hosts, unter <code>folder</code> den Ordner (<code>/</code> für den Hauptordner) und unter <code>attributes</code> die dem Host zugewiesenen Attribute inklusive der IP-Adresse.</p></div>
<div class="paragraph"><p>Als letzte wird die Zeile mit dem <a href="#http-status-code">HTTP-Status-Code</a> ausgegeben.
Dabei steht die <code>200</code> für <code>OK</code> und bedeutet, dass die Aktion erfolgreich durchgeführt wurde.</p></div>
</div>
<div class="sect3">
<h4 id="heading_service_discovery">
<span class="hidden-anchor sr-only" id="service_discovery"></span>Eine Service-Erkennung auf dem Host durchführen</h4>
<div class="paragraph"><p>Nachdem der Host <code>myhost123</code> erstellt wurde, können die Services ermittelt werden.
Damit eine <a href="glossar.html#service_discovery">Service-Erkennung</a> auch tatsächlich die erwarteten Services liefert, müssen Sie zuvor auf Linux- und Windows-Hosts die zugehörigen <a href="glossar.html#agent">Agenten</a> installieren und registrieren.</p></div>
<div class="paragraph"><p>Für die Ausführung einer Service-Erkennung via REST-API wählen Sie in der API-Dokumentation den entsprechenden Eintrag aus (<span class="guihint">Execute a service discovery on a host</span>), kopieren den Beispiel-Code in die dafür erstellte Skript-Datei und passen ihn an.</p></div>
<div class="paragraph"><p>Den ersten Teil mit den Umgebungsvariablen können Sie 1:1 aus dem vorherigen Beispiel übernehmen.
Im <code>curl</code>-Kommando ändern Sie den Namen des Hosts zu <code>myhost123</code> und bei Bedarf mit dem Parameter <code>mode</code> die Art der Service-Erkennung.</p></div>
<div class="listingblock">
<div class="title">service_discovery.sh</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash

# NOTE: We recommend all shell users to use the "httpie" examples instead.
#       `curl` should not be used for writing large scripts.
#       This code is provided for debugging purposes only.

<span class="hll">HOST_NAME="myserver"
</span><span class="hll">SITE_NAME="mysite"
</span>PROTO="http" #[http|https]
API_URL="$PROTO://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"

<span class="hll">USERNAME="automation"
</span><span class="hll">PASSWORD="theautomationsecret"
</span>
curl \
  --request POST \
  --write-out "\nxxx-status_code=%{http_code}\n" \
  --header "Authorization: Bearer $USERNAME $PASSWORD" \
  --header "Accept: application/json" \
  --header "Content-Type: application/json" \
  --data '{
<span class="hll">          "host_name": "myhost123",
</span><span class="hll">          "mode": "refresh"
</span>        }' \
  "$API_URL/domain-types/service_discovery_run/actions/start/invoke"</code></pre></div>
</div>
<div class="paragraph"><p>Führen Sie auch dieses Skript aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>./service_discovery.sh

<span class="tok-go">xxx-status_code=302</span></code></pre></div></div>
<div class="paragraph"><p>Der HTTP-Status-Code <code>302</code> bedeutet, dass der Hintergrundauftrag (<em>background job</em>) für die Service-Erkennung initialisiert wurde.</p></div>
</div>
<div class="sect3">
<h4 id="heading_show_pending_changes">
<span class="hidden-anchor sr-only" id="show_pending_changes"></span>Die ausstehenden Änderungen anzeigen</h4>
<div class="paragraph"><p>Vor der Aktivierung der Änderungen ist noch ein Zwischenschritt notwendig: die Anzeige der ausstehenden Änderungen mit der Anfrage <span class="guihint">Show all pending changes.</span>
Zusätzlich zu den Änderungen, die sich angesammelt haben, liefert die REST-API dabei das HTTP ETag (<em>entity tag</em>), das Sie benötigen, um diese Änderungen zu aktivieren.
Die Änderung eines Objekts via REST-API erfolgt nicht über die ID oder den Titel des Objekts.
Stattdessen wird das generierte ETag genutzt, mit dem verhindert werden soll, dass mehrere konkurrierende Anfragen Werte desselben Objekts gegenseitig überschreiben.</p></div>
<div class="paragraph"><p>Das ETag wird im Antwort-Header (<em>response header</em>) zurückgeliefert.
Damit dieser Header angezeigt wird, erweitern Sie den Beispiel-Code für diese Anfrage, indem Sie <code>curl</code> mit der Option -i (für <em>include response headers</em>) aufrufen.
Die geänderten Zeilen sind auch im folgenden Beispiel wieder markiert:</p></div>
<div class="listingblock">
<div class="title">show_pending_changes.sh</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash

# NOTE: We recommend all shell users to use the "httpie" examples instead.
#       `curl` should not be used for writing large scripts.
#       This code is provided for debugging purposes only.

<span class="hll">HOST_NAME="myserver"
</span><span class="hll">SITE_NAME="mysite"
</span>PROTO="http" #[http|https]
API_URL="$PROTO://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"

<span class="hll">USERNAME="automation"
</span><span class="hll">PASSWORD="theautomationsecret"
</span>
curl \
<span class="hll">  -i \
</span>  --request GET \
  --write-out "\nxxx-status_code=%{http_code}\n" \
  --header "Authorization: Bearer $USERNAME $PASSWORD" \
  --header "Accept: application/json" \
  "$API_URL/domain-types/activation_run/collections/pending_changes"</code></pre></div>
</div>
<div class="paragraph"><p>Nach der Ausführung des Skripts werden in der Ausgabe nun zuerst die Header-Zeilen gezeigt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>./show_pending_changes.sh
<span class="tok-go">HTTP/1.1 200 OK</span>
<span class="tok-go">Date: Wed, 03 Jul 2024 13:23:26 GMT</span>
<span class="tok-go">...</span>
<span class="hll"><span class="tok-go">ETag: "2156db7032754ec778c75123ec12cdd897592b0a574760fa0963a1782c22472c"</span>
</span><span class="tok-go">...</span>
<span class="tok-go">Content-Type: application/json</span>

<span class="tok-go">{</span>
<span class="tok-go">...</span>
<span class="tok-go">  "domainType":"activation_run",</span>
<span class="tok-go">  "value":[</span>
<span class="tok-go">    {</span>
<span class="tok-go">      "id":"8cb85882-cdae-4d43-b5af-362b4c1cb717",</span>
<span class="hll"><span class="tok-go">      "user_id":"automation",</span>
</span><span class="hll"><span class="tok-go">      "action_name":"create-host",</span>
</span><span class="hll"><span class="tok-go">      "text":"Created new host myhost123.",</span>
</span><span class="tok-go">      "time":"2024-07-03T13:05:07.466406+00:00"</span>
<span class="tok-go">    }</span>
<span class="tok-go">  ]</span>
<span class="tok-go">}</span>
<span class="hll"><span class="tok-go">xxx-status_code=200</span>
</span></code></pre></div></div>
<div class="paragraph"><p>Die Ausgabe ist gekürzt und markiert sind nur die wichtigen Zeilen: die Header-Zeile mit dem ETag, die Attribute der einen ausstehenden Änderung zum Erstellen eines Hosts und der HTTP-Status-Code für <code>OK</code>.
Das ETag benötigen Sie im nächsten und letzten Schritt.</p></div>
</div>
<div class="sect3">
<h4 id="heading_activate_changes">
<span class="hidden-anchor sr-only" id="activate_changes"></span>Die Änderungen aktivieren</h4>
<div class="paragraph"><p>Zum Abschluss müssen die Änderungen aktiviert werden.
Die passende Anfrage heißt <span class="guihint">Activate pending changes.</span></p></div>
<div class="paragraph"><p>Im <code>curl</code>-Kommando ändern Sie die Header-Zeile <code>If-Match</code> und setzen Sie dort das im vorherigen Abschnitt ausgelesene ETag ein.
Im Datenteil geben Sie für den Parameter <code>sites</code> den Namen der Instanz ein — dort, wo die Änderungen aktiviert werden sollen:</p></div>
<div class="listingblock">
<div class="title">activate_changes.sh</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash

# NOTE: We recommend all shell users to use the "httpie" examples instead.
#       `curl` should not be used for writing large scripts.
#       This code is provided for debugging purposes only.

<span class="hll">HOST_NAME="myserver"
</span><span class="hll">SITE_NAME="mysite"
</span>PROTO="http" #[http|https]
API_URL="$PROTO://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"

<span class="hll">USERNAME="automation"
</span><span class="hll">PASSWORD="1234567890"
</span>
curl -L \
  --write-out "\nxxx-status_code=%{http_code}\n" \
  --header "Authorization: Bearer $USERNAME $PASSWORD" \
  --header "Accept: application/json" \
<span class="hll">  --header "If-Match: "2156db7032754ec778c75123ec12cdd897592b0a574760fa0963a1782c22472c"" \
</span>  --header "Content-Type: application/json" \
  --data '{
          "force_foreign_changes": false,
          "redirect": false,
          "sites": [
<span class="hll">            "mysite"
</span>          ]
        }' \
  "$API_URL/domain-types/activation_run/actions/activate-changes/invoke"</code></pre></div>
</div>
<div class="paragraph"><p>Führen Sie das Skript aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>./activate_changes.sh
<span class="tok-go">{</span>
<span class="tok-go">  "links":[</span>
<span class="tok-go">    {</span>
<span class="tok-go">      "domainType":"link",</span>
<span class="tok-go">      "rel":"self",</span>
<span class="tok-go">      "href":"http://myserver/mysite/check_mk/api/1.0/objects/activation_run/eddbef05-438b-4108-9a02-0d010da2b290",</span>
<span class="tok-go">      "method":"GET",</span>
<span class="tok-go">      "type":"application/json"</span>
<span class="tok-go">    },</span>
<span class="tok-go">    {</span>
<span class="tok-go">      "domainType":"link",</span>
<span class="tok-go">      "rel":"urn:com.checkmk:rels/wait-for-completion",</span>
<span class="tok-go">      "href":"http://myserver/mysite/check_mk/api/1.0/objects/activation_run/eddbef05-438b-4108-9a02-0d010da2b290/actions/wait-for-completion/invoke",</span>
<span class="tok-go">      "method":"GET",</span>
<span class="tok-go">      "type":"application/json"</span>
<span class="tok-go">    }</span>
<span class="tok-go">  ],</span>
<span class="tok-go">  "domainType":"activation_run",</span>
<span class="tok-go">  "id":"eddbef05-438b-4108-9a02-0d010da2b290",</span>
<span class="hll"><span class="tok-go">  "title":"Activation status: In progress.",</span>
</span><span class="tok-go">  "members":{</span>

<span class="tok-go">  },</span>
<span class="tok-go">  "extensions":{</span>
<span class="tok-go">    "sites":[</span>
<span class="tok-go">      "mysite"</span>
<span class="tok-go">    ],</span>
<span class="tok-go">    "is_running":true,</span>
<span class="tok-go">    "force_foreign_changes":false,</span>
<span class="tok-go">    "time_started":"2024-07-03T13:45:07.031741+00:00",</span>
<span class="tok-go">    "changes":[</span>
<span class="tok-go">      {</span>
<span class="tok-go">        "id":"8cb85882-cdae-4d43-b5af-362b4c1cb717",</span>
<span class="tok-go">        "user_id":"automation",</span>
<span class="tok-go">        "action_name":"create-host",</span>
<span class="tok-go">        "text":"Created new host myhost123.",</span>
<span class="tok-go">        "time":"2024-07-03T13:05:07.466406+00:00"</span>
<span class="tok-go">      }</span>
<span class="tok-go">    ]</span>
<span class="tok-go">  }</span>
<span class="tok-go">}</span>
<span class="hll"><span class="tok-go">xxx-status_code=200</span>
</span></code></pre></div></div>
<div class="paragraph"><p>Der Text im <code>title</code> zeigt, dass die Aktivierung gestartet wurde.
Wieder schlägt die REST-API unter <code>links</code> zwei sinnvolle Folgeanfragen vor:
um den Status dieser Aktivierung abzufragen und auf deren Abschluss zu warten.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_rest_api_gui">
<span class="hidden-anchor sr-only" id="rest_api_gui"></span>3.5. Anfragen stellen per REST-API GUI</h3>
<div class="paragraph"><p>Mit der REST-API <strong>GUI</strong> erhalten Sie eine neue Perspektive auf die API:
Sie können mit dieser GUI aus dem Browser heraus direkt mit der API interagieren, indem Sie Anfragen per Curl-Kommando an den Server senden und postwendend die Antworten sehen.
Dafür müssen Sie in der API GUI auf die Code-Beispiele der REST-API-Dokumentation verzichten:
beide Sichten sind eben für ihren Anwendungszweck optimiert.</p></div>
<div class="paragraph"><p>Die REST-API GUI wird aus der gleichen Quelle wie die REST-API-Dokumentation generiert — dem OpenAPI-Dokument — und bietet daher stets die zur API passenden Funktionen an.</p></div>
<div class="paragraph"><p>Sie öffnen die API GUI in der Checkmk-GUI über die Navigationsleiste im Menü <span class="guihint">Help &gt; Developer resources &gt; REST API interactive GUI.</span>
Die API GUI wird in einem neuen Browser-Fenster (bzw. Browser-Tab) angezeigt:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/restapi_swaggerui.png" alt="Der Eintrag in der REST API GUI zum Erstellen eines Hosts."></div></div>
<div class="paragraph"><p>Im Folgenden skizzieren wir, wie Sie die erste Anfrage aus dem obigen Beispiel (einen Host erstellen) statt per Skript auch mit der REST-API GUI ausführen können:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Authentisieren:
Die REST-API GUI bietet nach dem Anklicken des Knopfs <span class="guihint">Authorize</span> (auf der rechten Seite über dem Eintrag des ersten Endpunkt-Ordners) eine Dialogbox zur Eingabe der Authentifizierungsinformationen.
Sofern Sie als Instanzbenutzer angemeldet sind, brauchen Sie dort aber <strong>keine</strong> Eingaben zu machen, da Sie als Checkmk-Benutzer per <a href="#auth">Cookie-Authentifizierung</a> berechtigt zur Nutzung der REST-API sind.</p></li>
<li><p>Endpunkt auswählen:
Wählen Sie im Ordner <span class="guihint">Hosts</span> den Endpunkt <span class="guihint">Create a host</span> aus und klicken Sie <span class="guihint">Try it out</span>.</p></li>
<li><p>Parameterwerte eingeben:
Überschreiben Sie im <span class="guihint">Request body</span> die Beispielwerte für <code>host_name</code> und <code>ipaddress</code>.</p></li>
<li><p>Anfrage senden:
Klicken Sie <span class="guihint">Execute</span>.</p></li>
<li><p>Antwort überprüfen:
Unter <span class="guihint">Responses</span> sehen Sie zunächst das gesendete Curl-Kommando und die URL des Endpunkts.
Anschließend wird unter <span class="guihint">Server response</span> die Antwort angezeigt mit HTTP-Status-Code und in <span class="guihint">Responses</span> die (mehrzeilig formatierte) REST-API Antwort.</p></li>
</ol></div>
<div class="paragraph"><p>Die REST-API GUI bietet Ihnen also die Möglichkeit, schnell und unkompliziert die Funktionen der API auszuprobieren und sich mit den Details der Eingabewerte und mit konkreten Antworten vertraut zu machen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_error_correction">
<span class="hidden-anchor sr-only" id="error_correction"></span>3.6. Fehler korrigieren</h3>
<div class="paragraph"><p>Im Gegensatz zu den bisher gezeigten Ausgaben bei erfolgreichen Kommandos per Skript, zeigt Ihnen die REST-API Fehler in der folgenden Art an:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">{</span>
<span class="tok-go">  "title": "The operation has failed.",</span>
<span class="tok-go">  "status": 401,</span>
<span class="tok-go">  "detail": "There are changes from other users and foreign changes are not allowed in this API call."</span>
<span class="tok-go">}</span>
<span class="tok-go">xxx-status_code=401</span></code></pre></div></div>
<div class="paragraph"><p>Je nach Fehler können die in der Ausgabe angezeigten Parameter unterschiedlich sein.
Immer erhalten Sie aber in <code>status</code> den <a href="#http-status-code">HTTP-Status-Code</a> und in <code>title</code> eine Kurzbeschreibung der Fehlerursache.</p></div>
<div class="paragraph"><p>In den meisten Fällen zeigt Ihnen <code>detail</code>, wie der Name schon vermuten lässt, detaillierte Informationen an.
Im obigen Beispiel erfahren Sie, dass es zwar ausstehende Änderungen in Checkmk gibt, diese aber von einem anderen Benutzer veranlasst wurden.
Über die API können standardmäßig nur Änderungen aktiviert werden, die auch über die API durchgeführt wurden.</p></div>
<div class="paragraph"><p>Auch im nächsten Beispiel stecken die hilfreichen in den detaillierten Informationen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">{</span>
<span class="tok-go">  "title":"Bad Request",</span>
<span class="tok-go">  "status":400,</span>
<span class="tok-go">  "detail":"These fields have problems: host_name",</span>
<span class="tok-go">  "fields":{</span>
<span class="tok-go">    "host_name":[</span>
<span class="tok-go">      "'my/host123' does not match pattern '^[-0-9a-zA-Z_.]+\\\\Z'."</span>
<span class="tok-go">    ]</span>
<span class="tok-go">  }</span>
<span class="tok-go">}</span>
<span class="tok-go">xxx-status_code=400</span></code></pre></div></div>
<div class="paragraph"><p>Hier liegt das Problem darin, dass ein Parameterwert sich nicht an den gültigen Wertebereich hält (wegen eines Schrägstrichs im Host-Namen).</p></div>
<div class="paragraph"><p>Die Anzahl der möglichen Fehler ist natürlich sehr viel länger als die beiden, die wir vorgestellt haben.
An den gezeigten Beispielen sehen Sie aber, dass die REST-API in der Ausgabe meist genügend Informationen über die Ursache liefert und Ihnen so Anhaltspunkte für den Einstieg in die Analyse und die Fehlerbehebung gibt.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_securing">
<span class="hidden-anchor sr-only" id="securing"></span>4. Die API absichern</h2>
<div class="sectionbody">
<div class="paragraph"><p>Da beim Zugriff über die REST-API sensible Daten übertragen  und — je nach Berechtigung des Automationsbenutzers — umfassende Änderungen an Checkmk durchgeführt werden können, sollten Sie den Zugriff entsprechend absichern.
Hier finden Sie einige der Möglichkeiten:</p></div>
<div class="ulist"><ul>
<li><p><a href="omd_https.html">Checkmk über HTTPS</a>:
Nutzen Sie die API ausschließlich über das Hypertext Transfer Protocol Secure (HTTPS), da Benutzername, Passwort und auch Konfigurationsdaten sonst im Klartext im Netz übertragen werden.</p></li>
<li><p>Geben Sie dem Automationsbenutzer ein Passwort mit einer ausreichenden Länge.
Da das Passwort in der Regel nur in einem Skript hinterlegt wird, können Sie problemlos ein sehr langes vergeben.</p></li>
<li><p>Achten Sie auf das Berechtigungskonzept zu den Skripten, mit denen Sie die Anfragen an die API stellen.
In den Skripten können sensible Daten, wie Konfigurationsdaten, Passwörter usw. enthalten sein.
Stellen Sie daher sicher, dass ausschließlich berechtigte Benutzer und Gruppen diese Skripte lesen können.</p></li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_examples">
<span class="hidden-anchor sr-only" id="examples"></span>5. Beispiele mit REST-API-Anfragen</h2>
<div class="sectionbody">
<div class="paragraph"><p>In diesem Kapitel finden Sie Beispiele, die zeigen, wie Sie mit Hilfe der REST-API häufig benötigte Aktionen ausführen können.
Die Beispiele orientieren sich erneut an dem Beispiel-Code für das Kommandozeilenprogramm <em>Curl.</em>
Im Unterschied zum Vorgehen im Kapitel <a href="#using_the_api">Die API nutzen</a> werden die Anfragen jedoch nicht per Skript sondern als <code>curl</code>-Befehle auf der Kommandozeile abgesetzt.
Dadurch können Sie die Beispiele gleich ausprobieren — nachdem Sie sie auf die bei Ihnen vorhandene Umgebung angepasst haben.</p></div>
<div class="paragraph"><p>Um die Befehle noch übersichtlich darstellen zu können, haben wir aus dem Beispiel-Code nur die für die Befehlsausführung absolut notwendigen Zeilen übernommen.</p></div>
<div class="paragraph"><p>So wie der Beispiel-Code in der API-Dokumentation enthalten auch die Beispiele in diesem Kapitel Variablen:
um die Basis-URL für die REST-API auf Ihrem Checkmk-Server zusammenzubauen und die Zugangsdaten des <a href="glossar.html#automation_user">Automationsbenutzers</a> für die genutzte <a href="#bearerauth">Bearer-Authentifizierung</a> festzulegen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Beispielwert</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HOST_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des Checkmk-Servers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITE_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name der Checkmk-Instanz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>API_URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://$HOST_NAME/$SITE_NAME/check_mk/api/1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basis-URL der REST-API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USERNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>automation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des Automationsbenutzers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PASSWORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>theautomationsecret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passwort des Automationsbenutzers</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Bevor Sie die <code>curl</code>-Kommandos absetzen, können Sie die Variablen mit den folgenden Kommandos in der Shell auf Ihre Umgebung anpassen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span><span class="tok-nv">HOST_NAME</span><span class="tok-o">=</span><span class="tok-s2">"myserver"</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-nv">SITE_NAME</span><span class="tok-o">=</span><span class="tok-s2">"mysite"</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-nv">API_URL</span><span class="tok-o">=</span><span class="tok-s2">"http://</span><span class="tok-nv">$HOST_NAME</span><span class="tok-s2">/</span><span class="tok-nv">$SITE_NAME</span><span class="tok-s2">/check_mk/api/1.0"</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-nv">USERNAME</span><span class="tok-o">=</span><span class="tok-s2">"automation"</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-nv">PASSWORD</span><span class="tok-o">=</span><span class="tok-s2">"theautomationsecret"</span><span class="tok-p">;</span></code></pre></div></div>
<div class="sect2">
<h3 id="heading_examples_hosts_folders">
<span class="hidden-anchor sr-only" id="examples_hosts_folders"></span>5.1. Hosts und Ordner</h3>
<div class="paragraph"><p>Die in diesem Kapitel beschriebenen Anfragen finden Sie in der API-Dokumentation in den Endpunktordnern <span class="guihint">Hosts</span> und <span class="guihint">Folders</span>.
Die in der API-Dokumentation enthaltenen Titel der jeweiligen Endpunkte stehen in den folgenden Überschriften in Klammern.</p></div>
<h3 id="restapi_show_all_folders" class="discrete">Alle Ordner anzeigen (Show all folders)</h3>
<div class="paragraph"><p>Hier werden <em>alle</em> Ordner im Setup angezeigt — rekursiv ausgehend vom Hauptordner <span class="guihint">Main</span> — <em>ohne</em> Auflistung der enthaltenen Hosts:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span>-G<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>GET<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data-urlencode<span class="tok-w"> </span><span class="tok-c1"><mark>'parent=~'</mark> \</span>
--data-urlencode<span class="tok-w"> </span><span class="tok-c1"><mark>'recursive=true'</mark> \</span>
--data-urlencode<span class="tok-w"> </span><span class="tok-c1"><mark>'show_hosts=false'</mark> \</span>
<span class="tok-s2">"</span><span class="tok-nv">$API_URL</span><span class="tok-s2">/domain-types/folder_config/collections/all"</span></code></pre></div></div>
<h3 id="restapi_show_all_hosts_in_a_folder" class="discrete">Alle Hosts eines Ordners anzeigen (Show all hosts in a folder)</h3>
<div class="paragraph"><p>Hier werden die Hosts im Unterordner <span class="guihint">Main &gt; Linux</span> angefordert:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>GET<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-s2">"</span><span class="tok-nv">$API_URL</span><span class="tok-s2">/objects/folder_config/<mark>~linux</mark>/collections/hosts"</span></code></pre></div></div>
<h3 id="restapi_create_a_folder" class="discrete">Ordner erstellen (Create a folder)</h3>
<div class="paragraph"><p>Hier wird in <span class="guihint">Main &gt; Linux</span> ein Unterordner <span class="guihint">Production Hosts</span> erstellt — im Dateisystem als Verzeichnis <code>production_hosts</code>.
Dem neuen Ordner wird dabei das <a href="glossar.html#host_tag">Host-Merkmal</a> <span class="guihint">Productive system</span> aus der <a href="host_tags.html#predefined_tags">vordefinierten Host-Merkmalsgruppe</a> <span class="guihint">Criticality</span> zugewiesen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w">     </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">    "attributes": {</span>
<span class="tok-go">        "tag_criticality": "prod"</span>
<span class="tok-go">    },</span>
<span class="tok-go">    "name": "production_hosts",</span>
<span class="tok-go">    "parent": "~linux",</span>
<span class="tok-go">    "title": "Production Hosts"</span>
<span class="tok-go">    }' \</span>
<span class="tok-go">"$API_URL/domain-types/folder_config/collections/all"</span></code></pre></div></div>
<h3 id="restapi_create_a_host" class="discrete">Host erstellen (Create a host)</h3>
<div class="paragraph"><p>Hier wird im Ordner <span class="guihint">Main &gt; Linux &gt; Production Hosts</span> der Host <code>mylinuxserver</code> mit der IP-Adresse <code>192.168.0.123</code> und dem Host-Merkmal <span class="guihint">Use piggyback data from other hosts if present</span> erstellt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">    "attributes": {</span>
<span class="tok-go">        "ipaddress": "192.168.0.123",</span>
<span class="tok-go">        "tag_piggyback": "auto-piggyback"</span>
<span class="tok-go">    },</span>
<span class="tok-go">    "folder": "~linux~production_hosts",</span>
<span class="tok-go">    "host_name": "mylinuxserver"</span>
<span class="tok-go">    }' \</span>
<span class="tok-go">"$API_URL/domain-types/host_config/collections/all"</span></code></pre></div></div>
<h3 id="restapi_show_a_host" class="discrete">Host anzeigen (Show a host)</h3>
<div class="paragraph"><p>Durch die Anzeige eines Hosts erhalten Sie die Liste der ihm zugewiesenen Attribute.
Zusätzlich wird dabei das HTTP ETag (<em>entity tag</em>) geliefert, das Sie benötigen, um einen Host zu ändern.
Mehr zum ETag erfahren Sie im Abschnitt <a href="#show_pending_changes">Die ausstehenden Änderungen anzeigen.</a></p></div>
<div class="paragraph"><p>Das ETag wird im Antwort-Header (<em>response header</em>) zurückgeliefert.
Damit dieser Header angezeigt wird, rufen Sie <code>curl</code> mit der Option <code>-v</code> (für <em>verbose</em>) auf.
Hier wird der Host <code>mylinuxserver</code> abgefragt — und aus der Antwort nur die Zeile mit dem ETag gezeigt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span>-vG<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>GET<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-s2">"</span><span class="tok-nv">$API_URL</span><span class="tok-s2">/objects/host_config/<mark>mylinuxserver</mark>"</span>
<span class="tok-go">...</span>
<span class="tok-go">&lt; ETag: "57db3792f23bd81ca7447ba4885fa2865d0c78aed4753229b29e179e539da48b"</span>
<span class="tok-go">...</span></code></pre></div></div>
<h3 id="restapi_update_a_host" class="discrete">Host ändern (Update a host)</h3>
<div class="paragraph"><p>Vor der Änderung besorgen Sie sich das ETag des Hosts, wie im Abschnitt <a href="#restapi_show_a_host">Host anzeigen (Show a host)</a> beschrieben.
Das ETag tragen Sie dann im Anfrage-Header unter <code>If-Match</code> ein.
Hier wird das beim Erstellen des Hosts gesetzte Host-Merkmal aus der Gruppe <span class="guihint">Piggyback</span> wieder gelöscht und stattdessen das vordefinierte Merkmal <span class="guihint">API integrations if configured, else Checkmk agent</span> gesetzt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>PUT<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"If-Match: "</span>57db3792f23bd81ca7447ba4885fa2865d0c78aed4753229b29e179e539da48b<span class="tok-s2">""</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">    "remove_attributes": [</span>
<span class="tok-go">        "tag_piggyback"</span>
<span class="tok-go">    ],</span>
<span class="tok-go">    "update_attributes": {</span>
<span class="tok-go">        "tag_agent": "cmk-agent"</span>
<span class="tok-go">    }</span>
<span class="tok-go">    }' \</span>
<span class="tok-go">"$API_URL/objects/host_config/<mark>mylinuxserver</mark>"</span></code></pre></div></div>
<h3 id="restapi_execute_a_service_discovery_on_a_host" class="discrete">Service-Erkennung auf einem Host durchführen (Execute a service discovery on a host)</h3>
<div class="paragraph"><p>Damit eine <a href="hosts_setup.html#services">Service-Erkennung</a> auch tatsächlich die erwarteten Services liefert, müssen Sie zuvor auf Linux- und Windows-Hosts die zugehörigen <a href="wato_monitoringagents.html">Monitoring-Agenten</a> installieren und registrieren.</p></div>
<div class="paragraph"><p>Hier wird die Service-Erkennung auf dem Host <code>mylinuxserver</code> durchgeführt mit der Option <code>refresh</code>, was in der Checkmk-GUI dem Knopf <span class="guihint">Full service scan</span> entspricht:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">    "host_name": "mylinuxserver",</span>
<span class="tok-go">    "mode": "refresh"</span>
<span class="tok-go">    }' \</span>
<span class="tok-go">"$API_URL/domain-types/service_discovery_run/actions/start/invoke"</span></code></pre></div></div>
<h3 id="restapi_bulk_create_host" class="discrete">Mehrere Hosts erstellen (Bulk create hosts)</h3>
<div class="paragraph"><p>Hier werden zwei Hosts im Ordner <span class="guihint">Main &gt; Linux &gt; Production Hosts</span> erstellt: der erste nur mit IP-Adresse und der zweite zusätzlich mit einem <a href="monitoring_basics.html#parents">Parent-Host</a> und mit zwei <a href="glossar.html#label">Labels:</a></p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">	"entries": [</span>
<span class="tok-go">	{</span>
<span class="tok-go">	"attributes": {</span>
<span class="tok-go">	    "ipaddress": "192.168.0.130"</span>
<span class="tok-go">	},</span>
<span class="tok-go">	"folder": "~linux~production_hosts",</span>
<span class="tok-go">	"host_name": "mylinuxserver02"</span>
<span class="tok-go">	},</span>
<span class="tok-go">	{</span>
<span class="tok-go">	"attributes": {</span>
<span class="tok-go">	    "ipaddress": "192.168.0.131",</span>
<span class="tok-go">	    "parents": [ "router01" ],</span>
<span class="tok-go">	    "labels": {</span>
<span class="tok-go">	    	"color": "blue-metallic",</span>
<span class="tok-go">	    	"admin": "Fozzie Bear"</span>
<span class="tok-go">	    }</span>
<span class="tok-go">	},</span>
<span class="tok-go">	"folder": "~linux~production_hosts",</span>
<span class="tok-go">	"host_name": "mylinuxserver03"</span>
<span class="tok-go">	}</span>
<span class="tok-go">	]</span>
<span class="tok-go">	}' \</span>
<span class="tok-go">"$API_URL/domain-types/host_config/actions/bulk-create/invoke"</span></code></pre></div></div>
<h3 id="restapi_activate_pending_changes" class="discrete">Änderungen aktivieren (Activate pending changes)</h3>
<div class="paragraph"><p>Bevor die komplexe Aktion der Umbenennung eines Hosts in Angriff genommen werden kann, ist es nötig, alle in der <a href="glossar.html#configuration_environment">Konfigurationsumgebung</a> aufgelaufenen Änderungen zu aktivieren.
Hier werden die Änderungen für die Instanz <code>mysite</code> gesammelt aktiviert:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">    "force_foreign_changes": false,</span>
<span class="tok-go">    "redirect": false,</span>
<span class="tok-go">    "sites": [</span>
<span class="tok-go">        "mysite"</span>
<span class="tok-go">     ]</span>
<span class="tok-go">     }' \</span>
<span class="tok-go">"$API_URL/domain-types/activation_run/actions/activate-changes/invoke"</span></code></pre></div></div>
<h3 id="restapi_bulk_rename_a_host" class="discrete">Host umbenennen (Rename a host)</h3>
<div class="paragraph"><p>Auch ein neuer Name ändert den Host.
Besorgen Sie sich daher zuerst das aktuelle ETag des Hosts, z.B. von <code>mylinuxserver</code>, wie im Abschnitt <a href="#restapi_show_a_host">Host anzeigen (Show a host)</a> beschrieben, und tragen es im Anfrage-Header unter <code>If-Match</code> ein.
Hier wird der Host in <code>mylinuxserver01</code> umbenannt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>curl<span class="tok-w"> </span><span class="tok-se">\</span>
--request<span class="tok-w"> </span>PUT<span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Authorization: Bearer </span><span class="tok-nv">$USERNAME</span><span class="tok-s2"> </span><span class="tok-nv">$PASSWORD</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Accept: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"If-Match: "</span>a200832df1b3c5ebe8f30809177630abbdcf8f7cbd9d0f69bd9f229b359f4d00<span class="tok-s2">""</span><span class="tok-w"> </span><span class="tok-se">\</span>
--header<span class="tok-w"> </span><span class="tok-s2">"Content-Type: application/json"</span><span class="tok-w"> </span><span class="tok-se">\</span>
--data<span class="tok-w"> </span><span class="tok-err">'</span><span class="tok-o">{</span>
<span class="tok-go">	"new_name": "mylinuxserver01"</span>
<span class="tok-go">	}' \</span>
<span class="tok-go">"$API_URL/objects/host_config/<mark>mylinuxserver</mark>/actions/rename/invoke"</span></code></pre></div></div>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#intro">1. Einleitung</a></li>
<li>
<a href="#api_doc">2. Die API-Dokumentation</a><ul class="sectlevel1">
<li><a href="#versioning">2.1. Versionierung</a></li>
<li><a href="#access">2.2. Zugriff</a></li>
<li><a href="#structure">2.3. Struktur und Inhalt</a></li>
</ul>
</li>
<li>
<a href="#using_the_api">3. Die API nutzen</a><ul class="sectlevel1">
<li>
<a href="#auth">3.1. Authentifizierung</a><ul class="sectlevel2">
<li><a href="#bearerauth">Bearer- oder Header-Authentifizierung</a></li>
<li><a href="#webserverauth">Webserver-Authentifizierung</a></li>
<li><a href="#cookieauth">Cookie-Authentifizierung</a></li>
</ul>
</li>
<li><a href="#http-status-code">3.2. HTTP-Status-Code</a></li>
<li><a href="#testing">3.3. Die API lokal testen</a></li>
<li>
<a href="#making_requests">3.4. Anfragen stellen per Skript</a><ul class="sectlevel2">
<li><a href="#create_host">Einen Host erstellen</a></li>
<li><a href="#service_discovery">Eine Service-Erkennung auf dem Host durchführen</a></li>
<li><a href="#show_pending_changes">Die ausstehenden Änderungen anzeigen</a></li>
<li><a href="#activate_changes">Die Änderungen aktivieren</a></li>
</ul>
</li>
<li><a href="#rest_api_gui">3.5. Anfragen stellen per REST-API GUI</a></li>
<li><a href="#error_correction">3.6. Fehler korrigieren</a></li>
</ul>
</li>
<li><a href="#securing">4. Die API absichern</a></li>
<li>
<a href="#examples">5. Beispiele mit REST-API-Anfragen</a><ul class="sectlevel1"><li><a href="#examples_hosts_folders">5.1. Hosts und Ordner</a></li></ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
