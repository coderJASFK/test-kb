<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="description" content="Checkmk can be incooperated in single sign-on (SSO) solutions. Read here how to set up authentication with SAML.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Authentication with SAML">
<meta name="og:description" content="Checkmk can be incooperated in single sign-on (SSO) solutions. Read here how to set up authentication with SAML.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Authentication with SAML</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/latest/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/latest/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../latest/de/saml.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">latest (2.3.0)</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.1.0/en/saml.html">2.1.0</a><a class="dropdown-item" href="../../2.2.0/en/saml.html">2.2.0</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="release_notes.html">Release notes</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and derivatives</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
<li>
<p><a href="install_azure.html">Installation from Azure Marketplace</a></p>
</li>
<li>
<p><a href="install_aws.html">Installation from AWS Marketplace</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="password_store.html">Password store</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="mkp_viewables.html">MKPs for GUI extensions</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
<li>
<p><a href="hosts_autoregister.html">Automated host creation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Rules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Notifications</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
<li>
<p><a href="notifications_ilert.html">Notifications via ilert</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_teams.html">Notifications via Microsoft Teams</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_signl4.html">Notifications via SIGNL4</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_logfiles.html">Monitoring log files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql_legacy.html">Monitoring MSSQL with the legacy plug-in</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMware ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_gcp.html">Monitoring Google Cloud Platform (GCP)</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_openshift.html">Monitoring OpenShift</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
<li>
<p><a href="robotmk.html">Checkmk Synthetic Monitoring with Robotmk</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Measured values and graphing</a></p>
</li>
<li>
<p><a href="custom_notes.html">Custom notes</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cse.html">Checkmk Enterprise</a></p>
</li>
<li>
<p><a href="cce.html">Checkmk Cloud</a></p>
</li>
<li>
<p><a href="managed.html">Checkmk MSP</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="apis_intro.html">Overview of API resources</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">The Checkmk REST API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_intro.html">Developing extensions for Checkmk</a></p>
</li>
<li>
<p><a href="devel_check_plugins.html">Writing agent-based check plug-ins</a></p>
</li>
<li>
<p><a href="devel_check_plugins_snmp.html">Writing SNMP-based check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Authentication with SAML</h1>
<div class="details">
<span id="revdate">Last modified on 23-Apr-2024</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.3.0/src/common/en/saml.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="ldap.html">User management with LDAP/Active Directory</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading_intro">
<span class="hidden-anchor sr-only" id="intro"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this article you will learn how to set up a login via <em>Secure Assertion Markup Language</em> (SAML).</p></div>
<div class="paragraph"><p>SAML is a standardized method for informing external applications and services that a user is actually who they claim to be.
SAML makes single sign-on (SSO) possible because it can be used to authenticate a user once and then communicate that authentication to multiple applications.
With the help of the connection and communication between the so-called 'Service Provider' (SP) and the so-called 'Identity Provider' (IdP), it is thus possible for employees to access various web applications with just a single login.
In the SAML architecture, the Service Provider makes the application available and the Identity Provider manages the digital identities of the users.</p></div>
<div class="paragraph"><p>SAML is supported in the commercial editions of Checkmk and can be set up directly in the Checkmk web interface.
Checkmk takes the role of the Service Provider.
For example, as described in the <a href="#saml_cee">setup chapter</a>, Entra ID is an example of an Identity Provider.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>Microsoft Entra ID (short: Entra ID) is the new name for Azure Active Directory (Azure AD) since 2023.
However, the screenshots and contents of configuration files contained in this article still use the old name Azure AD.</p></div></td>
</tr></table></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
Up to Checkmk version <span class="new">2.2.0</span>, as an alternative, SAML was also supported by the Apache <code>mod_auth_mellon</code> module, which was supplied as part of the Checkmk software.
From version <span class="new">2.3.0</span>, <code>mod_auth_mellon</code> is no longer included in the Checkmk software.
If you want to use SAML as a <span class="image-inline"><img src="../images/icons/CRE.png" alt="CRE" width="20" title="Checkmk Raw"></span> <strong>Checkmk Raw</strong> user, you must therefore install <code>mod_auth_mellon</code> yourself.
The configuration based on this is described in <a href="#saml_re">chapter on Checkmk Raw</a>.
However, it is <strong>no longer</strong> supported by us.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>The whole topic of transport encryption (TLS/SSL) is only included in the examples in a simple, demonstration implementation.
In production environments <a href="https://checkmk.com/blog/how-become-your-own-certificate-authority" target="_blank">with your own Certificate Authority (CA)</a> and proper certificate handling, there will be some differences which will depend on your own infrastructure.</p></div></td>
</tr></table></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_use_saml">
<span class="hidden-anchor sr-only" id="use_saml"></span>2. Using SAML in Checkmk</h2>
<div class="sectionbody">
<div class="paragraph"><p>Once you have gone through all of the points of the setup process, the SAML login can be used by the user in Checkmk.
The button text can be customized, as <a href="#configure_saml">described below</a>.</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_login.png" alt="Checkmk login with SAML button." width="55%"></div></div>
<div class="paragraph"><p>Any user authorized by SAML will be automatically created in Checkmk the first time they log in there — provided that there is not already a user with the same ID.
If a user with the same ID already exists, the current user creation will be rejected.</p></div>
<div class="paragraph"><p>The user data will be synchronized every time the user logs in to Checkmk.</p></div>
<div class="paragraph"><p>Several prerequisites must be met for SAML to function:</p></div>
<div class="ulist"><ul>
<li><p>The <a href="omd_https.html">web interface must be secured with HTTPS</a>. For security reasons HTTP addresses are not accepted.</p></li>
<li><p>Checkmk’s SAML endpoints for ID/metadata and responses (Assertion Consumer Service) must have been registered with the IdP. Below we will show how this can be done.</p></li>
<li><p>Messages directed by the IdP to Checkmk — responses to authentication requests (only mandatory for the assertion) and attribute statements — must be signed with one of the <a href="#supported_algorithms">supported algorithms</a>.</p></li>
</ul></div>
<div class="sect2">
<h3 id="heading_supported_algorithms">
<span class="hidden-anchor sr-only" id="supported_algorithms"></span>2.1. Supported algorithms</h3>
<div class="paragraph"><p>Checkmk accepts the following algorithms for communication with the IdP:</p></div>
<div class="ulist"><ul>
<li><p>RSA-SHA256</p></li>
<li><p>RSA-SHA384</p></li>
<li><p>RSA-SHA512</p></li>
<li><p>ECDSA-SHA256</p></li>
<li><p>ECDSA-SHA384</p></li>
<li><p>ECDSA-SHA512</p></li>
</ul></div>
<div class="paragraph"><p>Checkmk itself uses RSA-SHA256 for signing its requests.</p></div>
<div class="paragraph"><p>If the IdP does not use any of the above algorithms for its response, the response will be rejected by Checkmk.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_saml_cee">
<span class="hidden-anchor sr-only" id="saml_cee"></span>3. Setting up SAML</h2>
<div class="sectionbody">
<div class="paragraph"><p>To be able to use SAML in the commercial editions, the IdP must first be set up — in our example this is Entra ID (called Azure Active Directory until 2023).
Once this has been done, the SP, i.e. Checkmk, is then supplied with the required information.</p></div>
<div class="sect2">
<h3 id="heading_access_azure">
<span class="hidden-anchor sr-only" id="access_azure"></span>3.1. Logging into in Entra ID</h3>
<div class="sect3">
<h4 id="heading__registering_the_checkmk_saml_service_in_entra_id">
<span class="hidden-anchor sr-only" id="_registering_the_checkmk_saml_service_in_entra_id"></span>Registering the Checkmk SAML service in Entra ID</h4>
<div class="paragraph"><p>Next, register the Checkmk SAML service with Entra ID.
To do this, call <span class="guihint">Enterprise applications &gt; Create your own application</span>.</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_azure_own_application.png" alt="Creating your own application in Entra ID."></div></div>
<div class="paragraph"><p>Assign an arbitrary, preferably meaningful name, e.g. <code>checkmk-saml</code>.
We recommend not naming the application simply <code>checkmk</code> to avoid confusion with the Checkmk agent.</p></div>
<div class="paragraph"><p>Select the <span class="guihint">Integrate any other application you don’t find in the gallery (Non-gallery)</span> option and then click the <span class="guihint">Create</span> button.</p></div>
<div class="paragraph"><p>On the Entra ID overview page you will have created the following function: <span class="guihint">Single sign-on &gt; SAML &gt; Basic SAML Configuration</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_azure_sign_on.png" alt="Overview of application data in Entra ID."></div></div>
<div class="paragraph"><p>At this point, Entra ID will require two more pieces of information:</p></div>
<div class="ulist"><ul>
<li><p>the <span class="guihint">Identifier (Entity ID)</span> in the <code>https://myserver.com/mysite/check_mk/saml_metadata.py</code> format, and</p></li>
<li><p>the <span class="guihint">Reply URL (Assertion Consumer Service URL)</span> in the <code>https://myserver.com/mysite/check_mk/saml_acs.py?acs</code> format.</p></li>
</ul></div>
<div class="paragraph"><p>Leave all other options unchanged at their default value or empty.
In particular, the <span class="guihint">Relay State</span> in the <span class="guihint">Basic SAML Configuration</span> must remain unchanged, otherwise SAML will not work.</p></div>
<div class="paragraph"><p>Now call <span class="guihint">Edit &gt; Signing Option &gt; Sign SAML assertion</span> to configure an Entra ID for responses and verifications:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_signing_certificate.png" alt="SAML access data in Entra ID."></div></div>
</div>
<div class="sect3">
<h4 id="heading_url_from_azure">
<span class="hidden-anchor sr-only" id="url_from_azure"></span>Retrieving SAML information from Entra ID</h4>
<div class="paragraph"><p>Next, go to Entra ID to find the SAML information you need for Checkmk.</p></div>
<div class="paragraph"><p>This is available in the <span class="guihint">Enterprise applications | All applications &gt; Browse Microsoft Entra Gallery &gt; checkmk-saml | SAML-based Sign-On</span> view (see above):</p></div>
<div class="ulist"><ul>
<li><p>In the <span class="guihint">SAML Certificates</span> box, find the <span class="guihint">App Federation Metadata Url</span>.
You will need this in the next section for setting up SAML in Checkmk <span class="guihint">(Identity provider metadata)</span>.</p></li>
<li><p>The <span class="guihint">Attributes &amp; Claims</span> box takes you to a view of the user attributes for Checkmk, e.g. email address, first and last name:</p></li>
</ul></div>
<div class="imageblock"><div class="content"><img src="../images/saml_attributes_claims.png" alt="View of user attributes in Entra ID."></div></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_configure_saml">
<span class="hidden-anchor sr-only" id="configure_saml"></span>3.2. Activating SAML in the Checkmk web interface</h3>
<div class="paragraph"><p>With the information obtained earlier, set up the SAML connection on the Checkmk side.</p></div>
<div class="paragraph"><p>If necessary, add the TLS certificate issued by your IdP to the trusted certificates in Checkmk by entering it in <span class="guihint">Setup &gt; Global settings &gt; Trusted certificate authorities for SSL</span>.</p></div>
<div class="paragraph"><p>Now open <span class="guihint">Setup &gt; Users &gt; SAML authentication</span>.
Use <span class="guihint">Add connection</span> there to start configuring a new connection:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_saml_authentication.png" alt="The SAML connection in Checkmk."></div></div>
<div class="paragraph"><p>Assign a <span class="guihint">Connection ID</span> and a <span class="guihint">Name</span> for the new connection.
The <span class="guihint">Name</span> will be used afterwards for <a href="#use_saml">naming the Checkmk login button</a>.</p></div>
<div class="paragraph"><p>Next, in the <span class="guihint">Security</span> box, you specify whether you want to secure the access connections with Checkmk or with your own certificates:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_security.png" alt="Selecting the certificate for SAML."></div></div>
<div class="paragraph"><p>If you use your own certificates, you must specify the <span class="guihint">Private key</span> and the <span class="guihint">Certificate</span>.
Custom certificates are stored in the site directory under <code>~/etc/ssl/saml2/custom/</code>.</p></div>
<div class="paragraph"><p>Next, in the <span class="guihint">Connection</span> box, as the <span class="guihint">Identity provider metadata</span> enter the URL (e.g. App Federation Metadata URL) you selected as described in the <a href="#url_from_azure">previous section</a>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_connection.png" alt="Entering connection data."></div></div>
<div class="paragraph"><p>Alternatively, you can download the metadata XML file directly from Entra ID and upload it in the dialog above with the <span class="guihint">Upload XML file</span> in the <span class="guihint">Identity provider metadata</span> option.
This is convenient, for example, if your Checkmk server has no access to the internet.
For the mandatory <span class="guihint">Checkmk server URL</span>, enter the address you — not Entra ID — normally use to access Checkmk, e.g. <code>https://myserver.com</code>.</p></div>
<div class="paragraph"><p>You will now need to enter the user details into the <span class="guihint">Users</span> box:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_users.png" alt="Entering user information."></div></div>
<div class="paragraph"><p>You also need to obtain this information as described in the <a href="#url_from_azure">previous section</a>.
It is important to note that the <span class="guihint">User ID attribute</span> must be unique, for instance the user ID.
Checkmk here requires the complete <span class="guihint">claim name</span> from Entra ID, i.e. the URL address starting with <code>http</code>, for each entry,
for instance, in the above example, the user ID is <code>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/userID</code>.</p></div>
<div class="paragraph"><p>In order to define the responsibilities for all users who authenticate themselves with SAML in Checkmk, each user can be <a href="wato_user.html#contact_groups">assigned to one or more contact groups</a>.
You have various options for defining the mapping in the <span class="guihint">Contact groups</span>.</p></div>
<div class="paragraph"><p>You can use the <span class="guihint">Roles</span> to assign users to different roles in order to define normal users, administrators, etc.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_saml_re">
<span class="hidden-anchor sr-only" id="saml_re"></span>4. SAML in Checkmk Raw</h2>
<div class="sectionbody">
<div class="admonitionblock important"><table><tr>
<td class="icon"><img src="../images/icons/important.png" alt="Important"></td>
<td class="content"><div class="paragraph"><p>The configuration described in this chapter is only of interest to Checkmk Raw users who cannot use the <a href="#saml_cee">SAML connection</a> built into the commercial editions of Checkmk.
The prerequisite is that you have installed the Apache module <code>mod_auth_mellon</code>, which is not supplied with the Checkmk software, system-wide according to the <a href="https://github.com/latchset/mod_auth_mellon" target="_blank">instructions on the project page</a>.
The configuration based on this is described in this chapter.
However, we no longer support the SAML connection via <code>mod_auth_mellon</code>.</p></div></td>
</tr></table></div>
<div class="paragraph"><p>The following sections only describe the configuration of <code>mod_auth_mellon</code> for any IdPs that may already be running, using Active Directory Federation Services (ADFS) as an example.
The connection in Checkmk itself is limited to the last step from the ADFS instructions.
On the Checkmk server, <code>mod_auth_mellon</code> acts as the service provider for authentications.</p></div>
<div class="sect2">
<h3 id="heading__logging_in_with_active_directory_federation_services">
<span class="hidden-anchor sr-only" id="_logging_in_with_active_directory_federation_services"></span>4.1. Logging in with Active Directory Federation Services</h3>
<div class="sect3">
<h4 id="heading__prerequisites">
<span class="hidden-anchor sr-only" id="_prerequisites"></span>Prerequisites</h4>
<div class="paragraph"><p>Logging on to Checkmk using Active Directory is basically relatively simple:
Active Directory Federation Services (ADFS) serves as Identity Provider (IdP), Checkmk provides the SAML authentication.</p></div>
<div class="paragraph"><p>Prerequisites for this tutorial are accordingly:</p></div>
<div class="ulist"><ul>
<li><p>Functioning LDAP-AD integration</p></li>
<li><p>Working ADFS as IdP</p></li>
<li><p>Checkmk server with SSL</p></li>
<li><p>A supported operating system.</p></li>
</ul></div>
<div class="paragraph"><p>The setup is accomplished in three steps:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Configuration of Apache (one result: XML file with metadata).</p></li>
<li><p>Configuration of ADFS: setting up a relying party trust with Mellon metadata.</p></li>
<li><p>Enabling of the login in Checkmk itself.</p></li>
</ol></div>
</div>
<div class="sect3">
<h4 id="heading__configuring_apache">
<span class="hidden-anchor sr-only" id="_configuring_apache"></span>Configuring Apache</h4>
<div class="paragraph"><p>This is, of course, about configuring the site’s own Apache server, so log in there first:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>su<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>Now create a directory for <code>mod_auth_mellon</code> and switch to it:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>mkdir<span class="tok-w"> </span>etc/apache/mellon
<span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>etc/apache/mellon</code></pre></div></div>
<div class="paragraph"><p>Now run <code>mellon_create_metadata</code> specifying your server as well as your site with the <code>mellon</code> suffix:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mellon_create_metadata<span class="tok-w"> </span>https://myserver<span class="tok-w"> </span><span class="tok-s2">"https://myserver/mysite/mellon"</span></code></pre></div></div>
<div class="paragraph"><p>This module generates three files: Certificate (<code>.cert</code>), key (<code>.key</code>) and static metadata (<code>.xml</code>).
The <code>.xml</code> file is not required and can be deleted:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>rm<span class="tok-w"> </span>*.xml</code></pre></div></div>
<div class="paragraph"><p>Rename the key and certificate files for simplicity:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mv<span class="tok-w"> </span><strong>.key<span class="tok-w"> </span>mellon.key
<span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mv<span class="tok-w"> </span></strong>.cert<span class="tok-w"> </span>mellon.cert</code></pre></div></div>
<div class="paragraph"><p>Now get the required metadata directly from your ADFS server (here <code>myadfs</code>) and save it as <code>idp-metadata.xml</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>wget<span class="tok-w"> </span>--no-check-certificate<span class="tok-w"> </span>-O<span class="tok-w"> </span>./idp-metadata.xml<span class="tok-w"> </span>https://myadfs/FederationMetadata/2007-06/FederationMetadata.xml</code></pre></div></div>
<div class="paragraph"><p>Now you need the public certificate for the ADFS server, which is stored in the <code>idp-public-key.pem</code> file:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span>-n<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>openssl<span class="tok-w"> </span>s_client<span class="tok-w"> </span>-connect<span class="tok-w"> </span>myadfs:443<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sed<span class="tok-w"> </span>-ne<span class="tok-w"> </span><span class="tok-s1">'/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>openssl<span class="tok-w"> </span>x509<span class="tok-w"> </span>-pubkey<span class="tok-w"> </span>-noout<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>idp-public-key.pem</code></pre></div></div>
<div class="paragraph"><p>Just in case you are wondering about the <code>echo -n</code>:
This is used to terminate the following SSL session.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>The certificate should, or even <em>must</em> be uploaded to the trust store if, for example, the IdP service checks the certificate chain.
For more information on this topic, see the <a href="omd_https.html">HTTPS article</a>.</p></div></td>
</tr></table></div>
<div class="paragraph"><p>As a final step, replace the authentication configuration file <code>~/etc/apache/conf.d/auth.conf</code> with the following variant — of course specifying your Checkmk server (here <code>myserver</code>) and your site (here <code>mysite</code>).
Note in the following example configuration that the path of the installation directory in the line beginning with <code>LoadModule</code> may vary depending on the distribution used:</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span># Set this to the Name of your Checkmk site, e.g.
#Define SITE
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server. auth_mellon uses this
# to generate the needed URLs in the metadata
ServerName https://myserver

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /usr/lib/apache2/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
#MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.txt
#MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# cookie provided by the user and whitelist also some other required URLs
	&lt;If "! %{HTTP_COOKIE} =~ /^(.*;)?auth_${SITE}/ &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/restapi.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/automation.py' &amp;&amp; \
		! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
		! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

		MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
		MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
		MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
		MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
		MellonEndpointPath "/${SITE}/mellon"
		MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		AuthName "Checkmk SAML Login"
		MellonEnable auth
		Require valid-user

		# Get Username
		# ADFS sends username as DOMAIN\username pair.
		# Checkmk just wants the username.
		RewriteEngine on
		RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"
		RequestHeader edit X-Remote-User "^.*\\\(.*)$" "$1"

		# When SAML auth fails, show the login page to the user. This should only happen,
		# if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
		# A failed login at the IDP will not return you here at all.

    ErrorDocument 401 '&lt;html&gt; \
      &lt;head&gt; \
        &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
      &lt;/head&gt; \
      &lt;body&gt; \
        SAML authentication failed, redirecting to login page. \
        &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
      &lt;/body&gt; \
    &lt;/html&gt;'

	&lt;/If&gt;

	# This header is also needed after authentication (outside of the If clause)
	RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"
	RequestHeader edit X-Remote-User "^.*\\\(.*)$" "$1"

&lt;/Location&gt;</code></pre></div>
</div>
<div class="paragraph"><p>Then restart Apache:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>omd<span class="tok-w"> </span>restart<span class="tok-w"> </span>apache</code></pre></div></div>
<div class="paragraph"><p>Last but not least, you now download the dynamically created Mellon metadata as an XML file so that you can import it into AD Management right away:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>wget<span class="tok-w"> </span>https://myserver/mysite/mellon/metadata<span class="tok-w"> </span>-o<span class="tok-w"> </span>metadata.xml</code></pre></div></div>
</div>
<div class="sect3">
<h4 id="heading__configuring_active_directory">
<span class="hidden-anchor sr-only" id="_configuring_active_directory"></span>Configuring Active Directory</h4>
<div class="paragraph"><p>To create a relying party trust in ADFS, do the following:</p></div>
<div class="paragraph"><p>Start the ADFS interface:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_01.png" alt="saml adfs 01"></div></div>
<div class="paragraph"><p>Click <span class="guihint">Add Relying Party Trust</span>:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_02.png" alt="saml adfs 02"></div></div>
<div class="paragraph"><p>Leave the option set to <span class="guihint">Claims aware</span> and continue with the Start button:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_03.png" alt="saml adfs 03"></div></div>
<div class="paragraph"><p>Now select <span class="guihint">Import data on the relying party from a file</span> and specify the XML file you just downloaded:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_04.png" alt="saml adfs 04"></div></div>
<div class="paragraph"><p>You can safely ignore the <span class="guihint">AD FS Management</span> warning:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_05.png" alt="saml adfs 05"></div></div>
<div class="paragraph"><p>Under <span class="guihint">Specify Display Name</span> now enter <code>Checkmk</code> as the name:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_06.png" alt="saml adfs 06"></div></div>
<div class="paragraph"><p>When assigning permissions, <strong>for testing purposes</strong>, for the <span class="guihint">Choose Access Control Policy</span> you can first select the value <span class="guihint">Permit everyone</span>; you should later change this to <span class="guihint">Permit specific group</span>.</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_07.png" alt="saml adfs 07"></div></div>
<div class="paragraph"><p>Confirm the summary under <span class="guihint">Ready to Add Trust:</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_08.png" alt="saml adfs 08"></div></div>
<div class="paragraph"><p>Finally, confirm the <span class="guihint">Finish</span> dialog and keep the check mark at <span class="guihint">Configure claims issuance policy for this application:</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_09.png" alt="saml adfs 09"></div></div>
<div class="paragraph"><p>Select the relying party trust you just created and then start the editor with <span class="guihint">Edit Claim Issuance Policy…​ :</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_10.png" alt="saml adfs 10"></div></div>
<div class="paragraph"><p>Add a new rule in the following dialog via <span class="guihint">Add Rule…​</span>:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_11.png" alt="saml adfs 11"></div></div>
<div class="paragraph"><p>In the first step <span class="guihint">Select Rule Template</span> select <span class="guihint">Transform to Incoming Claim</span> and confirm:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_12.png" alt="saml adfs 12"></div></div>
<div class="paragraph"><p>In the second step <span class="guihint">Configure Rule</span> set the following values:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Incoming claim type</span>: <code>Windows account name</code></p></li>
<li><p><span class="guihint">Outgoing claim type</span>: <code>Name ID</code></p></li>
<li><p><span class="guihint">Outgoing name ID format</span>: <code>Transient Identifier</code></p></li>
</ul></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_13.png" alt="saml adfs 13"></div></div>
<div class="paragraph"><p>This also completes the ADFS configuration.
FS can now derive authentication for Checkmk from Windows authentication, which you instruct to authenticate users via HTTP requests in the next step.</p></div>
</div>
<div class="sect3">
<h4 id="heading__configuring_checkmk">
<span class="hidden-anchor sr-only" id="_configuring_checkmk"></span>Configuring Checkmk</h4>
<div class="paragraph"><p>In Checkmk, under <span class="guihint">Setup &gt; General &gt; Global Settings &gt; User Interface &gt; Authenticate users by incoming HTTP requests</span>, at the <span class="guihint">Current settings</span> you now only need to activate the <span class="guihint">Activate HTTP header authentication</span> option.</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_adfs_cmk.png" alt="saml adfs cmk"></div></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__additional_information_for_other_systems">
<span class="hidden-anchor sr-only" id="_additional_information_for_other_systems"></span>4.2. Additional information for other systems</h3>
<div class="sect3">
<h4 id="heading__entra_id_with_mod_auth_mellon">
<span class="hidden-anchor sr-only" id="_entra_id_with_mod_auth_mellon"></span>Entra ID with mod_auth_mellon</h4>
<div class="paragraph"><p>When Entra ID (called Azure Active Directory until 2023) acts as the IdP, there are some differences in the configuration procedure, for example, the user name can be specified directly without needing to be rewritten.</p></div>
<div class="paragraph"><p>Prerequisites for the following sample configuration:</p></div>
<div class="ulist"><ul>
<li><p>Set UserPrincipalName in LDAP connection as the identifier (more information in the <a href="https://learn.microsoft.com/en-us/windows/win32/adschema/a-userprincipalname" target="_blank">Microsoft documentation</a>).</p></li>
<li><p>Custom Enterprise App in Entra ID with UserPrincipalName as the 'name' attribute (for more information see the <a href="https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/add-application-portal" target="_blank">Microsoft documentation</a>).</p></li>
</ul></div>
<div class="paragraph"><p>Note in the following example configuration that the path of the installation directory in the line beginning with <code>LoadModule</code> may vary depending on the distribution used:</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#Set this to the Name of your Checkmk site, e.g.
# Define SITE mysite
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server.
# auth_mellon uses this to generate the needed URLs in the metadata.
ServerName https://myserver

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /usr/lib/apache2/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
# MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.log
# MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# cookie provided by the user and whitelist also some other required URLs.
   &lt;If "! %{HTTP_COOKIE} =~ /^auth_${SITE}/ &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/restapi.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
	! %{REQUEST_URI} = '/${SITE}/check_mk/automation.py' &amp;&amp; \
        ! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
        ! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

        RequestHeader unset X-Remote-User
        MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
        # Azure-AD-specific: Not needed because in metadata:
        #MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
        MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
        MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
        MellonEndpointPath "/${SITE}/mellon"
        MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		MellonEnable auth
		require valid-user

        # Azure-AD-specific:
        # Get Username
        # If your assertion offers the username for Checkmk in an attribute you can set it directly as the remote user (REMOTE_USER):
        MellonUser "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
        RequestHeader set X-Remote-User "%{MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name}e" env=MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name

        # When SAML auth fails, show the login page to the user. This should only happen, if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
        # A failed login at the IDP will not return you here at all.
        ErrorDocument 401 '&lt;html&gt; \
          &lt;head&gt; \
            &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
          &lt;/head&gt; \
          &lt;body&gt; \
            SAML authentication failed, redirecting to login page. \
            &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
          &lt;/body&gt; \
        &lt;/html&gt;'

	&lt;/If&gt;

	# Azure-AD-specific:
	# This header is also needed after authentication (outside of the If clause)
	RequestHeader set X-Remote-User "%{MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name}e" env=MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name

&lt;/Location&gt;</code></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="heading__netiq_access_manager">
<span class="hidden-anchor sr-only" id="_netiq_access_manager"></span>NetIQ Access Manager</h4>
<div class="paragraph"><p>When NetIQ Access Manager acts as the IdP, there are some differences in the configuration procedure, for example, the user name can be specified directly without needing to be rewritten.</p></div>
<div class="paragraph"><p>Note in the following example configuration that the path of the installation directory in the line beginning with <code>LoadModule</code> may vary depending on the distribution used:</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span>
# Set this to the Name of your Checkmk site, e.g.# Define SITE mysite
# Define SITE mysite
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server. auth_mellon uses this to generate the needed URLs in the metadata.

ServerName https://myserver.mydomain.tld

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /usr/lib/apache2/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
#MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.log
#MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# Cookie provided by the user and whitelist also some other required URLs.

    &lt;If "! %{HTTP_COOKIE} =~ /^auth_${SITE}/ &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/restapi.py' &amp;&amp; \
        ! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
        ! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

        MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
        # NetIQ-specific: Not needed because in metadata:
        #MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
        MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
        MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
        MellonEndpointPath "/${SITE}/mellon"
        MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		MellonEnable auth
		require valid-user


        # NetIQ-specific:
        # Even though it is set as 'optional' in https://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf
        # a NetIQ Access Manager requires it to be set.
        # Specified in oasis link above - line 396
        MellonOrganizationName "&lt;countrycode&gt;" "&lt;your organisation name&gt;"
        # Specified in oasis link above - line 443 / 452
        MellonOrganizationURL  "&lt;countrycode&gt;" "&lt;your organisation url&gt;"
        # Specified in oasis link above - line 454
        MellonOrganizationDisplayName "&lt;countrycode&gt;" "&lt;your organisation display name&gt;"

        # NetIQ-specific:
        # If your assertion offers the username for Checkmk in an attribute you can set it directly as the remote user (REMOTE_USER)
        MellonUser "myusername"

        # NetIQ-specific:
        # If the assertion does contain the username (and was set to MellonUser) then you can set the header directly.
        RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"

    # When SAML auth fails, show the login page to the user. This should only happen,
    # if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
    # A failed login at the IDP will not return you here at all.
        ErrorDocument 401 '&lt;html&gt; \
          &lt;head&gt; \
            &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
          &lt;/head&gt; \
          &lt;body&gt; \
            SAML authentication failed, redirecting to login page. \
            &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
          &lt;/body&gt; \
        &lt;/html&gt;'

# This header is also needed after authentication (outside of the If clause)
RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"

&lt;/Location&gt;</code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_migration">
<span class="hidden-anchor sr-only" id="migration"></span>5. Migrate existing users</h2>
<div class="sectionbody">
<div class="paragraph"><p>Once you have enabled SAML, you can migrate existing users from a password-based connection to the SAML connection.
To do this, check the desired accounts in the user management under <span class="guihint">Setup &gt; Users &gt; Users</span>.
Then start the migration via <span class="guihint">Migrate selected users</span>.</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_migration_list.png" alt="List of users marked for migration."></div></div>
<div class="paragraph"><p>In an intermediate step, you can have any attributes deleted.</p></div>
<div class="imageblock"><div class="content"><img src="../images/users_migration.png" alt="Dialog with user attributes that can be deleted."></div></div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#intro">1. Introduction</a></li>
<li>
<a href="#use_saml">2. Using SAML in Checkmk</a><ul class="sectlevel1"><li><a href="#supported_algorithms">2.1. Supported algorithms</a></li></ul>
</li>
<li>
<a href="#saml_cee">3. Setting up SAML</a><ul class="sectlevel1">
<li>
<a href="#access_azure">3.1. Logging into in Entra ID</a><ul class="sectlevel2">
<li><a href="#_registering_the_checkmk_saml_service_in_entra_id">Registering the Checkmk SAML service in Entra ID</a></li>
<li><a href="#url_from_azure">Retrieving SAML information from Entra ID</a></li>
</ul>
</li>
<li><a href="#configure_saml">3.2. Activating SAML in the Checkmk web interface</a></li>
</ul>
</li>
<li>
<a href="#saml_re">4. SAML in Checkmk Raw</a><ul class="sectlevel1">
<li>
<a href="#_logging_in_with_active_directory_federation_services">4.1. Logging in with Active Directory Federation Services</a><ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_configuring_apache">Configuring Apache</a></li>
<li><a href="#_configuring_active_directory">Configuring Active Directory</a></li>
<li><a href="#_configuring_checkmk">Configuring Checkmk</a></li>
</ul>
</li>
<li>
<a href="#_additional_information_for_other_systems">4.2. Additional information for other systems</a><ul class="sectlevel2">
<li><a href="#_entra_id_with_mod_auth_mellon">Entra ID with mod_auth_mellon</a></li>
<li><a href="#_netiq_access_manager">NetIQ Access Manager</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#migration">5. Migrate existing users</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
