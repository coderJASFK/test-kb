<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="description" content="Learn how to develop check plug-ins for SNMP using the Check API and use them in Checkmk.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Writing SNMP-based check plug-ins">
<meta name="og:description" content="Learn how to develop check plug-ins for SNMP using the Check API and use them in Checkmk.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Writing SNMP-based check plug-ins</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/latest/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/latest/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../latest/de/devel_check_plugins_snmp.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">latest (2.3.0)</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.1.0/en/devel_check_plugins_snmp.html">2.1.0</a><a class="dropdown-item" href="../../2.2.0/en/devel_check_plugins_snmp.html">2.2.0</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="release_notes.html">Release notes</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and derivatives</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
<li>
<p><a href="install_azure.html">Installation from Azure Marketplace</a></p>
</li>
<li>
<p><a href="install_aws.html">Installation from AWS Marketplace</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.3.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="password_store.html">Password store</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="mkp_viewables.html">MKPs for GUI extensions</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
<li>
<p><a href="hosts_autoregister.html">Automated host creation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Rules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Notifications</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
<li>
<p><a href="notifications_ilert.html">Notifications via ilert</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_teams.html">Notifications via Microsoft Teams</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_signl4.html">Notifications via SIGNL4</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_logfiles.html">Monitoring log files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql_legacy.html">Monitoring MSSQL with the legacy plug-in</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMware ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_gcp.html">Monitoring Google Cloud Platform (GCP)</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_openshift.html">Monitoring OpenShift</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
<li>
<p><a href="robotmk.html">Checkmk Synthetic Monitoring with Robotmk</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Measured values and graphing</a></p>
</li>
<li>
<p><a href="custom_notes.html">Custom notes</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cse.html">Checkmk Enterprise</a></p>
</li>
<li>
<p><a href="cce.html">Checkmk Cloud</a></p>
</li>
<li>
<p><a href="managed.html">Checkmk MSP</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="apis_intro.html">Overview of API resources</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">The Checkmk REST API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_intro.html">Developing extensions for Checkmk</a></p>
</li>
<li>
<p><a href="devel_check_plugins.html">Writing agent-based check plug-ins</a></p>
</li>
<li>
<p><a href="devel_check_plugins_snmp.html">Writing SNMP-based check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Writing SNMP-based check plug-ins</h1>
<div class="details">
<span id="revdate">Last modified on 09-Oct-2024</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.3.0/src/onprem/en/devel_check_plugins_snmp.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="devel_intro.html">Developing extensions for Checkmk</a>
<a href="devel_check_plugins.html">Writing agent-based check plug-ins</a>
<a href="snmp.html">Monitoring via SNMP</a>
<a href="wato_services.html">Understanding and configuring services</a>
<a href="cmk_commandline.html">Checkmk on the command line</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading_intro">
<span class="hidden-anchor sr-only" id="intro"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Check plug-ins that work with SNMP are developed in a similar way to their <a href="devel_check_plugins.html">agent-based relatives</a>.
The difference lies both in the <a href="glossar.html#service_discovery">service discovery</a> process and in the check itself.
With the agent-based check plug-ins, the <a href="glossar.html#agent_plugin">agent plug-in</a> is used to determine which data is <em>sent</em> to the Checkmk site, and pre-filtering (but no evaluation) often already takes place on the host.
In contrast, with SNMP you must specify exactly which data fields you require and explicitly <em>request</em> these.
With SNMP, these areas (branches of a tree) or individual data fields (leaves) are identified by OIDs (object identifiers).</p></div>
<div class="paragraph"><p>A complete transfer of all data would theoretically be possible (using the so-called <em>SNMP walk</em>),
However, even with fast devices this takes minutes, and with complex switches it can take over an hour.
This is therefore already a problem during a discovery and even more so during the check itself.
Here Checkmk takes a more targeted approach.
Nevertheless, SNMP walks are available in Checkmk for debugging existing checks and developing your own checks.</p></div>
<div class="paragraph"><p>If you do not yet have experience with SNMP, we recommend that you read the article on <a href="snmp.html">Monitoring via SNMP</a>.</p></div>
<div class="sect2">
<h3 id="heading_snmp_special">
<span class="hidden-anchor sr-only" id="snmp_special"></span>1.1. What works differently in SNMP?</h3>
<div class="paragraph"><p>Compared to a check plug-in for the Checkmk agent, there are some special features to note with SNMP.
With a check plug-in for SNMP, a service discovery is divided into two phases.</p></div>
<div class="paragraph"><p>As a first step, the <strong>SNMP detection</strong> function is used to detect the device.
This serves to determine whether the check plug-in is of any interest to the respective device and is carried out for every device that is monitored via SNMP.
For this purpose, a few OIDs are retrieved — individual ones, without an SNMP walk.
The most important of these is the <code>sysDescr</code> (OID: <code>1.3.6.1.2.1.1.1.0</code>).
Under this OID, each SNMP device provides a description of itself, for example <code>Flintstones, Inc. Fred Router rev23</code>.</p></div>
<div class="paragraph"><p>In the second step, the necessary monitoring data is retrieved for each of these candidates using SNMP walks.
These are then summarized in a table and provided to the check plug-in’s <strong>discovery function</strong> in the <code>section</code> argument, which then determines the items to be monitored.
A <a href="glossar.html#service">service</a> is then generated for each of these items.</p></div>
<div class="paragraph"><p>During the <strong>check</strong> it is then already known whether the plug-in should be executed for the device and thus a new SNMP detection is not necessary.
The current monitoring data required for the plug-in is retrieved here via SNMP walks.</p></div>
<div class="paragraph"><p>So what do you have to do differently with a check plug-in for SNMP compared to an agent-based one?</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>You do <em>not</em> need an <a href="glossar.html#agent_plugin">agent plug-in</a>.</p></li>
<li><p>You define the OIDs required for SNMP detection and the texts they should contain.</p></li>
<li><p>You decide which branches and leaves of the SNMP tree need to be fetched for monitoring.</p></li>
</ol></div>
</div>
<div class="sect2">
<h3 id="heading_mibs">
<span class="hidden-anchor sr-only" id="mibs"></span>1.2. Don’t be afraid of MIBs!</h3>
<div class="paragraph"><p>In this brief introduction we would like to discuss the notorious SNMP MIBs, about which there are many prejudices.
The good news:
Checkmk does not need MIBs!
However, they can be an important aid when <em>developing</em> a check plug-in or <em>troubleshooting</em> existing check plug-ins.</p></div>
<div class="paragraph"><p>What are MIBs?
MIB literally means <em>Management Information Base,</em> which contains little more information than the abbreviation itself.
Basically, an MIB is a human-readable text file that describes the branches and leaves in an SNMP data tree.</p></div>
<div class="paragraph"><p>OIDs can identify branches or leaves.
The branch description contains information on the system and subsystem information provided by the branch.
If an OID references a leaf, the information in the MIB contains information on the data type (character string, fixed-point number, hex string, …​), the value range and the representation.
For example, temperatures can be stored as a fixed-point number with a sign on the Celsius scale with a resolution of 0.1° or without a sign in steps of 1.0° on the Kelvin scale.</p></div>
<div class="paragraph"><p>Checkmk provides a series of freely accessible MIB files.
These describe very general fields in the global OID tree, but do not contain any manufacturer-specific fields.
They are therefore not much help for self-developed check plug-ins.</p></div>
<div class="paragraph"><p>So try to find the relevant MIB files for your specific device somewhere on the manufacturer’s website or even on the device’s management interface.
Install these files in the Checkmk site in the <code>~/local/share/check_mk/mibs/</code> directory.
You can then translate OID numbers into names using SNMP walks and thus more quickly find the data of interest for purposes of monitoring.
As already mentioned, well-maintained MIBs also contain interesting information in their comments.
You can easily view a MIB file with a text editor or the pager <code>less</code>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_locating_oids">
<span class="hidden-anchor sr-only" id="locating_oids"></span>2. Finding the correct OIDs</h2>
<div class="sectionbody">
<div class="paragraph"><p>The crucial prerequisite for developing an SNMP-based check plug-in is that you know which OIDs contain the relevant information.
For the example scenario presented, we have assumed that you have just commissioned a batch of routers of the type <em>Flintstones, Inc. Fred Router rev23</em>.
You will often come across this fictitious device in manufacturer documentation and MIB comments.
However, you have forgotten to enter the contact and location information for some devices.
A self-written check plug-in for Checkmk should now help to identify these devices.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>The example plug-in we have prepared is written in such a way that you can run it with almost any SNMP-capable device.
You only need to adapt the character string to be compared.
If you do not have a device at hand, you will find various simulation options in the chapter on <a href="#simulation">Troubleshooting</a>.</p></div></td>
</tr></table></div>
<div class="paragraph"><p>The first step is to carry out a complete SNMP walk.
This involves retrieving <em>all</em> of the available data via SNMP.
This can be done very easily for you with Checkmk.
First include the device for which you want to develop a check plug-in <a href="snmp.html#add_device">in the monitoring</a>.
Make sure that it can be monitored <a href="snmp.html#services">in the basic functions</a>.
At the very least, the <span class="guihint">SNMP Info</span> and <span class="guihint">Uptime</span> services must be found and probably also at least one <span class="guihint">Interface.</span>
This will ensure that the SNMP access works properly.</p></div>
<div class="paragraph"><p>Then switch to the Checkmk site’s command line.
Here you can execute a complete walk with the following command — in the following example for the device with the host name <code>mydevice01</code>.
We recommend that you also use the <code>-v</code> option (for <em>verbose</em>):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-v<span class="tok-w"> </span>--snmpwalk<span class="tok-w"> </span>mydevice01
<span class="tok-go">mydevice01:</span>
<span class="tok-go">Walk on ".1.3.6.1.2.1"...3898 variables.</span>
<span class="tok-go">Walk on ".1.3.6.1.4.1"...6025 variables.</span>
<span class="tok-go">Wrote fetched data to /omd/sites/mysite/var/check_mk/snmpwalks/mydevice01.</span></code></pre></div></div>
<div class="paragraph"><p>As already mentioned, a complete SNMP walk can take minutes or even hours (even if the latter is a rare occurrence), so don’t get nervous if it takes a while to complete.
The walk’s results is saved in the <code>~/var/check_mk/snmpwalks/mydevice01</code> file.
This is a text file that is easy to read and starts like this:</p></div>
<div class="listingblock">
<div class="title">~/var/check_mk/snmpwalks/mydevice01</div>
<div class="content"><pre class="pygments highlight"><code><span></span>.1.3.6.1.2.1.1.1.0 Flintstones, Inc. Fred Router rev23
.1.3.6.1.2.1.1.2.0 .1.3.6.1.4.1.424242.2.3
.1.3.6.1.2.1.1.3.0 546522419
.1.3.6.1.2.1.1.4.0 barney@example.com
.1.3.6.1.2.1.1.5.0 big-router-01
.1.3.6.1.2.1.1.6.0 Server room 23, Stonestreet 52, Munich
.1.3.6.1.2.1.1.7.0 72
.1.3.6.1.2.1.1.8.0 0</code></pre></div>
</div>
<div class="paragraph"><p>Each line contains an OID and then its value.
You will find the most important one in the very first line, namely <code>sysDescr</code>.
This should be a unique identifier for a hardware model.</p></div>
<div class="paragraph"><p>The second line is also interesting:
Below <code>1.3.6.1.4.1</code> there are branches that hardware manufacturers can assign themselves, here <em>Flintstones, Inc.</em> has the fictitious manufacturer ID <code>424242</code>.
Below this, the company has assigned <code>2</code> for routers and <code>3</code> for the same model.
You will then find device-specific OIDs within this branch.</p></div>
<div class="paragraph"><p>These OIDs are however not very meaningful.
If the correct MIBs are installed, you can translate these into names in a second step.
It is best to redirect the output from the following command, which would otherwise be displayed in the terminal, to a file:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>--snmptranslate<span class="tok-w"> </span>mydevice01<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>/tmp/translated</code></pre></div></div>
<div class="paragraph"><p>Once this file has been <code>translated</code> it reads like the original walk, but additionally shows the name of the OID in each line after the <code>--&gt;</code>:</p></div>
<div class="listingblock">
<div class="title">/tmp/translated</div>
<div class="content"><pre class="pygments highlight"><code><span></span>.1.3.6.1.2.1.1.1.0 Flintstones, Inc. Fred Router rev23 --&gt; SNMPv2-MIB::sysDescr.0
.1.3.6.1.2.1.1.2.0 .1.3.6.1.4.1.424242.2.3 --&gt; SNMPv2-MIB::sysObjectID.0
.1.3.6.1.2.1.1.3.0 546522419 --&gt; DISMAN-EVENT-MIB::sysUpTimeInstance
<span class="hll">.1.3.6.1.2.1.1.4.0 barney@example.com --&gt; SNMPv2-MIB::sysContact.0
</span>.1.3.6.1.2.1.1.5.0 big-router-01 --&gt; SNMPv2-MIB::sysName.0
.1.3.6.1.2.1.1.6.0 Server room 23, Stonestreet 52, Munich --&gt; SNMPv2-MIB::sysLocation.0
.1.3.6.1.2.1.1.7.0 42 --&gt; SNMPv2-MIB::sysServices.0
.1.3.6.1.2.1.1.8.0 27 --&gt; SNMPv2-MIB::sysORLastChange.0</code></pre></div>
</div>
<div class="paragraph"><p>In the above output, for example, the OID <code>1.3.6.1.2.1.1.4.0</code> has the value <code>barney@example.com</code> and the name <code>SNMPv2-MIB::sysContact.0</code>.
The additional information showing the names of the OIDs provides important information for identifying the OIDs of interest.
For the example presented, the OIDs <code>1.3.6.1.2.1.1.4.0</code> to <code>1.3.6.1.2.1.1.6.0</code> are sufficient.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_simple_snmp_plugin">
<span class="hidden-anchor sr-only" id="simple_snmp_plugin"></span>3. Writing a simple check plug-in</h2>
<div class="sectionbody">
<div class="paragraph"><p>You have now completed the preparatory work:
Now you have a list of the OIDs that you want to read and evaluate.
The task now is to use these notes to teach Checkmk which services are generated and when they should go to <span class="state1">WARN</span> or <span class="state2">CRIT</span>.
The programming of a check plug-in in Python used for this has many parallels to an <a href="devel_check_plugins.html#write_check_plugin">agent-based check plug-in</a>.
As there are some subtleties to consider, we will show the complete structure with all of the functions that are used.</p></div>
<div class="sect2">
<h3 id="heading_scaffold">
<span class="hidden-anchor sr-only" id="scaffold"></span>3.1. Preparing the file</h3>
<div class="paragraph"><p>For your own check plug-ins you will find the base directory already prepared in the <code>local</code> hierarchy of the <a href="cmk_commandline.html#sitedir">site directory</a>.
This is <code>~/local/lib/python3/cmk_addons/plugins/</code>.
The directory belongs to the site user and is therefore writable for you.</p></div>
<div class="paragraph"><p>In this directory, the plug-ins are organized in <em>plug-in families</em>, whose directory names can be freely chosen.
For example, all plug-ins relating to Cisco devices are stored in the <code>cisco</code> folder — or all plug-ins relating to routers from the manufacturer <code>Flintstones, Inc.</code> are stored in the <code>flintstone</code> folder.</p></div>
<div class="paragraph"><p>In this subdirectory <code>&lt;plug-in_family&gt;</code>, further subdirectories with predefined names are then created as required for the various APIs, e.g. <code>agent_based</code> for the Check API of agent-based plug-ins, including SNMP-based check plug-ins.</p></div>
<div class="paragraph"><p>Create the two subdirectories for the new check plug-in and then switch to them to work:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>mkdir<span class="tok-w"> </span>-p<span class="tok-w"> </span>local/lib/python3/cmk_addons/plugins/flintstone/agent_based
<span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>local/lib/python3/cmk_addons/plugins/flintstone/agent_based</code></pre></div></div>
<div class="paragraph"><p>Create the file <code>flintstone_setup_check.py</code> for the check plug-in here.
The convention is that the file name reflects the name of the check plug-in as it is defined when the check plug-in is created as an instance of the <code>CheckPlugin</code> class.
It is <em>mandatory</em> that the file ends with <code>.py</code>, because from Checkmk version <span class="new">2.0.0</span> the check plug-ins are always real Python modules.</p></div>
<div class="paragraph"><p>An executable basic framework (<a href="https://github.com/Checkmk/checkmk-docs/blob/master/examples/devel_check_plugins_snmp/flintstone_setup_check_bare_minimum.py" target="_blank">Download at GitHub</a>), which you will expand step by step in the following, looks like this:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-ch">#!/usr/bin/env python3</span>

<span class="tok-kn">from</span> <span class="tok-nn">cmk.agent_based.v2</span> <span class="tok-kn">import</span> <span class="tok-p">(</span>
    <span class="tok-n">CheckPlugin</span><span class="tok-p">,</span>
    <span class="tok-n">CheckResult</span><span class="tok-p">,</span>
    <span class="tok-n">startswith</span><span class="tok-p">,</span>
    <span class="tok-n">DiscoveryResult</span><span class="tok-p">,</span>
    <span class="tok-n">Result</span><span class="tok-p">,</span>
    <span class="tok-n">Service</span><span class="tok-p">,</span>
    <span class="tok-n">SimpleSNMPSection</span><span class="tok-p">,</span>
    <span class="tok-n">SNMPTree</span><span class="tok-p">,</span>
    <span class="tok-n">State</span><span class="tok-p">,</span>
    <span class="tok-n">StringTable</span><span class="tok-p">,</span>
<span class="tok-p">)</span>

<span class="tok-k">def</span> <span class="tok-nf">parse_flintstone</span><span class="tok-p">(</span><span class="tok-n">string_table</span><span class="tok-p">):</span>
    <span class="tok-k">return</span> <span class="tok-p">{}</span>

<span class="tok-k">def</span> <span class="tok-nf">discover_flintstone</span><span class="tok-p">(</span><span class="tok-n">section</span><span class="tok-p">):</span>
    <span class="tok-k">yield</span> <span class="tok-n">Service</span><span class="tok-p">()</span>

<span class="tok-k">def</span> <span class="tok-nf">check_flintstone</span><span class="tok-p">(</span><span class="tok-n">section</span><span class="tok-p">):</span>
    <span class="tok-k">yield</span> <span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-n">state</span><span class="tok-o">=</span><span class="tok-n">State</span><span class="tok-o">.</span><span class="tok-n">OK</span><span class="tok-p">,</span> <span class="tok-n">summary</span><span class="tok-o">=</span><span class="tok-s2">"Everything is fine"</span><span class="tok-p">)</span>

<span class="tok-n">snmp_section_flintstone_setup</span> <span class="tok-o">=</span> <span class="tok-n">SimpleSNMPSection</span><span class="tok-p">(</span>
    <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s2">"flintstone_base_config"</span><span class="tok-p">,</span>
    <span class="tok-n">parse_function</span> <span class="tok-o">=</span> <span class="tok-n">parse_flintstone</span><span class="tok-p">,</span>
    <span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"Flintstone"</span><span class="tok-p">),</span>
    <span class="tok-n">fetch</span> <span class="tok-o">=</span> <span class="tok-n">SNMPTree</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-o">=</span><span class="tok-s1">'.1.3.6.1.2.1.1'</span><span class="tok-p">,</span> <span class="tok-n">oids</span><span class="tok-o">=</span><span class="tok-p">[</span><span class="tok-s1">'4.0'</span><span class="tok-p">]),</span>
<span class="tok-p">)</span>

<span class="tok-n">check_plugin__flintstone_setup</span> <span class="tok-o">=</span> <span class="tok-n">CheckPlugin</span><span class="tok-p">(</span>
    <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s2">"flintstone_setup_check"</span><span class="tok-p">,</span>
    <span class="tok-n">sections</span> <span class="tok-o">=</span> <span class="tok-p">[</span> <span class="tok-s2">"flintstone_base_config"</span> <span class="tok-p">],</span>
    <span class="tok-n">service_name</span> <span class="tok-o">=</span> <span class="tok-s2">"Flintstone setup check"</span><span class="tok-p">,</span>
    <span class="tok-n">discovery_function</span> <span class="tok-o">=</span> <span class="tok-n">discover_flintstone</span><span class="tok-p">,</span>
    <span class="tok-n">check_function</span> <span class="tok-o">=</span> <span class="tok-n">check_flintstone</span><span class="tok-p">,</span>
<span class="tok-p">)</span></code></pre></div>
</div>
<div class="paragraph"><p>First you will need to import the functions and classes required for the check plug-ins from Python modules.
We advise against the occasionally used <code>import *</code>, as it makes unnecessary use of memory and obscures which namespaces are actually made available.
For our example, we will only import what will be required or may be useful in the rest of this article:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">cmk.agent_based.v2</span> <span class="tok-kn">import</span> <span class="tok-p">(</span>
    <span class="tok-n">CheckPlugin</span><span class="tok-p">,</span>
    <span class="tok-n">CheckResult</span><span class="tok-p">,</span>
    <span class="tok-n">startswith</span><span class="tok-p">,</span>
    <span class="tok-n">DiscoveryResult</span><span class="tok-p">,</span>
    <span class="tok-n">Result</span><span class="tok-p">,</span>
    <span class="tok-n">Service</span><span class="tok-p">,</span>
    <span class="tok-n">SimpleSNMPSection</span><span class="tok-p">,</span>
    <span class="tok-n">SNMPTree</span><span class="tok-p">,</span>
    <span class="tok-n">State</span><span class="tok-p">,</span>
    <span class="tok-n">StringTable</span><span class="tok-p">,</span>
<span class="tok-p">)</span></code></pre></div>
</div>
<div class="paragraph"><p>In comparison with the <a href="devel_check_plugins.html#scaffold">agent-based check plug-in</a>, the SNMP-specific new functions and classes stand out: <code>SNMPTree</code>, <code>SimpleSNMPSection</code> and <code>startswith</code>.
Self-explanatory is <code>SNMPTree</code>, which is a class for displaying SNMP trees.
The class <code>SimpleSNMPSection</code> is used to create an SNMP section.
The function <code>startswith()</code> compares the content of an SNMP leaf with a character string.
More on this later.</p></div>
</div>
<div class="sect2">
<h3 id="heading_snmp_section">
<span class="hidden-anchor sr-only" id="snmp_section"></span>3.2. Creating the SNMP section</h3>
<div class="paragraph"><p>After you have identified the <a href="#locating_oids">correct OIDs</a>, it’s time to actually develop the check plug-in.
When creating the SNMP section, you specify two things:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>You identify the devices for which the check plug-in is to be executed.<br>
In the following example, this is done with the <code>startswith()</code> function, which compares a character string with the start of the content of an OID leaf.
Further assignment options are shown below.</p></li>
<li><p>You declare which OID branches or leaves are to be retrieved for monitoring.<br>
This is done with the constructor of the <code>SNMPTree</code> class.</p></li>
</ol></div>
<div class="paragraph"><p>Extend the prepared example file so that the plug-in is only executed for a small number of devices, here the <code>Flintstones, Inc. Fred Router</code> models.
The OIDs for <em>contact</em>, <em>device name</em> and <em>location</em> are then retrieved for these devices.
These three OIDs are provided by each device.
If you want to test the example with real SNMP-capable devices, it is therefore sufficient to customize the model name to be recognized.</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">snmp_section_flintstone_setup_check</span> <span class="tok-o">=</span> <span class="tok-n">SimpleSNMPSection</span><span class="tok-p">(</span>
    <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s2">"flintstone_base_config"</span><span class="tok-p">,</span>
    <span class="tok-n">parse_function</span> <span class="tok-o">=</span> <span class="tok-n">parse_flintstone</span><span class="tok-p">,</span>
    <span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">startswith</span><span class="tok-p">(</span>
        <span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span>
        <span class="tok-s2">"Flintstones, Inc. Fred Router"</span><span class="tok-p">,</span>
    <span class="tok-p">),</span>
    <span class="tok-n">fetch</span> <span class="tok-o">=</span> <span class="tok-n">SNMPTree</span><span class="tok-p">(</span>
        <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-s1">'.1.3.6.1.2.1.1'</span><span class="tok-p">,</span>
        <span class="tok-n">oids</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s1">'4.0'</span><span class="tok-p">,</span> <span class="tok-s1">'5.0'</span><span class="tok-p">,</span> <span class="tok-s1">'6.0'</span><span class="tok-p">],</span>
    <span class="tok-p">),</span>
<span class="tok-p">)</span></code></pre></div>
</div>
<div class="paragraph"><p>The example also contains the <code>name</code> parameter with which the generated SNMP section is identified and a parse function, which we will discuss <a href="#parse_function">later</a>.</p></div>
<div class="sect3">
<h4 id="heading_detect">
<span class="hidden-anchor sr-only" id="detect"></span>The SNMP detection</h4>
<div class="paragraph"><p>Use the <code>detect</code> parameter to specify the conditions under which the discovery function should be executed.
In our example, this is the case if the value of the OID <code>1.3.6.1.2.1.1.1.0</code> (i.e. the <code>sysDescr</code>) begins with the text <code>Flintstones, Inc. Fred Router</code> (case-insensitive).
In addition to <code>startswith</code>, there is a whole range of other possible functions for identification.
There is also a negated form of each, which begins with <code>not_</code>.
Note that each function must be separately specified in the <code>import</code> statement.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Negation</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>equals(oid, "needle")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the OID matches the text <code>needle</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_equals(oid, "needle")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contains(oid, "needle")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the OID contains the text <code>needle</code> at some point.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_contains(oid, "needle")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>startswith(oid, "needle")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the OID begins with the text <code>needle</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_startswith(oid, "needle")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endswith(oid, "needle")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the OID ends with the text <code>needle</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_endswith(oid, "needle")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>matches(oid, regex)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the OID corresponds to the <a href="regexes.html">regular expression</a> <code>regex</code>, anchored after and before, i.e. with an exact match. If you only need a substring, simply add a <code>.*</code> to the start or end.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_matches(oid, regex)</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exists(oid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OID is available on the device. Its value may be empty.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_exists(oid)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>There is also the option of linking several attributes with <code>all_of</code> or <code>any_of</code>.</p></div>
<div class="paragraph"><p><code>all_of</code> requires several successful checks for positive recognition.
The following example assigns your check plug-in to a device if the text in the <code>sysDescr</code> begins with <code>foo</code> (or <code>FOO</code> or <code>Foo</code>) <strong>and</strong>
the OID <code>1.3.6.1.2.1.1.2.0</code> contains the text <code>.4.1.11863.</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">all_of</span><span class="tok-p">(</span>
    <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"foo"</span><span class="tok-p">),</span>
    <span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.2.0"</span><span class="tok-p">,</span> <span class="tok-s2">".4.1.11863."</span><span class="tok-p">)</span>
<span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>In contrast, <code>any_of</code> is satisfied if only one of the criteria has been met.
Here is an example in which different values are permitted for the <code>sysDescr</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">any_of</span><span class="tok-p">(</span>
    <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"foo version 3 system"</span><span class="tok-p">),</span>
    <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"foo version 4 system"</span><span class="tok-p">),</span>
    <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"foo version 4.1 system"</span><span class="tok-p">),</span>
<span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>By the way: Are you familiar with <a href="regexes.html">regular expressions</a>?
If so, you could probably simplify this example and get by with just a single line:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"FOO Version (3|4|4.1) .*"</span><span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>And another important note:
The OIDs that you pass to the SNMP detection for a check plug-in are retrieved from <strong>every</strong> device that is monitored via SNMP.
This is the only way Checkmk can determine which devices the check plug-in should be applied to.</p></div>
<div class="paragraph"><p>You should therefore be very careful when using manufacturer-specific OIDs.
Try to design your SNMP detection to prioritize that the <code>sysDescr</code> (<code>1.3.6.1.2.1.1.1.0</code>) and the <code>sysObjectID</code> (<code>1.3.6.1.2.1.1.2.0</code>) are checked first.</p></div>
<div class="paragraph"><p>If you still need a different OID for exact identification, use <code>all_of()</code> and proceed as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>First check for <code>sysDescr</code> or <code>sysObjectID</code>.</p></li>
<li><p>In further arguments, you can then further restrict the group of devices for which your plug-in is to be executed.</p></li>
</ol></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">detect</span> <span class="tok-o">=</span> <span class="tok-n">all_of</span><span class="tok-p">(</span>
    <span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.2.1.1.1.0"</span><span class="tok-p">,</span> <span class="tok-s2">"Flintstone"</span><span class="tok-p">),</span>   <span class="tok-c1"># first check sysDescr</span>
    <span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s2">".1.3.6.1.4.1.424242.2.3.37.0"</span><span class="tok-p">,</span> <span class="tok-s2">"foo"</span><span class="tok-p">),</span>  <span class="tok-c1"># fetch vendor specific OID</span>
<span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>This works thanks to the <em>lazy evaluation</em> principle:
As soon as one of the earlier checks fails, no further checks will be performed.
In the example above, the OID <code>1.3.6.1.4.1.424242.2.3.37.0</code> is only retrieved from devices that also have <code>Flintstone</code> in their <code>sysDescr</code>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_parse_function">
<span class="hidden-anchor sr-only" id="parse_function"></span>3.3. Writing the parse function</h3>
<div class="paragraph"><p>As with <a href="devel_check_plugins.html#parse_function">agent-based plug-ins</a>, the parse function in the SNMP-based check plug-in also has the task of converting the received agent data into a form that can be processed easily and, above all, with high performance.</p></div>
<div class="paragraph"><p>You also receive the data here as a list.
However, there are a few subtleties to consider, as it makes a difference whether you are querying leaves or branches.
As a reminder — in our <a href="#snmp_section">above example</a>, leaves are requested:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span>    <span class="tok-n">fetch</span> <span class="tok-o">=</span> <span class="tok-n">SNMPTree</span><span class="tok-p">(</span>
        <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-s1">'.1.3.6.1.2.1.1'</span><span class="tok-p">,</span>
        <span class="tok-n">oids</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s1">'4.0'</span><span class="tok-p">,</span> <span class="tok-s1">'5.0'</span><span class="tok-p">,</span> <span class="tok-s1">'6.0'</span><span class="tok-p">],</span>
    <span class="tok-p">)</span></code></pre></div>
</div>
<div class="paragraph"><p>If you temporarily extend the parse function with the <code>print()</code> function, you can display the data that Checkmk provides from this query when <a href="#test">testing the check plug-in</a>:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">parse_flintstone</span><span class="tok-p">(</span><span class="tok-n">string_table</span><span class="tok-p">):</span>
    <span class="tok-nb">print</span><span class="tok-p">(</span><span class="tok-n">string_table</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-p">{}</span></code></pre></div>
</div>
<div class="paragraph"><p>You will receive a nested list which contains only one element in its first level, namely a list of the retrieved values:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-p">[</span>
    <span class="tok-p">[</span><span class="tok-s1">'barney@example.com'</span><span class="tok-p">,</span> <span class="tok-s1">'big-router-01'</span><span class="tok-p">,</span> <span class="tok-s1">'Server room 23, Stonestreet 52, Munich'</span><span class="tok-p">]</span>
<span class="tok-p">]</span></code></pre></div></div>
<div class="paragraph"><p>The result looks a little different if you retrieve branches that contain multiple leaves.
Assume that the router can be equipped with a variable number of network cards whose name, connection status and speed can be read below <code>1.3.6.1.4.1.424242.2.3.23</code> …</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span>    <span class="tok-n">fetch</span> <span class="tok-o">=</span> <span class="tok-n">SNMPTree</span><span class="tok-p">(</span>
        <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-s1">'.1.3.6.1.4.1.424242.2.3.23'</span><span class="tok-p">,</span>
        <span class="tok-n">oids</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
            <span class="tok-s1">'6'</span><span class="tok-p">,</span> <span class="tok-c1"># all names</span>
            <span class="tok-s1">'7'</span><span class="tok-p">,</span> <span class="tok-c1"># all states</span>
            <span class="tok-s1">'8'</span><span class="tok-p">,</span> <span class="tok-c1"># all speeds</span>
        <span class="tok-p">],</span>
    <span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>… then the two-dimensional list could possibly look like this:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-p">[</span>
    <span class="tok-c1"># Name, State, Speed</span>
    <span class="tok-p">[</span><span class="tok-s1">'net0'</span><span class="tok-p">,</span> <span class="tok-s1">'1'</span><span class="tok-p">,</span> <span class="tok-s1">'1000'</span><span class="tok-p">],</span>
    <span class="tok-p">[</span><span class="tok-s1">'net1'</span><span class="tok-p">,</span> <span class="tok-s1">'0'</span><span class="tok-p">,</span> <span class="tok-s1">'100'</span><span class="tok-p">],</span>
    <span class="tok-p">[</span><span class="tok-s1">'net2'</span><span class="tok-p">,</span> <span class="tok-s1">'1'</span><span class="tok-p">,</span> <span class="tok-s1">'10000'</span><span class="tok-p">],</span>
    <span class="tok-p">[</span><span class="tok-s1">'net3'</span><span class="tok-p">,</span> <span class="tok-s1">'1'</span><span class="tok-p">,</span> <span class="tok-s1">'1000'</span><span class="tok-p">],</span>
<span class="tok-p">]</span></code></pre></div></div>
<div class="paragraph"><p>All leaves available under an OID are written to a table column.
It should therefore be obvious that for the purposes of displaying the data, only matching OIDs may be queried.</p></div>
<div class="admonitionblock tip"><table><tr>
<td class="icon"><img src="../images/icons/tip.png" alt="Tip"></td>
<td class="content"><div class="paragraph"><p>The last example shown for retrieving OID branches is also a part of our <a href="https://github.com/Checkmk/checkmk-docs/blob/master/examples/devel_check_plugins_snmp/flintstones_fred_router.txt" target="_blank">SNMP walk</a> provided on GitHub, which you can use for <a href="#simulation">simulations</a>.</p></div></td>
</tr></table></div>
<div class="paragraph"><p>But now back to the example in which the OID leaves for contact, device name and location are queried:
The following parse function simply copies each element of the inner list into a key-value pair in the returned dictionary:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">parse_flintstone</span><span class="tok-p">(</span><span class="tok-n">string_table</span><span class="tok-p">):</span>
    <span class="tok-c1"># print(string_table)</span>
    <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
    <span class="tok-n">result</span><span class="tok-p">[</span><span class="tok-s2">"contact"</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">string_table</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">][</span><span class="tok-mi">0</span><span class="tok-p">]</span>
    <span class="tok-n">result</span><span class="tok-p">[</span><span class="tok-s2">"name"</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">string_table</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">][</span><span class="tok-mi">1</span><span class="tok-p">]</span>
    <span class="tok-n">result</span><span class="tok-p">[</span><span class="tok-s2">"location"</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">string_table</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">][</span><span class="tok-mi">2</span><span class="tok-p">]</span>
    <span class="tok-c1"># print(result)</span>
    <span class="tok-k">return</span> <span class="tok-n">result</span></code></pre></div>
</div>
<div class="paragraph"><p>The result from the parse function will then look like this:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-p">{</span>
    <span class="tok-s1">'contact'</span><span class="tok-p">:</span> <span class="tok-s1">'barney@example.com'</span><span class="tok-p">,</span>
    <span class="tok-s1">'name'</span><span class="tok-p">:</span> <span class="tok-s1">'big-router-01'</span><span class="tok-p">,</span>
    <span class="tok-s1">'location'</span><span class="tok-p">:</span> <span class="tok-s1">'Server room 23, Stonestreet 52, Munich'</span>
<span class="tok-p">}</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_check_plug-in">
<span class="hidden-anchor sr-only" id="check_plug-in"></span>3.4. Creating the check plug-in</h3>
<div class="paragraph"><p>A check plug-in is created exactly as described in <a href="devel_check_plugins.html#check_plug-in">agent-based check plug-ins</a>.</p></div>
<div class="paragraph"><p>Since in most cases you will be querying several SNMP branches and this will result in several SNMP sections, the <code>sections</code> parameter with the list of sections to be evaluated is usually required:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">check_plugin__flintstone_setup</span> <span class="tok-o">=</span> <span class="tok-n">CheckPlugin</span><span class="tok-p">(</span>
    <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s2">"flintstone_setup_check"</span><span class="tok-p">,</span>
    <span class="tok-n">sections</span> <span class="tok-o">=</span> <span class="tok-p">[</span> <span class="tok-s2">"flintstone_base_config"</span> <span class="tok-p">],</span>
    <span class="tok-n">service_name</span> <span class="tok-o">=</span> <span class="tok-s2">"Flintstone setup check"</span><span class="tok-p">,</span>
    <span class="tok-n">discovery_function</span> <span class="tok-o">=</span> <span class="tok-n">discover_flintstone</span><span class="tok-p">,</span>
    <span class="tok-n">check_function</span> <span class="tok-o">=</span> <span class="tok-n">check_flintstone</span><span class="tok-p">,</span>
<span class="tok-p">)</span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_discovery_function">
<span class="hidden-anchor sr-only" id="discovery_function"></span>3.5. Writing the discovery function</h3>
<div class="paragraph"><p>The discovery function also corresponds to the example for <a href="devel_check_plugins.html#discovery_function">agent-based check plug-ins</a>.
For check plug-ins that only generate one service per host, a single <code>yield()</code> is sufficient:</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">discover_flintstone</span><span class="tok-p">(</span><span class="tok-n">section</span><span class="tok-p">):</span>
    <span class="tok-k">yield</span> <span class="tok-n">Service</span><span class="tok-p">()</span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_check_function">
<span class="hidden-anchor sr-only" id="check_function"></span>3.6. Writing the check function</h3>
<div class="paragraph"><p>In the example, we want to check whether the contact, device name and location information is available.
It is therefore sufficient to check which fields are empty in the check function and accordingly set the status to <span class="state2">CRIT</span> (if something is missing) or to <span class="state0">OK</span> (if everything is available):</p></div>
<div class="listingblock">
<div class="title">~/local/lib/python3/cmk_addons/plugins/flintstone/agent_based/flintstone_setup_check.py</div>
<div class="content"><pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">check_flintstone</span><span class="tok-p">(</span><span class="tok-n">section</span><span class="tok-p">):</span>
    <span class="tok-n">missing</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
    <span class="tok-k">for</span> <span class="tok-n">e</span> <span class="tok-ow">in</span> <span class="tok-p">[</span><span class="tok-s2">"contact"</span><span class="tok-p">,</span> <span class="tok-s2">"name"</span><span class="tok-p">,</span> <span class="tok-s2">"location"</span><span class="tok-p">]:</span>
        <span class="tok-k">if</span> <span class="tok-n">section</span><span class="tok-p">[</span><span class="tok-n">e</span><span class="tok-p">]</span> <span class="tok-o">==</span> <span class="tok-s2">""</span><span class="tok-p">:</span>
            <span class="tok-n">missing</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>
            <span class="tok-k">yield</span> <span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-n">state</span><span class="tok-o">=</span><span class="tok-n">State</span><span class="tok-o">.</span><span class="tok-n">CRIT</span><span class="tok-p">,</span> <span class="tok-n">summary</span><span class="tok-o">=</span><span class="tok-sa">f</span><span class="tok-s2">"Missing information: </span><span class="tok-si">{</span><span class="tok-n">e</span><span class="tok-si">}</span><span class="tok-s2">!"</span><span class="tok-p">)</span>
    <span class="tok-k">if</span> <span class="tok-n">missing</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">:</span>
        <span class="tok-k">yield</span> <span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-n">state</span><span class="tok-o">=</span><span class="tok-n">State</span><span class="tok-o">.</span><span class="tok-n">CRIT</span><span class="tok-p">,</span> <span class="tok-n">summary</span><span class="tok-o">=</span><span class="tok-sa">f</span><span class="tok-s2">"Missing fields: </span><span class="tok-si">{</span><span class="tok-n">missing</span><span class="tok-si">}</span><span class="tok-s2">!"</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-k">yield</span> <span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-n">state</span><span class="tok-o">=</span><span class="tok-n">State</span><span class="tok-o">.</span><span class="tok-n">OK</span><span class="tok-p">,</span> <span class="tok-n">summary</span><span class="tok-o">=</span><span class="tok-s2">"All required information is available."</span><span class="tok-p">)</span></code></pre></div>
</div>
<div class="paragraph"><p>Once the check function has been created, the check plug-in will be ready for use.</p></div>
<div class="paragraph"><p>We have made this complete check plug-in available at <a href="https://github.com/Checkmk/checkmk-docs/blob/master/examples/devel_check_plugins_snmp/flintstone_setup_check.py" target="_blank">GitHub</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_test">
<span class="hidden-anchor sr-only" id="test"></span>3.7. Testing and activating the check plug-in</h3>
<div class="paragraph"><p>Testing and activation are carried out in the same way as for an <a href="devel_check_plugins.html#test">agent-based check plug-in</a>.</p></div>
<div class="paragraph"><p>The first step is the service discovery for the plug-in:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-vI<span class="tok-w"> </span>--detect-plugins<span class="tok-o">=</span>flintstone_setup_check<span class="tok-w"> </span>mydevice01
<span class="tok-go">Discovering services and host labels on: mydevice01</span>
<span class="tok-go">mydevice01:</span>
<span class="tok-go">+ FETCHING DATA</span>
<span class="tok-go">No piggyback files for 'mydevice01'. Skip processing.</span>
<span class="tok-go">No piggyback files for '127.0.0.1'. Skip processing.</span>
<span class="tok-go">Get piggybacked data</span>
<span class="tok-go">+ ANALYSE DISCOVERED HOST LABELS</span>
<span class="tok-go">SUCCESS - Found no new host labels</span>
<span class="tok-go">+ ANALYSE DISCOVERED SERVICES</span>
<span class="hll"><span class="tok-go">+ EXECUTING DISCOVERY PLUGINS (1)</span>
</span><span class="hll"><span class="tok-go">  1 flintstone_setup_check</span>
</span><span class="hll"><span class="tok-go">SUCCESS - Found 1 services</span>
</span></code></pre></div></div>
<div class="paragraph"><p>As expected, the service discovery was successful.
Now you can test the check contained in the check plug-in:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-v<span class="tok-w"> </span>--detect-plugins<span class="tok-o">=</span>flintstone_setup_check<span class="tok-w"> </span>mydevice01
<span class="tok-go">+ FETCHING DATA</span>
<span class="tok-go">No piggyback files for 'mydevice01'. Skip processing.</span>
<span class="tok-go">No piggyback files for '127.0.0.1'. Skip processing.</span>
<span class="tok-go">Get piggybacked data</span>
<span class="hll"><span class="tok-go">Flintstone setup check All required information is available.</span>
</span><span class="tok-go">No piggyback files for 'mydevice01'. Skip processing.</span>
<span class="tok-go">No piggyback files for '127.0.0.1'. Skip processing.</span>
<span class="tok-go">[snmp] Success, [piggyback] Success ...</span></code></pre></div></div>
<div class="paragraph"><p>After restarting the monitoring core …</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-R
<span class="tok-go">Generating configuration for core (type nagios)...</span>
<span class="tok-go">Precompiling host checks...OK</span>
<span class="tok-go">Validating Nagios configuration...OK</span>
<span class="tok-go">Restarting monitoring core...OK</span></code></pre></div></div>
<div class="paragraph"><p>… the new service will then be visible in the monitoring:</p></div>
<div class="imageblock">
<div class="content"><img src="../images/devel_snmp_service.png" alt="The new service created by the check plug-in in the monitoring."></div>
<div class="title">Since all fields of the three SNMP leaves are filled, the service is <span class="state0">OK</span>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_errors">
<span class="hidden-anchor sr-only" id="errors"></span>4. Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph"><p>As the troubleshooting in <a href="devel_check_plugins.html#errors">agent-based check plug-ins</a> essentially also applies to SNMP-based check plug-ins, we will only deal with the SNMP specifics here.</p></div>
<div class="sect2">
<h3 id="heading_simulation">
<span class="hidden-anchor sr-only" id="simulation"></span>4.1. Simulation options</h3>
<div class="sect3">
<h4 id="heading_savedwalk">
<span class="hidden-anchor sr-only" id="savedwalk"></span>Using saved SNMP walks in Checkmk</h4>
<div class="paragraph"><p>In the article on monitoring via SNMP <a href="snmp.html#simulation">we show in detail</a> how you can create SNMP walks from the GUI and how you can use them for simulation.
This also makes it possible to develop check plug-ins on test systems that cannot access the SNMP hosts for which you are developing a plug-in.
In our GitHub repository you will find an example of an <a href="https://github.com/Checkmk/checkmk-docs/blob/master/examples/devel_check_plugins_snmp/flintstones_fred_router.txt" target="_blank">SNMP walk</a>, which we use in this article and which you can use to develop and test the check plug-in.</p></div>
</div>
<div class="sect3">
<h4 id="heading_dummydaemon">
<span class="hidden-anchor sr-only" id="dummydaemon"></span>The dummy SNMP daemon</h4>
<div class="paragraph"><p>If you want to ensure that specific OIDs change depending on each other, it can be useful to program a dummy SNMP daemon that delivers consistent data.
The <a href="https://pypi.org/project/snmp-agent/" target="_blank">Python <code>snmp-agent</code> module</a> can be an aid when programming such a dummy.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_hwbugs">
<span class="hidden-anchor sr-only" id="hwbugs"></span>4.2. Uncooperative hardware</h3>
<div class="paragraph"><p>Before a device can be monitored with a new SNMP-based check plug-in, it must first be able to be monitored via SNMP.
You can therefore find an overview of known problems with suggested solutions in the article on <a href="snmp.html#cursedhardware">Monitoring via SNMP</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>5. Files and directories</h2>
<div class="sectionbody"><table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">File path</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/local/lib/python3/cmk_addons/plugins/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base directory for storing plug-in files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/local/lib/python3/cmk_addons/plugins/&lt;plug-in_family&gt;/agent_based/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage location for check plug-ins written according to the Check API V2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/local/share/check_mk/mibs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store SNMP MIB files here that are to be loaded automatically.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li>
<a href="#intro">1. Introduction</a><ul class="sectlevel1">
<li><a href="#snmp_special">1.1. What works differently in SNMP?</a></li>
<li><a href="#mibs">1.2. Don’t be afraid of MIBs!</a></li>
</ul>
</li>
<li><a href="#locating_oids">2. Finding the correct OIDs</a></li>
<li>
<a href="#simple_snmp_plugin">3. Writing a simple check plug-in</a><ul class="sectlevel1">
<li><a href="#scaffold">3.1. Preparing the file</a></li>
<li>
<a href="#snmp_section">3.2. Creating the SNMP section</a><ul class="sectlevel2"><li><a href="#detect">The SNMP detection</a></li></ul>
</li>
<li><a href="#parse_function">3.3. Writing the parse function</a></li>
<li><a href="#check_plug-in">3.4. Creating the check plug-in</a></li>
<li><a href="#discovery_function">3.5. Writing the discovery function</a></li>
<li><a href="#check_function">3.6. Writing the check function</a></li>
<li><a href="#test">3.7. Testing and activating the check plug-in</a></li>
</ul>
</li>
<li>
<a href="#errors">4. Troubleshooting</a><ul class="sectlevel1">
<li>
<a href="#simulation">4.1. Simulation options</a><ul class="sectlevel2">
<li><a href="#savedwalk">Using saved SNMP walks in Checkmk</a></li>
<li><a href="#dummydaemon">The dummy SNMP daemon</a></li>
</ul>
</li>
<li><a href="#hwbugs">4.2. Uncooperative hardware</a></li>
</ul>
</li>
<li><a href="#files">5. Files and directories</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
