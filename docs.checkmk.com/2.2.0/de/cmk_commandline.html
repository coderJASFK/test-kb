<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Wenn Sie Checkmk auf der Kommandozeile nutzen wollen, finden Sie hier die wichtigsten Befehle (z.B. cmk) und die zugehörigen Dateien und Verzeichnisse.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Checkmk auf der Kommandozeile - Kommandozeilenbefehle verstehen und nutzen">
<meta name="og:description" content="Wenn Sie Checkmk auf der Kommandozeile nutzen wollen, finden Sie hier die wichtigsten Befehle (z.B. cmk) und die zugehörigen Dateien und Verzeichnisse.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Checkmk auf der Kommandozeile - Kommandozeilenbefehle verstehen und nutzen</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.2.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.2.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.2.0/en/cmk_commandline.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.2.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.1.0/de/cmk_commandline.html">2.1.0</a><a class="dropdown-item" href="../../latest/de/cmk_commandline.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="release_notes.html">Release notes</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und Derivaten</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
<li>
<p><a href="install_azure.html">Installation aus dem Azure Marketplace</a></p>
</li>
<li>
<p><a href="install_aws.html">Installation aus dem AWS Marketplace</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.2.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.2.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="password_store.html">Passwortspeicher (Password store)</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk-Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="mkp_viewables.html">MKPs für GUI-Erweiterungen</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
<li>
<p><a href="hosts_autoregister.html">Automatisch Hosts erstellen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Regeln</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
<li>
<p><a href="notifications_ilert.html">Benachrichtigungen per ilert</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_teams.html">Benachrichtigungen per Microsoft Teams</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_logfiles.html">Log-Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMware ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_gcp.html">Google Cloud Platform (GCP) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_openshift.html">OpenShift überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
<li>
<p><a href="custom_notes.html">Anmerkungen (Custom notes)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cse.html">Die Standard Edition</a></p>
</li>
<li>
<p><a href="cce.html">Die Cloud Edition</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Die Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_intro.html">Erweiterungen für Checkmk entwickeln</a></p>
</li>
<li>
<p><a href="devel_check_plugins.html">Agentenbasierte Check-Plugins schreiben</a></p>
</li>
<li>
<p><a href="devel_check_plugins_snmp.html">SNMP-basierte Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Checkmk auf der Kommandozeile</h1>
<div class="details">
<span id="revdate">Last modified on 28-Apr-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.2.0/src/onprem/de/cmk_commandline.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">Dies ist eine am 2025-01-07 22:12:14 +0000 für die Offline-Nutzung exportierte Seite. Sie spiegelt möglicherweise nicht den aktuellen Stand der Checkmk Dokumentation wider. Um eine täglich aktualisierte Version dieser Seite anzusehen, rufen Sie bitte <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a> auf.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="wato.html">Die Konfiguration von Checkmk</a>
<a href="livestatus.html">Statusdaten abrufen via Livestatus</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__warum_kommandozeile">
<span class="hidden-anchor sr-only" id="_warum_kommandozeile"></span>1. Warum Kommandozeile?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Wenn ein Checkmk-System erst einmal installiert ist, können Sie es zu 100 % über
die Weboberfläche konfigurieren und bedienen. Trotzdem gibt es Situationen,
in denen es nützlich ist, sich auf die Untiefen der Kommandozeile zu
begeben, z.B.</p></div>
<div class="ulist"><ul>
<li><p>bei der Suche nach der Ursache von Problemen,</p></li>
<li><p>beim Automatisieren der Administration von Checkmk,</p></li>
<li><p>beim Programmieren und Testen von eigenen Erweiterungen,</p></li>
<li><p>um zu verstehen, wie Checkmk intern funktioniert oder</p></li>
<li><p>einfach, weil Sie gerne auf der Kommandozeile arbeiten!</p></li>
</ul></div>
<div class="paragraph"><p>Dieser Artikel zeigt Ihnen die wichtigsten Befehle, Dateien und
Verzeichnisse auf der Kommandozeile von Checkmk.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_site_user">
<span class="hidden-anchor sr-only" id="site_user"></span>2. Der Instanzbenutzer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__login_als_instanzbenutzer">
<span class="hidden-anchor sr-only" id="_login_als_instanzbenutzer"></span>2.1. Login als Instanzbenutzer</h3>
<div class="paragraph"><p>Bei der Administration von Checkmk müssen Sie mit wenigen Ausnahmen
niemals als <code>root</code>-Benutzer arbeiten. In diesem Artikel gehen wir
grundsätzlich davon aus, dass Sie als <em>Instanzbenutzer</em> angemeldet
sind. Das geht z.B. mit:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>su<span class="tok-w"> </span>-<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>Auch ein direkter SSH-Login in eine Instanz ohne dem Umweg über <code>root</code>
ist möglich. Da der Instanzbenutzer ein „ganz normaler“ Linux-Benutzer
ist, müssen Sie dazu lediglich ein Passwort vergeben (was ein letztes Mal
<code>root</code>-Rechte erfordert):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>passwd<span class="tok-w"> </span>mysite
<span class="tok-go">Enter new UNIX password: <strong>**********</strong></span>
<span class="tok-go">Retype new UNIX password: <strong>**********</strong></span>
<span class="tok-go">passwd: password updated successfully</span></code></pre></div></div>
<div class="paragraph"><p>Danach sollte ein SSH-Login von einem anderen Rechner aus direkt
möglich sein (Windows-Benutzer verwenden am besten PuTTY dafür).
Von Linux aus geht das einfach mit dem Kommandozeilenbefehl <code>ssh</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">user@otherhost&gt; ssh mysite@myserver123</span>
<span class="tok-go">mysite@localhost's password: <strong>**********</strong></span></code></pre></div></div>
<div class="paragraph"><p>Beim ersten Login bekommen Sie wahrscheinlich eine Warnung wegen eines
unbekannten Host-Schlüssels. Wenn Sie sicher sind, dass kein Angreifer in
diesem Augenblick die IP-Adresse Ihres Monitoring-Systems übernommen hat,
können Sie diese einfach mit <code>yes</code> bestätigen.</p></div>
<div class="paragraph"><p>Auch bei der Checkmk-Appliance können Sie auf die Kommandozeile
zugreifen. Wie das geht, erklärt ein <a href="appliance_usage.html#ssh">eigener Artikel</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading__profil_und_umgebungsvariablen">
<span class="hidden-anchor sr-only" id="_profil_und_umgebungsvariablen"></span>2.2. Profil und Umgebungsvariablen</h3>
<div class="paragraph"><p>Damit es zu möglichst wenig Problemen aufgrund von Besonderheiten einzelner
Distributionen oder unterschiedlicher Betriebssystemkonfigurationen kommt,
sorgt das Checkmk-System dafür, dass Instanzbenutzer — und gleichzeitig
alle Prozesse des Monitorings — immer eine klar definierte Umgebung
haben.  Neben dem Home-Verzeichnis und den Berechtigungen, spielen hier die
<strong>Umgebungsvariablen</strong> (<em>environment variables</em>) eine wichtige Rolle.</p></div>
<div class="paragraph"><p>Unter anderem werden beim Login als Instanzbenutzer folgende Variablen
gesetzt bzw. modifiziert. Sie stehen in allen Prozessen zur Verfügung,
welche innerhalb der Instanz laufen. Das betrifft auch Skripten, die indirekt von diesen
aufgerufen werden (z.B. eigene <a href="notifications.html#scripts">Benachrichtigungsskripte</a>).</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_SITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Name der Instanz (<code>mysite</code>). In eigenen Skripten sollten Sie anstelle eines hartkodierten Instanznamens immer diese Variable verwenden (z.B. in der Shell mit <code>$OMD_SITE</code>). So können Sie das Skript unverändert auch in andere Instanzen übernehmen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_ROOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Pfad des Instanzverzeichnisses (<code>/omd/sites/mysite</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PATH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verzeichnisse, in denen ausführbare Programme gesucht werden. Checkmk hängt hier z.B. das <code>bin/</code> der Instanz mit ein. Bei Namensgleichheit haben Checkmk-Programme Vorrang. Das ist z.B. wichtig beim Befehl <code>mail</code>, den Checkmk in einer ganz bestimmten Version mit ausliefert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LD_LIBRARY_PATH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verzeichnisse, in denen nach zusätzlichen Binärbibliotheken gesucht wird. Durch diese Variable stellt Checkmk sicher, dass mit ausgelieferte Bibliotheken Vorrang vor den im normalen Betriebssystem installierten haben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PERL5LIB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suchpfad für Perl-Module. Auch hier haben von Checkmk ausgelieferte Modulvarianten im Zweifel den Vorrang.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LANG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spracheinstellung für Kommandozeilenbefehle. Diese Einstellung wird von der Spracheinstellung Ihrer Linux-Installation übernommen. Bei Prozessen der Instanz wird diese Variable aber automatisch entfernt! Die Sprache fällt dann auf die Systemsprache zurück (Englisch). Das betrifft auch andere regionale Einstellungen.  Das Entfernen von <code>LANG</code> ist sehr wichtig, denn einige klassische Nagios-Plugins verwenden sonst z.B. bei deutscher Spracheinstellung ein Komma anstelle eines Punkts als Dezimaltrenner. Ihre Ausgabe könnte dann nicht sauber ausgewertet werden.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Mit dem Befehl <code>env</code> können Sie sich alle Umgebungsvariablen ausgeben lassen.
Ein kleines, hübsches <code>| sort</code> dahinter, macht das Ganze etwas
übersichtlicher:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>env<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sort
<span class="tok-go">HOME=/omd/sites/mysite</span>
<span class="tok-go">LANG=de_DE.UTF-8</span>
<span class="tok-go">LD_LIBRARY_PATH=/omd/sites/mysite/local/lib:/omd/sites/mysite/lib</span>
<span class="tok-go">LOGNAME=mysite</span>
<span class="tok-go">MAILRC=/omd/sites/mysite/etc/mail.rc</span>
<span class="tok-go">MAIL=/var/mail/mysite</span>
<span class="tok-go">MANPATH=/omd/sites/mysite/share/man:</span>
<span class="tok-go">MODULEBUILDRC=/omd/sites/mysite/.modulebuildrc</span>
<span class="tok-go">MP_STATE_DIRECTORY=/omd/sites/mysite/var/monitoring-plugins</span>
<span class="tok-go">NAGIOS_PLUGIN_STATE_DIRECTORY=/omd/sites/mysite/var/monitoring-plugins</span>
<span class="tok-go">OMD_ROOT=/omd/sites/mysite</span>
<span class="tok-go">OMD_SITE=mysite</span>
<span class="tok-go">PATH=/omd/sites/mysite/lib/perl5/bin:/omd/sites/mysite/local/bin:/omd/sites/mysite/bin:/omd/sites/mysite/local/lib/perl5/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span>
<span class="tok-go">PERL5LIB=/omd/sites/mysite/local/lib/perl5/lib/perl5:/omd/sites/mysite/lib/perl5/lib/perl5:</span>
<span class="tok-go">PERL_MM_OPT=INSTALL_BASE=/omd/sites/mysite/local/lib/perl5/</span>
<span class="tok-go">PWD=/omd/sites/mysite</span>
<span class="tok-go">PYTHONPATH=/omd/sites/mysite/lib/python:/omd/sites/mysite/local/lib/python</span>
<span class="tok-go">SHELL=/bin/bash</span>
<span class="tok-go">SHLVL=1</span>
<span class="tok-go">TERM=xterm</span>
<span class="tok-go">USER=mysite</span>
<span class="tok-go">_=/usr/bin/env</span></code></pre></div></div>
<div class="paragraph"><p>Unter Linux ist das Environment eine Eigenschaft eines <em>Prozesses</em>. Jeder
Prozess hat seine eigenen Variablen, welcher er an Unterprozesse automatisch
vererbt. Dieser startet zwar dann erst einmal mit den gleichen Variablen, kann
diese aber verändern.</p></div>
<div class="paragraph"><p>Mit dem Befehl <code>env</code> können Sie immer nur die Umgebung der aktuellen
Shell ansehen.  Wenn Sie einen Fehler in der Umgebung eines bestimmten
Prozesses vermuten, können Sie diese mit einem kleinen Trick ausgeben lassen.
Dazu brauchen Sie nur die Prozess-ID (PID).
Diese können Sie z.B. mit <code>ps ax</code>, <code>pstree -p</code> oder <code>top</code>
ermitteln. Damit greifen Sie dann über das <code>/proc</code>-Dateisystem
direkt auf die Datei <code>environ</code> des Prozesses zu. Hier ist ein
passender Befehl für die Beispiel-PID <code>13222</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tr<span class="tok-w"> </span><span class="tok-se">\\</span><span class="tok-m">0</span><span class="tok-w"> </span><span class="tok-se">\\</span>n<span class="tok-w"> </span>&lt;<span class="tok-w"> </span>/proc/13222/environ<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sort</code></pre></div></div>
<div class="paragraph"><p>Wenn Sie für eigene Skripten oder andere Software, die in der Instanz
laufen soll, eigene Variablen benötigen, so legen Sie diese bitte
in der Datei <code>etc/environment</code> an, welche extra dafür vorgesehen
ist. Alle hier definierten Variablen werden überall in der Instanz
bereitgestellt:</p></div>
<div class="listingblock">
<div class="title">etc/environment</div>
<div class="content"><pre class="pygments highlight"><code><span></span># Custom environment variables
#
# Here you can set environment variables. These will
# be set in interactive mode when logging in as site
# user and also when starting the OMD processes with
# omd start.
#
# This file has shell syntax, but without 'export'.
# Better use quotes if your values contain spaces.
#
# Example:
#
# FOO="bar"
# FOO2="With some spaces"
#
MY_SUPER_VAR=blabla123
MY_OTHER_VAR=10.88.112.17</code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__anpassung_der_shell">
<span class="hidden-anchor sr-only" id="_anpassung_der_shell"></span>2.3. Anpassung der Shell</h3>
<div class="paragraph"><p>Wenn Sie Ihre Shell anpassen möchten (Prompt oder andere Dinge), können Sie das wie
gewohnt in der Datei <code>.bashrc</code> tun. Umgebungsvariablen gehören trotzdem
nach <code>etc/environment</code>, damit diese auch sicher in allen Prozessen vorhanden
sind.</p></div>
<div class="paragraph"><p>Es spricht auch nichts gegen eine eigene <code>.vimrc</code>, falls Sie gerne mit VIM arbeiten.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_folder_structure">
<span class="hidden-anchor sr-only" id="folder_structure"></span>3. Die Verzeichnisstruktur</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__trennung_von_software_und_daten">
<span class="hidden-anchor sr-only" id="_trennung_von_software_und_daten"></span>3.1. Trennung von Software und Daten</h3>
<div class="paragraph"><p>Folgendes Schaubild zeigt die wichtigsten Verzeichnisse einer Checkmk-Installation mit einer Instanz namens <code>mysite</code> und einer <code>&lt;version&gt;</code>, die zum Beispiel <code>2.0.0p8.cee</code> heißt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/filesystem.png" alt="Illustration der Verzeichnisstruktur einer Checkmk Instanz."></div></div>
<div class="paragraph"><p>Die Basis bildet das Verzeichnis <code>/omd</code>. Alle Dateien von
Checkmk befinden sich ohne Ausnahme hier.  Zwar ist <code>/omd</code>
ein symbolischer Link auf <code>/opt/omd</code> ist, womit die Daten
<em>physikalisch</em> eigentlich unterhalb von <code>/opt</code> liegen.
Aber alle Pfadangaben in Checkmk verwenden immer <code>/omd</code>.</p></div>
<div class="paragraph"><p>Wichtig ist die Aufteilung in Daten (gelb dargestellt) und Software (blau).
Die Daten der Instanzen liegen unterhalb von <code>/omd/sites</code>, die installierte
Software unter <code>/omd/versions</code>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_sitedir">
<span class="hidden-anchor sr-only" id="sitedir"></span>3.2. Instanzverzeichnis</h3>
<div class="paragraph"><p>Wie jeder Linux-Benutzer hat auch der Instanzbenutzer ein Home-Verzeichnis,
welches wir als Instanzverzeichnis bezeichnen.  Wenn Ihre Instanz
<code>mysite</code> heißt, so liegt dieses unter <code>/omd/sites/mysite</code>.
Wie bei Linux üblich kürzt die Shell das eigene Home-Verzeichnis mit
einer Tilde (<code>~</code>) ab. Da Sie sich nach einem Login direkt in diesem
Verzeichnis befinden, erscheint die Tilde im Eingabeprompt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]<mark>:~$</mark></span></code></pre></div></div>
<div class="paragraph"><p>Unterverzeichnisse des Instanzverzeichnisses werden relativ zur Tilde
dargestellt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>var/log
<span class="tok-gp">OMD[mysite]<mark>:~/var/log$</mark></span></code></pre></div></div>
<div class="paragraph"><p>Direkt im Instanzverzeichnis befinden sich etliche Unterverzeichnisse,
die Sie mit <code>ll</code> (Alias für <code>ls -alF)</code> auflisten können:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll
<span class="tok-go">total 16</span>
<span class="tok-go">lrwxrwxrwx  1 mysite mysite   11 Jan 24 11:56 bin -&gt; version/bin/</span>
<span class="tok-go">drwxr-xr-x 22 mysite mysite 4096 Jan 24 11:56 etc/</span>
<span class="tok-go">lrwxrwxrwx  1 mysite mysite   15 Jan 24 11:56 include -&gt; version/include/</span>
<span class="tok-go">lrwxrwxrwx  1 mysite mysite   11 Jan 24 11:56 lib -&gt; version/lib/</span>
<span class="tok-go">drwxr-xr-x  5 mysite mysite 4096 Jan 24 11:56 local/</span>
<span class="tok-go">lrwxrwxrwx  1 mysite mysite   13 Jan 24 11:56 share -&gt; version/share/</span>
<span class="tok-go">drwxr-xr-x 13 mysite mysite 4096 Jan 24 09:57 tmp/</span>
<span class="tok-go">drwxr-xr-x 13 mysite mysite 4096 Jan 24 11:56 var/</span>
<span class="tok-go">lrwxrwxrwx  1 mysite mysite   29 Jan 24 11:56 version -&gt; ../../versions/2.0.0p8.cee/</span></code></pre></div></div>
<div class="paragraph"><p>Wie Sie sehen können, sind die Verzeichnisse <code>bin</code>, <code>include</code>,
<code>lib</code>, <code>share</code> und <code>version</code> symbolische Links.
Beim Rest handelt es sich um „normale“ Verzeichnisse. Dies spiegelt die
oben genannte Trennung von Software und Daten wieder. Die Verzeichnisse zur
Software müssen zwar in der Instanz als Unterverzeichnisse verfügbar sein,
liegen aber physikalisch unterhalb von <code>/omd/versions</code> und werden
dort eventuell noch von weiteren Instanzen genutzt.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 35%;">
<col style="width: 40%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Software</th>
<th class="tableblock halign-left valign-top">Daten</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verzeichnisse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin</code>, <code>include</code>, <code>lib</code>, <code>share</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc</code>, <code>local</code>, <code>tmp</code>, <code>var</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eigentümer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instanzbenutzer (<code>mysite</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entsteht durch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation von Checkmk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anlegen der Instanz, Konfiguration, Monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physikalischer Ort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/omd/versions/2.0.0p8.cee/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/omd/sites/mysite/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dateityp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Symbolische Links</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normale Verzeichnisse</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__software">
<span class="hidden-anchor sr-only" id="_software"></span>3.3. Software</h3>
<div class="paragraph"><p>Die Verzeichnisse der Software gehören wie unter Linux üblich <code>root</code>
und sind daher vor Veränderungen durch den Instanzbenutzer geschützt. Es
gibt folgende Unterverzeichnisse, welche hier im Beispiel physikalisch
unterhalb von <code>/omd/versions/2.0.0p8.cee</code> liegen und über symbolische
Links vom Instanzverzeichnis aus erreichbar sind:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verzeichnis für ausführbare Programme. Dort liegt z.B. der Befehl <code>cmk</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C-Bibliotheken, Plugins für Apache und Python und — im Unterverzeichnis <code>nagios/plugins</code> klassische Monitoring-Plugins, die meist in C oder Perl geschrieben sind.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>share/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hauptteil der installierten Software. Sehr viele Komponenten befinden sich unter <code>share/check_mk</code> — unter anderem auch die über 2.000 Check-Plugins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>include/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enthält Include-Dateien für C-Programme, die mit den in <code>lib/</code> befindlichen Bibliotheken gelinkt werden sollen. Dieses Verzeichnis ist nicht wichtig und wird nur verwendet, wenn Sie selbst C-Programme übersetzen möchten.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Der symbolische Link <code>version/</code> ist ein „Zwischenstopp“ und dient
als zentrale Umschaltstelle für die von der Instanz verwendete Version.
Bei einem <a href="update.html">Software-Update</a> wird dieser symbolische Link
von der alten auf die neue Version umgebogen. Bitte versuchen Sie trotzdem nicht,
ein Update von Hand durch Ändern des Links zu durchzuführen, denn beim Update
sind noch einige weitere Schritte notwendig, die dann fehlen würden.</p></div>
</div>
<div class="sect2">
<h3 id="heading_data">
<span class="hidden-anchor sr-only" id="data"></span>3.4. Daten</h3>
<div class="paragraph"><p>Die eigentlichen <strong>Daten</strong> einer Instanz liegen in den restlichen
Unterverzeichnissen des Instanzverzeichnisses.  Diese gehören ohne Ausnahme
dem Instanzbenutzer. Auch das Instanzverzeichnis selbst gehört dazu. Checkmk
legt dort außer den hier gezeigten Verzeichnissen keine Dinge ab. Sie können
hier aber problemlos eigene Dateien und Verzeichnisse anlegen, in denen Sie
Tests, heruntergeladene Dateien, Kopien von Logdateien oder was auch immer
ablegen möchten.</p></div>
<div class="paragraph"><p>Es gibt folgende vordefinierte Verzeichnisse:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/</code></p></td>
<td class="tableblock halign-left valign-top">
<p class="tableblock">Konfigurationsdateien. Diese können Sie entweder von Hand oder mit dem Checkmk <a href="wato.html">Setup</a> editieren.</p>
<p class="tableblock">Hinweis: Die Skripten unter <code>etc/init.d</code> sind zwar - weil sie unter <code>etc/</code> liegen — auch „Konfigurationsdateien“. Dies ist in Anlehnung an das gleiche Schema, das Sie auf jedem Linux-System unter <code>/etc/init.d/</code> finden. Aber wir empfehlen, diese Skripten nicht zu ändern, da dies zu <a href="update.html#conflicts">Konflikten</a> bei einem Softwareupdate führen kann. Änderungen an den Skripten sind nicht notwendig.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Laufzeitdaten. Hier werden alle vom Monitoring erzeugten Daten abgelegt. Je nach Anzahl der überwachten Hosts und Services können immense Datenmengen zusammenkommen. Den größten Umfang haben dabei die aufgezeichneten Messdaten in den <a href="graphing.html#rrds">RRDs</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flüchtige Daten. Hier legen Checkmk und andere Komponenten temporäre Daten ab, die nicht persistiert werden müssen. Deswegen ist hier ein <code>tmpfs</code> gemountet. Das ist ein Dateisystem, welches die Daten im RAM verwaltet und deswegen keinerlei Disk-IO erzeugt. Beim Neustart des Rechners gehen alle Daten in <code>tmp/</code> verloren! Ein Stoppen und Starten der Instanz löscht die Daten <em>nicht</em>.  Unter <code>tmp/run</code> finden Sie Dateien wie Sockets, Pipes und PID-Dateien, welche zur Kommunikation und Verwaltung der Serverprozesse notwendig sind.  Verwenden Sie <code>tmp/</code> <strong>nicht</strong> für die Ablage von eigenen Dateien. Da dieses Verzeichnis im RAM liegt, ist der Platz begrenzt. Legen Sie eigene Dinge direkt in das Instanzverzeichnis oder in ein eigenes Unterverzeichnis davon.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eigene Erweiterungen. Unter <code>local/</code> finden Sie eine „Schattenhierarchie“ der Softwareverzeichnisse <code>bin/</code>, <code>lib/</code> und <code>share/</code>.   Diese sind für Ihre eigenen Änderungen oder Erweiterungen der Software vorgesehen.  Auch hier gilt: Legen Sie unter <code>local/</code> auf keinen Fall Testdateien, Logdateien, Sicherheitskopien oder Sonstiges an, was dort nicht hingehört. Checkmk könnte versuchen, diese Dateien als Teil der Software auszuführen. Auch werden die Dateien beim verteilten Monitoring auf alle Remote-Instanzen verteilt.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_local">
<span class="hidden-anchor sr-only" id="local"></span>3.5. Checkmk verändern und erweitern - die lokalen Dateien</h3>
<div class="paragraph"><p>Wie gerade in der Tabelle gezeigt, ist das Verzeichnis <code>local</code> mit
seinen zahlreichen Unterverzeichnissen für Ihre eigenen Erweiterungen
vorgesehen.  In einer neuen Instanz sind alle Verzeichnisse unter
<code>local/</code> zunächst leer.</p></div>
<div class="paragraph"><p>Mit dem praktischen Befehl <code>tree</code> können Sie sich schnell
einen Überblick über die Struktur unter <code>local</code> verschaffen.
Die Option <code>-L 3</code> begrenzt hier die Tiefe auf 3:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tree<span class="tok-w"> </span>-L<span class="tok-w"> </span><span class="tok-m">3</span><span class="tok-w"> </span><span class="tok-nb">local</span>
<span class="tok-go">local</span>
<span class="tok-go">├── bin</span>
<span class="tok-go">├── lib</span>
<span class="tok-go">│   ├── apache</span>
<span class="tok-go">│   ├── check_mk -&gt; python3/cmk</span>
<span class="tok-go">│   ├── nagios</span>
<span class="tok-go">│   │   └── plugins</span>
<span class="tok-go">│   ├── python</span>
<span class="tok-go">│   └── python3</span>
<span class="tok-go">│       └── cmk</span>
<span class="tok-go">└── share</span>
<span class="tok-go">    ├── check_mk</span>
<span class="tok-go">    │   ├── agents</span>
<span class="tok-go">    │   ├── alert_handlers</span>
<span class="tok-go">    │   ├── checkman</span>
<span class="tok-go">    │   ├── checks</span>
<span class="tok-go">    │   ├── inventory</span>
<span class="tok-go">    │   ├── locale</span>
<span class="tok-go">    │   ├── mibs</span>
<span class="tok-go">    │   ├── notifications</span>
<span class="tok-go">    │   ├── pnp-rraconf</span>
<span class="tok-go">    │   ├── pnp-templates</span>
<span class="tok-go">    │   ├── reporting</span>
<span class="tok-go">    │   └── web</span>
<span class="tok-go">    ├── diskspace</span>
<span class="tok-go">    ├── doc</span>
<span class="tok-go">    │   └── check_mk</span>
<span class="tok-go">    ├── nagios</span>
<span class="tok-go">    │   └── htdocs</span>
<span class="tok-go">    ├── nagvis</span>
<span class="tok-go">    │   └── htdocs</span>
<span class="tok-go">    └── snmp</span>
<span class="tok-go">        └── mibs</span></code></pre></div></div>
<div class="paragraph"><p>Alle Verzeichnisse der <em>untersten</em> Ebene sind aktiv in die
Software eingebunden.  Legen Sie hier eine Datei ab, so wird diese genauso
behandelt, als läge sie im gleichnamigen Verzeichnis unterhalb von
<code>/omd/versions/…​</code> (bzw. im logischen Pfad von der Instanz aus
unter <code>bin</code>, <code>lib</code> oder <code>share</code>).</p></div>
<div class="paragraph"><p>Beispiel: In der Instanz werden ausführbare Programme in
<code>bin</code> und in <code>local/bin</code> gesucht.</p></div>
<div class="paragraph"><p>Dabei gilt, dass bei einer <em>exakten Namensgleichheit</em> die Datei
unter <code>local</code> immer Vorrang hat. Das ermöglicht Ihnen,
Dateien der Software zu modifizieren, ohne Installationsdateien
unterhalb von <code>/omd/versions/</code> ändern zu müssen. Das Vorgehen
ist einfach:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Kopieren Sie die gewünschte Datei in das passende Verzeichnis unter <code>local</code>.</p></li>
<li><p>Ändern Sie diese Datei.</p></li>
<li><p>Starten Sie betroffenen Dienste neu, damit die Änderung wirksam wird.</p></li>
</ol></div>
<div class="paragraph"><p>Falls Sie beim dritten Punkt nicht genau wissen, welche Dienste das sind,
so können Sie einfach mit <code>omd restart</code> die ganze Instanz neu starten.</p></div>
</div>
<div class="sect2">
<h3 id="heading_logs">
<span class="hidden-anchor sr-only" id="logs"></span>3.6. Logdateien</h3>
<div class="paragraph"><p>Die Logdateien werden bei Checkmk unterhalb des bereits erwähnten
<a href="#data">Datenverzeichnisses</a> <code>var/</code> abgelegt. Hier finden
Sie zu allen Komponenten die zugehörigen Logdateien:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>-R<span class="tok-w"> </span>var/log/
<span class="tok-go">var/log/:</span>
<span class="tok-go">total 48</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  759 Sep 21 16:54 alerts.log</span>
<span class="tok-go">drwxr-xr-x 2 mysite mysite 4096 Sep 21 16:52 apache/</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite 8603 Sep 21 16:54 cmc.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite 3175 Sep 21 11:38 dcd.log</span>
<span class="tok-go">-rw-rw---- 1 mysite mysite    0 Oct 27 11:05 diskspace.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  313 Sep 21 16:54 liveproxyd.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite   62 Sep 21 16:54 liveproxyd.state</span>
<span class="tok-go">drwxr-xr-x 2 mysite mysite 4096 Sep 20 13:44 mkeventd/</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  676 Sep 21 16:54 mkeventd.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  310 Sep 21 16:54 mknotifyd.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  327 Sep 21 16:54 notify.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  458 Sep 21 16:54 rrdcached.log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite    0 Sep 21 16:52 web.log</span>

<span class="tok-go">var/log/apache:</span>
<span class="tok-go">total 32</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite 26116 Sep 21 16:54 access_log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite   841 Sep 21 16:54 error_log</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite     0 Sep 22 10:21 stats</span>

<span class="tok-go">var/log/mkeventd:</span>
<span class="tok-go">total 0</span></code></pre></div></div>
<div class="paragraph"><p>Auf der Weboberfläche können Sie bequem
konfigurieren, in welchem Umfang Daten in die Logdateien geschrieben werden
sollen, indem Sie in <span class="guihint">Setup &gt; General &gt; Global settings</span> nach allen Einträgen mit <code>logging</code> suchen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/cmk_commandline_global_settings_logging.png" alt="Liste der globalen Einstellungen für das Logging."></div></div>
<div class="paragraph"><p>Alternativ können Sie die Log Level auch auf der Kommandozeile in Konfigurationsdateien anpassen.
Die Dateien heißen jeweils <code>global.mk</code>, befinden sich aber in unterschiedlichen Verzeichnissen.
Setzen Sie die Einträge, wenn Sie noch nicht vorhanden sind, was dann der Fall ist, wenn ein
Standardwert (<span class="guihint">Factory setting</span>) noch nicht verändert wurde.</p></div>
<div class="listingblock">
<div class="title">~/etc/check_mk/conf.d/wato/global.mk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>notification_logging = 15
alert_logging = 10
cmc_log_levels = {
 'cmk.alert'        : 5,
 'cmk.carbon'       : 5,
 'cmk.core'         : 5,
 'cmk.downtime'     : 5,
 'cmk.helper'       : 5,
 'cmk.livestatus'   : 5,
 'cmk.notification' : 5,
 'cmk.rrd'          : 5,
 'cmk.smartping'    : 5,
}
cmc_log_rrdcreation = None</code></pre></div>
</div>
<div class="paragraph"><p>In dieser Datei werden die Einträge für <span class="guihint">Monitoring Core</span>, <span class="guihint">Notifications</span> und <span class="guihint">Alert Handlers</span> gesetzt:</p></div>
<div class="ulist"><ul>
<li><p>Für <code>notification_logging</code> stehen die drei Zahlenwerte 10 für <span class="guihint">Full dump of all variables and command</span>,
15 für <span class="guihint">Normal logging</span> und 20 für <span class="guihint">Minimal logging</span>.</p></li>
<li><p>Das <code>alert_logging</code> kann die Werte 10 für <span class="guihint">Full dump of all variables</span> oder 20 für <span class="guihint">Normal logging</span> erhalten.</p></li>
<li><p>Für <code>cmc_log_levels</code> nimmt der Umfang der geloggten Daten mit größeren
Zahlen zu. Hier gibt es acht Abstufungen (0 bis 7), wobei 0 für <span class="guihint">Emergency</span>
und 7 für <span class="guihint">Debug</span> steht.</p></li>
<li><p>Mit den drei Werten <code>None</code>, <code>'terse'</code> und <code>'full'</code> für <code>cmc_log_rrdcreation</code> können Sie festlegen, inwiefern die Erzeugung von <a href="graphing.html#rrds">RRDs</a> geloggt werden soll.</p></li>
</ul></div>
<div class="listingblock">
<div class="title">~/etc/check_mk/multisite.d/wato/global.mk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>log_levels = {
 'cmk.web'                : 50,
 'cmk.web.auth'           : 10,
 'cmk.web.automations'    : 15,
 'cmk.web.background-job' : 10,
 'cmk.web.bi.compilation' : 20,
 'cmk.web.ldap'           : 30,
}</code></pre></div>
</div>
<div class="paragraph"><p>In dieser Datei können Sie das <span class="guihint">User Interface</span> Logging festlegen.</p></div>
<div class="paragraph"><p>Der Umfang der geloggten Daten steigt, je kleiner die Zahl ist. Das
geringste Log Level ist somit 50 (<span class="guihint">Critical</span>), während 10 dem höchsten (<span class="guihint">Debug</span>) entspricht.</p></div>
<div class="listingblock">
<div class="title">~/etc/check_mk/liveproxyd.d/wato/global.mk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>liveproxyd_log_levels = {'cmk.liveproxyd': 20}</code></pre></div>
</div>
<div class="paragraph"><p>Diese Datei dient dem <span class="guihint">Livestatus Proxy logging</span>.
Die möglichen Werte hier entsprechen denen beim <span class="guihint">User Interface</span> Logging.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Logdateien können schnell sehr groß werden, wenn ein
hohes Level eingestellt ist. Es eignet sich daher vor allem zur temporären
Anpassung, um Probleme besser identifizieren zu können.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_cmk">
<span class="hidden-anchor sr-only" id="cmk"></span>4. Der Befehl cmk</h2>
<div class="sectionbody">
<div class="paragraph"><p>Neben dem <a href="omd_basics.html">Befehl <code>omd</code></a>, welcher zum Starten und Stoppen
von Instanzen, zur Grundkonfiguration der Komponenten und dem Starten eines
<a href="update.html">Software-Updates</a> dient, ist <code>cmk</code> der wichtigste Befehl.
Mit diesem können Sie eine Konfiguration für den Monitoring-Kern erzeugen,
Checks von Hand ausführen, eine Service-Erkennung durchführen und vieles mehr.</p></div>
<div class="sect2">
<h3 id="heading_options">
<span class="hidden-anchor sr-only" id="options"></span>4.1. Die Befehlsoptionen</h3>
<div class="paragraph"><p>Der Befehl <code>cmk</code> ist eigentlich eine Abkürzung für <code>check_mk</code>, die eingeführt wurde, damit man den Befehl schneller tippen kann.
Der Befehl verfügt über eine eingebaute, sehr ausführliche Onlinehilfe, die Sie mit der Option <code>--help</code> aufrufen können:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-h
<span class="tok-go">WAYS TO CALL:</span>
<span class="tok-go"> cmk  --automation [COMMAND...]          Internal helper to invoke Check_MK actions</span>
<span class="tok-go"> cmk  --backup BACKUPFILE.tar.gz         make backup of configuration and data</span>
<span class="tok-go"> cmk  --cap [pack|unpack|list FILE.cap]  Pack/unpack agent packages (Enterprise only)</span>
<span class="tok-go"> cmk  --check [HOST [IPADDRESS]]         Check all services on the given HOST</span>
<span class="tok-go">...</span></code></pre></div></div>
<div class="paragraph"><p>Wie Sie im obigen Kommando sehen, haben wir die Hilfe statt mit <code>--help</code> mit der Option <code>-h</code> aufgerufen.
Denn was für den Befehl selbst gilt, stimmt auch für seine Optionen: Je weniger zu tippen ist, um so schneller geht es.
Nicht für alle, aber für die oft benötigten Optionen, gibt es daher neben der Lang- auch eine Kurzform.
Auch wenn die Langform, gerade für Einsteiger, intuitiver ist (<code>check_mk --list-hosts</code>) als die Kurzform (<code>cmk -l</code>) werden wir im Handbuch die Kurzform verwenden. Im Zweifel können Sie immer in der Hilfe zum Kommando nachschlagen.
Ein längerer Blick in die Kommandohilfe ist auf jeden Fall eine gute Idee, da wir im Handbuch nicht alle Optionen vorstellen werden.</p></div>
<div class="paragraph"><p>Durch die Eingabe einer Option starten Sie den Befehl <code>cmk</code> in einem bestimmten Modus.
Hier folgt die Übersicht der Optionen, die wir in diesem Kapitel, aber auch an anderen Stellen des Handbuchs, vorstellen werden:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Wirkung</th>
</tr></thead>
<tbody>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Monitoring-Kern</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -R</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#commands_core">Kern neu starten</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#commands_core">Neue Konfiguration in den Kern laden</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -U</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#commands_core">Neue Konfiguration für den Kern erstellen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#commands_core">Nagios-Konfiguration des Kerns ausgeben</a></p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Checks</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#execute_checks">Checks ausführen</a> auf dem Host <code>myserver123</code></p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Services</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -I myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="wato_services.html#commandline">Service-Erkennung ausführen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --check-discovery myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Führt auf dem Host den <a href="wato_services.html#discovery_check">Discovery Check</a> aus, der nach neuen und verschwundenen Services und nach neuen Host-Labels sucht. Bei einer Änderung wird der Host "markiert" indem eine Datei mit dem Host-Namen in <code>var/check_mk/autodiscovery</code> angelegt wird — allerdings nur dann, wenn in Checkmk die automatische Aktualisierung der Service-Konfiguration aktiviert ist (im Regelsatz <span class="guihint">Periodic service discovery</span>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --discover-marked-hosts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Führt eine Service-Erkennung durch für alle Hosts, für die ein zuvor mit <code>cmk --check-discovery</code> ausgeführter Discovery Check Änderungen gefunden — und den betroffenen Host markiert hat. Dieser Befehl wird in einer Checkmk-Instanz standardmäßig alle 5 Minuten per Cronjob durchgeführt. Die Cronjobs können Sie sich mit <code>crontab -l</code> anzeigen lassen.</p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Agenten</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -d myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#dump_agent">Agentenausgabe holen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -A myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bake_agents">Agenten backen</a></p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Diagnose</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#list_hosts">Hosts auflisten</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --list-tag mytag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#list_hosts">Hosts mit Host-Merkmal auflisten</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -D myserver123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#dump_host">Host-Konfiguration anzeigen</a></p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Information</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -V</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zeigt die in der Instanz installierte Checkmk-Version an.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#paths">Checkmk Pfadübersicht</a>: Was liegt in welchem Verzeichnis?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#info_plugins">Check-Plugins auflisten</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#info_plugins">Katalog der Check-Plugins aufrufen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -M df</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#info_plugins">Manual Page eines Check-Plugins anzeigen</a> (hier des Plugins <code>df</code>)</p></td>
</tr>
<tr><td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Spezialthemen</strong></p></td></tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --update-dns-cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Löscht den DNS-Cache und erzeugt ihn neu. Details zum DNS-Cache finden Sie im <a href="hosts_setup.html#dns">Artikel über die Hosts.</a> Dieser Befehl wird in einer Checkmk-Instanz standardmäßig einmal am Tag per Cronjob durchgeführt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --cleanup-piggyback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Löscht alle veralteten <a href="piggyback.html">Piggyback-Daten</a> im Verzeichnis <code>tmp/check_mk/piggyback/</code>. Dieser Befehl wird in einer Checkmk-Instanz standardmäßig einmal am Tag per Cronjob durchgeführt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mkps.html#commandline">MKPs verwalten</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --convert-rrds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="graphing.html#customise_rrds">RRDs konvertieren</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --snmpwalk myswitch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="snmp.html#simulation">SNMP-Walk ziehen</a> vom Host <code>myswitch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --snmptranslate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="devel_check_plugins_snmp.html#locating_oids">SNMP-Walk übersetzen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --create-diagnostics-dump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="support_diagnostics.html#commandline">Support Diagnostics Dump erstellen</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>In einigen Modi stehen Ihnen weitere, spezifische Optionen zur Verfügung,
z.B. können Sie die Service-Erkennung auf bestimmte Checks einschränken, z.B. mit dem Kommando <code>cmk -I --detect-plugins=df myserver123</code> auf den Check <code>df</code>.</p></div>
<div class="paragraph"><p>Einige Optionen funktionieren immer — egal mit welchem Modus Sie den Befehl aufrufen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Wirkung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Veranlasst <code>cmk</code> zu einer ausführlichen Ausgabe dessen, was er gerade macht  („verbose“).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -vv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Ganze noch etwas ausführlicher („very verbose“).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Informationen werden aus Cache-Dateien gelesen, auch wenn diese veraltet sind. Der Agent wird nur dann kontaktiert, wenn keine Cache-Datei existiert. Die zwischengespeicherten Agentendaten des Hosts finden Sie unter <code>tmp/check_mk/cache</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --no-tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbeitet wie <code>--cache</code>, bricht allerdings ab, wenn keine Cache-Datei existiert oder diese nicht aktuell ist. So können Sie einen Zugriff auf den Agenten in jedem Fall unterbinden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --no-cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Informationen werden stets aktuell abgeholt, d.h. es werden keine Cache-Dateien verwendet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --usewalk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Für SNMP-Hosts: Verwendet anstatt eines Zugriffs auf den SNMP-Agenten einen gespeicherten SNMP-Walk, der zuvor mit <code>cmk --snmpwalk myserver123</code> gezogen wurde. Diese Walks liegen unter <code>var/check_mk/snmpwalks</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk --debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Falls es zu einem Fehler kommt, sorgt diese Option dafür, dass dieser nicht mehr abgefangen, sondern die ursprüngliche Python-Exception vollständig angezeigt wird. Das kann den Entwicklern als wichtige Information dienen, wo genau im Programm der Fehler auftritt. Auch wird es Ihnen sehr helfen, Fehler in selbst geschriebenen Check-Plugins zu lokalisieren. Falls Sie bei einem Aufruf von <code>cmk</code> auf einen Fehler stoßen, den Sie dem Support oder als Feedback melden möchten, rufen Sie bitte den gleichen Befehl nochmal mit <code>--debug</code> auf und fügen den Python-Trace in Ihre E-Mail ein.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Im Folgenden zeigen wir, wie Sie die Befehle verwenden können.
Die Beispielausgaben sind meist gekürzt dargestellt.</p></div>
</div>
<div class="sect2">
<h3 id="heading_commands_core">
<span class="hidden-anchor sr-only" id="commands_core"></span>4.2. Befehle für den Monitoring-Kern</h3>
<div class="paragraph"><p>Die kommerziellen Editionen verwenden als Monitoring-Kern den <a href="cmc.html">Checkmk Micro Core</a> (CMC), bei der
<span class="image-inline"><img src="../images/icons/CRE.png" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> kommt Nagios zum Einsatz. Eine wichtige Aufgabe von <code>cmk</code> ist es,
eine für den Kern lesbare Konfigurationsdatei zu erzeugen, welche alle
konfigurierten Hosts, Services, Kontakte, Kontaktgruppen, Zeitperioden
usw. enthält. Anhand dieser weiß der Kern, welche Checks er ausführen
muss und welche Objekte er per <a href="livestatus.html">Livestatus</a> der GUI bereitstellen soll.</p></div>
<div class="paragraph"><p>Grundsätzlich gilt sowohl für Nagios also auch für den CMC, dass die Menge der
Hosts, Services und anderen Objekte zur Laufzeit immer statisch ist und sich nur
durch das Erstellen einer neuen Konfiguration ändern kann, welche der Kern
anschließend neu laden muss. Bei Nagios ist dazu ein Neustart des Kerns nötigt.
Der CMC beherrscht ein sehr effizientes Neuladen der Konfiguration im laufenden
Betrieb.</p></div>
<div class="paragraph"><p>Folgende Tabelle zeigt wichtige Unterschiede bei der Konfiguration der beiden Kerne:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 45%;">
<col style="width: 35%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Nagios</th>
<th class="tableblock halign-left valign-top">CMC</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Konfigurationsdatei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/nagios/conf.d/check_mk_objects.cfg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/check_mk/core/config</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dateiart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Textdatei mit <code>define</code>-Befehlen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Komprimierte und optimierte Binärdatei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aktivierung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neustart des Kerns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Befehl an den Kern zum Neuladen der Konfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Befehl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -R</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -O</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Das Neuerzeugen der Konfiguration ist immer dann notwendig, wenn sich
Inhalte der Konfigurationsdateien unterhalb von <code>etc/check_mk/conf.d</code>
oder automatisch erkannte Services unter <code>var/check_mk/autochecks</code>
geändert haben. Das Setup führt Buch über solche Änderungen und zeigt diese
in der GUI als zu <a href="wato.html#activate_changes">aktivierende Änderungen</a> an.
Falls Sie die Konfiguration manuell oder durch Skripte „am Setup
vorbei“ modifizieren, müssen Sie sich selbst um das Aktivieren kümmern.
Dazu dienen folgende Befehle:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Wirkung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -R</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Erzeugt eine neue Konfiguration für den Kern und startet diesen dann neu (analog zu <code>omd restart core</code>). Das ist die bei Nagios vorgesehene Methode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -O</code></p></td>
<td class="tableblock halign-left valign-top">
<p class="tableblock">Erzeugt die Konfiguration für den Kern und lädt diese ohne einen Neustart im laufenden Betrieb (analog zu <code>omd reload core</code>). Das ist die beim CMC empfohlene Variante.</p>
<p class="tableblock"><strong>Achtung:</strong> Bei Nagios als Kern funktioniert diese Option zwar auch, kann aber zu Speicherlöchern und anderen Instabilitäten führen. Außerdem wird dort ohnehin kein echter Reload ausgeführt, sondern nur der Prozess quasi innerlich runter- und wieder hochgefahren.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -U</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Erzeugt die Konfiguration für den Kern, <em>ohne</em> diese zu aktivieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gibt zu Diagnosezwecken die zu erzeugende Konfiguration auf der Standardausgabe aus, ohne die eigentliche Konfigurationsdatei zu ändern. Sie können dabei den Namen eines Hosts angeben, um nur die Konfiguration dieses Hosts zu sehen (z.B. <code>cmk -N myserver123</code>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Zusammengefasst bedeutet das: Wenn Sie von Hand die Checkmk-Konfiguration anpassen
und die Änderungen aktivieren möchten, benötigen Sie anschließend bei Nagios:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-R</code></pre></div></div>
<div class="paragraph"><p>Und beim CMC:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-O</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_execute_checks">
<span class="hidden-anchor sr-only" id="execute_checks"></span>4.3. Checks ausführen</h3>
<div class="paragraph"><p>Ein zweiter Modus von Checkmk befasst sich mit der Ausführung von
Checkmk-basierten Checks eines Hosts. Damit können Sie alle automatisch
erkannten und auch manuell hinzu konfigurierten Services sofort checken lassen,
ohne dass Sie dafür den Monitoring-Kern oder die GUI bemühen müssen.</p></div>
<div class="paragraph"><p>Geben Sie dazu <code>cmk --check</code> gefolgt vom  Namen eines im Monitoring konfigurierten Hosts ein.
Da die Option <code>--check</code> die Standardoption von <code>cmk</code> ist, können Sie diese auch weglassen.
Außerdem sollten Sie immer die beiden Optionen <code>-n</code> (Ergebnisse nicht an den Kern übermitteln) und <code>-v</code> (alle Ergebnisse ausgeben) hinzufügen.
Dazu mehr bei der Beschreibung der Optionen weiter unten.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-nv<span class="tok-w"> </span>myserver123
<span class="tok-go">Checkmk version 2.0.0p8</span>
<span class="tok-go">CPU load             <span class="green">15 min load 0.22 at 8 Cores (0.03 per Core)</span></span>
<span class="tok-go">CPU utilization      <span class="green">Total CPU: 8.20%</span></span>
<span class="tok-go">Disk IO SUMMARY      <span class="green">Read: 14.0 kB/s, Write: 316 kB/s, Latency: 442 microseconds</span></span>
<span class="tok-go">Filesystem /         <span class="yellow">82.0% used (177.01 of 215.81 GB), (warn/crit at 80.00/90.00%),</span></span>
<span class="tok-go">Interface 2          <span class="green">[wlo1], (up), MAC: 5C:80:B6:3E:38:7F, Speed: unknown, In: 1.02 kB/s, Out: 902 B/s</span></span>
<span class="tok-go">Kernel Performance   <span class="green">Process Creations: 67.82/s, Context Switches: 4183.41/s, Major Page Faults: 1.71/s, Page Swap in: 0.00/s, Page Swap Out: 0.00/s</span></span>
<span class="tok-go">Memory               <span class="green">Total virtual memory: 37.07% - 6.08 GB of 16.41 GB</span></span>
<span class="tok-go">Mount options of /   <span class="green">Mount options exactly as expected</span></span>
<span class="tok-go">NTP Time             <span class="green">sys.peer - stratum 2, offset 16.62 ms, jitter 5.19 ms, last reac</span></span>
<span class="tok-go">Number of threads    <span class="green">Count: 1501 threads, Usage: 1.19%</span></span>
<span class="tok-go">TCP Connections      <span class="green">Established: 11</span></span>
<span class="tok-go">Temperature Zone 0   <span class="green">25.0 °C</span></span>
<span class="tok-go">Uptime               <span class="green">Up since Jul 29 2021 08:38:32, Uptime: 4 hours 43 minutes</span></span>
<span class="tok-go">[agent] Version: 2.0.0b5, OS: linux, execution time 0.9 sec | execution_time=0.850 user_time=0.050 system_time=0.010 children_user_time=0.000 children_system_time=0.000 cmk_time_agent=0.800</span></code></pre></div></div>
<div class="paragraph"><p>Hinweise dazu:</p></div>
<div class="ulist"><ul>
<li><p>Verwenden Sie diesen Befehl nicht bei produktiv überwachten Hosts, welche Logdatei-Monitoring verwenden. Log-Meldungen werden vom Agenten nur einmal gesendet. Es kann Ihnen passieren, dass Ihr manueller <code>cmk -nv</code> diese „erwischt“ und sie dann für das Monitoring verloren sind. Verwenden Sie in diesem Fall die Option <code>--no-tcp</code>.</p></li>
<li><p>Wenn Sie Nagios als Kern verwenden und <code>-n</code> weglassen, führt das zu einer sofortigen Aktualisierung der Check-Ergebnisse im Kern und in der GUI.</p></li>
<li><p>Der Befehl ist nützlich beim Entwickeln eigener Check-Plugins, weil so ein schnellerer Test möglich ist als über die GUI. Falls der Check in einen Fehler läuft und <span class="state3">UNKNOWN</span> wird, hilft die Option <code>--debug</code> die genaue Stelle im Code zu finden.</p></li>
</ul></div>
<div class="paragraph"><p>Folgende Optionen beeinflussen den Befehl:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Wirkung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check-Ergebnisse ausgeben: Ohne diese Option sehen Sie nur die Ausgabe des Services <span class="guihint">Check_MK</span> selbst und nicht die Resultate der anderen Services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trockenlauf: Ergebnisse <strong>nicht</strong> an den Kern übermitteln, Performance Counter nicht aktualisieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--detect-plugins=df,uptime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beschränkt die Ausführung auf die Check-Plugins <code>df</code> und <code>uptime</code>. Im Falle von SNMP-Hosts werden auch nur die dafür benötigten Daten geholt. Diese Option ist praktisch, wenn Sie eigene Check-Plugins entwickeln und nur diese testen möchten.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_dump_agent">
<span class="hidden-anchor sr-only" id="dump_agent"></span>4.4. Agentenausgabe holen</h3>
<div class="paragraph"><p><code>cmk -d</code> holt die Ausgabe des Checkmk-Agenten eines Hosts und zeigt sie an.
Die Agentendaten werden bei <code>cmk -d</code> auf dem gleichen Weg geholt wie während des Monitorings und weder geprüft noch aufbereitet.
Damit entsprechen die angezeigten Daten den Daten, die bei aktivierter TLS-Verschlüsselung dem Agent Controller oder bei Verwendung eines <a href="datasource_programs.html">Datenquellenprogramms</a> dem übertragenden Programm übergeben werden.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-d<span class="tok-w"> </span>myserver123
<span class="tok-go">&lt;&lt;&lt;check_mk&gt;&gt;&gt;</span>
<span class="tok-go">Version: 2.1.0b5</span>
<span class="tok-go">AgentOS: linux</span>
<span class="tok-go">Hostname: myserver123</span>
<span class="tok-go">AgentDirectory: /etc/check_mk</span>
<span class="tok-go">DataDirectory: /var/lib/check_mk_agent</span>
<span class="tok-go">SpoolDirectory: /var/lib/check_mk_agent/spool</span>
<span class="tok-go">PluginsDirectory: /usr/lib/check_mk_agent/plugins</span>
<span class="tok-go">LocalDirectory: /usr/lib/check_mk_agent/local</span>
<span class="tok-go">OnlyFrom:</span>
<span class="tok-go">&lt;&lt;&lt;df&gt;&gt;&gt;</span>
<span class="tok-go">udev              devtmpfs     8155492         4   8155488       1% /dev</span>
<span class="tok-go">tmpfs             tmpfs        1634036      1208   1632828       1% /run</span>
<span class="tok-go">/dev/sda5         ext4       226298268 175047160  39732696      82% /</span>
<span class="tok-go">none              tmpfs              4         0         4       0% /sys/fs/cgroup</span></code></pre></div></div>
<div class="paragraph"><p>Sie können <code>cmk -d</code> sogar mit dem Namen oder der IP-Adresse eines Hosts aufrufen, der nicht im Monitoring angelegt ist.
In diesem Fall werden für den Host Legacy-Einstellungen angenommen (TCP-Verbindung zu Port 6556, kein Agent Controller, keine Verschlüsselung, kein Datenquellenprogramm).</p></div>
</div>
<div class="sect2">
<h3 id="heading_bake_agents">
<span class="hidden-anchor sr-only" id="bake_agents"></span>4.5. Agenten backen</h3>
<div class="paragraph"><p>In den kommerziellen Editionen können Sie die Agenten auch von der Kommandozeile backen, so wie Sie es sonst über die <a href="wato_monitoringagents.html#bakery">Weboberfläche</a> tun würden. Damit haben Sie z.B. die Möglichkeit, die Agenten regelmäßig zu aktualisieren, etwa über einen Cronjob.</p></div>
<div class="paragraph"><p>Zum Backen der Agenten dient die Option <code>-A</code>, gefolgt vom Namen eines Hosts (oder auch von mehreren):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-Av<span class="tok-w"> </span>myserver123
<span class="tok-go">myserver123...linux_deb:baking...linux_rpm:baking...(fast repackage)...solaris_pkg:baking...windows_msi:baking...linux_tgz:baking...(fast repackage)...solaris_tgz:baking...(fast repackage)...aix_tgz:baking...OK</span></code></pre></div></div>
<div class="paragraph"><p>Die Ausgabe zeigt, dass die für den Host <code>myserver123</code> verfügbaren Agentenpakete erfolgreich gebacken wurden. Wenn Sie keinen Host angeben, werden die Pakete für alle Hosts gebacken.</p></div>
<div class="paragraph"><p>Das Kommando backt nur dann, wenn es notwendig ist. Falls die Pakete noch aktuell sind, sieht die Ausgabe etwa so aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-Av<span class="tok-w"> </span>myserver123
<span class="tok-go">myserver123...linux_deb:uptodate...linux_rpm:uptodate...solaris_pkg:uptodate...windows_msi:uptodate...linux_tgz:uptodate...solaris_tgz:uptodate...aix_tgz:uptodate...OK</span></code></pre></div></div>
<div class="paragraph"><p>Mit der Option <code>-f</code> (<em>force</em>) können Sie das Backen trotzdem erzwingen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_list_hosts">
<span class="hidden-anchor sr-only" id="list_hosts"></span>4.6. Hosts auflisten</h3>
<div class="paragraph"><p>Der Befehl <code>cmk -l</code> listet einfach die Namen aller im Setup eingerichteten Hosts auf:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-l
<span class="tok-go">myserver123</span>
<span class="tok-go">myserver124</span>
<span class="tok-go">myserver125</span></code></pre></div></div>
<div class="paragraph"><p>Da die Daten „nackt“ und ohne Verzierungen ausgegeben werden, können Sie sie
leicht in Skripten nutzen. Zum Beispiel können Sie damit eine Schleife über alle
Hostnamen bauen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-k">for</span><span class="tok-w"> </span>host<span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-k">$(</span>cmk<span class="tok-w"> </span>-l<span class="tok-k">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">do</span><span class="tok-w"> </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">"Host: </span><span class="tok-nv">$host</span><span class="tok-s2">"</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">done</span>
<span class="tok-go">Host: myserver123</span>
<span class="tok-go">Host: myserver124</span>
<span class="tok-go">Host: myserver125</span></code></pre></div></div>
<div class="paragraph"><p>Wenn Sie jetzt anstelle des <code>echo</code> einen Befehl einsetzen, der
etwas Sinnvolles macht, kann das wirklich nützlich sein.</p></div>
<div class="paragraph"><p>Der Aufruf <code>cmk --list-tag</code> gibt ebenfalls Hostnamen aus, bietet dabei aber
die Möglichkeit, nach <a href="glossar.html#host_tag">Host-Merkmalen</a> zu filtern. Geben Sie
einfach ein Host-Merkmal an und Sie erhalten alle Hosts, die dieses Merkmal besitzen.
Folgendes Beispiel listet alle Host auf, die per SNMP überwacht werden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>--list-tag<span class="tok-w"> </span>snmp
<span class="tok-go">myswitch01</span>
<span class="tok-go">myswitch02</span>
<span class="tok-go">myswitch03</span></code></pre></div></div>
<div class="paragraph"><p>Geben Sie mehrere Merkmale an, so werden diese per UND verknüpft.
Folgendes Kommando liefert alle Hosts, die gleichzeitig per SNMP <strong>und</strong> Checkmk-Agenten überwacht werden.
Da keine Hosts diese Bedingung erfüllen, bleibt die Ausgabe leer:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>--list-tag<span class="tok-w"> </span>snmp<span class="tok-w"> </span>tcp</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_dump_host">
<span class="hidden-anchor sr-only" id="dump_host"></span>4.7. Host-Konfiguration anzeigen</h3>
<div class="paragraph"><p><code>cmk -D</code> zeigt für einen oder mehrere Hosts die konfigurierten Services,
Host-Merkmale, Labels und andere Attribute. Da die Liste der Services sehr breit ist,
kann das Ganze im Terminal etwas unübersichtlich aussehen. Schicken Sie die
Ausgabe durch <code>less -S</code> um einen Umbruch zu vermeiden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-D<span class="tok-w"> </span>myserver123<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>less<span class="tok-w"> </span>-S
<span class="tok-go">myserver123</span>
<span class="tok-go">Addresses:              192.168.178.34</span>
<span class="tok-go">Tags:                   [address_family:ip-v4-only], [agent:cmk-agent], [criticality:prod], [ip-v4:ip-v4], [networking:lan], [piggyback:auto-piggyback], [site:mysite], [tcp:tcp]</span>
<span class="tok-go">Labels:                 [cmk/check_mk_server:yes], [cmk/os_family:linux]</span>
<span class="tok-go">Host groups:            mylinuxservers</span>
<span class="tok-go">Contact groups:         all</span>
<span class="tok-go">Agent mode:             Normal Checkmk agent, or special agent if configured</span>
<span class="tok-go">Type of agent:</span>
<span class="tok-go">  TCP: 192.168.178.34:6556</span>
<span class="tok-go">  Process piggyback data from /omd/sites/mysite/tmp/check_mk/piggyback/mycmkserver</span>
<span class="tok-go">Services:</span>
<span class="tok-go">Type of agent:          TCP (port: 6556)</span>
<span class="tok-go">Is aggregated:          no</span>
<span class="tok-go">Services:</span>
<span class="tok-go">  checktype        item              params</span>
<span class="tok-go">  ---------------- ----------------- ------------</span>
<span class="tok-go">  cpu.loads        None              (5.0, 10.0)</span>
<span class="tok-go">  kernel.util      None              {}</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_paths">
<span class="hidden-anchor sr-only" id="paths"></span>4.8. Checkmk Pfadübersicht</h3>
<div class="paragraph"><p>Der Befehl <code>cmk --paths</code> zeigt Ihnen, in welchen Verzeichnissen Checkmk
welche Dinge erwartet. Diese Liste umfasst nicht das komplette
Checkmk-System, sondern nur Dinge, mit denen das Kommandozeilentool <code>cmk</code>
selbst arbeitet. Trotzdem hilft es manchmal, Dinge schneller zu finden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>--paths
<span class="tok-go">Files copied or created during installation</span>
<span class="tok-go">  Main components of check_mk             : /omd/sites/mysite/share/check_mk/modules/</span>
<span class="tok-go">  Checks                                  : /omd/sites/mysite/share/check_mk/checks/</span>
<span class="tok-go">  Notification scripts                    : /omd/sites/mysite/share/check_mk/notifications/</span>
<span class="tok-go">  Inventory plugins                       : /omd/sites/mysite/share/check_mk/inventory/</span>
<span class="tok-go">  Agents for operating systems            : /omd/sites/mysite/share/check_mk/agents/</span>
<span class="tok-go">  Documentation files                     : /omd/sites/mysite/share/doc/check_mk/</span>
<span class="tok-go">  Check_MK's web pages                    : /omd/sites/mysite/share/check_mk/web/</span>
<span class="tok-go">  Check manpages (for check_mk -M)        : /omd/sites/mysite/share/check_mk/checkman/</span>
<span class="tok-go">  Binary plugins (architecture specific)  : /omd/sites/mysite/lib/</span>
<span class="tok-go">  Templates for PNP4Nagios                : /omd/sites/mysite/share/check_mk/pnp-templates/</span>
<span class="tok-go">  Startscript for Nagios daemon           : /omd/sites/mysite/etc/init.d/core</span>
<span class="tok-go">  Path to Nagios executable               : /omd/sites/mysite/bin/nagios</span>

<span class="tok-go">Configuration files edited by you</span>
<span class="tok-go">  Directory that contains main.mk         : /omd/sites/mysite/etc/check_mk/</span>
<span class="tok-go">  Directory containing further *.mk files : /omd/sites/mysite/etc/check_mk/conf.d/</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_info_plugins">
<span class="hidden-anchor sr-only" id="info_plugins"></span>4.9. Informationen zu den Check-Plugins</h3>
<div class="paragraph"><p>Checkmk liefert eine große Zahl von fertigen Plugins mit aus. In jedem Release
kommen etliche dazu und Version <span class="new">2.0.0</span> umfasst bereits über 2.000 Plugins. Drei
Optionen des Befehls <code>cmk</code> bieten Ihnen Zugriff auf Informationen zu diesen Plugins.</p></div>
<div class="paragraph"><p><code>cmk -L</code> gibt in einer Tabelle alle Plugins mit Namen, Typ und Beschreibung aus.
Dabei werden auch solche aufgelistet, welche Sie eventuell per Hand unterhalb von <code>local/</code> nachinstalliert haben.</p></div>
<div class="paragraph"><p>Beim Typ gibt es die folgenden Werte:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wertet Daten eines Checkmk-Agenten aus. Dieser wird (normalerweise) per TCP Port 6556 abgerufen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>snmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dient zur Überwachung von Geräten via SNMP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ruft für die Überwachung ein Nagios-kompatibles Plugin nach klassischer Art auf. Hier übernimmt Checkmk eigentlich nur die Konfiguration.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Natürlich können Sie in der Liste einfach mit <code>grep</code> filtern, wenn Sie nach etwas
Bestimmten suchen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-L<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span>f5
<span class="tok-go">f5_bigip_apm                      snmp   F5 Big-IP: number of current SSL/VPN connections</span>
<span class="tok-go">f5_bigip_chassis_temp             snmp   F5 Big-IP: Chassis temperature</span>
<span class="tok-go">f5_bigip_cluster                  snmp   F5 Big-IP: Cluster state, up to firmware version 10</span>
<span class="tok-go">f5_bigip_cluster_status           snmp   F5 Big-IP: active/active or passive/active cluster status</span>
<span class="tok-go">f5_bigip_cluster_status.v11_2     snmp   F5 Big-IP: active/active or passive/active cluster status</span>
<span class="tok-go">f5_bigip_cluster_status_v11_2     snmp   F5 Big-IP: active/active or passive/active cluster status</span>
<span class="tok-go">f5_bigip_cluster_v11              snmp   F5 Big-IP: Cluster state for firmware version &gt;= 11</span>
<span class="tok-go">f5_bigip_conns                    snmp   F5 Big-IP: number of current connections</span>
<span class="tok-go">f5_bigip_cpu_temp                 snmp   F5 Big-IP: CPU temperature</span>
<span class="tok-go">f5_bigip_fans                     snmp   F5 Big-IP: System fans</span>
<span class="tok-go">f5_bigip_interfaces               snmp   F5 Big-IP: Special Network Interfaces</span>
<span class="tok-go">f5_bigip_mem                      snmp   F5 Big-IP: Usage of memory</span>
<span class="tok-go">f5_bigip_mem.tmm                  snmp   F5 Big-IP: Usage of TMM memory</span>
<span class="tok-go">f5_bigip_pool                     snmp   F5 Big-IP: Load Balancing Pools</span>
<span class="tok-go">f5_bigip_psu                      snmp   F5 Big-IP: Power Supplies</span>
<span class="tok-go">f5_bigip_snat                     snmp   F5 Big-IP: Source NAT</span>
<span class="tok-go">f5_bigip_vcmpfailover             snmp   F5 Big-IP: active/active or passive/active vCMP guest failover status</span>
<span class="tok-go">f5_bigip_vcmpguests               snmp   F5 Big-IP: show failover states of all vCMP guests running on a vCMP host</span>
<span class="tok-go">f5_bigip_vserver                  snmp   F5 Big-IP: Virtual servers</span></code></pre></div></div>
<div class="paragraph"><p>Wenn Sie zu einem der Plugins mehr Information möchten, können Sie dessen Dokumentation als <em>Manual Page</em> (oder <em>Man Page</em>)
mit <code>cmk -M</code> aufrufen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-M<span class="tok-w"> </span>f5_bigip_pool</code></pre></div></div>
<div class="paragraph"><p>Das ergibt dann folgende Ausgabe:</p></div>
<div class="imageblock"><div class="content"><img src="../images/check_manpage_example.png" alt="Beispiel einer Check-Plugin Manual Page."></div></div>
<div class="paragraph"><p>Mit einem <code>cmk -m</code> ohne weitere Angaben kommen Sie in den kompletten Katalog aller Check-Plugin Man Pages:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-m</code></pre></div></div>
<div class="paragraph"><p>Hier können Sie interaktiv navigieren:</p></div>
<div class="imageblock"><div class="content"><img src="../images/cmk_commandline_manpage_catalog_level1.png" alt="Hauptmenü zur Auswahl einer Manual Page." width="65%"></div></div>
<div class="imageblock"><div class="content"><img src="../images/cmk_commandline_manpage_catalog_level2.png" alt="Untermenü zur Auswahl einer Manual Page." width="65%"></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_config">
<span class="hidden-anchor sr-only" id="config"></span>5. Konfiguration ohne Setup</h2>
<div class="sectionbody">
<div class="paragraph"><p>Das <a href="wato.html">Setup-Menü</a> ist ein tolles Konfigurationswerkzeug. Aber es gibt
gute Gründe, eine Konfiguration mit Textdateien in guter alter Linux-Tradition
zu bevorzugen. Wenn auch Sie diese Meinung haben, gibt es für Sie eine gute Nachricht:
Sie können Checkmk vollständig über Textdateien konfigurieren. Und da die Aktionen im <span class="guihint">Setup</span>-Menü
ebenfalls nichts anderes machen, als (dieselben) Textdateien zu bearbeiten,
ist das noch nicht einmal ein Entweder/Oder.</p></div>
<div class="sect2">
<h3 id="heading__wo_ist_die_dokumentation">
<span class="hidden-anchor sr-only" id="_wo_ist_die_dokumentation"></span>5.1. Wo ist die Dokumentation?</h3>
<div class="paragraph"><p>Falls Sie jetzt allerdings ein umfassendes Kompendium über den genauen
Aufbau von allen von Checkmk verwendeten Konfigurationsdateien erwarten,
müssen wir Sie an dieser Stelle leider enttäuschen. Die Komplexität und Vielfalt, die
in den Konfigurationsdateien steckt, ist einfach viel zu groß, um sie in diesem
Handbuch komplett zu beschreiben.</p></div>
<div class="paragraph"><p>Folgendes Beispiel zeigt einen komplett ausgefüllten Parametersatz für das
Check-Plugin, welches in Checkmk Dateisysteme überwacht. Wegen der vielen Parameter
ist der Screenshot in zwei Teile zerlegt und in kleiner Schrift gesetzt:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/cmk_commandline_parameters_for_df_check.png" alt="Kompletter Parametersatz des Check-Plugins zur Überwachung von Dateisystemen."></div></div>
<div class="paragraph"><p>Die entsprechende Passage dazu in der Konfigurationsdatei sieht (etwas
hübscher formatiert) so aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>{ 'inodes_levels'      : (10.0, 5.0),
  'levels'             : (80.0, 90.0),
  'levels_low'         : (50.0, 60.0),
  'magic'              : 0.8,
  'magic_normsize'     : 20,
  'show_inodes'        : 'onlow',
  'show_levels'        : 'onmagic',
  'show_reserved'      : True,
  'subtract_reserved'  : False,
  'trend_mb'           : (100, 200),
  'trend_perc'         : (5.0, 10.0),
  'trend_perfdata'     : True,
  'trend_range'        : 24,
  'trend_showtimeleft' : True,
  'trend_timeleft'     : (12, 6)},</code></pre></div></div>
<div class="paragraph"><p>Wie Sie sehen, gibt es hier mehr als 10 verschiedene Parameter, die
jeweils eine ganz eigene Logik haben. Manche werden über Fließkommazahlen
(<code>0.8</code>), manche über Ganzzahlen (<code>24</code>), manche über
Schlüsselworte (<code>'onlow'</code>), manche über boolesche Werte (<code>True</code>)
und andere wieder über Tupel aus solchen Dingen konfiguriert (<code>(5.0,
10.0)</code>).</p></div>
<div class="paragraph"><p>Dieses Beispiel ist nur eines von über 2.000 Plugins. Und dann gibt es
ja auch noch andere Konfigurationen als Check-Parameter: Man denke nur
an Zeitperioden, Regeln der Event Console, Benutzerprofile und vieles
mehr.</p></div>
<div class="paragraph"><p>Das soll natürlich nicht heißen, dass Sie auf eine Konfiguration
über Textdateien verzichten müssen! Wenn Sie die genaue Syntax für die
Konfigurationsaufgabe Ihrer Wahl noch nicht kennen, brauchen Sie dafür nur das
richtige Werkzeug — und das heißt: <strong>Setup:</strong></p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Erzeugen Sie eine Testinstanz von Checkmk.</p></li>
<li><p>Konfigurieren Sie dort die gewünschten Parameter mit dem <span class="guihint">Setup</span>-Menü.</p></li>
<li><p>Suchen Sie die dadurch veränderte Konfigurationsdatei (dazu gleich mehr).</p></li>
<li><p>Übernehmen Sie die exakte Syntax des betroffenen Abschnitts aus dieser Datei in Ihr Produktivsystem.</p></li>
</ol></div>
<div class="paragraph"><p>Sie müssen also nur wissen, in welche Datei das Setup was schreibt.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Wenn es um die Namen von Dateiverzeichnissen, Dateien oder auch um Dateiinhalte geht, werden Sie des öfteren die Bezeichnung <code>wato</code> finden. <strong>WATO</strong> ist die Abkürzung für Web Administration Tool: das Checkmk-Konfigurationswerkzeug bis einschließlich zur Version <span class="new">1.6.0</span>.
Die Funktion von WATO hat ab der Version <span class="new">2.0.0</span> das <span class="guihint">Setup</span>-Menü, oder auch kurz <strong>Setup</strong>, übernommen. Obwohl WATO in der Weboberfläche (fast) vollständig durch Setup ersetzt wurde, lebt es im Dateisystem weiter.</p></div>
</div>
<div class="sect2">
<h3 id="heading__welche_konfigurationsdatei_wird_verwendet">
<span class="hidden-anchor sr-only" id="_welche_konfigurationsdatei_wird_verwendet"></span>5.2. Welche Konfigurationsdatei wird verwendet?</h3>
<div class="paragraph"><p>Um herauszufinden, welche Datei Setup gerade verändert hat, gibt es einen
praktischen Befehl: <code>find</code>. Mit folgenden Parametern aufgerufen,
finden Sie alle Dateien (<code>-type f</code>) unterhalb von <code>etc/</code>,
welche innerhalb der letzten Minute (<code>-mmin -1</code>) geändert wurden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>find<span class="tok-w"> </span>etc/<span class="tok-w"> </span>-mmin<span class="tok-w"> </span>-1<span class="tok-w"> </span>-type<span class="tok-w"> </span>f
<span class="tok-go">etc/check_mk/conf.d/wato/rules.mk</span></code></pre></div></div>
<div class="paragraph"><p>Die Basis der Konfiguration ist immer das Verzeichnis <code>etc/check_mk</code>.
Darunter gibt es eine Aufteilung in verschiedene Domänen, welche meist einen
bestimmten Dienst betreffen. Dabei gibt es jeweils ein Verzeichnis mit der
Endung <code>.d</code>, unterhalb dessen alle Dateien mit der Endung <code>.mk</code>
automatisch und in <em>alphabetischer Reihenfolge</em> eingelesen werden. Bei
manchen gibt es noch eine Hauptdatei, welche als Erstes eingelesen wird.
Diese wird vom Setup nie angefasst und ist nur für manuelle Änderungen
vorgesehen.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 25%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Domäne</th>
<th class="tableblock halign-left valign-top">Konfigurationsverzeichnis</th>
<th class="tableblock halign-left valign-top">Hauptdatei</th>
<th class="tableblock halign-left valign-top">Änderungen aktivieren</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/conf.d/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>main.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmk -O</code> bzw. <code>cmk -R</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="user_interface.html">GUI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/multisite.d/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>multisite.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">automatisch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="ec.html">Event Console</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mkeventd.d/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mkeventd.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>omd reload mkeventd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="notifications.html#async">Benachrichtigungs-Spooler</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mknotifyd.d/</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">automatisch</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__setup_und_konfigurationsdateien">
<span class="hidden-anchor sr-only" id="_setup_und_konfigurationsdateien"></span>5.3. Setup und Konfigurationsdateien</h3>
<div class="paragraph"><p>Unterhalb der <code>.d/</code>-Konfigurationsverzeichnisse gibt es immer das Unterverzeichnis
<code>wato</code>, z.B. <code>etc/check_mk/conf.d/wato</code>. Das Setup liest und schreibt
grundsätzlich nur dort. Der für das Konfigurationsverzeichnis zuständige Dienst liest aber auch die übrigen
Dateien in „seinem“ <code>.d</code>-Verzeichnis, falls Sie dort welche von Hand anlegen. Das bedeutet:</p></div>
<div class="ulist"><ul>
<li><p>Möchten Sie, dass Ihre manuelle Konfiguration im Setup sichtbar und editierbar wird, so verwenden Sie die existierenden Pfade.</p></li>
<li><p>Möchten Sie, dass Ihre Konfiguration einfach nur wirksam, aber im Setup nicht sichtbar wird, so verwenden Sie eigene Dateien außerhalb von <code>wato/</code>.</p></li>
<li><p>Möchten Sie, dass Ihre Konfiguration im Setup sichtbar, aber nicht änderbar wird, so können Sie manche der Dateien <em>sperren.</em></p></li>
</ul></div>
<div class="sect3">
<h4 id="heading__sperren_von_dateien_und_ordnern">
<span class="hidden-anchor sr-only" id="_sperren_von_dateien_und_ordnern"></span>Sperren von Dateien und Ordnern</h4>
<div class="paragraph"><p>Ein häufiger Grund für das manuelle Erzeugen von Konfigurationsdateien ohne Setup ist der Import von zu überwachenden Hosts aus einer Configuration Management Database (CMDB).
Im Gegensatz zur Methode über die <a href="rest_api.html">REST-API</a> erzeugen Sie hier mit einem Skript direkt in <code>etc/check_mk/conf.d/wato</code> die Ordner für die Hosts und darin jeweils die Datei <code>hosts.mk</code> für die im Ordner enthaltenen Hosts und eventuell auch die Datei <code>.wato</code>, welche die Ordnereigenschaften enthält.</p></div>
<div class="paragraph"><p>Wenn dieser Import nicht nur einmalig geschieht, sondern regelmäßig wiederholt
wird, weil die CMDB das führende System ist, wäre es sehr ungünstig, wenn
Ihre Benutzer über das Setup irgendwelche Änderungen an den Dateien machen würden.
Denn diese gingen dann beim nächsten Import verloren.</p></div>
<div class="paragraph"><p>Eine <code>hosts.mk</code>-Datei können Sie sperren, indem Sie eine Zeile für das Attribut <code>lock</code> einfügen:</p></div>
<div class="listingblock">
<div class="title">hosts.mk</div>
<div class="content"><pre class="pygments highlight"><code><span></span># Created by WATO
# encoding: utf-8

_lock = True</code></pre></div>
</div>
<div class="paragraph"><p>Beim Öffnen dieses Ordners im Setup wird über der Hosts-Liste die folgende Meldung angezeigt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/cmk_commandline_locked_host_attributes.png" alt="Meldung, dass die Bearbeitung von Hosts im Ordner gesperrt ist."></div></div>
<div class="paragraph"><p>Sämtliche Aktionen, welche eine Änderung an der Datei <code>hosts.mk</code>
erfordern würden, sind in der GUI dann gesperrt. Das betrifft übrigens
<em>nicht</em> die Service-Erkennung. Die konfigurierten Services eines Hosts
werden unter <code>var/check_mk/autochecks/</code> gespeichert.</p></div>
<div class="paragraph"><p>Sie können auch die Ordnereigenschaften sperren.
Dies geschieht durch einen Eintrag in der Datei <code>.wato</code> des Ordners: Setzen Sie im Dictionary der Datei das Attribut <code>lock</code> auf <code>True</code>:</p></div>
<div class="listingblock">
<div class="title">.wato</div>
<div class="content"><pre class="pygments highlight"><code><span></span>{'title': 'My folder',
 'attributes': {},
 'num_hosts': 1,
 'lock': True,
 'lock_subfolders': False,
 '__id': '7f2a8906d3c3448fac8a379e2d1cec0e'}</code></pre></div>
</div>
<div class="paragraph"><p>Setzen Sie auch noch das Attribut <code>lock_subfolders</code> auf <code>True</code>, so verhindern Sie das Anlegen und Löschen von Unterordnern.</p></div>
<div class="paragraph"><p>Das Sperren von anderen Dateien — wie z.B. <code>rules.mk</code> — ist aktuell
nicht möglich.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__die_syntax_der_dateien">
<span class="hidden-anchor sr-only" id="_die_syntax_der_dateien"></span>5.4. Die Syntax der Dateien</h3>
<div class="paragraph"><p>Rein formal gilt für alle Konfigurationsdateien von Checkmk, dass diese
in <strong>Python 3</strong>-Syntax geschrieben sind. Dabei gibt es zwei Arten
von Dateien:</p></div>
<div class="ulist"><ul>
<li><p>solche, die von Python wie ein Skript <em>ausgeführt</em> werden, wozu z.B. <code>hosts.mk</code> gehört und</p></li>
<li><p>solche, die von Python als Wert eingelesen werden, wozu z.B. <code>.wato</code> gehört.</p></li>
</ul></div>
<div class="paragraph"><p>Die ausführbaren Dateien erkennen Sie daran, dass hier Variablen durch Zuweisungen (<code>=</code>)
mit Werten belegt werden. Die anderen Dateien enthalten meist ein Python-Dictionary, welches
mit einer öffnenden geschweiften Klammer beginnt. Manchmal sind es auch einfache Werte.</p></div>
<div class="paragraph"><p>Falls Sie in einer Datei ein Nicht-ASCII-Zeichen benötigen (z.B. einen deutschen Umlaut)
so müssen Sie in die erste oder zweite Zeile folgenden Kommentar einfügen:</p></div>
<div class="listingblock">
<div class="title">somefile.mk</div>
<div class="content"><pre class="pygments highlight"><code><span></span># encoding: utf-8</code></pre></div>
</div>
<div class="paragraph"><p>Andernfalls wird es beim Einlesen zu einem Syntaxfehler kommen. Für weitere Hinweise
zur Syntax von Python verweisen wir auf dafür spezialisierte Seiten, zum Beispiel auf die
<a href="https://docs.python.org/3/reference/">offizielle Referenz von Python 3</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_check_config_files">
<span class="hidden-anchor sr-only" id="check_config_files"></span>5.5. Konfigurationsdateien überprüfen</h3>
<div class="paragraph"><p>Wenn Sie Konfigurationsdateien in <code>etc/check_mk/</code> händisch editieren, bietet es sich an, die Konfiguration prüfen zu lassen.
Dies können Sie mit dem Tool <code>cmk-update-config</code> erledigen, welches eigentlich nur automatisch nach einem Versionsupdate mit <code>omd update</code> ausgeführt wird:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk-update-config
<span class="tok-go">...</span>
<span class="tok-go">Verifying Checkmk configuration...</span>
<span class="tok-go"> 01/05 Cleanup precompiled host and folder files...</span>
<span class="tok-go"> 02/05 Rulesets...</span>
<span class="tok-go">Exception while trying to load rulesets: Cannot read configuration file "/omd/sites/mysite/etc/check_mk/conf.d/wato/rules.mk":</span>
<span class="hll"><span class="tok-go"> '[' was never closed (&lt;string&gt;, line 44)</span>
</span>
<span class="tok-go">You can abort the update process (A) and try to fix the incompatibilities or try to continue the update (c).</span>
<span class="tok-go">Abort update? [A/c]</span>
<span class="tok-go">...</span></code></pre></div></div>
<div class="paragraph"><p>Im Auszug oben sehen Sie beispielsweise den Hinweis auf eine nicht geschlossene Klammer.</p></div>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#_warum_kommandozeile">1. Warum Kommandozeile?</a></li>
<li>
<a href="#site_user">2. Der Instanzbenutzer</a><ul class="sectlevel1">
<li><a href="#_login_als_instanzbenutzer">2.1. Login als Instanzbenutzer</a></li>
<li><a href="#_profil_und_umgebungsvariablen">2.2. Profil und Umgebungsvariablen</a></li>
<li><a href="#_anpassung_der_shell">2.3. Anpassung der Shell</a></li>
</ul>
</li>
<li>
<a href="#folder_structure">3. Die Verzeichnisstruktur</a><ul class="sectlevel1">
<li><a href="#_trennung_von_software_und_daten">3.1. Trennung von Software und Daten</a></li>
<li><a href="#sitedir">3.2. Instanzverzeichnis</a></li>
<li><a href="#_software">3.3. Software</a></li>
<li><a href="#data">3.4. Daten</a></li>
<li><a href="#local">3.5. Checkmk verändern und erweitern - die lokalen Dateien</a></li>
<li><a href="#logs">3.6. Logdateien</a></li>
</ul>
</li>
<li>
<a href="#cmk">4. Der Befehl cmk</a><ul class="sectlevel1">
<li><a href="#options">4.1. Die Befehlsoptionen</a></li>
<li><a href="#commands_core">4.2. Befehle für den Monitoring-Kern</a></li>
<li><a href="#execute_checks">4.3. Checks ausführen</a></li>
<li><a href="#dump_agent">4.4. Agentenausgabe holen</a></li>
<li><a href="#bake_agents">4.5. Agenten backen</a></li>
<li><a href="#list_hosts">4.6. Hosts auflisten</a></li>
<li><a href="#dump_host">4.7. Host-Konfiguration anzeigen</a></li>
<li><a href="#paths">4.8. Checkmk Pfadübersicht</a></li>
<li><a href="#info_plugins">4.9. Informationen zu den Check-Plugins</a></li>
</ul>
</li>
<li>
<a href="#config">5. Konfiguration ohne Setup</a><ul class="sectlevel1">
<li><a href="#_wo_ist_die_dokumentation">5.1. Wo ist die Dokumentation?</a></li>
<li><a href="#_welche_konfigurationsdatei_wird_verwendet">5.2. Welche Konfigurationsdatei wird verwendet?</a></li>
<li>
<a href="#_setup_und_konfigurationsdateien">5.3. Setup und Konfigurationsdateien</a><ul class="sectlevel2"><li><a href="#_sperren_von_dateien_und_ordnern">Sperren von Dateien und Ordnern</a></li></ul>
</li>
<li><a href="#_die_syntax_der_dateien">5.4. Die Syntax der Dateien</a></li>
<li><a href="#check_config_files">5.5. Konfigurationsdateien überprüfen</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
