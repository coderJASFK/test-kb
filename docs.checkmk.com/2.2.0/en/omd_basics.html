<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Checkmk enables the administration of any number of monitoring sites and software versions on a server with the omd command.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Site administration with omd">
<meta name="og:description" content="Checkmk enables the administration of any number of monitoring sites and software versions on a server with the omd command.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Site administration with omd</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.2.0/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.2.0/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.2.0/de/omd_basics.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.2.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.1.0/en/omd_basics.html">2.1.0</a><a class="dropdown-item" href="../../latest/en/omd_basics.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="release_notes.html">Release notes</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and derivatives</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
<li>
<p><a href="install_azure.html">Installation from Azure Marketplace</a></p>
</li>
<li>
<p><a href="install_aws.html">Installation from AWS Marketplace</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.2.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.2.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="password_store.html">Password store</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="mkp_viewables.html">MKPs for GUI extensions</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
<li>
<p><a href="hosts_autoregister.html">Automated host creation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Rules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Notifications</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
<li>
<p><a href="notifications_ilert.html">Notifications via ilert</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_teams.html">Notifications via Microsoft Teams</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_logfiles.html">Monitoring log files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMware ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_gcp.html">Monitoring Google Cloud Platform (GCP)</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_openshift.html">Monitoring OpenShift</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Measured values and graphing</a></p>
</li>
<li>
<p><a href="custom_notes.html">Custom notes</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cse.html">The Standard Edition</a></p>
</li>
<li>
<p><a href="cce.html">The Cloud Edition</a></p>
</li>
<li>
<p><a href="managed.html">The Managed Services Edition</a></p>
</li>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">The Checkmk REST API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_intro.html">Developing extensions for Checkmk</a></p>
</li>
<li>
<p><a href="devel_check_plugins.html">Writing agent-based check plug-ins</a></p>
</li>
<li>
<p><a href="devel_check_plugins_snmp.html">Writing SNMP-based check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Site administration with omd</h1>
<div class="details">
<span id="revdate">Last modified on 07-Sep-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.2.0/src/onprem/en/omd_basics.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="update.html">Updates and Upgrades</a>
<a href="install_packages.html">Basic information on the installation of Checkmk</a>
<a href="cmk_versions.html">Checkmk versions</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__omd_the_open_monitoring_distribution">
<span class="hidden-anchor sr-only" id="_omd_the_open_monitoring_distribution"></span>1. OMD - The Open Monitoring Distribution</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Checkmk monitoring system uses the <em>Open Monitoring Distribution</em> (OMD).
Founded by Mathias Kettner, OMD is an Open Source project which revolves around the user-friendly and flexible installation of a monitoring solution made up of various components.
The abbreviation OMD might already be familiar to you as part of the RPM/DEB-Package installation.</p></div>
<div class="paragraph"><p>An OMD-based installation is distinguished by a number of characteristics:</p></div>
<div class="ulist"><ul>
<li><p>The ability to run <em>multiple</em> monitoring sites in parallel</p></li>
<li><p>The ability to operate sites with <em>differing versions</em> of the monitoring software</p></li>
<li><p>An intelligent and convenient mechanism for updating the software</p></li>
<li><p>Uniform file paths — regardless of which Linux-platform is installed</p></li>
<li><p>A clear separation of <em>data</em> and <em>software</em></p></li>
<li><p>A very simple installation — with no dependence on third-party software</p></li>
<li><p>A perfect pre-configuration of all components</p></li>
</ul></div>
<div class="paragraph"><p>OMD is managed on the command line, using the <code>omd</code> command — more precisely, a set of <code>omd</code> commands for the various actions used for the management of the monitoring sites, for example, <code>omd create</code> for creating a site.
The most important <code>omd</code> commands are presented in this article.</p></div>
<div class="paragraph"><p>The first command is <code>omd help</code>, which displays an overview of the available <code>omd</code> commands.
You can get help for any of these commands by adding the <code>--help</code> option after the command, e.g. <code>omd create --help</code>.
The two dashes before <code>help</code> are important here, because without them <code>omd create help</code> would have already created your first site with the name <code>help</code>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_create">
<span class="hidden-anchor sr-only" id="omd_create"></span>2. Creating sites</h2>
<div class="sectionbody">
<div class="paragraph"><p>Perhaps the best thing about OMD is that it can manage any number of <em>monitoring sites</em> simultaneously on a single server.
Each site is a self-contained monitoring system which runs independently of the others.</p></div>
<div class="paragraph"><p>A site always has a distinctive name, specified at its creation.
This name is the same as that of the Linux user which is created at the same time.
The site’s name is based on the Linux user name conventions.
The first character of a site name must be a letter, all other characters may be letters, digits and underscores.
The maximum length is 16 characters.</p></div>
<div class="paragraph"><p>A creation is performed with the <code>omd create</code> command.
This must be executed as the <code>root</code> user:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>create<span class="tok-w"> </span>mysite
<span class="tok-go">Adding /opt/omd/sites/mysite/tmp to /etc/fstab.</span>
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Updating core configuration...</span>
<span class="tok-go">Generating configuration for core (type nagios)...</span>
<span class="tok-go">Precompiling host checks...<span class="green">OK</span></span>
<span class="tok-go">Executing post-create script "01_create-sample-config.py"...<span class="green">OK</span></span>
<span class="tok-go">Restarting Apache...<span class="green">OK</span></span>
<span class="tok-go">Created new site mysite with version 2.1.0p17.cre.</span>

<span class="tok-go">  The site can be started with <strong>omd start mysite</strong>.</span>
<span class="tok-go">  The default web UI is available at <strong>http://linux/mysite/</strong></span>

<span class="tok-go">  The admin user for the web applications is <strong>cmkadmin</strong> with password: <strong>YzxfoFZh</strong></span>
<span class="tok-go">  For command line administration of the site, log in with <strong>'omd su mysite'</strong>.</span>
<span class="tok-go">  After logging in, you can change the password for cmkadmin with <strong>'cmk-passwd cmkadmin'</strong>.</span></code></pre></div></div>
<div class="paragraph"><p>When creating the <code>cmkadmin</code> user a password will be randomly-generated and issued.</p></div>
<div class="paragraph"><p>What takes place during the creation of a site named <code>mysite</code>?</p></div>
<div class="ulist"><ul>
<li><p>An operating system user <code>mysite</code>, and a group <code>mysite</code> will be created.</p></li>
<li><p>A new home directory <code>/omd/sites/mysite</code> will be created and assigned.
This directory is also referred to as the <em>site directory</em>.</p></li>
<li><p>This home directory will be populated with configuration files and sub-directories.</p></li>
<li><p>A basic configuration will be created for the new site.</p></li>
</ul></div>
<div class="paragraph"><p><strong>Note:</strong> It is not possible to create a new site with a name that is already assigned on the server as the name of a 'normal' user.</p></div>
<div class="sect2">
<h3 id="heading_user_group_id">
<span class="hidden-anchor sr-only" id="user_group_id"></span>2.1. User and group IDs</h3>
<div class="paragraph"><p>In some cases it is also desirable to specify the user/group ID of the new user to be created.
This is performed with the <code>-u</code> and <code>-g</code> options, e.g.:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>create<span class="tok-w"> </span>-u<span class="tok-w"> </span><span class="tok-m">6100</span><span class="tok-w"> </span>-g<span class="tok-w"> </span><span class="tok-m">180</span><span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>An overview of the further options can be shown with <code>omd create --help</code>.
The most important options are:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u UID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new user will be created with the User-ID <code>UID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-g GID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new user’s group will be created with the Group-ID <code>GID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--admin-password mypassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new user is created with the password <code>mypassword</code> — instead of the randomly generated one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--reuse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OMD assumes that the new user already exists, and does not create it. The home directory of this user must be located below <code>/omd/sites/</code> and must be empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new site’s temporary file system will be created with the <code>SIZE</code> value. <code>SIZE</code> has the suffix <code>M</code> (Megabyte), <code>G</code> (Gigabyte) or <code>%</code> (percentage of RAM). Example: <code>-t 4G</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_init">
<span class="hidden-anchor sr-only" id="init"></span>2.2. External site directory</h3>
<div class="paragraph"><p>By default, the home directory of a new site is created at <code>/omd/sites/</code> and filled with default files.
However, you can also have an empty home directory created, for example to mount an external volume at this location.
This is done by the <code>--no-init</code> option:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>create<span class="tok-w"> </span>--no-init<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>This option also omits integration with the system apache, leaving <code>/omd/apache/mysite.conf</code> empty.
You could then mount any directory or volume and continue the setup:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>init<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p><code>omd init</code> then catches up with the two omitted steps, so it adds the default files and creates the Apache configuration.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_site_user">
<span class="hidden-anchor sr-only" id="site_user"></span>3. Site user</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can execute the <code>omd</code> commands as <code>root</code> user or as <em>site user</em>.
Under <code>root</code> you have more possibilities.
For example, only <code>root</code> can create a site, which is logical, because of course first a site must be created before a user can be created for it.
Since you can execute a command on <code>root</code> that applies simultaneously to all existing sites, you must include the name of the particular site you are interested in with the <code>omd</code> command.</p></div>
<div class="paragraph"><p>Once the new site has been created, you should run any other <code>omd</code> commands only as the site user.
As a site user you can execute all important operations affecting this site.</p></div>
<div class="paragraph"><p>Switching users is done with <code>su</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>su<span class="tok-w"> </span>-<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>Note that the minus sign following the <code>su</code> is essential.
It ensures that switching users processes <em>all</em> of the operations that take place during a normal login.
In particular, all environment variables will be correctly set, and your session will start as <code>mysite</code> in the <code>/omd/sites/mysite</code> site directory:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$</span></code></pre></div></div>
<div class="paragraph"><p>Once you are logged in as a site user, you usually don’t need to include a site name with <code>omd</code> commands, since such a command is applied only to the site you are logged in to.</p></div>
<div class="paragraph"><p>If you have multiple Checkmk versions installed on your Checkmk server, the corresponding OMD version is also installed with each of these versions.
This can result in a long list of software versions over time.
Since <code>omd</code> commands can also differ between versions, it is sometimes interesting to know which OMD version you are currently working with.</p></div>
<div class="ulist"><ul>
<li><p>As a site user, you always use the <code>omd</code> commands for the Checkmk version currently installed on the site, which you can display with <code>omd version</code>.</p></li>
<li><p>As a <code>root</code> user, you execute the commands for the default version that is also used when creating a site — this is usually the latest version installed on the server.
You can display the default version with <code>omd version</code> and change it with <code>omd setversion</code>.</p></li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_start_stop">
<span class="hidden-anchor sr-only" id="omd_start_stop"></span>4. Starting and stopping sites</h2>
<div class="sectionbody">
<div class="paragraph"><p>Your site is now ready to be started — which can be done as <code>root</code> with <code>omd start mysite</code>.
It is however, fundamentally better to work with the site as the site user:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Starting agent-receiver...OK</span>
<span class="tok-go">Starting mkeventd...OK</span>
<span class="tok-go">Starting rrdcached...OK</span>
<span class="tok-go">Starting npcd...OK</span>
<span class="tok-go">Starting nagios...OK</span>
<span class="tok-go">Starting apache...OK</span>
<span class="tok-go">Starting redis...OK</span>
<span class="tok-go">Initializing Crontab...OK</span></code></pre></div></div>
<div class="paragraph"><p>Unsurprisingly, stopping is done with <code>omd stop</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>stop
<span class="tok-go">Removing Crontab...OK</span>
<span class="tok-go">Stopping redis...killing 484382...OK</span>
<span class="tok-go">Stopping apache...killing 484371...OK</span>
<span class="tok-go">Stopping nagios...OK</span>
<span class="tok-go">Stopping npcd...OK</span>
<span class="tok-go">Stopping rrdcached...waiting for termination...OK</span>
<span class="tok-go">Stopping mkeventd...killing 484279...OK</span>
<span class="tok-go">Stopping agent-receiver...killing 484267...OK</span>
<span class="tok-go">Stopping 1 remaining site processes...<span class="green">OK</span></span></code></pre></div></div>
<div class="paragraph"><p>Starting and stopping a site is nothing more than starting or stopping a collection of services.
These can also be individually managed by specifying the name of the service, for example:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start<span class="tok-w"> </span>apache
<span class="tok-go">Temporary filesystem already mounted</span>
<span class="tok-go">Starting apache...OK</span></code></pre></div></div>
<div class="paragraph"><p>The names of the various services can be found in the <code>~/etc/init.d</code> directory.
Note the <em>tilde</em> (<code>~</code>) prefixing the path name — this represents the home directory for the site user (the site directory).
<code>~/etc/init.d</code> and <code>/etc/init.d</code> are different directories.</p></div>
<div class="paragraph"><p>Alongside <code>start</code> and <code>stop</code>, there are also the <code>omd</code> commands <code>restart</code>, <code>reload</code> and <code>status</code>.
Reloading Apache is, for example, always necessary following a manual change to the Apache configuration:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>reload<span class="tok-w"> </span>apache
<span class="tok-go">Reloading apache</span></code></pre></div></div>
<div class="paragraph"><p>Note that this does not apply to the global Linux server’s Apache process, but rather the site’s own dedicated Apache process.</p></div>
<div class="paragraph"><p>In order to be able to maintain an overview of the state of the site following all of the starts and stops, simply use <code>omd status</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>status
<span class="tok-go">agent-receiver: <span class="red">stopped</span></span>
<span class="tok-go">mkeventd:       <span class="red">stopped</span></span>
<span class="tok-go">rrdcached:      <span class="red">stopped</span></span>
<span class="tok-go">npcd:           <span class="red">stopped</span></span>
<span class="tok-go">nagios:         <span class="red">stopped</span></span>
<span class="tok-go">apache:         <span class="green">running</span></span>
<span class="tok-go">redis:          <span class="red">stopped</span></span>
<span class="tok-go">crontab:        <span class="red">stopped</span></span>
<span class="tok-go">-----------------------</span>
<span class="tok-go">Overall state:  <span class="yellow">partially running</span></span></code></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_config">
<span class="hidden-anchor sr-only" id="omd_config"></span>5. Configuring the components</h2>
<div class="sectionbody">
<div class="paragraph"><p>As already mentioned, OMD integrates multiple software components into a monitoring system.
In so doing, some components are optional, and for some there are alternatives or different operational settings.
All of this can be conveniently configured with the <code>omd config</code> command.
There are also interactive and scripting modes.</p></div>
<div class="sect2">
<h3 id="heading_interactive_mode">
<span class="hidden-anchor sr-only" id="interactive_mode"></span>5.1. Interactive configuration</h3>
<div class="paragraph"><p>As the site user you can simply call the interactive mode with:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>config</code></pre></div></div>
<div class="imageblock">
<div class="content"><img src="../images/omd_basics_omd_config_main.png" alt="Main menu of `omd config`." width="300"></div>
<div class="title">In the <code>omd config</code> menu you navigate with the cursor and enter keys</div>
</div>
<div class="paragraph"><p>As soon as you change a setting while the site is running, OMD will inform you that your site must be stopped first and does this as needed:</p></div>
<div class="imageblock">
<div class="content"><img src="../images/omd_basics_omd_config_cannotchange.png" alt="Hint when changing a setting while the site is running." width="300"></div>
<div class="title">The configuration can only be changed when the site is not running</div>
</div>
<div class="paragraph"><p>Don’t forget to restart the site following the completion of the work.
<code>omd config</code> will <em>not</em> do this for you automatically.</p></div>
</div>
<div class="sect2">
<h3 id="heading_script_mode">
<span class="hidden-anchor sr-only" id="script_mode"></span>5.2. Configuration via script mode</h3>
<div class="paragraph"><p>Those who don’t like the interactive mode, or prefer to work with scripts, can set the individual settings as variables via the command line.
For this there is the <code>omd config set</code> command.
The following example sets the <code>AUTOSTART</code> variable to <code>off</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>config<span class="tok-w"> </span><span class="tok-nb">set</span><span class="tok-w"> </span>AUTOSTART<span class="tok-w"> </span>off</code></pre></div></div>
<div class="paragraph"><p>This can be also performed as <code>root</code> if the site’s name is added as an argument:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>config<span class="tok-w"> </span>mysite<span class="tok-w"> </span><span class="tok-nb">set</span><span class="tok-w"> </span>AUTOSTART<span class="tok-w"> </span>off</code></pre></div></div>
<div class="paragraph"><p>The current assignment of all variables shows as <code>root</code> the command <code>omd config mysite show</code> and as site user <code>omd config show</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>config<span class="tok-w"> </span>show
<span class="tok-go">ADMIN_MAIL:</span>
<span class="tok-go">AGENT_RECEIVER: on</span>
<span class="tok-go">AGENT_RECEIVER_PORT: 8005</span>
<span class="tok-go">APACHE_MODE: own</span>
<span class="tok-go">APACHE_TCP_ADDR: 127.0.0.1</span>
<span class="tok-go">APACHE_TCP_PORT: 5008</span>
<span class="tok-go">AUTOSTART: off</span>
<span class="tok-go">[...]</span></code></pre></div></div>
<div class="paragraph"><p>The command output above is abbreviated for clarity and shows only the first entries.</p></div>
</div>
<div class="sect2">
<h3 id="heading__commonly_used_settings">
<span class="hidden-anchor sr-only" id="_commonly_used_settings"></span>5.3. Commonly used settings</h3>
<div class="paragraph"><p>There are numerous settings in <code>omd config</code>.
The most important are:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTOSTART</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>on</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to <code>off</code> if you want to prevent an automatic starting of the site when the computer is started. This is primarily of interest for test installations that should not normally start by themselves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nagios</code> (Raw Edition),<br>
<code>cmc</code> (commercial editions)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selection of the monitoring core. In the commercial editions the Nagios core can be selected instead of the <a href="cmc.html">Checkmk Micro Core (CMC)</a>. The <span class="image-inline"><img src="../images/icons/CRE.png" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> has only <code>nagios</code> as its monitoring core.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MKEVENTD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>on</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activates the <a href="glossar.html#ec">Event Console</a> with which the syslog messages, SNMP traps and other events can be processed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVESTATUS_TCP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>off</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows external access to the status data for this site. This can be used to set up a <a href="glossar.html#distributed_monitoring">distributed monitoring</a>. The status of this (remote) site can be incorporated into the central site. Enable this setting only in a secure network.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p><strong>Note:</strong> You can also see these variables under the same names in the interactive mode.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_cp_mv">
<span class="hidden-anchor sr-only" id="omd_cp_mv"></span>6. Copying and renaming sites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_omd_cp">
<span class="hidden-anchor sr-only" id="omd_cp"></span>6.1. Copying sites</h3>
<div class="paragraph"><p>It is sometimes useful to create a copy of a site for testing purposes or when preparing for an <a href="update.html">update</a>.
Of course one could simply copy the <code>/omd/sites/mysite_old</code> directory to <code>/omd/sites/mysite_new</code>.
That will however not work as desired, because:</p></div>
<div class="ulist"><ul>
<li><p>many configuration files include the site’s name,</p></li>
<li><p>in several places absolute paths which start with <code>/omd/sites/mysite_old</code> also appear,</p></li>
<li><p>and not least, at the operating system level there must be a <a href="#user_group_id">user, including its associated group</a> that owns the site and by default has the same name as the site.</p></li>
</ul></div>
<div class="paragraph"><p>To simplify copying a site, there is instead the <code>omd cp</code> command, which takes all of this into account.
Run the command as <code>root</code> and simply enter the name of the existing site followed by the name of the new one.
For example:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>cp<span class="tok-w"> </span>mysite_old<span class="tok-w"> </span>mysite_new</code></pre></div></div>
<div class="paragraph"><p>The copy can only work if:</p></div>
<div class="ulist"><ul>
<li><p>the site is stopped and</p></li>
<li><p>no processes are running that belong to the site user.</p></li>
</ul></div>
<div class="paragraph"><p>Both of these ensure that the site is in a consistent state at the time of copying and does not change during the operation.</p></div>
</div>
<div class="sect2">
<h3 id="heading_omd_cp_mv_migration">
<span class="hidden-anchor sr-only" id="omd_cp_mv_migration"></span>6.2. Migrating the configuration</h3>
<div class="paragraph"><p>OMD could originally only handle the files that were actually created during the <a href="#omd_create">creation of the site</a> with <code>omd create</code>, and which also contained the site’s ID (<code>$OMD_SITE</code>).
These files can be found in the site directory <code>~/etc</code> with this command:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>grep<span class="tok-w"> </span>-r<span class="tok-w"> </span><span class="tok-nv">$OMD_SITE</span><span class="tok-w"> </span>etc</code></pre></div></div>
<div class="paragraph"><p>Previously, OMD could not do anything with configuration files that were created later via work with the Checkmk site (the configurations of hosts that had been added at a later date, for example).
From a purely technical point of view, this behavior corresponds exactly to the scope of OMD.
However, the expectation of most users is that an <code>omd cp</code> creates a completely new site that can continue to be used productively — including its own monitoring configuration.</p></div>
<div class="paragraph"><p>From Checkmk version <span class="new">2.1.0</span> OMD can now also customize the most important elements of the Checkmk configuration.
By the way, you don’t have to do anything, the whole migration described below takes place automatically.</p></div>
<div class="paragraph"><p>A typical example:
In a host’s properties you can use the <span class="guihint">Monitored on site</span> attribute to manually specify which site this host should be monitored on, for example <code>mysite_old</code>.
After an <code>omd cp mysite_old mysite_new</code> the value will change to <code>mysite_new</code> accordingly.
(Previously this procedure would have resulted in the entry <code>Unknown site (mysite_old)</code>).</p></div>
<div class="paragraph"><p>The actual technical implementation of this migration is as follows:
OMD detects changes to the site ID and then executes the <code>post-rename-site -v -o mysite_new</code> command.
The individual migration steps are subsequently processed completely automatically via the so-called <em>rename actions plugins</em>,
which you can find  at <code>cmk/post_rename_site/plugins/actions</code> in the <a href="https://github.com/Checkmk/checkmk/tree/master/cmk/post_rename_site/plugins/actions" target="_blank">Git repository</a>.</p></div>
<div class="paragraph"><p>Migration also includes informing you about anything that <strong>cannot</strong> be migrated automatically.</p></div>
<div class="paragraph"><p>Here’s a concrete example:
you are using distributed monitoring and rename both the central site and a remote site.</p></div>
<div class="paragraph"><p><strong>Central site:</strong> The <code>sites.py</code> plug-in detects that this is a central site and updates, among other things, the <span class="guihint">URL prefix</span> value, which can be found in the connection settings of the local site under <span class="guihint">Setup &gt; General &gt; Distributed Monitoring</span>.</p></div>
<div class="paragraph"><p><strong>Remote site:</strong> The <code>warn_remote_site.py</code> plug-in recognizes that it is a remote site and accordingly indicates that the central site must be checked and manually customized if necessary.
This in turn means that in the distributed monitoring settings on the central site, the remote site’s new name must be entered in the connection settings to the renamed remote  site — OMD of course cannot do this from a remote computer.</p></div>
<div class="paragraph"><p>OMD itself informs you in detail about the whole procedure in the terminal.
Here you can see an example of the migration messages from the <code>omd cp</code> output when renaming a central site — separated into <em>success</em> and <em>warning</em> messages.
The processed <code>rename action plugins</code> are numbered individually.
First the output from the automatically performed migration tasks (shortened here):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">...</span>
<span class="tok-go">Executing post-cp script "01_cmk-post-rename-site"...</span>
<span class="tok-go">-|  1/6 Distributed monitoring configuration...</span>
<span class="tok-go">-|  2/6 Hosts and folders...</span>
<span class="tok-go">-|  3/6 Update core config...</span>
<span class="tok-go">...</span></code></pre></div></div>
<div class="paragraph"><p>The second part of the output now contains tips regarding settings you <strong>may</strong> need to configure manually (here heavily abbreviated):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">...</span>
<span class="tok-go">-|  4/6 Warn about renamed remote site...</span>
<span class="tok-go">-|  5/6 Warn about new network ports...</span>
<span class="tok-go">-|  6/6 Warn about configurations to review...</span>
<span class="tok-go">...</span></code></pre></div></div>
<div class="paragraph"><p>The <code>Warn about configurations to review…​</code> item includes general notes on individual aspects that will generally need to be reviewed manually during a migration, such as hard coded filters for views:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">...</span>
<span class="tok-go">-| Parts of the site configuration cannot be migrated automatically. The following</span>
<span class="tok-go">-| parts of the configuration may have to be reviewed and adjusted manually:</span>
<span class="tok-go">-|</span>
<span class="tok-go">-| - Custom bookmarks (in users bookmark lists)</span>
<span class="tok-go">-| - Hard coded site filters in custom dashboards, views, reports</span>
<span class="tok-go">-| - Path in rrdcached journal files</span>
<span class="tok-go">-| - NagVis maps or custom NagVis backend settings</span>
<span class="tok-go">-| - Notification rule "site" conditions</span>
<span class="tok-go">-| - Event Console rule "site" conditions</span>
<span class="tok-go">-| - "site" field in "Agent updater (Linux, Windows, Solaris)" rules (CEE/CME only)</span>
<span class="tok-go">-| - Alert handler rule "site" conditions (CEE/CME only)</span>
<span class="tok-go">-|</span>
<span class="tok-go">-| Done</span></code></pre></div></div>
<div class="paragraph"><p>Here is an overview of the six currently active plug-ins — the order here corresponds to the numbering in the above output:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Plug-in</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sites.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the site ID in various configuration files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hosts_and_folders.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the site attribute of host and folder properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update_core_config.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates the core configuration (<code>cmk -U</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>warn_remote_site.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warns when renaming a remote site.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>warn_changed_ports.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notices of problems with multiple ports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>warn_about_not_migrated_configs.py</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General tips for elements that should be checked manually.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_limit_data">
<span class="hidden-anchor sr-only" id="limit_data"></span>6.3. Limiting data volume</h3>
<div class="paragraph"><p>If you are monitoring a large number of hosts with the site, the volume of data to be copied can be quite substantial.
Most of this is produced by the measured values stored in the <a href="graphing.html#rrds">Round Robin Databases (RRD)</a>.
But the log files containing historic events can also produce larger data volumes.</p></div>
<div class="paragraph"><p>If the history is not required (for example, because you just want to test something quickly), these can be omitted from the copy.
In such cases the following options can be added to <code>omd cp</code>:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-rrds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies the site without the RRDs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-logs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies the site without log files and other historical data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does both: <code>-N</code> is an abbreviation for <code>--no-rrds --nologs</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The order of the option(s) is important:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>cp<span class="tok-w"> </span>--no-rrds<span class="tok-w"> </span>mysite_old<span class="tok-w"> </span>mysite_new</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_omd_mv">
<span class="hidden-anchor sr-only" id="omd_mv"></span>6.4. Renaming sites</h3>
<div class="paragraph"><p>Renaming a site is performed with the <code>omd mv</code> command.
This is done similarly to <a href="#omd_cp">copying a site</a>, has the same prerequisites and is also done including <a href="#omd_cp_mv_migration">configuration migration</a>.
The options to restrict the data volume are not available since the data is only being moved to another directory and is not being duplicated.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>mv<span class="tok-w"> </span>mysite_old<span class="tok-w"> </span>mysite_new</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__other_options">
<span class="hidden-anchor sr-only" id="_other_options"></span>6.5. Other options</h3>
<div class="paragraph"><p>As with creating a site, copying and renaming each creates a new Linux user.
Therefore <code>omd cp</code> and <code>omd mv</code> also have some of the same options as <code>omd create</code>, e.g. to specify <a href="#user_group_id">user and group IDs</a>.
For more detailed information, use the <code>omd cp --help</code> and <code>omd mv --help</code> commands.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_diff">
<span class="hidden-anchor sr-only" id="omd_diff"></span>7. Showing changes in configuration files</h2>
<div class="sectionbody">
<div class="paragraph"><p>When <a href="#omd_create">creating a site</a>, the <code>omd create</code> command fills the <code>~/etc</code> directory with numerous predefined configuration files.
A number of directories will also be created under <code>~/var</code> and <code>~/local</code>.</p></div>
<div class="paragraph"><p>Now it will probably be the case that over the course of time a number of the files will have been customized.
When after a time you wish to determine which files are no longer in the condition as originally supplied, the <code>omd diff</code> command can provide the answer.
Amongst other things, this is useful before an <a href="update.html">update of Checkmk</a>, since your changes could conflict with changes in the default files.</p></div>
<div class="paragraph"><p>When called without further arguments, all changed files below the current directory will be listed:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>diff
<span class="tok-go"> <span class="green">*</span> Changed content var/check_mk/wato/auth/auth.php</span>
<span class="tok-go"> <span class="yellow">!</span> Changed permissions var/check_mk/wato/auth/auth.php</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/htpasswd</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/diskspace.conf</span>
<span class="tok-go"> <span class="yellow">!</span> Changed permissions etc/diskspace.conf</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/auth.secret</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/mk-livestatus/xinetd.conf</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/omd/allocated_ports</span>
<span class="tok-go"> <span class="green">*</span> Changed content etc/apache/apache.conf</span>
<span class="tok-go"> <span class="green">*</span> Deleted etc/apache/apache-own.conf</span></code></pre></div></div>
<div class="paragraph"><p>You can also enter a query for a specific directory:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>diff<span class="tok-w"> </span>etc/apache
<span class="tok-go"> <span class="green">*</span> Changed content etc/apache/apache.conf</span>
<span class="tok-go"> <span class="green">*</span> Deleted etc/apache/apache-own.conf</span></code></pre></div></div>
<div class="paragraph"><p>If you wish to see the changes in detail, simply enter the path to the file:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>diff<span class="tok-w"> </span>etc/apache/apache.conf
<span class="tok-go">74,75c74,75</span>
<span class="tok-go">&lt; ServerLimit 64</span>
<span class="tok-go">&lt; MaxClients 64</span>
<span class="tok-go">---</span>
<span class="tok-go">&gt; ServerLimit 128</span>
<span class="tok-go">&gt; MaxClients 128</span></code></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_update">
<span class="hidden-anchor sr-only" id="omd_update"></span>8. Updating sites</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <code>omd update</code> command is used to update the monitoring software installed on the site to a later version.
This is presented in detail in the <a href="update.html#detailed">Updating Checkmk</a> article.
Other useful <code>omd</code> commands related to software updates are also shown there as examples:</p></div>
<div class="ulist"><ul>
<li><p><code>omd versions</code> to list all installed software versions,</p></li>
<li><p><code>omd sites</code> to list all existing sites with the versions installed on them,</p></li>
<li><p><code>omd version</code> to display the default version used when creating a site,</p></li>
<li><p><code>omd setversion</code> to set a different default version.</p></li>
</ul></div>
<div class="paragraph"><p>By the way, <code>omd update</code> is also used to <a href="update.html#updatedemo">upgrade</a> to another edition, e.g. from the Raw Edition to the Standard Edition.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_backup_restore">
<span class="hidden-anchor sr-only" id="omd_backup_restore"></span>9. Backing up and restoring sites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__creating_a_backup">
<span class="hidden-anchor sr-only" id="_creating_a_backup"></span>9.1. Creating a backup</h3>
<div class="paragraph"><p>The site management in Checkmk has a built-in mechanism for backing up and restoring Checkmk sites.
The <code>omd backup</code> and <code>omd restore</code> commands are the basics for packing all of the site’s data into a tar archive, and respectively, extracting that data for a restore.</p></div>
<div class="paragraph"><p><strong>Note:</strong> Checkmk also offers the possibility of performing backups and restores without using the command line, via the GUI under <span class="guihint">Setup &gt; Maintenance &gt; Backups</span>.
There you can also create encrypted backups and scheduled backup jobs.
See the <a href="backup.html">Backups</a> article to learn how to do this.</p></div>
<div class="paragraph"><p>Backing up a site with <code>omd backup</code> does not require <code>root</code> permissions.
A site user can perform this.
Simply enter as an argument the name of the backup file to be created:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>backup<span class="tok-w"> </span>/tmp/mysite.tar.gz</code></pre></div></div>
<div class="paragraph"><p>Note that:</p></div>
<div class="ulist"><ul>
<li><p>The created file type is a gzip-compressed tar archive. Therefore use <code>.tar.gz</code> or <code>.tgz</code> as the file extension.</p></li>
<li><p>Do <strong>not</strong> store the backup in the site directory, since this will of course be completely backed up – thus every subsequent backup will contain a copy of <em>all</em> of its predecessors.</p></li>
<li><p>If you create the backup as a site user, only the site user and their group will get read and write access to the tar archive.</p></li>
</ul></div>
<div class="paragraph"><p>If the backup’s target directory is not writable for a site user, you can also do the backup as <code>root</code>.
In this case an additional argument is required, as always, specifying the site name to be backed up:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>backup<span class="tok-w"> </span>mysite<span class="tok-w"> </span>/var/backups/mysite.tar.gz</code></pre></div></div>
<div class="paragraph"><p>The backup contains all of the site’s data — except for the volatile data under <code>~/tmp/</code>.
With the <code>tar tzf</code> command one can easily have a look at the file’s contents:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tar<span class="tok-w"> </span>tvzf<span class="tok-w"> </span>/tmp/mysite.tar.gz<span class="tok-w">  </span><span class="tok-p">|</span><span class="tok-w"> </span>less
<span class="tok-go">lrwxrwxrwx mysite/mysite     0 2022-07-25 11:59 mysite/version -&gt; ../../versions/2.1.0p8.cre</span>
<span class="tok-go">drwxr-xr-x mysite/mysite     0 2022-07-25 17:25 mysite/</span>
<span class="tok-go">-rw------- mysite/mysite   370 2022-07-26 17:09 mysite/.bash_history</span>
<span class="tok-go">-rw-r--r-- mysite/mysite  1091 2022-07-25 11:59 mysite/.bashrc</span>
<span class="tok-go">-rw-r--r-- mysite/mysite    63 2022-07-25 11:59 mysite/.modulebuildrc</span>
<span class="tok-go">-rw-r--r-- mysite/mysite  2066 2022-07-25 11:59 mysite/.profile</span>
<span class="tok-go">drwxr-xr-x mysite/mysite     0 2022-07-25 11:59 mysite/.version_meta/</span>
<span class="tok-go">drwxr-xr-x mysite/mysite     0 2022-07-20 11:40 mysite/.version_meta/skel/</span>
<span class="tok-go">-rw-r--r-- mysite/mysite  1091 2022-06-26 02:03 mysite/.version_meta/skel/.bashrc</span>
<span class="tok-go">-rw-r--r-- mysite/mysite    52 2022-07-20 09:02 mysite/.version_meta/skel/.modulebuildrc</span>
<span class="tok-go">-rw-r--r-- mysite/mysite  2055 2022-06-26 02:03 mysite/.version_meta/skel/.profile</span>
<span class="tok-go">drwxr-xr-x mysite/mysite     0 2022-07-20 11:40 mysite/.version_meta/skel/etc/</span>
<span class="tok-go">drwxr-xr-x mysite/mysite     0 2022-07-20 11:40 mysite/.version_meta/skel/etc/apache/</span>
<span class="tok-go">-rw-r--r-- mysite/mysite  1524 2022-06-26 02:03 mysite/.version_meta/skel/etc/apache/apache-own.conf</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__backup_without_history">
<span class="hidden-anchor sr-only" id="_backup_without_history"></span>9.2. Backup without history</h3>
<div class="paragraph"><p>The lion’s share of the data to be moved during a site backup are the measured values and the log files with historical events.
This is just as true when backing up as when copying a site.
If you do not absolutely need this data, you can omit it and thus make the backup much faster and the resulting output file much smaller.</p></div>
<div class="paragraph"><p><code>omd backup</code> provides <a href="#limit_data">the same options</a> to omit this data as <code>omd cp</code> does when copying.
In the following example, the backup is created without measurement data and without the history stored in the log files:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>backup<span class="tok-w"> </span>-N<span class="tok-w"> </span>/tmp/mysite.tar.gz</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__backing_up_a_running_site">
<span class="hidden-anchor sr-only" id="_backing_up_a_running_site"></span>9.3. Backing up a running site</h3>
<div class="paragraph"><p>A backup can also be created from a running site.
To ensure a consistent state of the <a href="graphing.html#rrds">Round Robin Databases (RRD)</a> used for recording the measurement data, the <code>omd backup</code> command automatically alters the Round Robin cache to a mode with which the running updates are written only to the journal, and no longer to the RRDs.
The journal files are the last to be backed up — thus it can be achieved that as much as possible of the measurement data that has been generated during the backup is also included in the backup.</p></div>
</div>
<div class="sect2">
<h3 id="heading__restore">
<span class="hidden-anchor sr-only" id="_restore"></span>9.4. Restore</h3>
<div class="paragraph"><p>Restoring a backup is as simple as creating a backup.
The <code>omd restore</code> command restores a site from a backup — in the Checkmk version that was used to backup the site.
Therefore, for the restore to work, this same version must be installed on the server.</p></div>
<div class="paragraph"><p>The site is completely emptied and refilled.
Before <code>omd restore</code> the site must be stopped and afterwards it must be restarted:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>stop
<span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>restore<span class="tok-w"> </span>/tmp/mysite.tar.gz
<span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start</code></pre></div></div>
<div class="paragraph"><p>A restore can also be performed by a <code>root</code> user.
Unlike when called by the site user, the site  will be <em>recreated</em> with the backup.</p></div>
<div class="paragraph"><p>So if there is still a site with the same name, you will need to <a href="#omd_rm">delete</a> it before the restore.
This can be performed either with an <code>omd rm</code>, or by simply including the <code>--reuse</code> option with the <code>omd restore</code>.
A <code>--kill</code> additionally ensures that the already existing site is stopped before the restore proceeds.
You do not need to specify the site name in the command, because it is contained in the backup:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>restore<span class="tok-w"> </span>--reuse<span class="tok-w"> </span>--kill<span class="tok-w"> </span>/var/backup/mysite.tar.gz
<span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>start<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>As <code>root</code>, you can also restore a site with a different name from that in the backup.
To do this, specify the desired name as an argument after the word <code>restore</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>restore<span class="tok-w"> </span>mysite2<span class="tok-w"> </span>/var/backup/mysite.tar.gz
<span class="tok-go">Restoring site mysite2 from /tmp/mysite.tar.gz...</span>
<span class="tok-go"> <span class="green">*</span> Converted ./.modulebuildrc</span>
<span class="tok-go"> <span class="green">*</span> Converted ./.profile</span>
<span class="tok-go"> <span class="green">*</span> Converted etc/xinetd.conf</span>
<span class="tok-go"> <span class="green">*</span> Converted etc/logrotate.conf</span></code></pre></div></div>
<div class="paragraph"><p>The long list of conversions that happen here has the same function as for <a href="#omd_cp_mv">copying and renaming sites</a> described earlier.
The site name is included in numerous configuration files, and with this procedure any such occurrences will be replaced automatically by the new name.</p></div>
</div>
<div class="sect2">
<h3 id="heading_ssh_omd_backup_restore">
<span class="hidden-anchor sr-only" id="ssh_omd_backup_restore"></span>9.5. Live backup &amp; restore to another server</h3>
<div class="paragraph"><p>The <code>omd backup</code> and <code>omd restore</code> commands can — in good old Unix tradition — also work via standard input/output instead of files.
Instead of a path for the tar file, simply enter a hyphen (<code><strong>-</strong></code>).</p></div>
<div class="paragraph"><p>In this way a pipe can be constructed and the data ‘streamed’ directly to another computer without requiring intermediate files.
The larger the backup, the more advantageous this will be since no temporary space in the backed up server’s file system will be needed.</p></div>
<div class="paragraph"><p>The following command backs up a site to another computer using SSH:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>backup<span class="tok-w"> </span>mysite<span class="tok-w"> </span>-<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>ssh<span class="tok-w"> </span>user@otherserver<span class="tok-w"> </span><span class="tok-s2">"cat &gt; /var/backup/mysite.tar.gz"</span></code></pre></div></div>
<div class="paragraph"><p>If you want to reverse the SSH access, i.e. prefer to connect from the backup server to the Checkmk site, this is also possible, as the following example shows.
For this, first an SSH login as a site user must be permitted.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@otherserver# </span>ssh<span class="tok-w"> </span>mysite@checkmkserver<span class="tok-w"> </span><span class="tok-s2">"omd backup -"</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>/var/backup/mysite.tar.gz</code></pre></div></div>
<div class="paragraph"><p>If you are clever, and combine the above with an <code>omd restore</code> which reads the data from the standard input, you can copy a complete, running site from one server to another — and without needing any
additional space for a backup file:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@otherserver# </span>ssh<span class="tok-w"> </span>mysite@checkmkserver<span class="tok-w"> </span><span class="tok-s2">"omd backup -"</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>omd<span class="tok-w"> </span>restore<span class="tok-w"> </span>-</code></pre></div></div>
<div class="paragraph"><p>And now again the whole thing with reversed SSH access — this time again from the source system to the target system:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>backup<span class="tok-w"> </span>mysite<span class="tok-w"> </span>-<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>ssh<span class="tok-w"> </span>user@otherserver<span class="tok-w"> </span><span class="tok-s2">"omd restore -"</span></code></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_enable">
<span class="hidden-anchor sr-only" id="enable"></span>10. Disabling sites</h2>
<div class="sectionbody">
<div class="paragraph"><p>OMD can disable sites.
With the command <code>omd disable --kill mysite</code>, executed as <code>root</code>, the following happens:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>The site <code>mysite</code> is stopped.</p></li>
<li><p>Processes accessing the <code>tmpfs</code> are stopped.</p></li>
<li><p>The <code>tmpfs</code> is unmounted.</p></li>
<li><p>The <code>/omd/apache/mysite.conf</code> file is flushed.</p></li>
<li><p>Apache is restarted.</p></li>
</ol></div>
<div class="paragraph"><p>In this state, the home directory of the site, here <code>/omd/sites/mysite</code>, is no longer referenced by any process.
This is especially practical in an <a href="appliance_cluster.html">cluster,</a> since the home directory can now be moved to another node.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_omd_rm">
<span class="hidden-anchor sr-only" id="omd_rm"></span>11. Deleting sites</h2>
<div class="sectionbody">
<div class="paragraph"><p>Deleting a site is as easy as <a href="#omd_create">creating</a> one — with the <code>omd rm</code> command as <code>root</code>.
The site will first be automatically stopped.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>rm<span class="tok-w"> </span>mysite
<span class="tok-go">PLEASE NOTE: This action removes all configuration files</span>
<span class="tok-go">             and variable data of the site.</span>

<span class="tok-go">In detail the following steps will be done:</span>
<span class="tok-go">- Stop all processes of the site</span>
<span class="tok-go">- Unmount tmpfs of the site</span>
<span class="tok-go">- Remove tmpfs of the site from fstab</span>
<span class="tok-go">- Remove the system user &lt;SITENAME&gt;</span>
<span class="tok-go">- Remove the system group &lt;SITENAME&gt;</span>
<span class="tok-go">- Remove the site home directory</span>
<span class="tok-go">- Restart the system wide apache daemon</span>
<span class="tok-go"> (yes/NO): <strong>yes</strong></span></code></pre></div></div>
<div class="paragraph"><p><strong>Attention:</strong> It goes without saying that this action also <strong>deletes all of the site’s data!</strong></p></div>
<div class="paragraph"><p>If you are no fan of confirmation prompts, or wish to perform the deletion as part of a script, the deletion can be forced with the <code>-f</code> option.</p></div>
<div class="paragraph"><p><strong>Attention:</strong> Here the <code>-f</code> must be placed <strong>before</strong> the <code>rm</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>-f<span class="tok-w"> </span>rm<span class="tok-w"> </span>mysite</code></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_cleanup">
<span class="hidden-anchor sr-only" id="cleanup"></span>12. Uninstall unused versions</h2>
<div class="sectionbody">
<div class="paragraph"><p>Since Checkmk may be installed in several versions at the same time, it may happen that not all versions are actually in use by an instance.
OMD can uninstall unused versions with the command <code>cleanup</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>cleanup
<span class="tok-go">1.6.0p28.cee         In use (by mysite_old). Keeping this version.</span>
<span class="tok-go">2.1.0p15.cee         Uninstalling</span>
<span class="tok-go">2.1.0p15.cme         Uninstalling</span>
<span class="tok-go">2.1.0p15.cre         In use (by mysite_raw). Keeping this version.</span>
<span class="tok-go">2.1.0p19.cme         Keeping this version, since it is the default.</span>
<span class="tok-go">2022.12.14.cee       In use (by mysite). Keeping this version.</span></code></pre></div></div>
<div class="paragraph"><p>OMD keeps the default version in addition to the used versions; unless manually configured otherwise, the last installed version of Checkmk, here <code>2.1.0p19.cme</code>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>13. Files and directories</h2>
<div class="sectionbody"><table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/omd/sites/mysite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site directory for the site <code>mysite</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/etc/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The site’s configuration files are stored in this directory.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#_omd_the_open_monitoring_distribution">1. OMD - The Open Monitoring Distribution</a></li>
<li>
<a href="#omd_create">2. Creating sites</a><ul class="sectlevel1">
<li><a href="#user_group_id">2.1. User and group IDs</a></li>
<li><a href="#init">2.2. External site directory</a></li>
</ul>
</li>
<li><a href="#site_user">3. Site user</a></li>
<li><a href="#omd_start_stop">4. Starting and stopping sites</a></li>
<li>
<a href="#omd_config">5. Configuring the components</a><ul class="sectlevel1">
<li><a href="#interactive_mode">5.1. Interactive configuration</a></li>
<li><a href="#script_mode">5.2. Configuration via script mode</a></li>
<li><a href="#_commonly_used_settings">5.3. Commonly used settings</a></li>
</ul>
</li>
<li>
<a href="#omd_cp_mv">6. Copying and renaming sites</a><ul class="sectlevel1">
<li><a href="#omd_cp">6.1. Copying sites</a></li>
<li><a href="#omd_cp_mv_migration">6.2. Migrating the configuration</a></li>
<li><a href="#limit_data">6.3. Limiting data volume</a></li>
<li><a href="#omd_mv">6.4. Renaming sites</a></li>
<li><a href="#_other_options">6.5. Other options</a></li>
</ul>
</li>
<li><a href="#omd_diff">7. Showing changes in configuration files</a></li>
<li><a href="#omd_update">8. Updating sites</a></li>
<li>
<a href="#omd_backup_restore">9. Backing up and restoring sites</a><ul class="sectlevel1">
<li><a href="#_creating_a_backup">9.1. Creating a backup</a></li>
<li><a href="#_backup_without_history">9.2. Backup without history</a></li>
<li><a href="#_backing_up_a_running_site">9.3. Backing up a running site</a></li>
<li><a href="#_restore">9.4. Restore</a></li>
<li><a href="#ssh_omd_backup_restore">9.5. Live backup &amp; restore to another server</a></li>
</ul>
</li>
<li><a href="#enable">10. Disabling sites</a></li>
<li><a href="#omd_rm">11. Deleting sites</a></li>
<li><a href="#cleanup">12. Uninstall unused versions</a></li>
<li><a href="#files">13. Files and directories</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
