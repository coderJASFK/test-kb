<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="To configure notifications, the time, method and group of recipients are essential. Learn here how to implement your requirements in Checkmk.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Notifications - via Email, SMS, Ticketsystems and more">
<meta name="og:description" content="To configure notifications, the time, method and group of recipients are essential. Learn here how to implement your requirements in Checkmk.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Notifications - via Email, SMS, Ticketsystems and more</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/de/notifications.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/en/notifications.html">2.2.0</a><a class="dropdown-item" href="../../latest/en/notifications.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host and service parameters</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Introduction to notifications</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMWare ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Performance data and graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">The Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Configuration via the Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
<li>
<p><a href="web_api.html">Configuration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Command reference for the HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Writing your own check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Notifications</h1>
<div class="details">
<span id="revdate">Last modified on 13-Oct-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/en/notifications.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="basics_ackn.html">Acknowledging problems</a>
<a href="commands.html">Commands</a>
<a href="wato_user.html">Users, roles and permissions</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading_intro">
<span class="hidden-anchor sr-only" id="intro"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_notifications.png" alt="Notification icon." width="80"></div></div>
<div class="paragraph"><p>In Checkmk, notification means that users are actively informed in the case of problems or other events in the monitoring.
This is most commonly achieved using emails.
However, there are also many other methods, such as sending SMS or forwarding to a ticket system.
Checkmk provides a simple interface for writing scripts for your own notification methods.</p></div>
<div class="paragraph"><p>The starting point for any notification to a user is an event reported by the monitoring core.
We call this a <strong>monitoring event</strong> in the following article to avoid confusion with the events processed by the <a href="ec.html">Event Console</a>.
A monitoring event is always related to a particular host or service.
Possible types of monitoring events are:</p></div>
<div class="ulist"><ul>
<li><p>A change of state, e.g. <span class="state0">OK</span> → <span class="state1">WARN</span></p></li>
<li><p>The change between a steady and an <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="Icon indicating a flapping state."></span> unsteady (<em>flapping</em>) state.</p></li>
<li><p>The start or end of a <span class="image-inline"><img src="../images/icons/icon_downtime.png" alt="Icon indicating a scheduled downtime for services."></span> <a href="basics_downtimes.html">scheduled downtime</a>.</p></li>
<li><p>The <span class="image-inline"><img src="../images/icons/icon_ack.png" alt="Icon indicating acknowledgement."></span> <a href="basics_ackn.html">acknowledgement of a problem</a> by a user.</p></li>
<li><p>A notification manually triggered by a <span class="image-inline"><img src="../images/icons/icon_commands.png" alt="Icon indicating a command."></span> <a href="commands.html">command</a>.</p></li>
<li><p>The execution of an <span class="image-inline"><img src="../images/icons/icon_alert_handlers.png" alt="Icon of an alert handler."></span> <a href="alert_handlers.html">alert handler</a>.</p></li>
<li><p>An event passed for notification from the <span class="image-inline"><img src="../images/icons/icon_event_console.png" alt="Event Console icon."></span> <a href="ec.html">Event Console</a>.</p></li>
</ul></div>
<div class="paragraph"><p>Checkmk utilises a rule-based system that allows you to create user notifications from these monitoring events — and this can also be used to implement very demanding requirements.
A simple notification by email — which is entirely satisfactory in many cases — is nonetheless quick to set up.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_notify_or_not">
<span class="hidden-anchor sr-only" id="notify_or_not"></span>2. To notify, or not (yet) to notify?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Notifications are basically optional, and Checkmk can still be used efficiently without them.
Some large organisations have a sort of control panel in which an operations team has the Checkmk interface constantly under observation, and thus additional notifications are unnecessary.</p></div>
<div class="paragraph"><p>If your Checkmk environment is still under construction, it should be considered that notifications will only be of help to your colleagues when no — or only occasional — <strong>false alarms</strong> (false positives) are produced.
One first needs to come to grips with the threshold values and all other settings, so that all states are <span class="state0">OK</span> / <span class="hstate0">UP</span> — or in other words: everything is <strong>‘green’</strong>.</p></div>
<div class="paragraph"><p>Acceptance of the new monitoring will quickly fade if every day the inbox is flooded with hundreds of useless emails.</p></div>
<div class="paragraph"><p>The following procedure has been proven to be effective for the fine-tuning of notifications:</p></div>
<div class="paragraph"><p><strong>Step 1</strong>: Fine-tune the monitoring, on the one hand, by fixing any actual problems newly uncovered by Checkmk and, on the other hand, by eliminating false alarms.
Do this until everything is ‘normally’ <span class="state0">OK</span> / <span class="hstate0">UP</span>.
See the <a href="intro_finetune.html#filesystems">Beginner’s guide</a> for some recommendations for reducing typical false alarms.</p></div>
<div class="paragraph"><p><strong>Step 2</strong>: Next switch the notifications to be active only for yourself.
Reduce the ‘static’ caused by sporadic, short duration problems.
To do this, adjust further threshold values, use <a href="predictive_monitoring.html">predictive monitoring</a> if necessary, increase the <a href="#repeated_check_attempts">number of check attempts</a> or try <a href="#delaying">delayed notifications</a>.
And of course if genuine problems are responsible, attempt to get these under control.</p></div>
<div class="paragraph"><p><strong>Step 3</strong>: Once your own inbox is tolerably peaceful, activate the notifications for your colleagues.
Create efficient contact groups so that each contact only receives notifications relevant to them.</p></div>
<div class="paragraph"><p>These procedures will result in a system which provides relevant information that assists in reducing outages.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_simple_mail">
<span class="hidden-anchor sr-only" id="simple_mail"></span>3. Simple notifications by email</h2>
<div class="sectionbody">
<div class="paragraph"><p>An email notification sent by Checkmk in HTML format looks something like this:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/html_notification.png" alt="A notification by email."></div></div>
<div class="paragraph"><p>As can be seen in the example, the email also contains the current <a href="graphing.html">readings</a> for the affected service.</p></div>
<div class="paragraph"><p>Before you receive such an email from Checkmk, a few preparations are necessary, as are described below.</p></div>
<div class="sect2">
<h3 id="heading__prerequisites">
<span class="hidden-anchor sr-only" id="_prerequisites"></span>3.1. Prerequisites</h3>
<div class="paragraph"><p>In the default Checkmk configuration, a user will receive notifications per email when the following prerequisites have been satisfied:</p></div>
<div class="ulist"><ul>
<li><p>The Checkmk server has a functioning <a href="#smtp">setup for sending emails</a>.</p></li>
<li><p>An email address is configured for the <a href="wato_user.html#user_config">user</a>.</p></li>
<li><p>The user is a member of a <a href="wato_user.html#contact_groups">contact group</a>, and is therefore a contact.</p></li>
<li><p>A monitoring event occurs on a host or service assigned to this contact group, which triggers a notification.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_smtp">
<span class="hidden-anchor sr-only" id="smtp"></span>3.2. Setting up mail dispatching in Linux</h3>
<div class="paragraph"><p>For the successful sending of emails, your Checkmk server must have a functioning SMTP-server configuration.
Depending on your Linux distribution, this could utilise, for example, Postfix, Qmail, Exim, Sendmail or Nullmailer.
The configuration will be implemented with your Linux distribution’s resources.</p></div>
<div class="paragraph"><p>The configuration is generally confined to registering a ‘smarthost’ (also known as an SMTP relay server) to which all emails will be directed.
This will then be your firm’s internal SMTP mail server.
As a rule smarthosts don’t require authentication in a LAN — which makes matters simple.
In some distributions the smarthost will be queried during the installation.
With the Checkmk appliance one can configure the smarthost conveniently via the <a href="appliance_usage.html#cma_webconf_system_settings">web interface</a>.</p></div>
<div class="paragraph"><p>You can test the sending of emails easily with the <code>mail</code> command on the command line.
Because there are numerous different implementations for this command under Linux, for standardisation Checkmk provides the version
from the <a href="http://heirloom.sourceforge.net/mailx.html" target="_blank">Heirloom mailx</a> project directly in the site user’s search path (as <code>~/bin/mail</code>).
The corresponding configuration file is <code>~/etc/mail.rc</code>.
The best way to test this is as a site user, since the notification scripts will later run with the same permissions.</p></div>
<div class="paragraph"><p>The email’s content is read from the standard input, the subject specified with <code>-s</code>, and the recipient’s address simply appended as an argument to the end of the command line:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span>“content”<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>mail<span class="tok-w"> </span>-s<span class="tok-w"> </span>test-subject<span class="tok-w"> </span>harry.hirsch@example.com</code></pre></div></div>
<div class="paragraph"><p>The email should be delivered without delay.
If this doesn’t work, information can be found in the SMTP server’s log file in the <code>/var/log</code> directory (see <a href="#maillog">files and directories</a>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__email_address_and_contact_group">
<span class="hidden-anchor sr-only" id="_email_address_and_contact_group"></span>3.3. Email address and contact group</h3>
<div class="paragraph"><p>A user’s email address and contact group are defined in the <a href="wato_user.html#user_config">user administration</a>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_add_user.png" alt="Dialog for entering email address and selecting contact groups."></div></div>
<div class="paragraph"><p>In a freshly-generated Checkmk site, initially there is only the <span class="guihint">Everything</span> contact group.
Members of this group are automatically responsible for <strong>all</strong> hosts and services, and will be notified of every relevant monitoring event by email.</p></div>
<div class="paragraph"><p><strong>Note:</strong> If your Checkmk installation has been generated with an older version, this group could also possibly be called <span class="guihint">Everybody</span>.
This is however illogical, as this group doesn’t contain every user, rather it contains all hosts.
Apart from the differing names the function is the same.</p></div>
</div>
<div class="sect2">
<h3 id="heading_notification_testing">
<span class="hidden-anchor sr-only" id="notification_testing"></span>3.4. Testing</h3>
<div class="paragraph"><p>To test the notification you could simply set an <span class="state0">OK</span> service to <span class="state2">CRIT</span> manually.
This can be done with the <a href="commands.html">command</a> <span class="guihint">Fake check results,</span> which you can find in the service list in the <span class="guihint">Commands</span> menu. If the command is not visible in the list, please click the button <span class="guihint">Show more</span> <span class="image-inline"><img src="../images/icons/button_showmore.png" alt="button showmore"></span> once.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_fake_check_results.png" alt="Dialog for manual state change."></div></div>
<div class="paragraph"><p>This should immediately trigger an email for this problem.
At the next regular check the service should revert to <span class="state0">OK</span>, thereby triggering a new notification — this time a recovery.</p></div>
<div class="paragraph"><p>Note that during these tests, by making frequent changes to its state the service will after a while enter the <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="icon flapping"></span> <em>flapping</em> state.
Subsequent state changes will no longer trigger notifications.
In the <a href="user_interface.html#master_control">Master control</a> snapin on the sidebar you can temporarily deactivate the detection of flapping (<span class="guihint">Flap Detection</span>).</p></div>
<div class="paragraph"><p>Alternatively, you can also send a <span class="guihint">Custom notification</span> — also using a command:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_custom.png" alt="Dialog for a custom notification."></div></div>
<div class="paragraph"><p>This does not alter the status of the affected service.
This generated notification is however of a different type and — depending on your notification rules — it can behave differently.</p></div>
</div>
<div class="sect2">
<h3 id="heading_finetuning">
<span class="hidden-anchor sr-only" id="finetuning"></span>3.5. Fine-tuning HTML email</h3>
<div class="paragraph"><p>When sending HTML emails, you may wish to add additional information or flexibly define a reply address (<span class="guihint">Reply to</span>) to a specific contact for any queries.
For this, there is the <span class="guihint">Setup &gt; Services &gt; Service monitoring rules &gt; Parameters for HTML Email</span> rule, and in <a href="notifications.html#notification_rule">notification rules</a> the HTML email notification method.
With these rules you can add a number of parameters such as response address, additional fields with details or free text formatted as HTML.</p></div>
<div class="paragraph"><p>Note that in the <span class="guihint">Insert HTML section between body and table</span> field, for security reasons only a small set of HTML tags is allowed.
These are:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 25%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Additional information</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a" target="_blank">Anchor/Link</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is permitted if it is combined with the <code>href</code> (mandatory) and <code>target</code> (optional) attributes. Links must either contain relative paths (i.e. with <code>./</code> or <code>../</code>) or use one of the URL schemes <code>http</code>, <code>https</code> or <code>mailto</code>. We advise against the use of relative paths because of their very different handling by email clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h1" target="_blank">Heading 1</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h2" target="_blank">Heading 2</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b" target="_blank">Bring Attention (usually bold)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/tt" target="_blank">Teletype (monospaced font)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated, please do not use anymore!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i" target="_blank">Idiomatic (usually italic)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/u" target="_blank">Unarticulated Annotation (usually underlined)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/br" target="_blank">Break</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nobr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/nobr" target="_blank">Text without line break</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated, please do not use anymore!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/pre" target="_blank">Pre-formatted</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spaces and tab stops are shown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/sup" target="_blank">Superscript</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p" target="_blank">Paragraph</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/hr" target="_blank">Thematic Break (horizontal rule)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>li</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li" target="_blank">List Item</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only use within these list environments:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ul</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul" target="_blank">Unordered List</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ol" target="_blank">Ordered List</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>As usual with all rules in Checkmk, a very finely granulated application is possible, so that you can individualize a detailed set of notifications to hosts and services as required.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_rules">
<span class="hidden-anchor sr-only" id="rules"></span>4. Controlling notifications with rules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__the_principle">
<span class="hidden-anchor sr-only" id="_the_principle"></span>4.1. The principle</h3>
<div class="paragraph"><p>Checkmk is configured ‘by default’ so that when a monitoring event occurs a notification email is sent to every <a href="wato_user.html#contact_groups">contact</a> for the affected host or service.
This is certainly initially sensible, but in practice many further requirements arise, for example:</p></div>
<div class="ulist"><ul>
<li><p>The suppression of specific, less useful notifications</p></li>
<li><p>The ‘subscription’ to notifications from services for which one is not a contact</p></li>
<li><p>A notification can be sent by email, SMS or pager, depending on the time of day</p></li>
<li><p>The escalation of problems when no <a href="basics_ackn.html">acknowledgement</a> has been received beyond a certain time limit</p></li>
<li><p>The option of NO notification for the <span class="state1">WARN</span> or <span class="state3">UNKNOWN</span> states</p></li>
<li><p>and much more …​</p></li>
</ul></div>
<div class="paragraph"><p>Checkmk offers you maximum flexibility in implementing such requirements via a rule-based mechanism.</p></div>
<div class="paragraph"><p>You enter the configuration with <span class="guihint">Setup &gt; Events &gt; Notifications</span>.</p></div>
<div class="paragraph"><p><strong>Note:</strong> When you call up the <span class="guihint">Notification configuration</span> page for the first time, you will see a warning about the unconfigured <em>"fallback email address"</em>. You can ignore this warning for the moment. We will go into this <a href="#fallback">below</a>.</p></div>
<div class="paragraph"><p>In the notification configuration, you manage the <strong>chain of notification rules,</strong> which determine <em>who</em> should be notified and <em>how</em>.
When any monitoring event occurs this rule chain will be run through from <em>top to bottom</em>.
Each rule has a condition that decides whether the rule actually applies to the situation in question.</p></div>
<div class="paragraph"><p>If the condition is satisfied the rule determines two things:</p></div>
<div class="ulist"><ul>
<li><p>A selection of contacts (<em>Who</em> should be notified?).</p></li>
<li><p>A notification method (<em>How</em> to notify?), e.g. HTML email, and optionally, additional parameters for the chosen method.</p></li>
</ul></div>
<div class="paragraph"><p><strong>Important:</strong> In contrast to the <a href="wato_rules.html">rules for hosts and services</a>, here the evaluation also continues after the applicable rule has been satisfied.
Subsequent rules can add further notifications.
Notifications generated by preceding rules can also be <a href="#cancel">deleted</a>.</p></div>
<div class="paragraph"><p>The end result of the rule evaluation will be table with a structure something like this:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Who (contact)</th>
<th class="tableblock halign-left valign-top">How (method)</th>
<th class="tableblock halign-left valign-top">Parameters for the method</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Reply-To: linux.group@example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Reply-To: linux.group@example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Now, for each entry in this table the <a href="#scripts%20">notification script</a> which actually executes the user notification appropriate to the method will be invoked.</p></div>
</div>
<div class="sect2">
<h3 id="heading__the_initial_predefined_rule">
<span class="hidden-anchor sr-only" id="_the_initial_predefined_rule"></span>4.2. The initial predefined rule</h3>
<div class="paragraph"><p>If you have a freshly-installed Checkmk, precisely one rule will have been predefined:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_default_rule.png" alt="List with the predefined notification rule."></div></div>
<div class="paragraph"><p>This rule defines the above-described default behaviour. It is structured as follows:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None, i.e. the rule applies to <strong>all</strong> monitoring events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends an email in HTML format (with embedded metric graphs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contact</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All contacts of the affected host/service</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>As usual, you can edit the rule <span class="image-inline"><img src="../images/icons/icon_edit.png" alt="icon edit"></span>, clone (copy) it <span class="image-inline"><img src="../images/icons/icon_clone.png" alt="icon clone"></span>, delete it <span class="image-inline"><img src="../images/icons/icon_delete.png" alt="Icon to delete."></span>, or create a new rule.
Once you have more than a single rule, you can change their processing order by dragging and dropping them with the <span class="image-inline"><img src="../images/icons/icon_drag.png" alt="icon drag"></span> icon.</p></div>
<div class="paragraph"><p><strong>Note:</strong> Changes to notification rules do <strong>not</strong> require activation of the changes, rather they take effect immediately.</p></div>
</div>
<div class="sect2">
<h3 id="heading_notification_rule">
<span class="hidden-anchor sr-only" id="notification_rule"></span>4.3. Structure of the notification rules</h3>
<div class="paragraph"><p>In the following, we present the general structure of the notification rules with the definitions of general properties, methods, contacts and conditions.</p></div>
<div class="sect3">
<h4 id="heading__general_properties">
<span class="hidden-anchor sr-only" id="_general_properties"></span>General properties</h4>
<div class="paragraph"><p>As with all rules in Checkmk, here you can include a description and a commentary for the rule, or even temporarily deactivate the rule.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part1.png" alt="Rule with the option to enable disabling of notifications by users."></div></div>
<div class="paragraph"><p>The option <span class="guihint">Overriding by users</span> is activated by default.
activated. It allows users to 'unsubscribe' from notifications generated by this rule.
We show how to do this with the <a href="#personal">custom notifications</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__notification_method">
<span class="hidden-anchor sr-only" id="_notification_method"></span>Notification method</h4>
<div class="paragraph"><p>The notification method specifies the technique to be used for sending the notification., e.g. with HTML email.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part2.png" alt="Rule with notification method options."></div></div>
<div class="paragraph"><p>Each method is realised using a script.
Checkmk includes a number of <a href="#includedscripts">scripts</a>.
You can also quite easily write your <a href="#scripts">custom scripts</a> in any desired programming language in order to implement special notifications — for example, to redirect a notification to your own ticket system.</p></div>
<div class="paragraph"><p>A method can include parameters — such as allowing the method that sends ASCII and HTML emails to explicitly set the sender’s address (<code>From:</code>) for example.</p></div>
<div class="paragraph"><p>Before making settings directly in the notification rule, one should know that parameters for the notification methods can also be specified via <a href="wato_rules.html">rules for hosts and services</a>:
Under <span class="guihint">Setup &gt; Services &gt; Service monitoring rules</span>, in the <span class="guihint">Notifications</span> section, you will find a rule set for each notification method, which you can use to define the same settings — and as usual, can be dependent on the host or service.</p></div>
<div class="paragraph"><p>Parameter definitions in notification rules enable these settings to be varied in individual cases.
So you can, for example, define a global subject for your email, but also define an alternative subject with an individual notification rule.</p></div>
<div class="paragraph"><p>Instead of parameters you can also select <span class="guihint">Cancel previous notifications</span> –
with which all of this method’s notifications from prior rules will be deleted.
For more on this, see the topic <a href="#cancel">deleting notifications</a>.</p></div>
<div class="paragraph"><p>Note: For the following notification methods for forwarding to other systems, you will find more detailed information in their own separate articles:
<a href="notifications_jira.html">Jira</a>,
<a href="notifications_mattermost.html">Mattermost</a>,
<a href="notifications_pagerduty.html">PagerDuty</a>,
<a href="notifications_pushover.html">Pushover</a>,
<a href="notifications_opsgenie.html">Opsgenie</a>,
<a href="notifications_servicenow.html">ServiceNow</a>,
<a href="notifications_slack.html">Slack</a>,
<a href="notifications_opsgenie.html">Opsgenie</a>, and
<a href="notifications_webex.html">Cisco Webex Teams</a></p></div>
</div>
<div class="sect3">
<h4 id="heading__selecting_contacts">
<span class="hidden-anchor sr-only" id="_selecting_contacts"></span>Selecting contacts</h4>
<div class="paragraph"><p>The most common procedure is for notifications to be sent to all users who have been registered as a <a href="wato_user.html#add_host_to_contact_group">contact</a> for the respective host/service.
This is the ‘normal’ and logical procedure, since it is also via the contacts that it is defined which objects each user receives in their GUI display — in effect those objects for which the user is responsible.</p></div>
<div class="paragraph"><p>You can tick several options in the contact selection and thus extend the notification to more contacts:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part3.png" alt="Rule with contact selection options."></div></div>
<div class="paragraph"><p>Checkmk will automatically delete duplicate contacts.
In order for the rule to make sense at least one selection must be made.</p></div>
<div class="paragraph"><p>The two <span class="guihint">Restrict by…​</span> options function somewhat differently.
Here the contacts selected with the other options will again be <em>restricted</em>.
With these you can also create an AND-operator between contact groups, for example, to enable notifications to be sent to all contacts who are members of both the <code>Linux</code> and <code>Datacenter</code> groups.</p></div>
<div class="paragraph"><p>By entering <span class="guihint">Explicit email addresses</span> you can notify persons who are not in fact nominated as users in Checkmk.
This of course only makes sense when used in the notification method that actually sends emails.</p></div>
<div class="paragraph"><p>If, in the chosen method, you have selected <span class="guihint">Cancel previous notifications</span>, the notifications will only be deleted for the contact selected here.</p></div>
</div>
<div class="sect3">
<h4 id="heading_rule_conditions">
<span class="hidden-anchor sr-only" id="rule_conditions"></span>Conditions</h4>
<div class="paragraph"><p>Conditions determine when a rule will be used. For comprehension it is important to remember that the source is always a monitoring event on a concrete host or service.</p></div>
<div class="paragraph"><p>The conditions address</p></div>
<div class="ulist"><ul>
<li><p>the object’s static attributes – e.g., whether the service name contains the <code>/tmp</code> text,</p></li>
<li><p>with the current state or the change of the state, e.g. whether the service has just changed from <span class="state0">OK</span> to <span class="state2">CRIT</span>,</p></li>
<li><p>or with completely different things, e.g., whether the 'working time’<a href="timeperiods.html">time period</a> is currently active.</p></li>
</ul></div>
<div class="paragraph"><p>There are two important points to consider when setting the conditions:</p></div>
<div class="paragraph"><p>Without the exception discussed separately below, there are two important things to note here:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>If no conditions have been defined the rule will take effect for <strong>every</strong> monitoring event.</p></li>
<li><p>As soon as you select even a single condition, the rule takes effect only if <strong>all</strong> conditions are met.
All selected conditions are linked with AND. There is only one exception to this important rule, which we will discuss later and not consider now.</p></li>
</ol></div>
<div class="paragraph"><p>This means that you should pay very close attention to whether the conditions you have chosen can be met at the same time so that a notification is triggered for the desired case.</p></div>
<div class="paragraph"><p>Let’s say you want a notification to be triggered when a monitoring event occurs for a service starting with the name <code>NTP</code> on a host in the <span class="guihint">Main</span> folder:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4.png" alt="Rule containing the conditions for creating a notification."></div></div>
<div class="paragraph"><p>Suppose further that this condition is now <strong>extended</strong> by also notifying all state changes of a host to the <span class="hstate1">DOWN</span> state:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_match_host_types.png" alt="Rule with extended conditions for creating a notification."></div></div>
<div class="paragraph"><p>The result of this notification rule with the three single conditions is that <strong>never</strong> a notification will occur, because no monitoring event will contain the state change of a host <strong>and</strong> the service name with <code>NTP</code>.</p></div>
<div class="paragraph"><p>The following note is repeated in this User guide from time to time. However, in connection with the configuration of your notifications, it should be emphasized again:
Show the context-sensitive help with <span class="guihint">Help &gt; Show inline help</span> to get details about the effect of the various conditions.
The following excerpt from the context-sensitive help for the <span class="guihint">Match services</span> option illustrates the behavior very well: "<em>Note: Host notifications will never match this rule, if this option is being used.</em>".</p></div>
<h4 id="_the_exception_to_the_and_operation" class="discrete">The exception to the AND operation</h4>
<div class="paragraph"><p>Only if a monitoring event satisfies all configured conditions, the notification rule will apply.
As mentioned above, there is one important exception to this general rule: for the <span class="guihint">Match host event type</span> and <span class="guihint">Match service event type</span> conditions:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_match_event_types.png" alt="The conditions 'Match host event type' and 'Match service event type'."></div></div>
<div class="paragraph"><p>Should you select <strong>only</strong> <span class="guihint">Match host event type</span>, the rule will match no single service event.
Similarly, this applies to the selection of <span class="guihint">Match service event type</span> and host events.
Should you activate <strong>both</strong> conditions however, the rule will match if the event type is activated in <strong>any</strong> of the two checkbox lists.
In this exceptional case these conditions will thus not be linked with a logical ‘AND’, but rather with an ‘OR’.
In this way you can simply administer host and service notifications with a single rule.</p></div>
<div class="paragraph"><p>A further tip regarding the <span class="guihint">Match contacts</span> and <span class="guihint">Match contact groups</span> conditions:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_contacts.png" alt="The conditions 'Match contacts' and 'Match contact groups'."></div></div>
<div class="paragraph"><p>The condition checked here is whether the host/service in question has a certain contact assignment.
This can be used to implement functions such as "Host notifications in the contact group Linux should never be sent by SMS".
This has nothing to do with the contact selection described above.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_cancel">
<span class="hidden-anchor sr-only" id="cancel"></span>4.4. Cancelling notifications</h3>
<div class="paragraph"><p>As already mentioned in the selection of the notification method, you will also find the selection option <span class="guihint">Cancel previous notifications</span>.
In order to be able to understand the functioning of such a rule, it is best to visualise the notification table.
Assuming the processing of the rules for a concrete monitoring event is partly complete, and that due to a number of rules the following three notifications have been triggered:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Who (contact)</th>
<th class="tableblock halign-left valign-top">How (method)</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Now comes a next rule with the <span class="guihint">SMS</span> method and the <span class="guihint">Cancel previous notifications</span> selection.
The contact selection chooses the 'Windows' group, in which Bruno Weizenkeim is a member.
As a result of this rule, the entry 'Bruno Weizenkeim / SMS' is removed from the table, which then looks like this:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Who (contact)</th>
<th class="tableblock halign-left valign-top">How (method)</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Should a subsequent rule again define an SMS notification for Bruno, then this rule will have priority and the SMS will be added anew to the table.</p></div>
<div class="paragraph"><p>To summarise:</p></div>
<div class="ulist"><ul>
<li><p>Rules can suppress (delete) specific notifications.</p></li>
<li><p>Deletion rules must come after the rules that create the notifications.</p></li>
<li><p>A deletion rule does not actually ‘delete’ a preceding rule, rather it suppresses the notifications that are generated by (possibly multiple) preceding rules.</p></li>
<li><p>Subsequent rules can reinstate the previously suppressed notifications.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_fallback">
<span class="hidden-anchor sr-only" id="fallback"></span>4.5. What happens if no rule is applicable?</h3>
<div class="paragraph"><p>One who configures can also make errors.
One possible error in the notification configuration could be that a critical monitoring problem is discovered, but not a single
notification rule takes effect.</p></div>
<div class="paragraph"><p>To protect you from such a case, Checkmk offers the setting <span class="guihint">Fallback email address for notifications</span>.
This can be found under <span class="guihint">Setup &gt; General &gt; Global settings</span> in the section <span class="guihint">Notifications</span>.
Enter an email address here.
This email address will then receive notifications for which no notification rule applies.</p></div>
<div class="paragraph"><p><strong>Note:</strong> Alternatively, you can also make a user the recipient in his <a href="wato_user.html#user_config_notifications">personal settings</a>.
The email address stored with the user is used as the fallback address.</p></div>
<div class="paragraph"><p>The fallback address will however only be used if <strong>no rule</strong> applies, not when no
notification has been triggered! As we showed in the previous chapter, the
explicit suppression of notifications is desired — it is not a configuration
error.</p></div>
<div class="paragraph"><p>The entry of a fallback address will be ‘recommended’ on the <span class="guihint">Notification configuration</span> page with an onscreen warning:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_warning_fallback_email.png" alt="Warning that no fallback email address is stored."></div></div>
<div class="paragraph"><p>If you don’t want to use the fallback address, simply add  a new rule as the <em>first rule</em> that deletes all preceding notifications.
This rule is ineffective on the notification configuration, as no notifications have been created here yet.
But with this you can ensure that at least one rule will always apply, thus allowing this warning to be eliminated.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_personal">
<span class="hidden-anchor sr-only" id="personal"></span>5. Custom notifications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__overview">
<span class="hidden-anchor sr-only" id="_overview"></span>5.1. Overview</h3>
<div class="paragraph"><p>A useful feature in Checkmk’s notification system is the one with which users — even without administrator rights — can customise notifications.
Users can:</p></div>
<div class="ulist"><ul>
<li><p>Add notifications they would not otherwise receive (‘subscribe’)</p></li>
<li><p>Delete notifications they would otherwise receive (if not restricted)</p></li>
<li><p>Customise notification parameters</p></li>
<li><p>Completely disable their notifications altogether</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__custom_notification_rules">
<span class="hidden-anchor sr-only" id="_custom_notification_rules"></span>5.2. Custom notification rules</h3>
<div class="paragraph"><p>The entry point from the user’s point of view is the <a href="user_interface.html#user_menu">User menu</a>, and there the entry <span class="guihint">Notification rules</span>.
On the <span class="guihint">Your personal notification rules</span> page, a new rule can be created with <span class="guihint">Add rule</span>.</p></div>
<div class="paragraph"><p>Custom rules are structured like the normal rules — with one difference: they do not contain a contact selection.
The user himself is automatically selected as the contact.
This means that a user can only add or delete notifications for himself.</p></div>
<div class="paragraph"><p>However, the user can only delete notifications if the <span class="guihint">allow users to deactivate this notification</span> option is activated in the rule that creates them:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part1.png" alt="Rule with the option to enable disabling of notifications by users."></div></div>
<div class="paragraph"><p>In the order of notification rules, the custom rules always come <em>after</em> the global rules and so can adjust the notification table that has been generated so far.
So, except for the deletion blocking just described, the global rules always apply as the default setting that can be customised by the user.</p></div>
<div class="paragraph"><p>If you want to prevent customisation altogether, you can revoke the <a href="wato_user.html#roles">permission</a> <span class="guihint">General Permissions &gt; Edit personal notification settings</span> of the <code>user</code> role.</p></div>
<div class="paragraph"><p>As an administrator, you can display all user rules if in the menu you select <span class="guihint">Display &gt; Show user rules</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_show_user_roles.png" alt="List of user rules from an administrator's point of view."></div></div>
<div class="paragraph"><p>After the global rules, the user rules are listed, which you can also edit with <span class="image-inline"><img src="../images/icons/icon_edit.png" alt="icon edit"></span>.</p></div>
</div>
<div class="sect2">
<h3 id="heading__temporarily_disabling_notifications">
<span class="hidden-anchor sr-only" id="_temporarily_disabling_notifications"></span>5.3. Temporarily disabling notifications</h3>
<div class="paragraph"><p>The complete disabling of notifications by a user is protected with the <a href="wato_user.html#roles">permission</a> <span class="guihint">General Permissions &gt; Disable all personal notifications</span>, which is set to <code>no</code> for the user role <code>user</code> by default.
A user will only see the corresponding checkboxes in his personal settings if you explicitly assign this right to the <code>user</code> role:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_edit_profile_disable.png" alt="Personal setting to temporarily disable notifications."></div></div>
<div class="paragraph"><p>As an administrator with access to the user’s personal settings, you can carry out disablement actions on the user’s behalf — even if the permission as described above is not present.
You can find this setting under <span class="guihint">Setup &gt; Users &gt; Users</span> and then in the properties of the user profile.
With this, for example, you can very quickly silence a holidaying colleague’s notifications — without needing to alter the actual configuration.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_conditions">
<span class="hidden-anchor sr-only" id="conditions"></span>6. When notifications are generated and how to deal with them</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__introduction">
<span class="hidden-anchor sr-only" id="_introduction"></span>6.1. Introduction</h3>
<div class="paragraph"><p>A large part of the Checkmk notification system’s complexity is due to its numerous tuning options, with which unimportant notifications can be avoided.
Most of these will be situations in which notifications are already being delayed or suppressed when they occur.
Additionally, the monitoring core has a built-in intelligence that suppresses certain notifications by default.
We would like to address all of these aspects in this chapter.</p></div>
</div>
<div class="sect2">
<h3 id="heading__scheduled_downtimes">
<span class="hidden-anchor sr-only" id="_scheduled_downtimes"></span>6.2. Scheduled downtimes</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_downtime.png" alt="Scheduled downtime icon." width="50"></div></div>
<div class="paragraph"><p>When a host or service is in a <a href="basics_downtimes.html">scheduled downtime</a> the object’s notifications will be suppressed.
This is – alongside a correct evaluation of availabilities — the most important reason for the actual provision of downtimes in monitoring.
The following details are relevant to this:</p></div>
<div class="ulist"><ul>
<li><p>If a host is flagged as having a scheduled downtime, then all of its services will also be automatically in scheduled downtime – without an explicit entry for them needing to be entered.</p></li>
<li><p>Should an object enter a problem state <em>during</em> a scheduled downtime, when the downtime ends as planned this problem will be retroactively notified precisely at the end of the downtime.</p></li>
<li><p>The beginning and the end of a scheduled downtime is itself a monitoring event which will be notified.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__notification_periods">
<span class="hidden-anchor sr-only" id="_notification_periods"></span>6.3. Notification periods</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_outofnot.png" alt="Icon of an inactive notification period." width="50"></div></div>
<div class="paragraph"><p>You can define a notification period for each host and service during configuration.
This is a <a href="timeperiods.html">time period</a> which defines the time frame within which the notification should be constrained.</p></div>
<div class="paragraph"><p>The configuration is performed using the <span class="guihint">Monitoring Configuration &gt; Notification period for hosts</span>, or respectively the <span class="guihint">Notification period for services</span> rule set, which you can quickly find via the <a href="user_interface.html#search_setup">search in Setup menu</a>.
An object that is not currently in a notification period will be flagged with a grey pause icon <span class="image-inline"><img src="../images/icons/icon_outofnot.png" alt="Icon of an inactive notification period."></span>.</p></div>
<div class="paragraph"><p>Monitoring events for an object that is not currently in its notification period will not be notified.
Such notifications will be ‘reissued’ when the notification period is again active – if the host/service is still in a problem state.
Only the latest state will be notified even if multiple changes to the object’s state have occurred during the time outside the notification period.</p></div>
<div class="paragraph"><p>Incidentally, in the notification rules it is also possible to restrict a notification to a specific time period.
In this way you can <em>additionally</em> restrict the time ranges.
However, notifications that have been discarded due to a rule with time conditions will <strong>not</strong> automatically be repeated later!</p></div>
</div>
<div class="sect2">
<h3 id="heading_state_host">
<span class="hidden-anchor sr-only" id="state_host"></span>6.4. The state of the host on which a service is running</h3>
<div class="paragraph"><p>If a host has completely failed, or is at least inaccessible to the monitoring, then obviously its services can no longer be monitored.
<a href="active_checks.html">Active checks</a> will then as a rule register <span class="state2">CRIT</span> or <span class="state3">UNKNOWN</span>, since these will be actively attemping to access the host and will thereby run into an error.
In such a situation all other checks — thus the great majority — will be omitted and will thus remain in their old state.
These will be flagged with the <span class="guihint">stale</span> time icon <span class="image-inline"><img src="../images/icons/icon_stale.png" alt="icon stale"></span>.</p></div>
<div class="paragraph"><p>It would naturally be very cumbersome if all active checks in such a state were to notify their problems.
For example, if a web server is not reachable – and this has already been notified – it would not be very helpful to additionally generate an email for every single one of its dependent HTTP services.</p></div>
<div class="paragraph"><p>To minimise such situations, as a basic principle the monitoring core only generates notifications for services if the host is in the <span class="hstate0">UP</span> state.
This is also the reason why host accessibility is separately verified.
If not otherwise configured, this verification will be achieved with a <a href="cmc_differences.html#smartping">Smart Ping</a> or ping.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
If you are using the Raw Edition (or one of the Enterprise Editions with a Nagios core), in isolated cases it can nonetheless occur that a host problem
generates a notification for an active service.
The reason for this is that Nagios regards the results of host checks as still being valid for a short time into the future.
If even only a few seconds have elapsed between the last successful ping to the server and the next active check, Nagios can still assess the host as <span class="hstate0">UP</span> even though it is in fact <span class="hstate1">DOWN</span>.
In contrast, the <a href="cmc.html">Checkmk Micro Core (CMC)</a> will hold the service notification in a ‘standby’ mode until the host state has been verified, thus reliably minimising undesired notifications.</p></div>
</div>
<div class="sect2">
<h3 id="heading_parents">
<span class="hidden-anchor sr-only" id="parents"></span>6.5. Parent hosts</h3>
<div class="paragraph"><p>Imagine that an important network router to a company location with hundreds of hosts fails.
All of its hosts will then be unavailable to the monitoring and become <span class="hstate1">DOWN</span>.
Hundreds of notifications will therefore be triggered. Not good.</p></div>
<div class="paragraph"><p>In order to avoid such problems the router can be defined as a <a href="hosts_structure.html#parents">parent host</a> for its hosts.
If there are redundant hosts, multiple parents can also be defined.
As soon as all parents enter a <span class="hstate1">DOWN</span> state, the hosts that are no longer reachable will be flagged with the <span class="hstate2">UNREACH</span> state and their notifications will be suppressed.
The problem with the router itself will of course still be notified.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
By the way, the <a href="cmc.html">CMC</a> operates internally in a slightly different manner to Nagios.
In order to reduce false alarms, but still process genuine notifications, it pays very close attention to the exact times of the
relevant host checks.
If a host check fails the core will wait for the result of the host check on the parent host before generating a notification.
This wait is asynchronous and has no effect on the general monitoring.
Notifications from hosts can thereby be subject to minimal delays.</p></div>
</div>
<div class="sect2">
<h3 id="heading__disabling_notifications_using_rules">
<span class="hidden-anchor sr-only" id="_disabling_notifications_using_rules"></span>6.6. Disabling notifications using rules</h3>
<div class="paragraph"><p>With the <span class="guihint">Enable/disable notifications for hosts</span>, or respectively, the <span class="guihint">Enable/disable notifications for services</span> rule sets you can specify hosts and services for which generally no notifications are to be issued.
As mentioned above the core then suppresses notifications.
A subsequent notification rule that ‘subscribes’ to notifications for such services will be ineffective, as the notifications are simply not generated.</p></div>
</div>
<div class="sect2">
<h3 id="heading__disabling_notifications_using_commands">
<span class="hidden-anchor sr-only" id="_disabling_notifications_using_commands"></span>6.7. Disabling notifications using commands</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_notif_man_disabled.png" alt="Icon of a disabled notification." width="50"></div></div>
<div class="paragraph"><p>It is also possible to temporarily disable notifications for individual hosts or services via a <a href="commands.html">command</a>.</p></div>
<div class="paragraph"><p>However, this requires that the <a href="wato_user.html#roles">permission</a> <span class="guihint">Commands on host and services &gt; Enable/disable notifications</span> is assigned to the user role. By default, this is not the case for <strong>any</strong> role.</p></div>
<div class="paragraph"><p>With the assigned permission, you can disable (and later enable) notifications from hosts and services with the <span class="guihint">Commands &gt; Notifications</span> command:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_commands_disable.png" alt="Command to enable and disable notifications."></div></div>
<div class="paragraph"><p>Such hosts or services will then be marked with an <span class="image-inline"><img src="../images/icons/icon_notif_man_disabled.png" alt="icon notif man disabled"></span> icon.</p></div>
<div class="paragraph"><p>Since commands — in contrast to rules — require neither configuration permissions nor an <a href="wato.html#activate_changes">activate changes</a>, they can be a quick workaround for reacting promply to a situation.</p></div>
<div class="paragraph"><p><strong>Important:</strong> In contrast to <span class="image-inline"><img src="../images/icons/icon_downtime.png" alt="icon downtime"></span> scheduled downtimes, disabled notifications have no influence on the <a href="availability.html">availability</a> evaluations.
If during an unplanned outage you really only want to disable the notifications without wishing to distort the availability statistics,
you should not register a scheduled downtime!</p></div>
</div>
<div class="sect2">
<h3 id="heading_global">
<span class="hidden-anchor sr-only" id="global"></span>6.8. Disabling notifications globally</h3>
<div class="paragraph"><p>In the <span class="guihint">Master control</span> snapin in the sidebar you will find a master switch for <span class="guihint">Notifications</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_master_control.png" alt="Snapin Master control." width="50%"></div></div>
<div class="paragraph"><p>This switch is incredibly useful if you plan to make bigger system changes, during which an error could under the circumstances force many services into a <span class="state2">CRIT</span> state.
You can use the switch to avoid upsetting your colleagues with a flood of useless emails.
Remember to re-enable the notifications when you are finished.</p></div>
<div class="paragraph"><p>Each site in a <a href="distributed_monitoring.html">distributed monitoring</a> has one of these switches.
Switching off the central site’s notifications still allows remote sites to activate notifications — even though these are directed to and delivered from the central site.</p></div>
<div class="paragraph"><p><strong>Important:</strong> Notifications that would have been triggered during the time when notifications were disabled will <strong>not</strong> be repeated later when they are re-enabled.</p></div>
</div>
<div class="sect2">
<h3 id="heading_delaying">
<span class="hidden-anchor sr-only" id="delaying"></span>6.9. Delaying notifications</h3>
<div class="paragraph"><p>You may possibly have services that occasionally enter a problem state for short periods, but the stops are very brief and are not critical for you.
In such cases notifications are very annoying, but are easily suppressed.
The <span class="guihint">Delay host notifications</span> and <span class="guihint">Delay service notifications</span> rule sets serve this situation.</p></div>
<div class="paragraph"><p>You specify a time in minutes here — and a notification will be delayed until this time has expired.
Should the <span class="state0">OK</span> / <span class="hstate0">UP</span> state occurs again before then, no notification will be triggered.
Naturally this also means that the notification of a <em>genuine</em> problem will be delayed.</p></div>
<div class="paragraph"><p>Obviously even better than delaying notifications would be the elimination of the actual cause of the sporadic problems — but that is of course another story…​</p></div>
</div>
<div class="sect2">
<h3 id="heading_repeated_check_attempts">
<span class="hidden-anchor sr-only" id="repeated_check_attempts"></span>6.10. Repeated check attempts</h3>
<div class="paragraph"><p>Another very similar method for delaying notifications is to allow multiple check attempts when a service enters a problem state.
This is achieved with the <span class="guihint">Maximum number of check attempts for hosts</span>, or respectively, the <span class="guihint">Maximum number of check attempts for service</span> rule set.</p></div>
<div class="paragraph"><p>If you set a value of <code>3</code> here, for example, a check with a <span class="state2">CRIT</span> result will at first not trigger a notification.
This is referred to as a <span class="state2">CRIT</span> <em>soft state</em>.
The <em>hard state</em> remains <span class="state0">OK</span>.
Only if three successive attempts return a not-<span class="state0">OK</span>-state will the service switch to the hard state and a notification be triggered.</p></div>
<div class="paragraph"><p>In contrast to delayed notifications, here you have the option of defining views so that such problems are not displayed.
A <a href="bi.html">BI aggregate</a> can also be constructed so that only hard states are included — not soft ones.</p></div>
</div>
<div class="sect2">
<h3 id="heading_flapping">
<span class="hidden-anchor sr-only" id="flapping"></span>6.11. Flapping hosts and services</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_flapping.png" alt="Icon indicating flapping state." width="50"></div></div>
<div class="paragraph"><p>When a host or service frequently changes its state over a short time it is regarded as <em>flapping</em>.
This is an actual state.
The principle here is the reduction of excessive notifications during phases when a service is not (quite) running stably.
Such phases can also be specially evaluated in the <a href="availability.html">availability statistics</a>.</p></div>
<div class="paragraph"><p>Flapping objects are marked with the <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="Icon indicating flapping state."></span> icon.
As long as an object is flapping, successive state changes trigger no further notifications.
A notification will however be triggered whenever the object enters or leaves the flapping state.</p></div>
<div class="paragraph"><p>The system’s recognition of flapping can be influenced in the following ways:</p></div>
<div class="ulist"><ul>
<li><p>The <span class="guihint">Master control</span> has a main switch for controlling the detection of flapping (<span class="guihint">Flap Detection</span>).</p></li>
<li><p>You can exclude objects from detection by using the <span class="guihint">Enable/disable flapping detection for hosts</span>, or respectively, the <span class="guihint">Enable/disable flapping detection for services</span> rule set.</p></li>
<li><p>In the <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong>, using <span class="guihint">Global settings &gt; Monitoring Core &gt; Tuning of flap detection</span> you can define the parameters for flapping detection and set them to be more or less sensitive:</p></li>
</ul></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_tuning_flap_detection.png" alt="Global settings for flap detection handling."></div></div>
<div class="paragraph"><p>Show the context sensitive help with <span class="guihint">Help &gt; Show inline help</span> for details on the customizable values.</p></div>
</div>
<div class="sect2">
<h3 id="heading__periodically_repeated_notifications_and_escalation">
<span class="hidden-anchor sr-only" id="_periodically_repeated_notifications_and_escalation"></span>6.12. Periodically-repeated notifications and escalation</h3>
<div class="paragraph"><p>For some systems, it can make sense not to leave it to a single notification when a problem persists over a longer time frame, for example, for hosts whose <a href="glossar.html#host_tag">host tag</a> <span class="guihint">Criticality</span> is set to <span class="guihint">Business critical</span>.</p></div>
<div class="sect3">
<h4 id="heading__set_up_periodically_repeated_notifications">
<span class="hidden-anchor sr-only" id="_set_up_periodically_repeated_notifications"></span>Set up periodically-repeated notifications</h4>
<div class="paragraph"><p>Checkmk can be set up so that successive notifications are issued at fixed intervals, until either the problem has been <span class="image-inline"><img src="../images/icons/icon_ack.png" alt="Icon to indicate acknowledgement."></span> <a href="basics_ackn.html">acknowledged</a> or solved.</p></div>
<div class="paragraph"><p>The setting for this can be found in the <span class="guihint">Periodic notifications during host problems</span>, or respectively, the <span class="guihint">Periodic notifications during service problems</span> rule set:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_periodic.png" alt="Rule for periodically-repeated notifications."></div></div>
<div class="paragraph"><p>Once this option is active, for a persistent problem, Checkmk will trigger regular notifications at the configured intervals.
These notifications will receive an incrementing number beginning with 1 (for the initial notification).</p></div>
<div class="paragraph"><p>Periodic notifications are not only useful for reminding about a problem (and <em>annoying</em> the operator), they also provide a basis for <em>escalations</em> — meaning that after a defined time a notification can be escalated to other recipients.</p></div>
</div>
<div class="sect3">
<h4 id="heading__set_up_escalations_and_understand_them">
<span class="hidden-anchor sr-only" id="_set_up_escalations_and_understand_them"></span>Set up escalations and understand them</h4>
<div class="paragraph"><p>To set up an escalation, create an additional notification rule which uses the <span class="guihint">Restrict to notification number</span> condition.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_escalation.png" alt="Rule for setting the frequency of notifications."></div></div>
<div class="paragraph"><p>If you enter 3 to 99999 as the range for the sequential number, this rule takes effect from the third notification.
The escalation can then be performed either by selecting another method, (e.g., SMS), or it can notify other persons (contact selection).</p></div>
<div class="paragraph"><p>With the <span class="guihint">Throttle periodic notifications</span> option, after a given time the rate of notification repetition can be reduced so that, for example, in the beginning an email can be sent every hour, and later this can be reduced to one email per day.</p></div>
<div class="paragraph"><p>With multiple notification rules, you can build an escalation model.
But how will this escalation then function in practice?
Who is notified and when?
Here is an example, implemented with one rule for periodically repeated notifications as well as three notification rules:
For example:</p></div>
<div class="ulist"><ul>
<li><p>In the event of a problem being detected in a service, a notification in the form of an email will be triggered every 60 minutes until the problem is either resolved or acknowledged.</p></li>
<li><p>Notifications one to five go to the two people responsible for the service.</p></li>
<li><p>Notifications six to ten are also sent to the relevant team leader.</p></li>
<li><p>From notification eleven on, a daily mail goes to the company management instead.</p></li>
</ul></div>
<div class="paragraph"><p>At 9 o’clock in the morning, a problem occurs at the facility.
The two responsible employees are notified of the problem but do not respond (for whatever reason).
So at 10, 11, 12 and at 1 p.m. they each receive new emails.
From the sixth notification at 2 p.m., the team leader now also receives an email — nevertheless, the problem still does not change.
At 3, 4, 5 and 6 p.m., further emails are sent to the team members and the team leader.</p></div>
<div class="paragraph"><p>At 7 p.m., the third escalation level takes effect:
From now on, no more e-mails are sent to the team members or the team leader.
Instead, the company management now receives an email every day at 7 p.m. until the problem is resolved.</p></div>
<div class="paragraph"><p>As soon as the problem has been fixed and the service in Checkmk goes back to <span class="state0">OK</span>, an 'all clear' is automatically sent to the last notified group of people:
So in the example above, if the problem is fixed before 2 p.m., to the two team members; if the problem is fixed between 2 and 7 p.m., to the team members and the team leader; and after 7 p.m., only to the company management.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_path">
<span class="hidden-anchor sr-only" id="path"></span>7. The path of a notification from beginning to end</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_history">
<span class="hidden-anchor sr-only" id="history"></span>7.1. The notification history</h3>
<div class="paragraph"><p>To get started, we will show you how to view the history of notifications at the host and service level in Checkmk to be able to track the notification process.</p></div>
<div class="paragraph"><p>A monitoring event that causes Checkmk to trigger a notification is, for example, the change of state of a service.
You can manually trigger this state change with the command <span class="guihint">Fake check results</span> for testing purposes, as we have already shown in the chapter on the <a href="#notification_testing">testing</a> of a simple notification by email.</p></div>
<div class="paragraph"><p>For a notification test, you can move a service from the <span class="state0">OK</span> state to <span class="state2">CRIT</span> in this way.
If you now display the notifications for this service on the service details page with <span class="guihint">Service &gt; Service Notifications</span>, you will see the following entries:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_list.png" alt="List of accumulated notifications for a service."></div></div>
<div class="paragraph"><p>The most recent entry is at the top of the list. However, the first entry is at the bottom, so let’s look at the individual entries from bottom to top:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>The monitoring core logs the monitoring event of the state change. The <span class="image-inline"><img src="../images/icons/icon_alert_crit.png" alt="icon alert crit"></span> icon in the 1st column indicates the state (<span class="state2">CRIT</span> in the example).</p></li>
<li><p>The monitoring core generates a <span class="image-inline"><img src="../images/icons/icon_alert_cmk_notify.png" alt="icon alert cmk notify"></span> <em>raw notification</em>. This is passed by the core to the notification module, which performs the evaluation of the applicable notification rules.</p></li>
<li><p>The evaluation of the rules results in a <span class="image-inline"><img src="../images/icons/icon_alert_notify.png" alt="icon alert notify"></span> <em>user notification</em> to the user <code>hh</code> with the method <code>mail</code>.</p></li>
<li><p>The <span class="image-inline"><img src="../images/icons/icon_alert_notify_result.png" alt="icon alert notify result"></span> <em>notification result</em> shows that the email was successfully handed over to the SMTP server for delivery.</p></li>
</ol></div>
<div class="paragraph"><p>To help in the correct understanding of the contexts for all of the various setting options and basic conditions, and to enable an accurate problem diagnosis when a notification appears or does not appear as expected, here we will describe all of the details of the notification process including all of the components involved.</p></div>
<div class="paragraph"><p><strong>Note:</strong> The notification history that we have shown above for a service can also be displayed for a host: on the host details page in the <span class="guihint">Host</span> menu for the host itself (<span class="guihint">Notifications of host</span> menu item) and also for the host with all its services (<span class="guihint">Notifications of host &amp; services</span>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__the_components">
<span class="hidden-anchor sr-only" id="_the_components"></span>7.2. The components</h3>
<div class="paragraph"><p>The following components are involved in the Checkmk notification system:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 45%;">
<col style="width: 25%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Log file</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nagios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The monitoring core in the <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> that detects monitoring events and generates raw notifications.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/nagios.log<br>
~/var/nagios/debug.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="cmc.html">Checkmk Micro Core (CMC)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The monitoring core in the Enterprise Editions that performs the same function as Nagios in the <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/cmc.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes the notification rules in order to create a user notification from a raw notification. It calls up the notification scripts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification spooler (Enterprise Editions only)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous delivery of notifications, and centralised notifications in distributed environments.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mknotifyd.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For every notification method there is a script which processes the actual delivery (e.g., generates and sends an HTML email).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__the_monitoring_core">
<span class="hidden-anchor sr-only" id="_the_monitoring_core"></span>7.3. The monitoring core</h3>
<div class="sect3">
<h4 id="heading__raw_notifications">
<span class="hidden-anchor sr-only" id="_raw_notifications"></span>Raw notifications</h4>
<div class="paragraph"><p>As described above, every notification begins with a monitoring event in the monitoring core.
If all conditions have been satisfied and a ‘green light’ for a notification can be given, the core generates a <em>raw notification</em> to the internal <code>check-mk-notify</code> help contact.
The raw notification doesn’t yet contain details of the actual contacts or of the notification method.</p></div>
<div class="paragraph"><p>The raw notification looks like this in the service’s notification history:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_raw.png" alt="A raw notification in the notification history."></div></div>
<div class="ulist"><ul>
<li><p>The icon is a <span class="image-inline"><img src="../images/icons/icon_alert_cmk_notify.png" alt="icon alert cmk notify"></span> light-grey loudspeaker</p></li>
<li><p><code>check-mk-notify</code> is given as the contact.</p></li>
<li><p><code>check-mk-notify</code> is given as the notification command.</p></li>
</ul></div>
<div class="paragraph"><p>The raw notification then passes to the Checkmk notification module, which processes the notification rules.
This module is called up as an external program by Nagios (<code>cmk --notify</code>).
The CMC on the other hand keeps the module on standby as a permanent auxiliary process (<em>notification helper</em>), thus reducing process-creation and saving machine time.</p></div>
</div>
<div class="sect3">
<h4 id="heading__error_diagnosis_in_the_nagios_monitoring_core">
<span class="hidden-anchor sr-only" id="_error_diagnosis_in_the_nagios_monitoring_core"></span>Error diagnosis in the Nagios monitoring core</h4>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
The Nagios core used in the <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> logs all monitoring events to <code>~/var/log/nagios.log</code>.
This file is simultaneously the location where it stores the notification history — which is also queried using the
GUI if, for example, you wish to see a host’s or service’s notifications.</p></div>
<div class="paragraph"><p>More interesting however are the messages you find in the <code>~/var/nagios/debug.log</code> file which you receive if you set the <code>debug_level</code>
variable to <code>32</code> in <code>etc/nagios/nagios.d/logging.cfg</code>.</p></div>
<div class="paragraph"><p>Following a core restart …​</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>restart<span class="tok-w"> </span>nagios</code></pre></div></div>
<div class="paragraph"><p>… you will find useful information on the reasons notifications were created or suppressed:</p></div>
<div class="listingblock">
<div class="title">~/var/nagios/debug.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1592405483.152931] [032.0] [pid=18122] ** Service Notification Attempt ** Host: 'localhost', Service: 'backup4', Type: 0, Options: 0, Current State: 2, Last Notification: Wed Jun 17 16:24:06 2020
[1592405483.152941] [032.0] [pid=18122] Notification viability test passed.
[1592405485.285985] [032.0] [pid=18122] 1 contacts were notified.  Next possible notification time: Wed Jun 17 16:51:23 2020
[1592405485.286013] [032.0] [pid=18122] 1 contacts were notified.</code></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="heading__error_diagnosis_in_the_cmc_monitoring_core">
<span class="hidden-anchor sr-only" id="_error_diagnosis_in_the_cmc_monitoring_core"></span>Error diagnosis in the CMC monitoring core</h4>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
In the <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> you can find a protocol from the monitoring core in the <code>~/var/log/cmc.log</code> log file.
In the standard installation this file contains no information regarding notifications.
You can however activate a very detailed logging function with <span class="guihint">Global settings &gt; Monitoring Core &gt; Logging of the notification mechanics.</span>
The core will then provide information on why — or why not (yet) — a monitoring event prompts it to pass a notification to the notification system:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tail<span class="tok-w"> </span>-f<span class="tok-w"> </span>var/log/cmc.log
<span class="tok-go">+2021-08-26 16:12:37 [5] [core 27532] Executing external command: PROCESS_SERVICE_CHECK_RESULT;mysrv;CPU load;1;test</span>
<span class="tok-go">+2021-08-26 16:12:43 [5] [core 27532] Executing external command: LOG;SERVICE NOTIFICATION: hh;mysrv;CPU load;WARNING;mail;test</span>
<span class="tok-go">+2021-08-26 16:12:52 [5] [core 27532] Executing external command: LOG;SERVICE NOTIFICATION RESULT: hh;mysrv;CPU load;OK;mail;success 250 - b'2.0.0 Ok: queued as 482477F567B';success 250 - b'2.0.0 Ok: queued as 482477F567B'</span></code></pre></div></div>
<div class="paragraph"><p><strong>Note:</strong> Turning on logging to notifications can generate a lot of messages.
It is however useful when one later asks why a notification was <em>not</em> generated in a particular situation.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__rule_evaluation_by_the_notification_module">
<span class="hidden-anchor sr-only" id="_rule_evaluation_by_the_notification_module"></span>7.4. Rule evaluation by the notification module</h3>
<div class="paragraph"><p>Once the core has generated a raw notification, this runs through the chain of notification rules – resulting in a table of notifications.
Alongside the data from the raw notification, every notification contains the following additional information:</p></div>
<div class="ulist"><ul>
<li><p>The contact to be notified</p></li>
<li><p>The notification method</p></li>
<li><p>The parameters for this method</p></li>
</ul></div>
<div class="paragraph"><p>In a synchronous delivery, for every entry in the table an appropriate <a href="#scripts">notification script</a> will now be executed.
In an <a href="#async">asynchronous delivery</a> a notification will be passed as a file to the notification spooler.</p></div>
<div class="sect3">
<h4 id="heading__analysis_of_the_rule_chain">
<span class="hidden-anchor sr-only" id="_analysis_of_the_rule_chain"></span>Analysis of the rule chain</h4>
<div class="paragraph"><p>When you create more complex rule regimes the question of which rules will apply to a specific notification will certainly come up.
For this Checkmk provides a built-in analysis function on the <span class="guihint">Notifications configuration</span> page, which you can reach with the <span class="guihint">Display &gt; Show analysis</span> menu item.</p></div>
<div class="paragraph"><p>In the analysis mode, by default the last ten raw notifications generated by the system and processed through the rules will be displayed:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_analysis.png" alt="List of the last 10 raw notifications in analysis mode."></div></div>
<div class="paragraph"><p>Should you need to analyze a larger number of raw notifications, you can easily increase the number stored for analysis via <span class="guihint">Global settings &gt; Notifications &gt; Store notifications for rule analysis</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_storenotifications.png" alt="Global setting for the number of raw notifications displayed."></div></div>
<div class="paragraph"><p>For each of these raw notifications three actions will be available to you:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_analyze.png" alt="Icon to test the rule chain."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests the rule chain, in which every rule will be checked if all conditions for the rule have been satisfied for the selected monitoring event. The resulting table of notifications will be displayed with the rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_toggle_context.png" alt="Icon to display the notification context."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the complete notification context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_reload_cmk.png" alt="Raw notification reload icon."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repeats this raw notification as if it has just appeared. Otherwise the display is the same as in the analysis. With this you can not only check the rule’s conditions, but also test how a notification looks visually.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__error_diagnosis">
<span class="hidden-anchor sr-only" id="_error_diagnosis"></span>Error diagnosis</h4>
<div class="paragraph"><p>If you have performed the rule chain test (<span class="image-inline"><img src="../images/icons/icon_analyze.png" alt="for testing the rule chain."></span>), you can see which rules <span class="image-inline"><img src="../images/icons/icon_test_green.png" alt="Symbol in green"></span> have been applied or <span class="image-inline"><img src="../images/icons/icon_test_grey.png" alt="Symbol in gray"></span> have not been applied to a monitoring event:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_test_rules.png" alt="List of applied and not applied rules."></div></div>
<div class="paragraph"><p>If a rule was not applied, move the mouse over the gray circle to see the hint (mouse-over text):</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_mouseover.png" alt="Hint when a rule has not been applied." width="72%"></div></div>
<div class="paragraph"><p>However, this mouse-over text uses abbreviations for the causes a rule was not applied.
These refer to the <span class="guihint">Match host event type</span> or <span class="guihint">Match service event type</span> <a href="#rule_conditions">conditions</a> of the rule.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 33%;">
<col style="width: 57%;">
</colgroup>
<thead><tr><th class="tableblock halign-left valign-top" colspan="3">Host event types</th></tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abbreviation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Meaning</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate0">UP</span> to <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate0">UP</span> to <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate1">DOWN</span> to <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">du</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate1">DOWN</span> to <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNREACHABLE ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate2">UNREACH</span> to <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNREACHABLE ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from <span class="hstate2">UNREACH</span> to <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from any status to <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from any status to <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host status changed from any status to <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start or end of flapping state</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start or end of a scheduled downtime</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgement of problem</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alert handler execution, successful</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">af</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alert handler execution, failed</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 33%;">
<col style="width: 57%;">
</colgroup>
<thead><tr><th class="tableblock halign-left valign-top" colspan="3">Service event types</th></tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abbreviation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Meaning</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state0">OK</span> to <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state0">OK</span> to <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state0">OK</span> to <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state0">OK</span> to <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state1">WARN</span> to <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state1">WARN</span> to <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state1">WARN</span> to <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state2">CRIT</span> to <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state2">CRIT</span> to <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state2">CRIT</span> to <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state3">UNKNOWN</span> to <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state3">UNKNOWN</span> to <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from <span class="state3">UNKNOWN</span> to <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from any status to <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from any status to <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from any status to <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service status changed from any status to <span class="state3">UNKNOWN</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Based on these hints you can check and revise your rules.</p></div>
<div class="paragraph"><p>Another important diagnostic option is the log file <code>~/var/log/notify.log</code>.
During tests with the notifications, the popular command <code>tail -f</code> is useful for this:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tail<span class="tok-w"> </span>-f<span class="tok-w"> </span>var/log/notify.log
<span class="tok-go">2021-08-26 17:11:58,914 [20] [cmk.base.notify] Analysing notification (mysrv;Temperature Zone 7) context with 71 variables</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify] Global rule 'Notify all contacts of a host/service via HTML email'...</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify]  -&gt; matches!</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify]    - adding notification of hh via mail</span>
<span class="tok-go">2021-08-26 17:11:58,916 [20] [cmk.base.notify] Executing 1 notifications:</span>
<span class="tok-go">2021-08-26 17:11:58,916 [20] [cmk.base.notify]   * would notify hh via mail, parameters: smtp, graphs_per_notification, notifications_with_graphs, bulk: no</span></code></pre></div></div>
<div class="paragraph"><p>With <span class="guihint">Global settings &gt; Notifications &gt; Notification log level</span> you can control the comprehensiveness of the notifications in three levels.
Set this to <span class="guihint">Full dump of all variables and command</span>, and in the log file you will find a complete listing of all of the variables available to the <a href="#scripts">notification script</a>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_log_level.png" alt="Global setting to specify the log level."></div></div>
<div class="paragraph"><p>For example, the list will appear like this (extract):</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 17:24:54,709 [10] [cmk.base.notify] Raw context:
                    CONTACTS=hh
                    HOSTACKAUTHOR=
                    HOSTACKCOMMENT=
                    HOSTADDRESS=127.0.0.1
                    HOSTALIAS=localhost
                    HOSTATTEMPT=1
                    HOSTCHECKCOMMAND=check-mk-host-smart</code></pre></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="heading_async">
<span class="hidden-anchor sr-only" id="async"></span>7.5. Asynchronous delivery via the notification spooler</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
A powerful supplementary function of the Enterprise Editions is the <em>notification spooler</em>.
This enables an asynchronous delivery of notifications.
What does asynchronous mean in this context?</p></div>
<div class="ulist"><ul>
<li><p>Synchronous delivery: The notification module waits until the notification script has finished executing. If this takes a long time to execute, more notifications will pile up. If monitoring is stopped, these notifications are lost. In addition, if many notifications are generated over a short period of time, a backlog may build up to the core, causing the monitoring to stall.</p></li>
<li><p>Asynchronous delivery: Every notification will be saved to a spool file under <code>~/var/check_mk/notify/spool</code>. No jam can build up. If the monitoring is stopped the spool files will be retained and notifications can later be delivered correctly. The notification spooler takes over the processing of the spool files.</p></li>
</ul></div>
<div class="paragraph"><p>A synchronous delivery is then feasible if the notification script runs quickly, and above all can’t lead to some sort of timeout. With notification methods that access existing spoolers that is a given.
Spool services from the system can be used particularly with email and SMS.
The notification script passes a file to the spooler — with this procedure no wait state can occur.</p></div>
<div class="paragraph"><p>When using the <a href="#syncsmtp">traceable delivery via SMTP</a> or other scripts which establish network connections, you should <strong>always</strong> employ asynchronous delivery.
This also applies to scripts that send text messages (SMS) via HTTP over the internet.
The timeouts when building a connection to a network service can take up to several minutes, causing a jam as described above.</p></div>
<div class="paragraph"><p>The good news is that asynchronous delivery is enabled by default in Checkmk.
For one thing, the notification spooler (<code>mknotifyd</code>) is also started when the site is started, which you can check with the following command:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>status<span class="tok-w"> </span>mknotifyd
<span class="tok-go">mknotifyd:      <span class="green">running</span></span>
<span class="tok-go">-----------------------</span>
<span class="tok-go">Overall state:  <span class="green">running</span></span></code></pre></div></div>
<div class="paragraph"><p>On the other hand, asynchronous delivery (<span class="guihint">Asynchronous local delivery by notification spooler</span>) is selected in <span class="guihint">Global settings &gt; Notifications &gt; Notification Spooling</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_spooling.png" alt="Global setting for the notification spooler delivery method."></div></div>
<div class="sect3">
<h4 id="heading__error_diagnosis_2">
<span class="hidden-anchor sr-only" id="_error_diagnosis_2"></span>Error diagnosis</h4>
<div class="paragraph"><p>The notification spooler maintains its own log file: <code>~/var/log/mknotifyd.log</code>.
This possesses three log levels which can be set  under <span class="guihint">Global settings &gt; Notifications &gt; Notification Spooler Configuration</span> with the <span class="guihint">Verbosity of logging</span> parameter.
In the middle level, <span class="guihint">Verbose logging (i.e. spooled notifications),</span> the processing of the spool files can be seen:</p></div>
<div class="listingblock">
<div class="title">~/var/log/mknotifyd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 18:05:02,928 [15] [cmk.mknotifyd] processing spoolfile: /omd/sites/mysite/var/check_mk/notify/spool/dad64e2e-b3ac-4493-9490-8be969a96d8d
2021-08-26 18:05:02,928 [20] [cmk.mknotifyd] running cmk --notify --log-to-stdout spoolfile /omd/sites/mysite/var/check_mk/notify/spool/dad64e2e-b3ac-4493-9490-8be969a96d8d
2021-08-26 18:05:05,848 [20] [cmk.mknotifyd] got exit code 0
2021-08-26 18:05:05,850 [20] [cmk.mknotifyd] processing spoolfile dad64e2e-b3ac-4493-9490-8be969a96d8d successful: success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9'
2021-08-26 18:05:05,850 [20] [cmk.mknotifyd] sending command LOG;SERVICE NOTIFICATION RESULT: hh;mysrv;CPU load;OK;mail;success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9';success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9'</code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_bulk">
<span class="hidden-anchor sr-only" id="bulk"></span>8. Bulk notifications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__overview_2">
<span class="hidden-anchor sr-only" id="_overview_2"></span>8.1. Overview</h3>
<div class="paragraph"><p>Everyone who works with monitoring has experienced an isolated problem setting off a veritable flood of (successive) notifications.
The principle of the <a href="#parents">parent hosts</a> is a way of reducing these under specific circumstances, but unfortunately it doesn’t help in all cases.</p></div>
<div class="paragraph"><p>You can take an example from the Checkmk project itself:
Once each day we build Checkmk installation packages for every supported Linux distribution.
Our own Checkmk monitoring is set up so that we have a service that is then only <span class="state0">OK</span> if the right number of packages have been correctly constructed.
It can occasionally happen that a general error in the software hampers the packaging, causing 43 services to go into a <span class="state2">CRIT</span> state simultaneously.</p></div>
<div class="paragraph"><p>We have configured the notifications in such a way that in such a case only a single email listing all 43 notifications in sequence will be sent.
This is naturally clearer than 43 single emails, and it also reduces the risk that ‘in the heat of the battle’ one misses a 44th email belonging to quite another problem.</p></div>
<div class="paragraph"><p>The mode of operation of this <em>bulk notification</em> is very simple.
When a notification occurs, at first it will be held back for a short time.
Subsequent notifications that occur during this time will be immediately added into the same email.
This collecting can be defined <em>for each rule</em>.
So, for example, during the day you can operate with individual emails, but overnight with a bulk notification.
If a bulk notification is activated you will generally be offered the following options:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_bulk.png" alt="Notification rule with bulk notification options."></div></div>
<div class="paragraph"><p>The waiting time can be configured as desired.
In many cases one minute suffices as by then at the latest all related problems should have appeared.
You can of course set a longer time, but that will result in a fundamental delay to the notifications.</p></div>
<div class="paragraph"><p>Since it naturally makes no sense to throw everything into a single pot, you can specify which groups of problems should be notified collectively.
The <span class="guihint">Host</span> option is very commonly used — this ensures that only notifications from the same host are bundled.</p></div>
<div class="paragraph"><p>Here are a few additional facts about bulk notifications:</p></div>
<div class="ulist"><ul>
<li><p>If the bundling is activated in a rule, the activation can be deactivated by a subsequent rule – and vice versa.</p></li>
<li><p>The bulk notification always takes place per contact. Each contact has their own 'private collection pot' in effect.</p></li>
<li><p>You can limit the size of the pot (<span class="guihint">Maximum bulk size</span>). Once the maximum is reached the bulk notification will immediately be sent.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__bulk_notifications_and_time_periods">
<span class="hidden-anchor sr-only" id="_bulk_notifications_and_time_periods"></span>8.2. Bulk notifications and time periods</h3>
<div class="paragraph"><p>What happens when a notification is within the notification period, but the bulk notification that contains it — and which comes somewhat later — is outside the notification period?
The reverse situation is also possible…​</p></div>
<div class="paragraph"><p>Here a very simple principle applies:
all configurations that restrict notifications to time periods are valid only <strong>for the actual notification</strong>.
The subsequent bulk notification will always be delivered <strong>independently</strong> of all time periods.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_syncsmtp">
<span class="hidden-anchor sr-only" id="syncsmtp"></span>9. Traceable delivery per SMTP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__email_is_not_reliable">
<span class="hidden-anchor sr-only" id="_email_is_not_reliable"></span>9.1. Email is not reliable</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Monitoring is only useful when one can rely on it.
This requires that notifications are received <em>reliably</em> and <em>promptly</em>.
Unfortunately email delivery is not completely ideal however.
The despatch is usually processed by passing the email to the local SMTP server.
This attempts to deliver the email autonomously and asynchronously.</p></div>
<div class="paragraph"><p>With a temporary error (e.g., a case where the receiving SMTP server is not reachable) the email will be put into a queue and a later a new attempt will be made.
This ‘later’ will as a rule be after 15-30 minutes.
By then the notification could be far too late!</p></div>
<div class="paragraph"><p>If the email really can’t be delivered the SMTP server creates a nice error message in its log file and attempts to generate an error email to the ‘sender’.
But the monitoring system is not a real sender and also cannot receive emails.
It follows that such errors simply disappear and notifications are then absent.</p></div>
<div class="paragraph"><p><strong>Important:</strong> Traceable notifications are not available for <a href="#bulk">bulk notifications</a>!</p></div>
</div>
<div class="sect2">
<h3 id="heading__using_smtp_on_a_direct_connection_enables_error_analysis">
<span class="hidden-anchor sr-only" id="_using_smtp_on_a_direct_connection_enables_error_analysis"></span>9.2. Using SMTP on a direct connection enables error analysis</h3>
<div class="paragraph"><p>The <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> provide the possibilty of a <em>traceable</em> delivery via SMTP.
This it intentionally does without the help of the local mail server.
Instead Checkmk itself sends the email to your smarthost via SMTP, and then it evaluates the SMTP response itself.</p></div>
<div class="paragraph"><p>In this way, not only are SMTP errors treated intelligently, but a correct delivery is also precisely documented.
It is a bit like a registered letter:
Checkmk receives a receipt from the SMTP smarthost (receiving server) verifying that the email has been accepted — including a mail ID.</p></div>
</div>
<div class="sect2">
<h3 id="heading__synchronous_delivery_for_html_emails">
<span class="hidden-anchor sr-only" id="_synchronous_delivery_for_html_emails"></span>9.3. Synchronous delivery for HTML emails</h3>
<div class="paragraph"><p>You can select and configure the tracable delivery via SMTP for the notification method HTML email by entering the smarthost (with name and port number) and the access data and encryption method:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_enable_sync_smtp.png" alt="Notification rule with synchronous email delivery options."></div></div>
<div class="paragraph"><p>In the history of the service concerned, you can then track the delivery exactly.
Here is an example in which a service — for testing purposes — was manually set to <span class="state2">CRIT</span>.
The screenshot below shows the notifications for this service, which you can display on the service details page with <span class="guihint">Service &gt; Service Notifications</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_smtp_success.png" alt="List of accumulated notifications for a successful email delivery."></div></div>
<div class="paragraph"><p>Here you will see the four individual steps in the chronological sequence from bottom to top, as we have already presented them in the chapter on <a href="#history">notification history</a>.
The important difference is that now you can see in the <span class="image-inline"><img src="../images/icons/icon_alert_notify_result.png" alt="icon alert notify result"></span> topmost entry that the email was successfully delivered to the smarthost and its response is <code>success</code>.</p></div>
<div class="paragraph"><p>You can also follow the individual steps in the <code>notify.log</code> file.
The following lines belong to the last step and contain the response of the SMTP server:</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 10:02:22,016 [20] [cmk.base.notify] Got spool file d3b417a5 (mysrv;CPU load) for local delivery via mail
2021-08-26 10:02:22,017 [20] [cmk.base.notify]      executing /omd/sites/mysite/share/check_mk/notifications/mail
2021-08-26 10:02:29,538 [20] [cmk.base.notify]      Output: success 250 - b'2.0.0 Ok: queued as 1BE667EE7D6'</code></pre></div>
</div>
<div class="paragraph"><p>The Message-ID <code>1BE667EE7D6</code>  will appear in the smarthost’s log file.
There — if you are concerned — you can investigate where the email has gotten to.
In any case you can prove that, and when, the email was correctly sent from Checkmk.</p></div>
<div class="paragraph"><p>Let us repeat the test from above, but this time with a falsely-configured password for the SMTP transfer to the smarthost.
Here you can see in plain text the SMTP error message <code>Error: authentication failed</code> from the smarthost:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_smtp_failed.png" alt="List of accumulated notifications for a failed email delivery."></div></div>
<div class="paragraph"><p>What can be done about failed notifications?
Again, notifying by email is apparently not a good solution.
Instead Checkmk shows a clear warning with red background colour in the <a href="user_interface.html#overview">Overview</a>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_overview_failed.png" alt="Display of failed notifications in the 'Overview' snapin." width="50%"></div></div>
<div class="paragraph"><p>Here you can:</p></div>
<div class="ulist"><ul>
<li><p>Click on the text <span class="guihint">…​ failed notifications</span> for a list of the failed deliveries.</p></li>
<li><p>Click on the <span class="image-inline"><img src="../images/icons/icon_delete.png" alt="Icon to delete."></span> icon to confirm these messages and remove the notice by clicking on <span class="image-inline"><img src="../images/icons/icon_confirm.png" alt="Icon to confirm."></span> <span class="guihint">Confirm</span> in the overview that opens.</p></li>
</ul></div>
<div class="paragraph"><p><strong>Important:</strong> Note that direct delivery per SMTP in error situations can lead to a notification script running for a very long time and lead to a timeout.
For this reason you are strongly advised to use the notification spooler and to select an <a href="#async">asynchronous delivery</a> of notifications.</p></div>
<div class="paragraph"><p>The conduct with repeatable errors (such as an SMTP timeout) can be defined with <span class="guihint">Global settings &gt; Notifications &gt; Notification spooler configuration</span> per notification method:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_plugin_timing_settings.png" alt="Global timer setting for a notification method."></div></div>
<div class="paragraph"><p>Alongside an optional timeout (the default is 1 minute) and a maximum number of retries, it can also be defined whether the script is permitted to run multiply in parallel and thus send multiple notifications (<span class="guihint">Maximum concurrent executions</span>).
If the notification script is very slow a parallel execution can make sense — however the script must be so-programmed that multiple executions run cleanly (and, for example, that the script doesn’t reserve certain data for itself).</p></div>
<div class="paragraph"><p>A multiple, parallel delivery over SMTP is unproblematic since the target server can manage multiple parallel connections.
This is certainly not the case when delivering directly from SMS via a modem without an additional spooler, and here one should stick with the setting 1.</p></div>
</div>
<div class="sect2">
<h3 id="heading__sms_and_other_notification_methods">
<span class="hidden-anchor sr-only" id="_sms_and_other_notification_methods"></span>9.4. SMS and other notification methods</h3>
<div class="paragraph"><p>A synchronous delivery including error messages and traceability has to date only been implemented for HTML emails.
How one can return an error status in a self-written notification script can be found in the chapter on <a href="#scripts">writing your own scripts</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_distributed">
<span class="hidden-anchor sr-only" id="distributed"></span>10. Notifications in distributed systems</h2>
<div class="sectionbody">
<div class="paragraph"><p>In distributed environments — i.e., those with more than a single Checkmk site — the question arises of what to do with notifications generated on remote sites.</p></div>
<div class="paragraph"><p>In such a situation there are basically two possibilities:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Local delivery</p></li>
<li><p>Central delivery on the central site (Enterprise Editions only)</p></li>
</ol></div>
<div class="paragraph"><p>Detailed information on this subject can be found in the article on <a href="distributed_monitoring.html#notifications">distributed monitoring</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_scripts">
<span class="hidden-anchor sr-only" id="scripts"></span>11. Notification scripts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__the_principle_2">
<span class="hidden-anchor sr-only" id="_the_principle_2"></span>11.1. The principle</h3>
<div class="paragraph"><p>Notification can occur in manifold and individual ways.
Typical examples are:</p></div>
<div class="ulist"><ul>
<li><p>Transfer of notifications to a ticket, or external notification system</p></li>
<li><p>The sending of an SMS over various internet services</p></li>
<li><p>Automated telephone calls</p></li>
<li><p>Forwarding to a higher, umbrella monitoring system</p></li>
</ul></div>
<div class="paragraph"><p>For this reason Checkmk provides a very simple interface which enables you to write your own notification scripts.
These can be written in any Linux-supported programming language — even though Shell, Perl and Python together have 95% of the ‘market’.</p></div>
<div class="paragraph"><p>The <a href="#includedscripts">standard scripts included</a> with Checkmk can be found in <code>~/share/check_mk/notifications</code>.
This directory is a component of the software and is not intended to be changed.
Instead, save your own scripts in <code>~/local/share/check_mk/notifications</code>.
Ensure that your scripts are executable  (<code>chmod +x</code>).
They will then be found automatically and made available for selection in the notification rules.</p></div>
<div class="paragraph"><p>Should you wish to customise a standard script, simply copy it from <code>~/share/check_mk/notifications</code> to <code>~/local/share/check_mk/notifications</code> and there make your changes in the copy.
If you retain the original name, your script will be substituted automatically for the standard version and no changes will need to be made to the existing notification rules.</p></div>
<div class="paragraph"><p>Some more sample scripts are included with the software in <code>~/share/doc/check_mk/treasures/notifications</code>.
You can use these as templates for customisation.
The configuation will generally take place directly in the script — tips covering this can be found there in the comments.</p></div>
<div class="paragraph"><p>In the case of a notification your script will be called up with the site user’s permissions.
In <strong>environment variables</strong>, (those that begin with <code>NOTIFY_</code>), it will receive all of the information about the affected host/service, the monitoring event, the contacts to be notified, and the parameters specified in the notification rule.</p></div>
<div class="paragraph"><p>Texts that the script writes to the <strong>standard output</strong> (with <code>print</code>, <code>echo</code>, etc.), appear in the notification module’s log file <code>~/var/log/notify.log</code>.</p></div>
</div>
<div class="sect2">
<h3 id="heading__traceable_notifications">
<span class="hidden-anchor sr-only" id="_traceable_notifications"></span>11.2. Traceable notifications</h3>
<div class="paragraph"><p>Notification scripts have the option of using an exit code to communicate whether a replicable or final error has occurred:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Exit code</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The script was successfully executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A temporary error has occurred. The execution should after a short wait be repeatedly reattempted, up until the configured maximum number of attempts has been reached. Example: an HTTP connection cannot be established with an SMS service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> and higher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A final error has occurred. The notification will not be reattempted. A notification error will be displayed in the GUI. The error will be displayed in the host’s/service’s history. Example: the SMS service records an 'invalid authentification' error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Additionally, in all cases the standard output from the notification script, together with the status will be entered into the host’s/service’s notification history and will therefore be visible in the GUI.</p></div>
<div class="paragraph"><p><strong>Important:</strong> Traceable notifications are not available for <a href="#bulk">bulk notifications</a>!</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
The treatment of notification errors from the user’s point of view will be explained in the chapter on <a href="#syncsmtp">traceable delivery via SMTP</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_example">
<span class="hidden-anchor sr-only" id="example"></span>11.3. A simple sample script</h3>
<div class="paragraph"><p>As an example you can create a script that writes all of the information about the notification to a file.
The coding language is the Bash Linux shell:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/foobar</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Foobar Teleprompter

env | grep NOTIFY_ | sort &gt; $OMD_ROOT/tmp/foobar.out
echo "Successfully written $OMD_ROOT/tmp/foobar.out"
exit 0</code></pre></div>
</div>
<div class="paragraph"><p>Then make the script executable:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>local/share/check_mk/notifications/foobar</code></pre></div></div>
<div class="paragraph"><p>Here are a couple of explanations concerning the script:</p></div>
<div class="ulist"><ul>
<li><p>In the first line is a <code>#!</code> and the path to the script language’s interpreter (here <code>/bin/bash</code>).</p></li>
<li><p>In the second line after the comment character <code>#</code> is a <strong>title</strong> for the script. As a rule this will be shown when selecting the notification method.</p></li>
<li><p>The <code>env</code> command will output all environment variables received by the script.</p></li>
<li><p>With <code>grep NOTIFY_</code> the Checkmk variables will be filtered out …​</p></li>
<li><p>… and sorted alphabetically with <code>sort</code>.</p></li>
<li><p><code>&gt; $OMD_ROOT/tmp/foobar.out</code> writes the result to the <code>~/tmp/foobar.out</code> file within the site directory.</p></li>
<li><p>The <code>exit 0</code> would actually be superfluous in this location since the shell always takes the exit code from the last command. Here this is <code>echo</code> and is always successful — but explicit is always better.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_example_test">
<span class="hidden-anchor sr-only" id="example_test"></span>11.4. Testing the sample script</h3>
<div class="paragraph"><p>So that the script will be used you must define it as a method in a notification rule.
Self-written scripts have no parameter declaration, therefore all of the checkboxes such as those offered, for example, in the <span class="guihint">HTML Email</span> method, will be missing.
Instead you can enter a list of texts as parameters that can be available as <code>NOTIFY_PARAMETER_1</code>, <code>NOTIFY_PARAMETER_2</code>, etc, to the script.
For a test provide the parameters <code>Fröhn</code>, <code>Klabuster</code> and <code>Feinbein</code>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_method_foobar.png" alt="Rule with selection of sample script as notification method."></div></div>
<div class="paragraph"><p>Now to test, set the service <code>CPU load</code> on the host <code>myserver</code> to <span class="state2">CRIT</span> — with the command <span class="guihint">Fake check results</span> as described <a href="#notification_testing">above</a>.
In the log file of the notification module <code>~/var/log/notify.log</code> you then see the execution of the script including parameters and the generated spool file.:</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-25 13:01:23,887 [20] [cmk.base.notify] Executing 1 notifications:
2021-08-25 13:01:23,887 [20] [cmk.base.notify]   * notifying hh via foobar, parameters: Fröhn, Klabuster, Feinbein, bulk: no
2021-08-25 13:01:23,887 [20] [cmk.base.notify] Creating spoolfile: /omd/sites/mysite/var/check_mk/notify/spool/e1b5398c-6920-445a-888e-f17e7633de60</code></pre></div>
</div>
<div class="paragraph"><p>The file <code>~/tmp/foobar.out</code> will now contain an alphabetic list of all Checkmk environment variables that include information concerning the notification.
Here you can orient yourself with which values are available to your script.
Here are the first ten lines:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>head<span class="tok-w"> </span>tmp/foobar.out
<span class="tok-go">NOTIFY_ALERTHANDLERNAME=debug</span>
<span class="tok-go">NOTIFY_ALERTHANDLEROUTPUT=Arguments:</span>
<span class="tok-go">NOTIFY_ALERTHANDLERSHORTSTATE=OK</span>
<span class="tok-go">NOTIFY_ALERTHANDLERSTATE=OK</span>
<span class="tok-go">NOTIFY_CONTACTALIAS=Harry Hirsch</span>
<span class="tok-go">NOTIFY_CONTACTEMAIL=<a href="mailto:harryhirsch@example.com">harryhirsch@example.com</a></span>
<span class="tok-go">NOTIFY_CONTACTNAME=hh</span>
<span class="tok-go">NOTIFY_CONTACTPAGER=</span>
<span class="tok-go">NOTIFY_CONTACTS=hh</span>
<span class="tok-go">NOTIFY_DATE=2021-08-25</span></code></pre></div></div>
<div class="paragraph"><p>The parameters can also be found:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>grep<span class="tok-w"> </span>PARAMETER<span class="tok-w"> </span>tmp/foobar.out
<span class="tok-go">NOTIFY_PARAMETERS=Fröhn Klabuster Feinbein</span>
<span class="tok-go">NOTIFY_PARAMETER_1=Fröhn</span>
<span class="tok-go">NOTIFY_PARAMETER_2=Klabuster</span>
<span class="tok-go">NOTIFY_PARAMETER_3=Feinbein</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__environment_variables">
<span class="hidden-anchor sr-only" id="_environment_variables"></span>11.5. Environment variables</h3>
<div class="paragraph"><p>In the above example you have seen a number of environment variables that will be passed to the script.
Precisely which variables will be available will depend on the type of notification and also on the Checkmk version and edition being used.
Alongside the trick with the <code>env</code> command there are two further ways of getting a complete list of all variables:</p></div>
<div class="ulist"><ul>
<li><p>Changing up the log level for <code>notify.log</code> via <span class="guihint">Global settings &gt; Notifications &gt; Notification log level</span>.</p></li>
<li><p>For notifications per <span class="guihint">HTML Email</span> there is a checkbox <span class="guihint">Information to be displayed in the email body</span> with the <span class="guihint">Complete variable list (for testing)</span> option.</p></li>
</ul></div>
<div class="paragraph"><p>Below is a list of the most important variables:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_ROOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home directory of the site, e.g., <code>/omd/sites/mysite</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_SITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site name, e.g., <code>mysite</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_WHAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For host notifications, the word <code>HOST</code>, otherwise <code>SERVICE</code>. With these you can make your script so intelligent that it logs useful information in both cases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User name (login) of the contact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTEMAIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email address of the contact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTPAGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entry in the <span class="guihint">Pager</span> field in the contact’s user profile. Since the field is not generally reserved for a specific purpose, you can simply use it for each user in order to save information required for notifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date of the notification in ISO-8601-Format, e.g., <code>2021-08-25</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_LONGDATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time in the non-localised Linux system’s default display, e.g., <code>Wed Aug 25 15:18:58 CEST 2021</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SHORTDATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time in ISO-Format, e.g. <code>2021-08-25 15:18:58</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the affected host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTOUTPUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output of the host check’s check plug-in, e.g., “<code>Packet received via smart PING</code>”. This output is only relevant for host notifications, but is also present in service notifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTSTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the words: <code>UP</code>, <code>DOWN</code> or <code>UNREACH</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_NOTIFICATIONTYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification type as described in the <a href="#intro">introduction to this article</a>. This will be expressed by one of the following words:<br>
<code>PROBLEM</code>: Normal host or service problem<br>
<code>RECOVERY</code>: Host/Service is again <span class="hstate0">UP</span> / <span class="state0">OK</span><br>
<code>ACKNOWLEDGEMENT (…​)</code>: <a href="basics_ackn.html">Acknowledgement</a> of a problem<br>
<code>FLAPPINGSTART</code>: Host/service has begun flapping<br>
<code>FLAPPINGSTOP</code>:- Flapping has ended<br>
<code>DOWNTIMESTART</code>: Start of a <a href="basics_downtimes.html">scheduled downtime</a><br>
<code>DOWNTIMEEND</code>: Normal end of a downtime<br>
<code>DOWNTIMECANCELLED</code>: Premature interruption of a downtime<br>
<code>CUSTOM</code>: Notification issued by a manual <a href="commands.html">command</a><br>
<code>ALERTHANDLER (…​)</code>: <a href="alert_handlers.html">Alert handler</a> execution (only Enterprise Editions)<br>
For types with <code>(…​)</code>, the brackets contain additional informationen on the notification’s type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All of the script’s parameters separated by blanks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETER_1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The script’s first parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETER_2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The script’s second parameter, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICEDESC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the service concerned. This variable is not present in host notifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICEOUTPUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output of the service check’s check plug-in (not for host notifications)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the words: <code>OK</code>, <code>WARN</code>, <code>CRIT</code> or <code>UNKNOWN</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__bulk_notifications">
<span class="hidden-anchor sr-only" id="_bulk_notifications"></span>11.6. Bulk notifications</h3>
<div class="paragraph"><p>If your script should support <a href="#bulk">bulk notifications</a>, it will need to be specially prepared, since the script must deliver <em>multiple notifications simultaneously</em>.
For this reason a delivery using environment variables also doesn’t function practicably.</p></div>
<div class="paragraph"><p>Give your script a name in the <em>third line</em> in the header as below — the notification module will then send the notifications through the <em>standard input</em>:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/mybulk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# My Bulk Notification
# Bulk: yes</code></pre></div>
</div>
<div class="paragraph"><p>Through the standard input the script will receive blocks of variables.
Each line has the form: <code>NAME=VALUE</code>.
Blocks are separated by blank lines.
The ASCII character with the code 1 (<code>\a</code>) is used to represent <em>newlines</em> within the text.</p></div>
<div class="paragraph"><p>The first block contains a list of general variables (e.g., call parameters).
Each subsequent block assembles the variables into a notification.</p></div>
<div class="paragraph"><p>The best recommendation is to try it yourself with a simple test that writes the complete data to a file so that you can see how the data is sent.
You can use the following notification script for this purpose:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/mybulk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# My Bulk Notification
# Bulk: yes

cat &gt; $OMD_ROOT/tmp/mybulktest.out</code></pre></div>
</div>
<div class="paragraph"><p>Test the script as <a href="#example_test">described above</a> and additionally activate the <span class="guihint">Notification Bulking</span> in the notification rule.</p></div>
</div>
<div class="sect2">
<h3 id="heading_includedscripts">
<span class="hidden-anchor sr-only" id="includedscripts"></span>11.7. Supplied notification scripts</h3>
<div class="paragraph"><p>As delivered, Checkmk already provides a whole range of scripts for connecting to popular and widely used instant messaging services, incident management platforms and ticket systems. You can find out how to use these scripts in the following articles:</p></div>
<div class="ulist"><ul>
<li><p><a href="notifications_jira.html">Jira</a></p></li>
<li><p><a href="notifications_mattermost.html">Mattermost</a></p></li>
<li><p><a href="notifications_pagerduty.html">PagerDuty</a></p></li>
<li><p><a href="notifications_pushover.html">Pushover</a></p></li>
<li><p><a href="notifications_opsgenie.html">Opsgenie</a></p></li>
<li><p><a href="notifications_servicenow.html">ServiceNow</a></p></li>
<li><p><a href="notifications_slack.html">Slack</a></p></li>
<li><p><a href="notifications_opsgenie.html">Opsgenie</a></p></li>
<li><p><a href="notifications_webex.html">Cisco Webex Teams</a></p></li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>12. Files and directories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__paths_of_checkmk">
<span class="hidden-anchor sr-only" id="_paths_of_checkmk"></span>12.1. Paths of Checkmk</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">File path</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/cmc.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="cmc.html">CMC</a> log file. If notification debugging ist activated, here you will find precise information as to why notifications were, or were not generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The notification module’s log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mkotifyd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The notification spooler’s log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mkotifyd.state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current status of the notification spooler. This is primarily relevant for <a href="distributed_monitoring.html#notifications">notifications in distributed environments</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/nagios/debug.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Nagios debug log file. Switch on the debug messages in <code>etc/nagios/nagios.d/logging.cfg</code> using the <code>debug_level</code> variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/spool/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage location for the spool files to be processed by the notification spooler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/deferred/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With temporary errors the notification spooler moves the files to here and retries after a couple of minutes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/corrupted/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defective spool files will be moved to here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/share/check_mk/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification scripts supplied as standard with Checkmk. Make no changes here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/local/share/check_mk/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage location for your custom notification scripts. If you wish to customise a standard script, copy it from <code>~/share/check_mk/notifications</code> to here, and retain the original file name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/share/doc/check_mk/treasures/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other notification scripts which you can slightly customise and use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_maillog">
<span class="hidden-anchor sr-only" id="maillog"></span>12.2. SMTP server log files</h3>
<div class="paragraph"><p>The SMTP server’s log files are system files and their absolute paths are listed here below.
Precisely where the log files are stored will depend on your Linux distribution.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/mail.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP-server’s log file under Debian and Ubuntu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/mail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP-server’s log file under SUSE Linux Enterprise Server (SLES)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/maillog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP-server’s log file under Red Hat Enterprise Linux (RHEL)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#intro">1. Introduction</a></li>
<li><a href="#notify_or_not">2. To notify, or not (yet) to notify?</a></li>
<li>
<a href="#simple_mail">3. Simple notifications by email</a><ul class="sectlevel1">
<li><a href="#_prerequisites">3.1. Prerequisites</a></li>
<li><a href="#smtp">3.2. Setting up mail dispatching in Linux</a></li>
<li><a href="#_email_address_and_contact_group">3.3. Email address and contact group</a></li>
<li><a href="#notification_testing">3.4. Testing</a></li>
<li><a href="#finetuning">3.5. Fine-tuning HTML email</a></li>
</ul>
</li>
<li>
<a href="#rules">4. Controlling notifications with rules</a><ul class="sectlevel1">
<li><a href="#_the_principle">4.1. The principle</a></li>
<li><a href="#_the_initial_predefined_rule">4.2. The initial predefined rule</a></li>
<li>
<a href="#notification_rule">4.3. Structure of the notification rules</a><ul class="sectlevel2">
<li><a href="#_general_properties">General properties</a></li>
<li><a href="#_notification_method">Notification method</a></li>
<li><a href="#_selecting_contacts">Selecting contacts</a></li>
<li><a href="#rule_conditions">Conditions</a></li>
</ul>
</li>
<li><a href="#cancel">4.4. Cancelling notifications</a></li>
<li><a href="#fallback">4.5. What happens if no rule is applicable?</a></li>
</ul>
</li>
<li>
<a href="#personal">5. Custom notifications</a><ul class="sectlevel1">
<li><a href="#_overview">5.1. Overview</a></li>
<li><a href="#_custom_notification_rules">5.2. Custom notification rules</a></li>
<li><a href="#_temporarily_disabling_notifications">5.3. Temporarily disabling notifications</a></li>
</ul>
</li>
<li>
<a href="#conditions">6. When notifications are generated and how to deal with them</a><ul class="sectlevel1">
<li><a href="#_introduction">6.1. Introduction</a></li>
<li><a href="#_scheduled_downtimes">6.2. Scheduled downtimes</a></li>
<li><a href="#_notification_periods">6.3. Notification periods</a></li>
<li><a href="#state_host">6.4. The state of the host on which a service is running</a></li>
<li><a href="#parents">6.5. Parent hosts</a></li>
<li><a href="#_disabling_notifications_using_rules">6.6. Disabling notifications using rules</a></li>
<li><a href="#_disabling_notifications_using_commands">6.7. Disabling notifications using commands</a></li>
<li><a href="#global">6.8. Disabling notifications globally</a></li>
<li><a href="#delaying">6.9. Delaying notifications</a></li>
<li><a href="#repeated_check_attempts">6.10. Repeated check attempts</a></li>
<li><a href="#flapping">6.11. Flapping hosts and services</a></li>
<li>
<a href="#_periodically_repeated_notifications_and_escalation">6.12. Periodically-repeated notifications and escalation</a><ul class="sectlevel2">
<li><a href="#_set_up_periodically_repeated_notifications">Set up periodically-repeated notifications</a></li>
<li><a href="#_set_up_escalations_and_understand_them">Set up escalations and understand them</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#path">7. The path of a notification from beginning to end</a><ul class="sectlevel1">
<li><a href="#history">7.1. The notification history</a></li>
<li><a href="#_the_components">7.2. The components</a></li>
<li>
<a href="#_the_monitoring_core">7.3. The monitoring core</a><ul class="sectlevel2">
<li><a href="#_raw_notifications">Raw notifications</a></li>
<li><a href="#_error_diagnosis_in_the_nagios_monitoring_core">Error diagnosis in the Nagios monitoring core</a></li>
<li><a href="#_error_diagnosis_in_the_cmc_monitoring_core">Error diagnosis in the CMC monitoring core</a></li>
</ul>
</li>
<li>
<a href="#_rule_evaluation_by_the_notification_module">7.4. Rule evaluation by the notification module</a><ul class="sectlevel2">
<li><a href="#_analysis_of_the_rule_chain">Analysis of the rule chain</a></li>
<li><a href="#_error_diagnosis">Error diagnosis</a></li>
</ul>
</li>
<li>
<a href="#async">7.5. Asynchronous delivery via the notification spooler</a><ul class="sectlevel2"><li><a href="#_error_diagnosis_2">Error diagnosis</a></li></ul>
</li>
</ul>
</li>
<li>
<a href="#bulk">8. Bulk notifications</a><ul class="sectlevel1">
<li><a href="#_overview_2">8.1. Overview</a></li>
<li><a href="#_bulk_notifications_and_time_periods">8.2. Bulk notifications and time periods</a></li>
</ul>
</li>
<li>
<a href="#syncsmtp">9. Traceable delivery per SMTP</a><ul class="sectlevel1">
<li><a href="#_email_is_not_reliable">9.1. Email is not reliable</a></li>
<li><a href="#_using_smtp_on_a_direct_connection_enables_error_analysis">9.2. Using SMTP on a direct connection enables error analysis</a></li>
<li><a href="#_synchronous_delivery_for_html_emails">9.3. Synchronous delivery for HTML emails</a></li>
<li><a href="#_sms_and_other_notification_methods">9.4. SMS and other notification methods</a></li>
</ul>
</li>
<li><a href="#distributed">10. Notifications in distributed systems</a></li>
<li>
<a href="#scripts">11. Notification scripts</a><ul class="sectlevel1">
<li><a href="#_the_principle_2">11.1. The principle</a></li>
<li><a href="#_traceable_notifications">11.2. Traceable notifications</a></li>
<li><a href="#example">11.3. A simple sample script</a></li>
<li><a href="#example_test">11.4. Testing the sample script</a></li>
<li><a href="#_environment_variables">11.5. Environment variables</a></li>
<li><a href="#_bulk_notifications">11.6. Bulk notifications</a></li>
<li><a href="#includedscripts">11.7. Supplied notification scripts</a></li>
</ul>
</li>
<li>
<a href="#files">12. Files and directories</a><ul class="sectlevel1">
<li><a href="#_paths_of_checkmk">12.1. Paths of Checkmk</a></li>
<li><a href="#maillog">12.2. SMTP server log files</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
