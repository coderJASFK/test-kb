<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Here you will learn how to piggyback monitoring data from a host when querying another host using Checkmk.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="The piggyback mechanism">
<meta name="og:description" content="Here you will learn how to piggyback monitoring data from a host when querying another host using Checkmk.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>The piggyback mechanism</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/de/piggyback.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/en/piggyback.html">2.2.0</a><a class="dropdown-item" href="../../latest/en/piggyback.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host and service parameters</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Introduction to notifications</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMWare ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Performance data and graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">The Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Configuration via the Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
<li>
<p><a href="web_api.html">Configuration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Command reference for the HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Writing your own check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>The piggyback mechanism</h1>
<div class="details">
<span id="revdate">Last modified on 23-Nov-2021</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/en/piggyback.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="wato_monitoringagents.html">Monitoring agents</a>
<a href="dcd.html">Dynamic host configuration</a>
<a href="monitoring_azure.html">Monitoring Microsoft Azure</a>
<a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a>
<a href="monitoring_kubernetes.html">Monitoring Kubernetes</a>
<a href="monitoring_docker.html">Monitoring Docker</a>
<a href="monitoring_vmware.html">Monitoring VMWare ESXi</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__introduction">
<span class="hidden-anchor sr-only" id="_introduction"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>The piggyback mechanism has been in place since the early days of Checkmk — as a
part of the monitoring of <a href="monitoring_vmware.html">VMware</a>.
Here is a situation in which data needs to be queried from a particular host
because the data is located only on that host (for example, from an ESX host
system or the vCenter), but in the monitoring the data relates to a completely
different host (a virtual machine for example).</p></div>
<div class="paragraph"><p>This cannot be realized with the normal mechanism in Checkmk because this
automatically assigns data and services that it fetches from a host. It would
also be very impractical for a monitoring if all information for all VMs always
appeared directly at the ESX host or even the vCenter.</p></div>
<div class="paragraph"><p>The term ‘piggyback’ describes the process by which monitoring data for host <em>B</em>
is <em>piggybacked</em> (so to speak) with the data queried from host <em>A</em>.</p></div>
<div class="paragraph"><p>These days piggyback is used in many other monitoring plug-ins,
e.g. when monitoring</p></div>
<div class="ulist"><ul>
<li><p><a href="monitoring_aws.html">AWS</a></p></li>
<li><p><a href="monitoring_azure.html">Azure</a></p></li>
<li><p><a href="monitoring_docker.html">Docker</a></p></li>
<li><p><a href="monitoring_kubernetes.html">Kubernetes</a></p></li>
<li><p>Proxmox VE</p></li>
<li><p><a href="monitoring_vmware.html">VMware</a></p></li>
</ul></div>
<div class="paragraph"><p>In addition to virtualization environments, the piggyback mechanism can also be used for the
monitoring of mobile devices or climate monitoring in the data center (MQTT).
Since the query interfaces are very simple, it is very easy to use the piggyback mechanism yourself.
You can use it, for example, when implementing your own check plug-ins
to map data from one source to any other host.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__the_piggyback_principle">
<span class="hidden-anchor sr-only" id="_the_piggyback_principle"></span>2. The piggyback principle</h2>
<div class="sectionbody">
<div class="paragraph"><p>The basic principle of piggyback works as shown in the following diagram.
Host <em>A</em> not only has its own monitoring data, but also that from other
hosts — or more generally from other objects.
For example, an ESX host records the state and many current metrics for each of
its VMs. This host <em>A</em> is sometimes referred to as the <em>source host</em>
in this context.</p></div>
<div class="paragraph"><p>If Checkmk now retrieves the monitoring data from <em>A</em> in its regular
one-minute intervals — be it from the normal Checkmk agent or from a special
agent via a manufacturer’s API — in the response it also receives
specially-marked reporting data from the other hosts/objects <em>B</em>, <em>C</em>,
and so on. This <em>piggyback data</em> is then placed in files on the Checkmk
server for later processing. The hosts <em>B</em>, <em>C</em>, and so on are
referred to as <em>piggybacked hosts</em>.</p></div>
<div class="paragraph"><p>If Checkmk later requires the monitoring data from <em>B</em> or <em>C</em>,
they are already in the local files and can be processed directly without having
to query an agent:</p></div>
<div class="imageblock"><div class="content"><img src="../images/piggyback_scheme_1.png" alt="Schematic representation of indirect data forwarding via the piggyback mechanism." width="50%"></div></div>
<div class="paragraph"><p>It is also possible and useful to combine normal monitoring and piggybacking.
Let’s take the example of VMware again: You may have installed a Checkmk agent in
your VM <em>B</em> which evaluates local information from the VM that is not known
to the ESX host (e.g., processes running in the VM).
In this case <em>not only</em> will the agent be queried, <em>but</em> its data will
<em>also</em> be combined with the piggyback data received from host <em>A</em>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/piggyback_scheme_2.png" alt="Schematic representation of combined data forwarding: part of the data comes via Piggyback, the rest directly from the monitored host." width="50%"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_piggyback_in_practice">
<span class="hidden-anchor sr-only" id="piggyback_in_practice"></span>3. Piggyback in practice</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__setting_up_piggyback">
<span class="hidden-anchor sr-only" id="_setting_up_piggyback"></span>3.1. Setting up piggyback</h3>
<div class="paragraph"><p>First the good news — The piggyback mechanism often works completely automatically:</p></div>
<div class="ulist"><ul>
<li><p>If piggyback data for other hosts is detected when querying <em>A</em> they are automatically saved for later evaluation.</p></li>
<li><p>If piggyback data from another host is found when querying <em>B</em> it will be used automatically.</p></li>
</ul></div>
<div class="paragraph"><p>However — as usual in Checkmk — everything is configurable.
Namely, in the properties of a host (such as host <em>B</em> ) in the
<span class="guihint">Monitoring agents</span> box you can set how it should react to existing or missing
piggyback data:</p></div>
<div class="imageblock"><div class="content"><img src="../images/piggyback_settings.png" alt="Piggyback data redirection is defined in the agent settings."></div></div>
<div class="paragraph"><p>The default is <span class="guihint">Use piggyback data from other hosts if present</span>.
If available, piggyback data is used, and if none is there the host just uses
its ‘own’ monitoring data.</p></div>
<div class="paragraph"><p>With the <span class="guihint">Always use and expect piggyback data</span> setting you <em>force</em> the
processing of piggyback data. If the data is missing or outdated the
<span class="guihint">Check_MK</span> service will issue a warning.</p></div>
<div class="paragraph"><p>And with <span class="guihint">Never use piggyback data</span> any piggyback data found is simply
ignored — a setting that you’ll only need in exceptional cases.</p></div>
</div>
<div class="sect2">
<h3 id="heading__hosts_must_be_present">
<span class="hidden-anchor sr-only" id="_hosts_must_be_present"></span>3.2. Hosts must be present</h3>
<div class="paragraph"><p>Of course for a host to process piggyback data the host itself must be present
in the monitoring. In the example of ESX this means that you must also have your
VMs as hosts in Checkmk so that they are actually monitored.</p></div>
<div class="paragraph"><p>Meanwhile, you can automate this using the
<a href="dcd.html">dynamic configuration</a> and automatically create
hosts for which piggyback data is available.</p></div>
</div>
<div class="sect2">
<h3 id="heading_renamehosts">
<span class="hidden-anchor sr-only" id="renamehosts"></span>3.3. Host names and their assignments</h3>
<div class="paragraph"><p>In the above schemes it was somehow logical that the data from object <em>B</em>
was assigned to host <em>B</em> in the monitoring. But what <em>exactly</em> is B?</p></div>
<div class="paragraph"><p>With the piggyback mechanism the assignment always uses a <em>name</em>.
The (special) agent writes an object name for each set of piggyback data.
In the case of ESX, e.g. the name of the virtual machine.
Some plug-ins — such as <a href="monitoring_docker.html">Docker</a> — also have several options
for what should be used as a name.</p></div>
<div class="paragraph"><p>For the mapping to work correctly, the name of the matching host in Checkmk must
of course be identical — including upper and lower case.</p></div>
<div class="paragraph"><p>But what happens if the names of objects in the piggyback data are inappropriate
or undesirable for monitoring?
For this there is the special <span class="guihint">Hostname translation for piggybacked hosts</span> <a href="wato_rules.html">rule set</a>, which you can find in the Setup menu under <span class="guihint">Setup &gt; Agents &gt; Agent access rules</span>.</p></div>
<div class="paragraph"><p>To configure a rename you will need to do two things:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Create a rule and set the condition to access the <em>source host</em> – ie. host <em>A</em>.</p></li>
<li><p>Create a suitable name assignment value in the rule.</p></li>
</ol></div>
<div class="paragraph"><p>Here is an example of the value in a rule.
Two things are configured: first, all host names from the piggyback data are
converted to lowercase letters.
Then the two hosts <code>vm0815</code> or <code>vm0816</code> are also converted to the
Checkmk host’s <code>mylnxserver07</code> or <code>mylnxserver08</code> :</p></div>
<div class="imageblock"><div class="content"><img src="../images/piggyback_hostname_translation.png" alt="Options for 'hostname translation', removing the domain part, conversion to lowercase or explicit mapping."></div></div>
<div class="paragraph"><p>More flexible is the method using <a href="regexes.html">regular expressions</a> found under
<span class="guihint">Multiple regular expressions</span>.
This is useful if the renaming of many hosts is necessary, and it is done
according to a specific scheme.
Proceed as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Activate the <span class="guihint">Multiple regular expressions</span> option.</p></li>
<li><p>Add a translation entry with the <span class="guihint">Add expression</span> button — two fields will appear.</p></li>
<li><p>In the first field — <span class="guihint">Regular expression</span> — enter a regular expression that matches the original object name and which contains at least one subgroup – that is, a subexpression enclosed in parentheses. For a good explanation of these groups <a href="regexes.html#matchgroups">see the article on regular expressions</a>.</p></li>
<li><p>In <span class="guihint">Replacement</span> specify a schema for the desired target host name in which the values that were ‘trapped’ with the subgroups will be replaced by <code>\1</code>, <code>\2</code>, etc.</p></li>
</ol></div>
<div class="paragraph"><p>An example of a regular expression would be, for example <code>vm(.*)-local</code>.
The substitute value <code>myvm\1</code> would then translate the name
<code>vmharri-local</code> into <code>myvmharri</code>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__the_technology_behind_this_process">
<span class="hidden-anchor sr-only" id="_the_technology_behind_this_process"></span>4. The technology behind this process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__transport_of_the_piggyback_data">
<span class="hidden-anchor sr-only" id="_transport_of_the_piggyback_data"></span>4.1. Transport of the piggyback data</h3>
<div class="paragraph"><p>As described above, the piggyback data is also transported to other hosts with
the agent output from the source host.
The output from the Checkmk agent is a simple text-based format which is shown in
<a href="wato_monitoringagents.html">the article on monitoring agents</a>.</p></div>
<div class="paragraph"><p>What’s new is that a line is allowed in the output that starts with
<code>&lt;&lt;&lt;&lt;</code> and ends with <code>&gt;&gt;&gt;&gt;</code>.
In between is a host name. All further monitoring data starting from this line is
then assigned to this host.
Here is an example excerpt that assigns the section
<code>&lt;&lt;&lt;esx_vsphere_vm&gt;&gt;&gt;</code> to the host <code>316-VM-MGM</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>&lt;&lt;&lt;&lt;316-VM-MGM&gt;&gt;&gt;&gt;
&lt;&lt;&lt;esx_vsphere_vm&gt;&gt;&gt;
config.datastoreUrl url /vmfs/volumes/55b643e1-3f344a10-68eb-90b11c00ff94|uncommitted 12472944334|name EQLSAS-DS-04|type VMFS|accessible true|capacity 1099243192320|freeSpace 620699320320
config.hardware.memoryMB 4096
config.hardware.numCPU 2
config.hardware.numCoresPerSocket 2
guest.toolsVersion 9537
guest.toolsVersionStatus guestToolsCurrent
guestHeartbeatStatus green
name 316-VM-MGM</code></pre></div></div>
<div class="paragraph"><p>A line with the content <code>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;</code> can be used to
end this assignment. Any further output then belongs again to the source host.</p></div>
<div class="paragraph"><p>When processing the agent output Checkmk extracts the parts intended for other hosts
and places them in files under <code>tmp/check_mk/piggyback</code>.
Below this is a subdirectory for each target host
(for example, for each VM) — that is if we stick to our example with the
name <code>B</code>.
In this subdirectory there will then be a separate file with the actual data
from each source host. Their names would be <code>A</code> in our example.
Why is this so complicated? Well — one host can indeed get piggyback data from
<em>multiple</em> hosts, so a single file would not be enough.</p></div>
<div class="paragraph"><p><strong>Tip:</strong> If you are curious about what the piggyback data looks like,
look up the agent output from your monitoring site’s hosts in the
<code>tmp/check_mk/cache</code> directory. An overview of all involved files and
directories can be found <a href="#files">below</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_orphaned_piggyback_data">
<span class="hidden-anchor sr-only" id="orphaned_piggyback_data"></span>4.2. Orphaned piggyback data</h3>
<div class="paragraph"><p>If you are working in an environment where hosts automatically change the source host,
we recommend using the <a href="dcd.html">dynamic host configuration</a>.
If you cannot or do not want to use dynamic host configuration, for example, because virtual machines are moved manually,
you may receive piggyback data from a host that you have not even created in Checkmk.
This may be intentional, but it may also be an error — e.g. because a name is not an exact match.</p></div>
<div class="paragraph"><p>In the ‘Treasures’ section you will find a script called
<code>find_piggy_orphans</code> with which your Checkmk can search for piggyback data
for which there is no host in monitoring.
Simply call this script without any arguments.
The script will output a list with one line — sorted by name — for each
non-monitored piggybacked host found:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>share/doc/check_mk/treasures/find_piggy_orphans
<span class="tok-go">fooVM01</span>
<span class="tok-go">barVM02</span></code></pre></div></div>
<div class="paragraph"><p>This output is ‘clean’ and can, for example, be processed in a script.</p></div>
</div>
<div class="sect2">
<h3 id="heading__piggyback_in_distributed_environments">
<span class="hidden-anchor sr-only" id="_piggyback_in_distributed_environments"></span>4.3. Piggyback in distributed environments</h3>
<div class="paragraph"><p>Note that currently in <a href="distributed_monitoring.html">distributed environments</a> the source host and the piggybacked hosts must be monitored in the same site.
This is simply because — for efficiency reasons — the transmission of data between the hosts is done by using local file exchange running via the <code>tmp/check_mk</code> directory.</p></div>
<div class="paragraph"><p>Future versions of Checkmk may provide a mechanism allowing the optional
transmission of piggyback data across site boundaries.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>5. Files and directories</h2>
<div class="sectionbody"><div class="sect2">
<h3 id="heading__file_paths_on_the_checkmk_server">
<span class="hidden-anchor sr-only" id="_file_paths_on_the_checkmk_server"></span>5.1. File paths on the Checkmk server</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/check_mk/piggyback/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage location for piggyback data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/check_mk/piggyback/B/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory for piggyback data <em>for</em> Host <em>B</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/check_mk/piggyback/B/A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File with piggyback data <em>from</em> Host <em>A</em> <em>for</em> Host <em>B</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/check_mk/piggyback_sources/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta information for the hosts creating piggyback data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/check_mk/cache/A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Agent output from Host <em>A</em> — including any existing piggyback data in a raw-format</p></td>
</tr>
</tbody>
</table>
</div></div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_the_piggyback_principle">2. The piggyback principle</a></li>
<li>
<a href="#piggyback_in_practice">3. Piggyback in practice</a><ul class="sectlevel1">
<li><a href="#_setting_up_piggyback">3.1. Setting up piggyback</a></li>
<li><a href="#_hosts_must_be_present">3.2. Hosts must be present</a></li>
<li><a href="#renamehosts">3.3. Host names and their assignments</a></li>
</ul>
</li>
<li>
<a href="#_the_technology_behind_this_process">4. The technology behind this process</a><ul class="sectlevel1">
<li><a href="#_transport_of_the_piggyback_data">4.1. Transport of the piggyback data</a></li>
<li><a href="#orphaned_piggyback_data">4.2. Orphaned piggyback data</a></li>
<li><a href="#_piggyback_in_distributed_environments">4.3. Piggyback in distributed environments</a></li>
</ul>
</li>
<li>
<a href="#files">5. Files and directories</a><ul class="sectlevel1"><li><a href="#_file_paths_on_the_checkmk_server">5.1. File paths on the Checkmk server</a></li></ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
