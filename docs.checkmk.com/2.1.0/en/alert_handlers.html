<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Some problems occur only rarely and with a short duration. Checkmk can then run alert handler scripts to collect information for analysis.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Alert handlers - Responding to problems automatically">
<meta name="og:description" content="Some problems occur only rarely and with a short duration. Checkmk can then run alert handler scripts to collect information for analysis.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Alert handlers - Responding to problems automatically</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/de/alert_handlers.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/en/alert_handlers.html">2.2.0</a><a class="dropdown-item" href="../../latest/en/alert_handlers.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginnerâ€™s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host and service parameters</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Introduction to notifications</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMWare ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Performance data and graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">The Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Configuration via the Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
<li>
<p><a href="web_api.html">Configuration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Command reference for the HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Writing your own check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Alert handlers</h1>
<div class="details">
<span id="revdate">Last modified on 13-Feb-2017</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/en/alert_handlers.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="notifications.html">Notifications</a>
<a href="commands.html">Commands</a>
<a href="wato_monitoringagents.html">Monitoring agents</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__introduction">
<span class="hidden-anchor sr-only" id="_introduction"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__should_the_monitoring_intervene">
<span class="hidden-anchor sr-only" id="_should_the_monitoring_intervene"></span>1.1. Should the monitoring intervene?</h3>
<div class="paragraph"><p>One would think it obvious that a monitoring system should never intervene in events -
but rather that it should, well, monitor.
And itâ€™s probably a good idea to leave it at that.</p></div>
<div class="paragraph"><p>It is however an admittedly attractive notion that a system which can reliably identify
problems could also correct these, provided that it could function automatically.</p></div>
<div class="paragraph"><p>A few suitable examples can be easily imagined:</p></div>
<div class="ulist"><ul>
<li><p>Restarting a service that has crashed.</p></li>
<li><p>The triggering of a garbage collector if a Java-VM is running out of memory.</p></li>
<li><p>The rebuilding of a VPN channel if it is definitely dead.</p></li>
</ul></div>
<div class="paragraph"><p>If one can accept this, then one must think differently about monitoring.
From a system that simply observes and is 'not necessary' for operations,
a step by step process leads to monitoring becoming a vital organ in the processing center.</p></div>
<div class="paragraph"><p>But correcting problems is not the only thing that monitoring can do automatically
when it identifies a problem.
Very useful, but also harmless is the collection of
additional diagnostic data at the moment of a failure!
You could no doubt offhand think of numerous further issues with which one
could use <strong>Alert handlers</strong> as a starting point.</p></div>
</div>
<div class="sect2">
<h3 id="heading__alert_handlers_in_checkmk">
<span class="hidden-anchor sr-only" id="_alert_handlers_in_checkmk"></span>1.2. Alert handlers in Checkmk</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Alert handlers are scripts you write yourself, that are run for you by Checkmk if
a problem is detected - or more precisely - if a host or service changes its status.</p></div>
<div class="paragraph"><p>Alert handlers are very similar to <a href="notifications.html">notifications</a> and are similarly configured,
but there are a few important differences:</p></div>
<div class="ulist"><ul>
<li><p>Alert handlers are independent of <a href="basics_downtimes.html">Downtimes</a>, notifications periods, <a href="basics_ackn.html">Acknowledgements</a> and similar controls.</p></li>
<li><p>Alert handlers will be activated by the first retry (if multiple check attempts have been configured).</p></li>
<li><p>Alert handlers are independent of users and contact groups.</p></li>
<li><p>Alert handlers are only available in the <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong>.</p></li>
</ul></div>
<div class="paragraph"><p>One can also say that alert handlers are very 'low level'. As soon as a host or
service changes its status, your configured alert handler will
be <em>immediately</em> activated. In this manner an alert handler can even perform
a repair successfully before an actual alert is generated.</p></div>
<div class="paragraph"><p>You can naturally - as always in Checkmk - use rules to define the conditions
for which a particular handler should be executed.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
A further tip for <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> users: monitoring can also be enabled to execute
actions automatically. Use Nagiosâ€™s 'Event Handler' for this.
Configure this with manual configuration files in Nagios-Syntax under
<code>~/etc/nagios/conf.d/</code>. The event handlers are well documented.
Information can be found simply via
<a href="https://www.google.com/search?q=nagios+event+handlers">Google</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_setup">
<span class="hidden-anchor sr-only" id="setup"></span>2. Setting up alert handlers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__saving_scripts_in_the_correct_directory">
<span class="hidden-anchor sr-only" id="_saving_scripts_in_the_correct_directory"></span>2.1. Saving scripts in the correct directory</h3>
<div class="paragraph"><p>Alert handlers are scripts that are run on the Checkmk server. They must be stored in
the <code>~/local/share/check_mk/alert_handlers/</code> directory, and may be coded in any
Linux-supported language, e.g., BASH, Python or Perl. Please donâ€™t forget to make the
scripts executable (<code>chmod +x â€¦â€‹</code>).</p></div>
<div class="paragraph"><p>New from <span class="new">1.4.0</span>: if a comment is inserted into the second line
of the script (with a <code>#</code> hash), this will appear as the scriptâ€™s name in
the ruleâ€™s selection list:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/alert_handlers/myhandler</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Foobar handler for repairing stuff
...</code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__a_simple_alert_handler_to_try_out">
<span class="hidden-anchor sr-only" id="_a_simple_alert_handler_to_try_out"></span>2.2. A simple alert handler to try out</h3>
<div class="paragraph"><p>As with <a href="notifications.html">notifications</a> the script obtains all information for
the host or service as environment variables, all of which begin with
the <code>ALERT_</code> prefix.</p></div>
<div class="paragraph"><p>To test exactly which environment variables appear in the script, you can use
the following alert handler for a test:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/alert_handlers/debug</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Dump all variables to ~/tmp/alert.out

env | grep ^ALERT_ | sort &gt; $OMD_ROOT/tmp/alert.out</code></pre></div>
</div>
<div class="ulist"><ul>
<li><p><code>env</code> outputs all environment variables</p></li>
<li><p><code>grep ^ALERT_</code> selects those that begin with <code>ALERT_</code></p></li>
<li><p><code>sort</code> sort the resulting list alphabetically</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__activating_alert_handlers">
<span class="hidden-anchor sr-only" id="_activating_alert_handlers"></span>2.3. Activating alert handlers</h3>
<div class="paragraph"><p>The handler activation is performed using the <span class="image-inline"><img src="../images/icons/icon_alert_handlers.png" alt="icon alert handlers"></span> <span class="guihint">Alert handlers</span> Setup module.</p></div>
<div class="paragraph"><p>Proceed as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Save the script in <code>~/local/share/check_mk/alert_handlers/debug</code>.</p></li>
<li><p>Make it executable with <code>chmod +x debug</code>.</p></li>
<li><p>Call up the configuration page via <span class="guihint">Setup &gt; Events &gt; Alert handlers</span>.</p></li>
<li><p>There, define a new rule with <span class="guihint">Add rule</span>.</p></li>
</ol></div>
<div class="paragraph"><p>The mask for selecting the handler
allows direct access and shows the title which is logged in the second line of the script. Additionally you may add arguments, which you enter in the text fields. These will be interpreted as commandline arguments in the script. On your shell you may access them with <code>$1</code>, <code>$2</code>, etc.</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handler_arguments.png" alt="alert handler arguments"></div></div>
<div class="paragraph"><p><strong>Important</strong>: After saving the rule the alert handler will be immediately active and will
run with every change of status for any host oder service!</p></div>
</div>
<div class="sect2">
<h3 id="heading__test_and_fault_diagnoses">
<span class="hidden-anchor sr-only" id="_test_and_fault_diagnoses"></span>2.4. Test and fault diagnoses</h3>
<div class="paragraph"><p>To test, manually set a service, for example, <span class="guihint">Fake check results</span> to <span class="state2">CRIT</span>.
Now the file should have been created with the variables.
Here are its first twenty lines:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>head<span class="tok-w"> </span>-n<span class="tok-w"> </span><span class="tok-m">20</span><span class="tok-w"> </span>~/tmp/alert.out
<span class="tok-go">ALERT_ALERTTYPE=STATECHANGE</span>
<span class="tok-go">ALERT_CONTACTNAME=check-mk-notify</span>
<span class="tok-go">ALERT_CONTACTS=</span>
<span class="tok-go">ALERT_DATE=2016-07-19</span>
<span class="tok-go">ALERT_HOSTADDRESS=127.0.0.1</span>
<span class="tok-go">ALERT_HOSTALIAS=myserver123</span>
<span class="tok-go">ALERT_HOSTATTEMPT=1</span>
<span class="tok-go">ALERT_HOSTCHECKCOMMAND=check-mk-host-smart</span>
<span class="tok-go">ALERT_HOSTCONTACTGROUPNAMES=all</span>
<span class="tok-go">ALERT_HOSTDOWNTIME=0</span>
<span class="tok-go">ALERT_HOSTFORURL=myserver123</span>
<span class="tok-go">ALERT_HOSTGROUPNAMES=check_mk</span>
<span class="tok-go">ALERT_HOSTNAME=myserver123</span>
<span class="tok-go">ALERT_HOSTNOTESURL=</span>
<span class="tok-go">ALERT_HOSTNOTIFICATIONNUMBER=1</span>
<span class="tok-go">ALERT_HOSTOUTPUT=Packet received via smart PING</span>
<span class="tok-go">ALERT_HOSTPERFDATA=</span>
<span class="tok-go">ALERT_HOSTPROBLEMID=0</span>
<span class="tok-go">ALERT_HOSTSHORTSTATE=UP</span>
<span class="tok-go">ALERT_HOSTSTATE=UP</span></code></pre></div></div>
<div class="paragraph"><p>A log file for the alert handlerâ€™s (non-)execution will be found
in <code>var/log/alerts.log</code>.
The section for the execution of handler <code>debug</code>,
for the service <code>Filesystem /</code> on host <code>myserver123</code>
will look something like this:</p></div>
<div class="listingblock">
<div class="title">var/log/alerts.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2016-07-19 15:17:22 Got raw alert (myserver123;Filesystem /) context with 60 variables
2016-07-19 15:17:22 Rule ''...
2016-07-19 15:17:22  -&gt; matches!
2016-07-19 15:17:22 Executing alert handler debug for myserver123;Filesystem /
2016-07-19 15:17:22 Spawned event handler with PID 6004
2016-07-19 15:17:22 1 running alert handlers:
2016-07-19 15:17:22 PID: 6004, object: myserver123;Filesystem /
2016-07-19 15:17:24 1 running alert handlers:
2016-07-19 15:17:24 PID: 6004, object: myserver123;Filesystem /
2016-07-19 15:17:24 Handler [6004] for myserver123;Filesystem / exited with exit code 0.
2016-07-19 15:17:24 Output:</code></pre></div>
</div>
<div class="paragraph"><p>A couple of further useful tips:</p></div>
<div class="ulist"><ul>
<li><p>Texts produced by alert handlers on the standard version appear in the log file alongside <code>Output:</code>.</p></li>
<li><p>The scriptâ€™s exit code will also be logged (<code>exited with exit code 0</code>).</p></li>
<li><p>Alert handlers really become useful when they execute a command on the target host. Checkmk offers a ready solution for Linux that will be explained later <a href="#linux_remote">see below</a>.</p></li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__rules_based_configuration">
<span class="hidden-anchor sr-only" id="_rules_based_configuration"></span>3. Rules based configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p>As shown in the introductory example, which events should trigger
alert handlers are defined via rules.
This functions completely analogous to <a href="notifications.html">Notifications</a>,
only somewhat simplified.
In the example we specified no prerequisites, which is naturally unrealistic in practice.
The following example shows a prerequisite that an alert handler defines for
specific hosts and services:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_rule_condition.png" alt="alert handlers rule condition"></div></div>
<div class="ulist"><ul>
<li><p>The alert handler will only be triggered for the hosts <code>myhost123</code> and <code>myhost124</code>â€¦â€‹</p></li>
<li><p>â€¦â€‹ and only for the service <code>JVM CaramKern Memory</code></p></li>
<li><p>â€¦â€‹ and only if the state changes from <span class="state0">OK</span> or <span class="state1">WARN</span> to <span class="state2">CRIT</span></p></li>
<li><p>â€¦â€‹ and then only at the second check attempt.</p></li>
</ul></div>
<div class="paragraph"><p>In order for the handler to be triggered, in this example it is necessary to use
a rule <span class="guihint">Maximum number of check attempts for service</span> to set the minimum
number of check attempts at 2.
In order to suppress a notification in the case of a successful garbage collector
the number should be set to 3 - since if the handler can solve the problem directly
following the second attempt, the third attempt should detect an <span class="state0">OK</span> state
and therefore no further notification will be necessary.</p></div>
<div class="paragraph"><p>Please note: Unlike other places in Checkmk <strong>every</strong> alert handler rule
will be executed if the conditions are matching. Even if two rules calling the
same handler these handler will indeed run two times. The alert helper will
suppress the second execution with an error message since the same handler
must not run multiple times at the same time. Still it is recommended to
set up the rules that this case will not appear.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_execution">
<span class="hidden-anchor sr-only" id="execution"></span>4. How alert handlers are executed</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__asynchronous_execution">
<span class="hidden-anchor sr-only" id="_asynchronous_execution"></span>4.1. Asynchronous execution</h3>
<div class="paragraph"><p>Alert handlers are very often used to log in to an affected machine remotely
using SSH or another protocol, and once there execute a script-controlled action.
Since this machine is experiencing a problem, it cannot be excluded that connecting
takes a long time or even goes into a timeout.</p></div>
<div class="paragraph"><p>So that the monitoring is not allowed to stand still, or other alert handlers
stalled during this time, as a matter of principle alert handlers are run <em>asynchronously</em>.
An auxiliary process - the alert helper - is responsible for this function,
and it is started by the <a href="cmc.html">CMC</a>.
To reduce overhead, this only occurs if a minimum of one alert handler rule has been created.
In the <code>cmc.log</code> you will then see the following line:</p></div>
<div class="listingblock">
<div class="title">var/log/cmc.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2016-07-19 15:17:00 [5] Alert handlers have been switched on</code></pre></div>
</div>
<div class="paragraph"><p>With every change of state for a host or service, the alert helper receives a
notification from the CMC containing all information relevant to the event.
It then evaluates all alert rules and determines whether a handler should be triggered.
If yes, the appropriate script will be started and run in the background as an external process.</p></div>
</div>
<div class="sect2">
<h3 id="heading__stopping_the_core">
<span class="hidden-anchor sr-only" id="_stopping_the_core"></span>4.2. Stopping the core</h3>
<div class="paragraph"><p>When you stop the CMC (e.g. via <code>omd stop</code> or by shutting the monitoring server down),
all alert helpers still running will be <strong>aborted</strong>.
These will <strong>not be repeated</strong> later - since who knows when 'later' will be?
Itâ€™s possible that restarting a service or similar may be more damaging than useful!</p></div>
</div>
<div class="sect2">
<h3 id="heading__timeouts">
<span class="hidden-anchor sr-only" id="_timeouts"></span>4.3. Timeouts</h3>
<div class="paragraph"><p>In order to protect itself from too many processes being started in the case of an error situation,
when an alert handler is running a 60 second (settable) timeout is in force.
At the end of this time the handler will be stopped. From version
<span class="new">1.4.0</span> it is regulated that at the end of a timeout a
Signal 15 (<code>SIGTERM</code>) will be sent to the handler.
In this way it has the possibility to stop itself cleanly. After a further 60 seconds
(double timeout) it will then be 'terminated' finally with a Signal 9 (<code>SIGKILL</code>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__overlaying">
<span class="hidden-anchor sr-only" id="_overlaying"></span>4.4. Overlaying</h3>
<div class="paragraph"><p>From version <span class="new">1.4.0</span> Checkmk precludes the simultaneous running of alert
helpers if they apply to the same host/service and would run the same script with the same parameters.
Such a situation indicates that the first handler is still running and that it would make no
sense to start a second copy of the same handler - the second handler would be instantly
cancelled and identified as 'failed'.</p></div>
</div>
<div class="sect2">
<h3 id="heading__exit_status_and_output_from_handlers">
<span class="hidden-anchor sr-only" id="_exit_status_and_output_from_handlers"></span>4.5. Exit status and output from handlers</h3>
<div class="paragraph"><p>The alert handlerâ€™s outputs and exit codes are reliably evaluated and returned
to the core where it is saved in the monitoring history. Furthermore you can
trigger a notification <a href="#notification">below</a>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__global_settings">
<span class="hidden-anchor sr-only" id="_global_settings"></span>4.6. Global settings</h3>
<div class="paragraph"><p>There are a number of global settings for executing alert handlers:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_options.png" alt="alert handlers options"></div></div>
<div class="paragraph"><p>The <span class="guihint">Alert handler log level</span> influences the logging in the alert helper
(<code>alerts.log</code>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__master_control">
<span class="hidden-anchor sr-only" id="_master_control"></span>4.7. Master control</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/alert_handlers_master_control_off.png" alt="alert handlers master control off" width="280"></div></div>
<div class="paragraph"><p>With a click in the <span class="guihint">Master control</span> you can deactivate alert handlers globally.
Currently running handlers will <em>not</em> be affected and will run to completion.</p></div>
<div class="paragraph"><p>Please donâ€™t forget to reset the small switch to green as soon as practicable! Otherwise you
could be deceived by a false sense of security that the monitoring is fixing everythingâ€¦â€‹
<br>
<br></p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__alert_handlers_in_the_history">
<span class="hidden-anchor sr-only" id="_alert_handlers_in_the_history"></span>5. Alert handlers in the history</h2>
<div class="sectionbody">
<div class="paragraph"><p>Since version <span class="new">1.4.0</span> alert handlers have created entries in the monitoring history.
With this you have a better traceability compared to only having the <code>alerts.log</code> log file.
An entry is created as soon as an alert handler starts and another when it ends.</p></div>
<div class="paragraph"><p>The alert handlers are thus regarded in the same way as typical monitoring plug-ins -
that means they should produce one line of text and return one of the four exit codes 0 (<span class="state0">OK</span>),
1 (<span class="state1">WARN</span>), 2 (<span class="state2">CRIT</span>) or 3 (<span class="state3">UNKNOWN</span>). All errors that from the outset prevent a handlerâ€™s execution
(abortion due to duplicate execution, script missing, timeout, etc.) are automatically flagged with <span class="state3">UNKNOWN</span>.</p></div>
<div class="paragraph"><p>For example - calling this very simple handlerâ€¦â€‹</p></div>
<div class="listingblock">
<div class="title">local/share/check_mk/alert_handlers/dummy</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Dummy handler for testing

sleep 3
echo "Everything is fine again"
exit 0</code></pre></div>
</div>
<div class="paragraph"><p>... produces a result as above in the relevant serviceâ€™s history
(as always the newest message is at the top):</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handler_history.png" alt="alert handler history"></div></div>
<div class="paragraph"><p>There is also a generic view <span class="guihint">Monitor &gt; System Alert handler executions</span>, which provides a global display of all executing alert handlers.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_notification">
<span class="hidden-anchor sr-only" id="notification"></span>6. Notification via alert handlers</h2>
<div class="sectionbody">
<div class="paragraph"><p>The execution of an alert handlerâ€‰â€”â€‰or more exactly, the <em>completion</em> of an executionâ€‰â€”â€‰is an event that triggers a <a href="notifications.html">notification</a>.
This way you can be informed that a handler has completed its task.
There are additionally two new types of event that you can filter in a notification rule:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handler_notif_condition.png" alt="alert handler notif condition"></div></div>
<div class="paragraph"><p>You can thus differentiate between successfully executed handlers (Exitcode 0 - <span class="state0">OK</span>),
and failures (all other codes).
The email notifications in Checkmk have been adapted so that alert handler notifications,
instead of displaying results from checks now display results from alert handlers.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__handlers_for_every_check_execution">
<span class="hidden-anchor sr-only" id="_handlers_for_every_check_execution"></span>7. Handlers for every check execution</h2>
<div class="sectionbody">
<div class="paragraph"><p>Alert handlers are normally only called up when the state of a host or service changes
(or during retry attempts when handling problems). Simple check executions without a change of state
trigger no alert handlers.</p></div>
<div class="paragraph"><p>With the
<span class="guihint">Alert handlers &gt; Types of events that are being processed &gt; All check executions!</span> global option
you can arrange exactly that.
<strong>Every</strong> execution of a check can potentially trigger an alert handler.
You can, for example, use this to transfer data from the active monitoring to other systems.</p></div>
<div class="paragraph"><p>Please be careful with this setting! Starting processes and calling up scripts consumes a lot
of CPU resources. Checkmk can easily run 1000 checks per second - but Linux certainly couldnâ€™t
handle 1000 alert handler scripts per second.</p></div>
<div class="paragraph"><p>In order to make this usefully possible, Checkmk provides the option to write alert
handlers as <strong>Python functions</strong>, which then run inline - without process creation.
Such inline handlers can be saved in the same directory as the normal handler scripts.
The following functioning example shows the structure of an inline handler:</p></div>
<div class="listingblock">
<div class="title">local/share/check_mk/alert_handlers/foo</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/usr/bin/python
# Inline: yes

# Do some basic initialization (optional)
def handle_init():
    log("INIT")

# Called at shutdown (optional)
def handle_shutdown():
    log("SHUTDOWN")

# Called at every alert (mandatory)
def handle_alert(context):
    log("ALERT: %s" % context)</code></pre></div>
</div>
<div class="paragraph"><p>This script has no central function, rather it simply defines three functions,
although only the <code>handle_alert(â€¦â€‹)</code> function is required.
This is called up following every check execution and in its argument <code>context</code>
receives a Python-Dictionary with variables such as <code>"HOSTNAME"</code>,
<code>"SERVICEOUTPUT"</code>, etc. These represent the environmentâ€™s variables that the
normal handlers also receive - however here without the <code>ALERT_</code> prefix.
The above example can be used in order to view the contents of <code>context</code>.</p></div>
<div class="paragraph"><p>All outputs produced by the <code>log()</code> auxiliary function are saved to <code>var/log/alert.log</code>.
Both of the global variables <code>omd_root</code> and <code>omd_site</code> are based on the
home directory and the Checkmk-Instanceâ€™s name respectively.</p></div>
<div class="paragraph"><p>The <code>handle_init()</code> and <code>handle_shutdown()</code> functions are called up by
Checkmk when starting or stopping the monitoring core and enable an
intialisation - for example when establishing a connection to a data base.</p></div>
<div class="paragraph"><p>Additional information:</p></div>
<div class="ulist"><ul>
<li><p>Please note the <strong># Inline: yes</strong> in the second line.</p></li>
<li><p>The core must be restarted after every change in the script (<code>omd restart cmc</code>).</p></li>
<li><p><code>Import</code>-commands are permitted.</p></li>
<li><p>The Checkmk alert helpers call up their functions <strong>synchronously</strong>. Make sure that no wait states occur!</p></li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_linux_remote">
<span class="hidden-anchor sr-only" id="linux_remote"></span>8. Remote execution under Linux</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__basic_principles">
<span class="hidden-anchor sr-only" id="_basic_principles"></span>8.1. Basic principles</h3>
<div class="paragraph"><p>Version <span class="new">1.4.0</span> includes a built-in alert handler that enables
the reliable execution of scripts on monitored Linux systems.
The most important features of this solution are:</p></div>
<div class="ulist"><ul>
<li><p>The scripts are called up using SSH with <strong>Command restriction</strong>.</p></li>
<li><p>No arbitrary commands may be used, rather only those commands defined by you.</p></li>
<li><p>This can all be implemented using the <a href="wato_monitoringagents.html#bakery">Agent bakery</a>.</p></li>
</ul></div>
<div class="paragraph"><p>The <span class="guihint">Linux Remote Alert Handler</span> consists of the following individual elements:</p></div>
<div class="ulist"><ul>
<li><p>The <code>linux_remote</code> alert handler with the title <span class="guihint">â€žLinux via SSHâ€œ</span> on the Checkmk-Server.</p></li>
<li><p>The <code>mk-remote-alert-handler</code> script on the target system.</p></li>
<li><p>The ('Remote handler') scripts written by you on the target system.</p></li>
<li><p>Entries in <code>.ssh/authorized_keys</code> for those users on the target system who will execute them.</p></li>
<li><p>Rules in <span class="guihint">Monitoring agents &gt; Rules &gt; Linux Agent &gt; Install remote alert handlers (Linux)</span> that generate SSH keys.</p></li>
<li><p>Alert handler rules that call up <code>linux_remote</code>.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__installation">
<span class="hidden-anchor sr-only" id="_installation"></span>8.2. Installation</h3>
<div class="paragraph"><p>Assuming one wants to run the <code>/etc/init.d/foo restart</code> script on the <code>myserver123</code> Linux
system whenever the <em>Process FOO</em> service becomes critical (which we have already set up).
Proceed as follows:</p></div>
<div class="sect3">
<h4 id="heading__coding_the_remote_handler">
<span class="hidden-anchor sr-only" id="_coding_the_remote_handler"></span>Coding the remote handler</h4>
<div class="paragraph"><p>Next, write the script to be executed on the target system. Since we are working with
the <a href="wato_monitoringagents.html#bakery">Agent bakery</a>, install the script
<strong>on the Checkmk-Server</strong> (not on the target system!).
The correct directory for this is <code>local/share/check_mk/agents/linux/alert_handlers</code>.
Here as well the comment in the second line provides a title for selection in the user interface:</p></div>
<div class="listingblock">
<div class="title">local/share/check_mk/agents/linux/alert_handlers/restart_foo</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Restart FOO service

/etc/init.d/foo restart || {
    echo "Could not restart FOO."
    exit 2
}</code></pre></div>
</div>
<div class="paragraph"><p>Make the script executable:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>local/share/check_mk/agents/linux/alert_handlers
<span class="tok-gp">OMD[mysite]:~$ </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>restart_foo</code></pre></div></div>
<div class="paragraph"><p>Our example script is so constructed that in the case of an error it ends with a Code 2
so that the alert handler assesses it as <span class="state2">CRIT</span>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__preparing_agent_packages_with_the_handler">
<span class="hidden-anchor sr-only" id="_preparing_agent_packages_with_the_handler"></span>Preparing agent packages with the handler</h4>
<div class="paragraph"><p>Here we will describe the procedure with the agent bakery. Tips for installing by hand
can be found further below.
Define a rule under <span class="guihint">Setup &gt; Agents &gt; Windows, Linux, Solaris, AIX &gt; Agent rules &gt; Linux Agent &gt; Remote alert handlers (Linux)</span>.
In the characteristics, the Remotehandler <span class="guihint">Restart FOO service</span> you have just defined can be seen.
Select this for installation:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_install_remote.png" alt="alert handlers install remote"></div></div>
<div class="paragraph"><p>Once you have saved it you will see the rule in the list: an SSH-key pair for calling up the handler
will be automatically generated and the fingerprint of which will appear in the rule. The fingerprint itself has been shortened to fit the width in this screenshot:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_install_remote2.png" alt="alert handlers install remote2"></div></div>
<div class="paragraph"><p>The public key is intended for the agent. The private key will later be required by the Checkmk-Server
so that a script installed in this way can be called up without needing to enter a password.</p></div>
<div class="paragraph"><p>One can also utilise another user as the <code>root</code> - naturally only when they have the appropriate rights
for the required action. The Checkmk-Agent will only install the SSH-key on systems where this user already exists.</p></div>
</div>
<div class="sect3">
<h4 id="heading__baking_agents">
<span class="hidden-anchor sr-only" id="_baking_agents"></span>Baking agents</h4>
<div class="paragraph"><p>Now bake new agents with <span class="image-inline"><img src="../images/icons/button_bake_agents.png" alt="button bake agents"></span>. In the list of ready agents an entry should
now appear in which your remote handler and SSH-key can be seen. The screenshot has also been shortened here. This time by the amount of possible packages that may be downloaded:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_baked_handler.png" alt="alert handlers baked handler"></div></div>
</div>
<div class="sect3">
<h4 id="heading__agent_installation">
<span class="hidden-anchor sr-only" id="_agent_installation"></span>Agent installation</h4>
<div class="paragraph"><p>Next, install the RPM or DEB package on your target system (the <code>TGZ</code>-Installation
cannot load the SSH-key and is thus incomplete). With the installation the following things occur:</p></div>
<div class="ulist"><ul>
<li><p>Your remote handler script will be installed</p></li>
<li><p>The <code>mk-remote-alert-handler</code> auxiliary program will be installed</p></li>
<li><p>For selected users (here <code>root</code>) an entry will be made in <code>authorized_keys</code> that will enable the handlerâ€™s execution.</p></li>
<li><p>The <code>.ssh</code> directory and the <code>authorized_keys</code> file will be created as necessary.</p></li>
</ul></div>
<div class="paragraph"><p>With an installation via <code>DEB</code> it will look something like this:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@myserver123:~# </span>dpkg<span class="tok-w"> </span>-i<span class="tok-w"> </span>check-mk-agent_2016.07.19-9d3ab34905da4934_all.deb
<span class="tok-go">Selecting previously unselected package check-mk-agent.</span>
<span class="tok-gp tok-gp-VirtualEnv">(Reading database ... 515080 files and directories currently installed.)</span>
<span class="tok-go">Preparing to unpack ...check-mk-agent_2016.07.19-9d3ab34905da4934_all.deb ...</span>
<span class="tok-go">Unpacking check-mk-agent (2016.07.19-9d3ab34905da4934) ...</span>
<span class="tok-go">Setting up check-mk-agent (2016.07.19-9d3ab34905da4934) ...</span>
<span class="tok-go">Reloading xinetd...</span>
<span class="tok-go"> * Reloading internet superserver configuration xinetd                            [ OK ]</span>
<span class="tok-go"><strong>Package 9d3ab34905da4934: adding SSH keys for Linux remote alert handlers for user root...</strong></span></code></pre></div></div>
<div class="paragraph"><p>A look into the SSH-configuration for <code>root</code> reveals:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@myserver123:~# </span>cat<span class="tok-w"> </span>/root/.ssh/authorized_keys
<span class="tok-go">command="/usr/bin/mk-remote-alert-handler restart_foo",no-port-forwarding,no-x11-forwarding,no-agent-forwarding ssh-rsa  AAAAB3NzaC1yc2EAAAADAQABAAACAQCqoDVNFEbTqYEmhSZhUMvRy5SqGIPp1nE+EJGw1LITV/rej4AAiUUBYwMkeo5aBC6VOXkq78CdRuReSozec3krKkkwVbgYf98Wtc6N3WiljS85PLAVvPadJiJCkXFctbxyI2xeF5TQ1VKDRvzbBjXE9gjTnLWbPy77RC8SVXLoOQgabixpWQquIIdGyccPsWGTRgeI7Ua0lgWZQUJt7OIKQ0X7Syv2VHKJNqtW28IWu8y2hBEY/TERip5EQoNT/VclhHqjDG2y3F45PswcXD5in6y30EnfHGcwk+PD6fgp7jPGbO2+QBUwYgW67GmRpbaVQ97CqXFJvORNF+C6+O8DNweyH3ogspjfKvM7eN+M4NIJzjMRyNBMzqF3VmrMeqpzRjfFj2BS/8UbXGgHzZRapwrK3+GXX1pG49n77cIs+GWos9xb1DxX1pEu2tgQwRBBhYcTkk2eKkH18LKzFUyObxtQmf40C24cdQOp6USbwzsniqehsLIHH2unQ7bW6opF/GiaEjZamGbgsPOe8rmey5Vcd//e8cS+OsmcPZNybsTJpBeHpes+5bw0e1POw9GD9qptylrQLYIO5R467Ov8YlRFgYKyaDFHD40j5/JHPzmtp4vjH8Si7YZZOzvTRgBYEoEgbLS5dgdr/I5ZMRKfDPCpRUbGhp9kUEdGX99o5Q== mk-remote-alert-handler-9d3ab34905da4934</span></code></pre></div></div>
<div class="paragraph"><p>Please be aware that your system could be set up so that an SSH-access as <code>root</code> is not
generally possible. In this case you can go via another user and there work with <code>sudo</code>,
which is so configured that the desired command can be executed without a password.</p></div>
</div>
<div class="sect3">
<h4 id="heading__calling_alert_handlers_using_rules">
<span class="hidden-anchor sr-only" id="_calling_alert_handlers_using_rules"></span>Calling alert handlers using rules</h4>
<div class="paragraph"><p>We have almost reached our objective. The agent is ready.
Now all thatâ€™s missing is a rule to actually summon the alert handler.
The procedure is as described at the beginning of this article and is achieved through the
creation of an appropriate rule. This time choose <span class="guihint">Linux via SSH</span> as the handler,
enter the user for whom the SSH-key should be installed, and select your remote handler:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_rule_foo.png" alt="alert handlers rule foo"></div></div>
<div class="paragraph"><p>Please also set a sensible <strong>condition</strong> in the rule, otherwise an SSH-connection will be
attempted with <strong>every</strong> service alert!</p></div>
</div>
<div class="sect3">
<h4 id="heading__test">
<span class="hidden-anchor sr-only" id="_test"></span>Test</h4>
<div class="paragraph"><p>When, e.g., you now set the relevant service manually to <span class="state2">CRIT</span>,
in the serviceâ€™s history you will shortly see:</p></div>
<div class="imageblock"><div class="content"><img src="../images/alert_handlers_foo_failing.png" alt="alert handlers foo failing"></div></div>
<div class="paragraph"><p>Naturally if no <code>foo</code> service exists, then <code>/etc/init.d/foo restart</code> also canâ€™t work.
It can however be seen that this command has been processed and also that the error status has
been correctly reported.
Likewise that Checkmk has triggered a notification which was stopped by an alert handler.</p></div>
<div class="paragraph"><p>The <code>Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.</code> message is
harmless by the way and only appears on first contact with the host. To avoid the time-consuming
manual exchange of the host key, SSH is called with <code>-o StrictHostKeyChecking=false</code>.
At the first connection the key will be stored for future use.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__installation_without_the_agent_bakery">
<span class="hidden-anchor sr-only" id="_installation_without_the_agent_bakery"></span>8.3. Installation without the agent bakery</h3>
<div class="paragraph"><p>Of course manually preparing an agent also works. In such a case we recommend performing the
agent bakery procedure on a test system, then examine the relevant data and replicate it
manually on your own system.
A list of the file paths can be found <a href="#files_agent">here</a>.</p></div>
<div class="paragraph"><p>Here in this case it is also important that in the agent bakery you create a rule
for installing the remote handler - because in this rule the SSH-key will be generated for
the access and also for use by the alert handler! The public key for the installation in
<code>authorized_keys</code> can be found in the <code>etc/check_mk/conf.d/wato/rules.mk</code>
configuration file (or in a subfolder in <code>rules.mk</code>).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>9. Relevant files and directories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__files_and_directories_on_the_checkmk_server">
<span class="hidden-anchor sr-only" id="_files_and_directories_on_the_checkmk_server"></span>9.1. Files and directories on the Checkmk-Server</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 53%;">
<col style="width: 47%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var/log/alerts.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file with all events relevant to the alert handler (logged by the alert helper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var/log/cmc.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file for the core. Some alert handler information is also stored here</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local/share/check_mk/alert_handlers/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save your self-written alert handlers here</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var/check_mk/core/history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here the monitoring historyâ€™s log file is stored and also evaluated by the core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local/share/check_mk/agents/linux/alert_handlers/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote alert handlers to be run on Linux systems</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_files_agent">
<span class="hidden-anchor sr-only" id="files_agent"></span>9.2. Files and directories on the monitored Linux system</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 53%;">
<col style="width: 47%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/bin/mk-remote-alert-handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auxiliary script for executing the remote handlers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/lib/check_mk_agent/alert_handlers/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote handlers written by you</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/root/.ssh/authorized_keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH-configuration for the user <code>root</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~harri/.ssh/authorized_keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH-configuration for a user <code>harri</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li>
<a href="#_introduction">1. Introduction</a><ul class="sectlevel1">
<li><a href="#_should_the_monitoring_intervene">1.1. Should the monitoring intervene?</a></li>
<li><a href="#_alert_handlers_in_checkmk">1.2. Alert handlers in Checkmk</a></li>
</ul>
</li>
<li>
<a href="#setup">2. Setting up alert handlers</a><ul class="sectlevel1">
<li><a href="#_saving_scripts_in_the_correct_directory">2.1. Saving scripts in the correct directory</a></li>
<li><a href="#_a_simple_alert_handler_to_try_out">2.2. A simple alert handler to try out</a></li>
<li><a href="#_activating_alert_handlers">2.3. Activating alert handlers</a></li>
<li><a href="#_test_and_fault_diagnoses">2.4. Test and fault diagnoses</a></li>
</ul>
</li>
<li><a href="#_rules_based_configuration">3. Rules based configuration</a></li>
<li>
<a href="#execution">4. How alert handlers are executed</a><ul class="sectlevel1">
<li><a href="#_asynchronous_execution">4.1. Asynchronous execution</a></li>
<li><a href="#_stopping_the_core">4.2. Stopping the core</a></li>
<li><a href="#_timeouts">4.3. Timeouts</a></li>
<li><a href="#_overlaying">4.4. Overlaying</a></li>
<li><a href="#_exit_status_and_output_from_handlers">4.5. Exit status and output from handlers</a></li>
<li><a href="#_global_settings">4.6. Global settings</a></li>
<li><a href="#_master_control">4.7. Master control</a></li>
</ul>
</li>
<li><a href="#_alert_handlers_in_the_history">5. Alert handlers in the history</a></li>
<li><a href="#notification">6. Notification via alert handlers</a></li>
<li><a href="#_handlers_for_every_check_execution">7. Handlers for every check execution</a></li>
<li>
<a href="#linux_remote">8. Remote execution under Linux</a><ul class="sectlevel1">
<li><a href="#_basic_principles">8.1. Basic principles</a></li>
<li>
<a href="#_installation">8.2. Installation</a><ul class="sectlevel2">
<li><a href="#_coding_the_remote_handler">Coding the remote handler</a></li>
<li><a href="#_preparing_agent_packages_with_the_handler">Preparing agent packages with the handler</a></li>
<li><a href="#_baking_agents">Baking agents</a></li>
<li><a href="#_agent_installation">Agent installation</a></li>
<li><a href="#_calling_alert_handlers_using_rules">Calling alert handlers using rules</a></li>
<li><a href="#_test">Test</a></li>
</ul>
</li>
<li><a href="#_installation_without_the_agent_bakery">8.3. Installation without the agent bakery</a></li>
</ul>
</li>
<li>
<a href="#files">9. Relevant files and directories</a><ul class="sectlevel1">
<li><a href="#_files_and_directories_on_the_checkmk_server">9.1. Files and directories on the Checkmk-Server</a></li>
<li><a href="#files_agent">9.2. Files and directories on the monitored Linux system</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
