<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Whether syslog, forwarded text logs or traps via SNMP - here you will learn how to process these events in the Checkmk Event Console.">
<meta name="og:locale" content="en">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="The Event Console - Processing logs and SNMP traps">
<meta name="og:description" content="Whether syslog, forwarded text logs or traps via SNMP - here you will learn how to process these events in the Checkmk Event Console.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>The Event Console - Processing logs and SNMP traps</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Search docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/en"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/en"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">en</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/de/ec.html">Deutsch</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/en/ec.html">2.2.0</a><a class="dropdown-item" href="../../latest/en/ec.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_welcome_to_checkmk">
<a class="anchor" href="#_welcome_to_checkmk"></a>1. Welcome to Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Welcome to the Checkmk User Guide</a></p>
</li>
<li>
<p><a href="glossar.html">Glossary</a></p>
</li>
<li>
<p><a href="search.html">Searching docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginners_guide">
<a class="anchor" href="#_beginners_guide"></a>2. Beginner’s Guide</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Setting up Checkmk</a></p>
</li>
<li>
<p><a href="intro_gui.html">The Checkmk user interface</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Setting up monitoring</a></p>
</li>
<li>
<p><a href="intro_tools.html">The monitoring tools</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk in monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Fine-tuning the monitoring</a></p>
</li>
<li>
<p><a href="intro_users.html">Working with multiple users</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Switching on notifications</a></p>
</li>
<li>
<p><a href="intro_extend.html">Extending the monitoring system further</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best practices, tips &amp; tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Basic information on the installation of Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_and_vms">
<a class="anchor" href="#_server_and_vms"></a>3.1. Server and VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation on Debian and Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation on Red Hat and CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation on SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, container, cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation of Checkmk in the appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation as a Docker container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates and upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update to version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update matrix for version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux upgrade on the Checkmk server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk versions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_of_checkmk">
<a class="anchor" href="#_administration_of_checkmk"></a>4. Administration of Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Authentication with SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single sign-on with Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk server in a Docker container</a></p>
</li>
<li>
<p><a href="security.html">Security</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Securing the web interface with HTTPS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sites">
<a class="anchor" href="#_sites"></a>4.2. Sites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Site administration with omd</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk on the command line</a></p>
</li>
<li>
<p><a href="license.html">Managing licenses</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Distributed monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Analyzing the Checkmk site configuration</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk extension packages (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Simulation mode</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">
<a class="anchor" href="#_configuration"></a>5. Configuration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Configuring Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Host administration</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Host structuring</a></p>
</li>
<li>
<p><a href="host_tags.html">Host tags</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamic host configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Understanding and configuring services</a></p>
</li>
<li>
<p><a href="clustered_services.html">Monitoring cluster services</a></p>
</li>
<li>
<p><a href="piggyback.html">The piggyback mechanism</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rules">
<a class="anchor" href="#_rules"></a>5.3. Rules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host and service parameters</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_configurations">
<a class="anchor" href="#_supporting_configurations"></a>5.4. Supporting configurations</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Time periods</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Regular expressions in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_permissions">
<a class="anchor" href="#_users_and_permissions"></a>5.5. Users and permissions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Users, roles and permissions</a></p>
</li>
<li>
<p><a href="ldap.html">User management with LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">
<a class="anchor" href="#_notifications"></a>5.6. Notifications</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Introduction to notifications</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Notifications via Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Notifications via Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Notifications via PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Notifications via Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Notifications via Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Notifications via ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Notifications via Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Notifications via Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Notifications via Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">The Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert handlers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_systems">
<a class="anchor" href="#_monitoring_systems"></a>6. Monitoring systems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring agents</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agents_and_snmp">
<a class="anchor" href="#_checkmk_agents_and_snmp"></a>6.1. Checkmk agents and SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatic agent updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Monitoring Linux</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Monitoring Linux in legacy mode</a></p>
</li>
<li>
<p><a href="agent_windows.html">Monitoring Windows</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">Monitoring FreeBSD</a></p>
</li>
<li>
<p><a href="snmp.html">Monitoring via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agent_extensions">
<a class="anchor" href="#_agent_extensions"></a>6.2. Agent extensions</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">The HW/SW inventory</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Monitoring files</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Monitoring Oracle databases</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">Monitoring MySQL</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">Monitoring MSSQL</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Monitoring time-based processes (Cronjobs)</a></p>
</li>
<li>
<p><a href="spool_directory.html">The spool directory</a></p>
</li>
<li>
<p><a href="localchecks.html">Local checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, cloud, container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datasource programs</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">Monitoring VMWare ESXi</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Monitoring Amazon Web Services (AWS)</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Monitoring Microsoft Azure</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Monitoring Kubernetes</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Monitoring Docker</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">
<a class="anchor" href="#_endpoints"></a>6.4. Endpoints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Monitoring network services (Active checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metrics">
<a class="anchor" href="#_dashboards_views_metrics"></a>7. Dashboards, views, metrics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">The user interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general">
<a class="anchor" href="#_general"></a>7.1. General</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Host and service views</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Performance data and graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commands_in_views">
<a class="anchor" href="#_commands_in_views"></a>7.2. Commands in views</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Commands</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Acknowledging problems</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Scheduled downtimes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysis_and_prognosis">
<a class="anchor" href="#_analysis_and_prognosis"></a>8. Analysis and prognosis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_analysis">
<a class="anchor" href="#_analysis"></a>8.1. Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Availability</a></p>
</li>
<li>
<p><a href="sla.html">Extended availability (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Reports</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosis">
<a class="anchor" href="#_prognosis"></a>8.2. Prognosis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Predictive monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Forecast graphs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_of_other_applications">
<a class="anchor" href="#_connection_of_other_applications"></a>9. Connection of other applications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Integrating Prometheus</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Integrating Datadog</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: status data on maps and diagrams</a></p>
</li>
<li>
<p><a href="ntop.html">Integrating ntopng in Checkmk</a></p>
</li>
<li>
<p><a href="grafana.html">Integrating Checkmk in Grafana</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Sending metrics to InfluxDB and Graphite</a></p>
</li>
<li>
<p><a href="nagstamon.html">Integrating Checkmk in Nagstamon</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifics_to_the_editions">
<a class="anchor" href="#_specifics_to_the_editions"></a>10. Specifics to the editions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">The Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automation_and_development">
<a class="anchor" href="#_automation_and_development"></a>11. Automation and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_for_automation">
<a class="anchor" href="#_apis_for_automation"></a>11.1. APIs for automation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Configuration via the Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Retrieving status data via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus command reference</a></p>
</li>
<li>
<p><a href="web_api.html">Configuration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Command reference for the HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_for_development">
<a class="anchor" href="#_apis_for_development"></a>11.2. APIs for development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">The Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_of_check_plug_ins">
<a class="anchor" href="#_development_of_check_plug_ins"></a>11.3. Development of check plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Writing your own check plug-ins</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">
<a class="anchor" href="#_concepts"></a>12. Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_checkmk_micro_core_cmc">
<a class="anchor" href="#_the_checkmk_micro_core_cmc"></a>12.1. The Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">The Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Special characteristics of the CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration to the CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">CMC files and directories</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_checkmk_appliance">
<a class="anchor" href="#_the_checkmk_appliance"></a>13. The Checkmk appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Quick start guide for Checkmk racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Quick start guide for Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Installation of the virtual appliance</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Configuring and using the appliance</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in the appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance in cluster operation</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Special features of the hardware appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>The Event Console</h1>
<div class="details">
<span id="revdate">Last modified on 05-Apr-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/en/ec.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">This page was exported for offline usage on 2025-01-07 22:12:14 +0000. It may not reflect the current state of the Checkmk documentation. To view a daily updated version, visit <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a>.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="monitoring_basics.html">Basic principles of monitoring with Checkmk</a>
<a href="wato_rules.html">Host and service parameters</a>
<a href="livestatus.html">Retrieving status data via Livestatus</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__introduction">
<span class="hidden-anchor sr-only" id="_introduction"></span>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__events_are_not_states">
<span class="hidden-anchor sr-only" id="_events_are_not_states"></span>1.1. Events are not states</h3>
<div class="paragraph"><p>The main task of Checkmk is the active monitoring of <em>states.</em>
At any point in time, each monitored service has one of the states, <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> or <span class="state3">UNKNOWN</span>.
Through regular polling the monitoring constantly updates its picture of the current situation.</p></div>
<div class="paragraph"><p>A completely different type of monitoring is that which handles <em>events</em>.
An example of an event is an <em>exception</em> that occurs in an application.
The application may remain in the <span class="state0">OK</span> state and continue to run correctly — but, <em>something has happened</em>.</p></div>
</div>
<div class="sect2">
<h3 id="heading__the_event_console">
<span class="hidden-anchor sr-only" id="_the_event_console"></span>1.2. The Event Console</h3>
<div class="paragraph"><p>With the <strong>Event Console</strong> (EC for short), Checkmk provides a fully integrated system for monitoring events from sources including syslog, SNMP traps, Windows Event Logs, log files and own applications.
Events are not simply defined as states, but they form a category of their own and are in fact displayed as separate information by Checkmk in the <a href="user_interface.html#sidebar">sidebar’s</a> <span class="guihint">Overview</span>.</p></div>
<div class="imageblock"><div class="content"><img src="../images/tactical_overview_events.png" alt="tactical overview events" width="400"></div></div>
<div class="paragraph"><p>Internally, events are not processed by the monitoring core, but by a separate service — the Event daemon (<code>mkeventd</code>).</p></div>
<div class="paragraph"><p>The Event Console also has an archive where you can search for past events.
However, it should be said right away this is not a substitute for a proper log archive.
The task of the Event Console is the intelligent filtering of a <em>small</em> number of <em>relevant</em> messages from a large stream.
It is optimized for simplicity, robustness and throughput — not for storing large volumes of data.</p></div>
<div class="paragraph"><p>A brief outline of the EC’s functionality:</p></div>
<div class="ulist"><ul>
<li><p>It can receive messages <em>directly</em> via syslog or SNMP traps.
Therefore a configuration of the corresponding Linux system services is not necessary.</p></li>
<li><p>It can also evaluate text-based log files and Windows Event Logs using the Checkmk agents.</p></li>
<li><p>It classifies messages based on chains of user-defined rules.* It can correlate, summarize, count, annotate and rewrite messages as well as consider their temporal relationships.</p></li>
<li><p>It can perform automated actions and send <a href="notifications.html">notifications</a> via Checkmk.</p></li>
<li><p>It is fully integrated into the Checkmk user interface.</p></li>
<li><p>It is included and ready for use in any current Checkmk system version.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__terminology">
<span class="hidden-anchor sr-only" id="_terminology"></span>1.3. Terminology</h3>
<div class="paragraph"><p>The Event Console receives <strong>messages</strong> (mostly in the form of <em>log messages</em>).
A message is a line of text with a number of possible additional attributes, e.g. a timestamp, a host name, etc.
If the message is relevant, it can be converted directly into an <strong>event</strong> with the same attributes, but:</p></div>
<div class="ulist"><ul>
<li><p>A message will only be turned into an event if a rule takes effect.</p></li>
<li><p>Rules can edit the text and other attributes of messages.</p></li>
<li><p>Multiple messages can be combined into one event.</p></li>
<li><p>Messages can also <a href="#cancelling">cancel</a> current events.</p></li>
<li><p>Artificial events can be generated if certain <a href="#expect">messages fail to appear</a>.</p></li>
</ul></div>
<div class="paragraph"><p>An event can go through a number of <strong>phases</strong>:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Open</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 'normal' state: <em>Something</em> has occurred: the operator should attend to it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Acknowledged</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The problem has been acknowledged — this is analogous to host and service problems from status-based monitoring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Counting</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The required number of specified messages have not yet arrived: the situation is not yet problematic. The event is therefore not yet displayed to the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Delayed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An error message has been received, but the Event Console is still waiting whether the appropriate <span class="state0">OK</span> message will be received within a configured time. Only then the event will be displayed to the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Closed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event has been closed by the operator or automatically by the system and is found only in the archive.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>An event also has a <strong>state.</strong>
Strictly speaking, however, it is not the state of the event itself that is meant here, but rather the state of the service or device that sent the event.
To use an analogy with status-based monitoring, an event can also be flagged as <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span>, or <span class="state3">UNKNOWN</span>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_setup">
<span class="hidden-anchor sr-only" id="setup"></span>2. Setting up the Event Console</h2>
<div class="sectionbody">
<div class="paragraph"><p>Setting up the Event Console is very simple, because the Event Console is an integral part of Checkmk and is activated automatically.</p></div>
<div class="paragraph"><p>However, if you want to receive syslog messages or SNMP traps over the network, you must enable this separately.
The reason for this is that both services need to open a UDP port with a specifically-identified port number.
And since only one Checkmk site per system can do this, reception over the network is by default disabled.</p></div>
<div class="paragraph"><p>The port numbers are:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Service</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">162</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP traps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog via TCP</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Syslog via TCP is rarely used, but it does have the advantage that the transmission of messages is secured here.
With UDP it can never be guaranteed that packets will actually arrive.
And neither Syslog nor SNMP traps offer acknowledgements or similar protection against lost messages.
In order to be able to use syslog via TCP, the sending system must of course be able to send messages via this port.</p></div>
<div class="paragraph"><p>In the Checkmk appliance, you can enable the reception of syslog/SNMP traps in the site configuration.
Otherwise, simply use <code>omd config</code>.
You can find the required setting under <span class="guihint">Addons</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_omd_config.png" alt="ec omd config" width="360"></div></div>
<div class="paragraph"><p>At <code>omd start</code> you can see in the line containing <code>mkeventd</code> which external interfaces your EC has open:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Starting mkeventd (builtin: syslog-udp,snmptrap)...OK</span>
<span class="tok-go">Starting liveproxyd...OK</span>
<span class="tok-go">Starting mknotifyd...OK</span>
<span class="tok-go">Starting rrdcached...OK</span>
<span class="tok-go">Starting cmc...OK</span>
<span class="tok-go">Starting apache...OK</span>
<span class="tok-go">Starting dcd...OK</span>
<span class="tok-go">Starting redis...OK</span>
<span class="tok-go">Initializing Crontab...OK</span></code></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__the_first_steps_with_the_event_console">
<span class="hidden-anchor sr-only" id="_the_first_steps_with_the_event_console"></span>3. The first steps with the Event Console</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_first_steps_rules">
<span class="hidden-anchor sr-only" id="first_steps_rules"></span>3.1. Rules, rules, rules</h3>
<div class="paragraph"><p>It was mentioned at the beginning that the EC is used to fish out and display <em>relevant</em> messages.
However the unfortunate fact is that most messages — no matter whether they are from text files, the Windows Event Log or the syslog — are rather unimportant.
It also doesn’t help when messages have already been pre-classified by their originator.</p></div>
<div class="paragraph"><p>For example, in Syslog and in the Windows Event Log messages are classified into something similar to OK, WARN and CRIT.
But what WARN and CRIT actually mean can be defined subjectively by their programmer.
And it can’t even be definitely said that the application which has produced the message is even important on this computer.
In short: You cannot get around needing to configure which messages look like a real problem to you and which ones can simply be discarded.</p></div>
<div class="paragraph"><p>As everywhere in Checkmk, the configuration is performed via <a href="glossar.html#rule">rules,</a> which are processed by the EC for each incoming message according to the 'first match' principle.
The first rule which is applied to an incoming message decides its fate.
If no rule is applied, the message will simply be silently discarded.</p></div>
<div class="paragraph"><p>Since over time one usually accumulates very many rules for the EC, the rules are organized in <em>packets</em>.
The processing of the rules is done packet by packet and within a packet from top to bottom — so the order of processing of these packets is important.</p></div>
</div>
<div class="sect2">
<h3 id="heading__creating_a_simple_rule">
<span class="hidden-anchor sr-only" id="_creating_a_simple_rule"></span>3.2. Creating a simple rule</h3>
<div class="paragraph"><p>Not surprisingly, the configuration interface for the EC can be found in the <span class="guihint">Setup</span> menu under <span class="guihint">Events &gt; Event Console</span>.
Out of the box, you will only find the <span class="guihint">Default rule pack</span>, which does not actually contain any rules.
Incoming messages are therefore, as already mentioned, discarded and also not logged.
The module itself looks like this:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_wato_module.png" alt="ec wato module"></div></div>
<div class="paragraph"><p>Start by creating a new rule package with <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add rule pack</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_new_rule_pack.png" alt="ec new rule pack"></div></div>
<div class="paragraph"><p>As always, the ID is an internal reference and cannot be changed later.
After saving you will find the new entry in the list of your rule packages:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_pack_list.png" alt="ec rule pack list"></div></div>
<div class="paragraph"><p>There you can now switch to the still empty rule package with <span class="image-inline"><img src="../images/icons/icon_ec_rules.png" alt="icon ec rules"></span> and create a new rule with <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add rule</span>.
Only fill in the first box here with the <span class="guihint">Rule Properties</span> heading:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_first_rule.png" alt="ec first rule"></div></div>
<div class="paragraph"><p>The only thing necessary is a unique <span class="guihint">Rule ID</span>.
This ID will be found later in log files, and it will be stored with the generated events.
So it is sensible to assign the IDs with meaningful names in a systematic way.
All other boxes are optional.
This is especially true for the conditions.</p></div>
<div class="paragraph"><p><strong>Important:</strong> This new rule is an example only for testing and will apply to <em>every</em> event.
Therefore it is also important that you later remove it or at least deactivate it, otherwise your Event Console will be flooded with every imaginable pointless message and will be pretty much useless!</p></div>
<div class="sect3">
<h4 id="heading__activating_the_changes">
<span class="hidden-anchor sr-only" id="_activating_the_changes"></span>Activating the changes</h4>
<div class="paragraph"><p>As always in Checkmk, you must first <a href="glossar.html#activate_changes">activate changes</a> in order for them to take effect.
This is not a disadvantage because this way, for changes that affect several related rules, you can specify exactly when the rules should go 'live'.
And beforehand you can use the <span class="guihint">Event Simulator</span> to test if everything fits as intended.</p></div>
<div class="paragraph"><p>First, click on the number of accumulated changes at the top right of the page.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_activate_changes.png" alt="ec activate changes"></div></div>
<div class="paragraph"><p>Then click <span class="guihint">Activate on selected sites</span> to activate the change.
The Event Console is designed in such a way that this action runs with <em>no interruptions</em>.
The reception of incoming messages is ensured at all times, so that no messages can be lost in the process.</p></div>
<div class="paragraph"><p>Only administrators are allowed to activate changes in the EC.
This is controlled via the <span class="guihint">Activate changes for event console</span> <a href="wato_user.html#roles">permission</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading_eventsimulator">
<span class="hidden-anchor sr-only" id="eventsimulator"></span>Testing the new rule</h4>
<div class="paragraph"><p>For testing you could of course now send messages via Syslog or SNMP.
You should also do this later.
But for a first test the EC’s built-in <span class="guihint">Event Simulator</span> is more practical:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_simulator.png" alt="ec simulator"></div></div>
<div class="paragraph"><p>Here you have two options:
<span class="guihint">Try out</span> evaluates on the basis of the simulated message which of the rules would match.
If you are in the top level of the Setup GUI for the EC, the rule packages will be highlighted.
If you are inside a rule package, the individual rules are highlighted.
Each package or rule is marked with one of the following three symbols:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulematch.png" alt="icon rulematch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This rule is the first to take effect on the message and consequently determines its fate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulepmatch.png" alt="icon rulepmatch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This rule would take effect, but the message has already been handled by an earlier rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulenmatch.png" alt="icon rulenmatch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This rule does not take effect. Very handy: If you move the mouse over the grey ball, you get an explanation of why the rule does not apply.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Clicking <span class="guihint">Generate event</span> does almost the same as <span class="guihint">Try out</span>, only now the message is <strong>actually generated.</strong>
Any defined <a href="#actions">actions</a> are actually executed.
And the event will then also show up in the open events in the monitoring.
You can see the source code for the generated message in the confirmation:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_event_generated.png" alt="ec event generated"></div></div>
<div class="paragraph"><p>The generated event appears in the <span class="guihint">Monitor</span> menu under <span class="guihint">Event Console &gt; Events</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_one_open_event.png" alt="ec one open event"></div></div>
</div>
<div class="sect3">
<h4 id="heading__generating_messages_manually_for_testing">
<span class="hidden-anchor sr-only" id="_generating_messages_manually_for_testing"></span>Generating messages manually for testing</h4>
<div class="paragraph"><p>For a first real test over the network, you can easily send a syslog message from a another Linux computer by hand.
Since the protocol is so simple, you don’t even need a special program, you can simply send the data via <code>netcat</code> or <code>nc</code> using UDP.
The content of the UDP packet consists of a single line of text.
If this conforms to a specific structure, the Event Console breaks down the components cleanly:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'&lt;78&gt;Dec 18 10:40:00 myserver123 MyApplication: It happened again.'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>nc<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-m">0</span><span class="tok-w"> </span>-u<span class="tok-w"> </span><span class="tok-m">10</span>.1.1.94<span class="tok-w"> </span><span class="tok-m">514</span></code></pre></div></div>
<div class="paragraph"><p>But you can also simply send <em>anything</em>.
The EC will then accept it anyway and just evaluate it as a message text.
Additional information such as the application, the priority, etc. will of course be missing.
For security reasons the status <span class="state2">CRIT</span> will be assumed:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'This is no syslog message'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>nc<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-m">0</span><span class="tok-w"> </span>-u<span class="tok-w"> </span><span class="tok-m">10</span>.1.1.94<span class="tok-w"> </span><span class="tok-m">514</span></code></pre></div></div>
<div class="paragraph"><p>Within the Checkmk site running the EC there is a <em>named pipe</em>, into which you can write text messages locally via <code>echo</code>.
This is a very simple method for connecting a local application and also a way to test the processing of messages:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'Local application says hello'</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>tmp/run/mkeventd/events</code></pre></div></div>
<div class="paragraph"><p>By the way, it is also possible to send in syslog format here, so that all fields in the event data are filled in cleanly.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_globalsettings">
<span class="hidden-anchor sr-only" id="globalsettings"></span>3.3. Event Console settings</h3>
<div class="paragraph"><p>The Event Console has its own global settings, which are not found with those of the other modules, but instead under <span class="guihint">Setup &gt; Events &gt; Event Console</span> with the <span class="guihint">Settings</span> button.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_settings.png" alt="ec settings"></div></div>
<div class="paragraph"><p>As always, you can find explanations of the individual settings from the <a href="user_interface.html#inline_help">inline help</a> and at the appropriate places in this article.</p></div>
<div class="paragraph"><p>Access to the settings is possible via the <span class="guihint">Configuration of Event Console</span> permission, which by default is only available in the <code>admin</code> role.</p></div>
</div>
<div class="sect2">
<h3 id="heading_permissions">
<span class="hidden-anchor sr-only" id="permissions"></span>3.4. Permissions</h3>
<div class="paragraph"><p>The Event Console also has its own section for <a href="wato_user.html#roles">roles and permissions</a>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_permissions.png" alt="ec permissions"></div></div>
<div class="paragraph"><p>We will discus some of these permissions in more detail at appropriate places in this article.</p></div>
</div>
<div class="sect2">
<h3 id="heading_hostnames">
<span class="hidden-anchor sr-only" id="hostnames"></span>3.5. Host assignment in the Event Console</h3>
<div class="paragraph"><p>A special feature of the Event Console is that, in contrast to status-based monitoring, hosts are not the focus.
Events can occur without any explicit host assignment, which is in fact often desired.
However an assignment should be possible for hosts that are already in active monitoring, in order to quickly access the status overview when an event occurs.
Or at the latest, if events are to be converted into <a href="#eventsgostate">states</a>, a correct assignment is essential.</p></div>
<div class="paragraph"><p>The fundamental rule for messages received via syslog is that the host name in the message should correspond to the host name in the monitoring.
This is achieved by using the <em>fully qualified domain name</em> (FQDN) / <em>fully qualified host name</em> (FQHN), both in your syslog configuration as well as in the host naming in Checkmk.
In Rsyslog you can accomplish this using the global directive <code>$PreserveFQDN on</code>.</p></div>
<div class="paragraph"><p>Checkmk tries to match the host names from the events to those from the active monitoring as best it can <a href="#hostmatching">automatically</a>.
In addition to the host name, the host alias is also tried.
If the short name is transmitted via syslog the assignment will be correct.</p></div>
<div class="paragraph"><p>A backward resolution of the IP address would not make much sense here, because intermediate log servers are often used.
If the conversion of the host names to FQDN/FQHN or the re-entry of many aliases is too time-consuming, you can use the <a href="#globalsettings">Event Console setting</a> <span class="guihint">Hostname translation for incoming messages</span> to translate host names directly when receiving messages.
Thereby you have numerous possibilities:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_hostname_translation.png" alt="ec hostname translation"></div></div>
<div class="paragraph"><p>The most flexible method is to work with <a href="regexes.html">regular expressions</a>, which allow intelligent search-and-replace within host names.
In particular, if host names are explicit, but only the domain part used in Checkmk is missing, a simple rule helps: <code>(.*)</code> becomes <code>\1.mydomain.test</code>.
In cases where all this is not enough, you can still use <span class="guihint">Explicit hostname mapping</span> to specify a table of individual names and their respective translations.</p></div>
<div class="paragraph"><p><strong>Important:</strong> A name conversion is performed <strong>before</strong> the checking of the rule conditions and thus long before a possible rewriting of the host name by the <span class="guihint">Rewrite hostname</span> rule action in <a href="#rewriting">automatic text rewriting</a>.</p></div>
<div class="paragraph"><p>The assignment is somewhat simpler with <a href="snmp.html">SNMP</a>.
Here the IP address of the sender is compared with the cached IP addresses of the hosts in the monitoring — i.e. as soon as regular active checks are available, such as the accessibility check of the Telnet or SSH port at a switch, status messages from this device sent via SNMP will be assigned to the correct host.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_monitoring">
<span class="hidden-anchor sr-only" id="monitoring"></span>4. The Event Console in monitoring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__event_views">
<span class="hidden-anchor sr-only" id="_event_views"></span>4.1. Event views</h3>
<div class="paragraph"><p>Events generated by the Event Console are displayed analogously to hosts and services in the <a href="glossar.html#monitoring_environment">monitoring environment</a>.
You can find the entry point for this in the <span class="guihint">Monitor</span> menu under <span class="guihint">Event Console &gt; Events:</span></p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_open_events_hilites.png" alt="ec open events hilites"></div></div>
<div class="paragraph"><p>You can customize the displayed <span class="guihint">Events</span> view just like any other.
You can filter the displayed events, execute commands, etc.
For details, see the article on <a href="views.html">views</a>.
When you create new event views, events and <a href="#archive">event history</a> are available as data sources.</p></div>
<div class="paragraph"><p>A click on the event ID (here e.g. <code>27</code>) will show you its details:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_event_details.png" alt="ec event details"></div></div>
<div class="paragraph"><p>As you can see, an event has quite a few data fields, whose meaning we will explain bit by bit in this article.</p></div>
<div class="paragraph"><p>The most important fields should nevertheless be briefly mentioned here:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">State (severity) of event</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As mentioned in the introduction. each event is classified as <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> or <span class="state3">UNKNOWN</span>. Events of status <span class="state0">OK</span> are rather unusual. This is because the EC is designed precisely to only filter out <em>problems</em>. However, there are situations where an <span class="state0">OK</span> event can make sense.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Text/Message of the event</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual content of the event: A text message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Hostname</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the host that sent the message. This does not necessarily have to be a host being actively monitored by Checkmk. However, if a host of that name exists in the monitoring, the EC will automatically create a <a href="#hostnames">link</a>. In this case, the <span class="guihint">Host alias</span>, <span class="guihint">Host contacts</span> and <span class="guihint">Host icons</span> fields will also be filled and the host will appear in the same notation as in the active monitoring.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>As mentioned at the beginning, events are displayed directly in the <span class="guihint">Overview</span> of the sidebar:</p></div>
<div class="imageblock"><div class="content"><img src="../images/tactical_overview_events.png" alt="tactical overview events" width="400"></div></div>
<div class="paragraph"><p>Here you will see three numbers:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Events</span> — all open and acknowledged events (corresponds to the <span class="guihint">Event Console &gt; Events</span> view)</p></li>
<li><p><span class="guihint">Problems</span> — of which only those with a <span class="state1">WARN</span> / <span class="state2">CRIT</span> / <span class="state3">UNKNOWN</span> state</p></li>
<li><p><span class="guihint">Unhandled</span> — of these again only those not yet acknowledged (more on this in a moment)</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_commands">
<span class="hidden-anchor sr-only" id="commands"></span>4.2. Commands and workflow of events</h3>
<div class="paragraph"><p>Analogous to the hosts and services, a simple workflow is mapped for events as well.
As usual this is done via <a href="commands.html">commands</a>, which can be found in the <span class="guihint">Commands</span> menu.
By showing and selecting with checkboxes you can execute a command on multiple events simultaneously.
As a special feature there is the frequently used <em>archive</em> of a single event directly via the <span class="image-inline"><img src="../images/icons/icon_archive_event.png" alt="icon archive event"></span> icon.</p></div>
<div class="paragraph"><p>For each of the commands there is a <a href="#permissions">permission</a>, which you can use to control for which role the command execution is allowed.
By default all commands are allowed for holders of the <code>admin</code> and <code>user</code> roles.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_commands_menu.png" alt="ec commands menu" width="550"></div></div>
<div class="paragraph"><p>The following commands are available:</p></div>
<div class="sect3">
<h4 id="heading__update_and_acknowledge">
<span class="hidden-anchor sr-only" id="_update_and_acknowledge"></span>Update and acknowledge</h4>
<div class="paragraph"><p>The <span class="guihint">Update &amp; Acknowledge</span> command displays the following area above the event list:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_commands.png" alt="ec commands" width="550"></div></div>
<div class="paragraph"><p>With the <span class="guihint">Update</span> button you can in a single action add a comment to the event, add a contact person and acknowledge the event.
The <span class="guihint">Change contact</span> field is intentionally free text.
Here you can also enter things like phone numbers.
In particular, this field has no influence on the visibility of the event in the GUI — it is purely a comment field.</p></div>
<div class="paragraph"><p>The <span class="guihint">Set event to acknowledged</span> checkbox will cause the event to switch from the <span class="guihint">open</span> phase to <span class="guihint">acknowledged</span>, and henceforth be displayed as <span class="guihint">handled</span>.
This is analogous to the <a href="basics_ackn.html">acknowledgement</a> of host and service problems.</p></div>
<div class="paragraph"><p>Subsequent invocation of the command with the checkbox unchecked <em>removes</em> the acknowledgement.</p></div>
</div>
<div class="sect3">
<h4 id="heading__change_state">
<span class="hidden-anchor sr-only" id="_change_state"></span>Change state</h4>
<div class="paragraph"><p>The <span class="guihint">Change State</span> command allows the manual changing of an event’s state — e.g. from <span class="state2">CRIT</span> to <span class="state1">WARN</span>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__custom_action">
<span class="hidden-anchor sr-only" id="_custom_action"></span>Custom action</h4>
<div class="paragraph"><p>With the <span class="guihint">Custom Action</span> command, freely definable <a href="#actions">actions</a> can be executed on events.
Initially, only the <span class="guihint">Send monitoring notification</span> action is available.
This will send a Checkmk notification which will be handled in the same way as one from an actively monitored service.
This goes through the <a href="notifications.html#rules">notification rules</a> and can generate emails, an SMS, or whatever you have configured accordingly.
See <a href="#notifications">below</a> for details on notification by the EC.</p></div>
</div>
<div class="sect3">
<h4 id="heading__archive_event">
<span class="hidden-anchor sr-only" id="_archive_event"></span>Archive event</h4>
<div class="paragraph"><p>The <span class="guihint">Archive Event</span> button permanently removes an event from the open events list.
Since all actions on events — including this deletion — are also recorded in the <a href="#archive">archive</a>, you will still be able to later access all of the information on the event.
That is why we don’t speak of <em>deleting</em>, but rather of <em>archiving</em>.</p></div>
<div class="paragraph"><p>You can also conveniently archive individual events from the event list using <span class="image-inline"><img src="../images/icons/icon_archive_event.png" alt="icon archive event"></span>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_visibility">
<span class="hidden-anchor sr-only" id="visibility"></span>4.3. Visibility of events</h3>
<div class="sect3">
<h4 id="heading__the_visibility_problem">
<span class="hidden-anchor sr-only" id="_the_visibility_problem"></span>The visibility 'problem'</h4>
<div class="paragraph"><p>To provide visibility of hosts and services in monitoring for normal users, Checkmk uses <a href="wato_user.html#contact_groups">contact groups</a>.
These groups are assigned to the hosts and services through Setup GUI, rule or folder configuration.</p></div>
<div class="paragraph"><p>With the Event Console the situation is that such an assignment of events to contact groups does not exist.
This is because it is simply not known in advance which messages will actually be received.
Not even the list of hosts is known, because the sockets for Syslog and SNMP are accessible from everywhere.
Therefore the Event Console includes a few special features for defining visibility.</p></div>
</div>
<div class="sect3">
<h4 id="heading__initially_everyone_can_see_everything">
<span class="hidden-anchor sr-only" id="_initially_everyone_can_see_everything"></span>Initially, everyone can see everything</h4>
<div class="paragraph"><p>First of all, when configuring the <a href="wato_user.html#roles">user roles</a> there is the <span class="guihint">Event Console &gt; See all events</span> permission.
This is active by default, <strong>so that normal users are allowed to see all events!</strong>
This is deliberately set to ensure that important error messages do not fall by the wayside due to incorrect configuration.
The first step to more precise visibility is to remove this permission from the <code>user</code> role.</p></div>
</div>
<div class="sect3">
<h4 id="heading_hostmatching">
<span class="hidden-anchor sr-only" id="hostmatching"></span>Assignment to hosts</h4>
<div class="paragraph"><p>To ensure that the visibility of events is as consistent as possible with the rest of the monitoring, the Event Console tries as much as it can to match the hosts from which it receives events to those hosts configured via the Setup GUI.
What sounds simple is tricky in detail.
Sometimes a host name is missing in the event and only the IP address is known.
In other cases the host name is spelled differently to what is in the Setup GUI.</p></div>
<div class="paragraph"><p>The assignment is done as follows:</p></div>
<div class="ulist"><ul>
<li><p>If no host name is found in the event, its IP address is used as the host name.</p></li>
<li><p>The host name in the event is then compared case-insensitively with all host names, host addresses and IP addresses of the hosts in the monitoring.</p></li>
<li><p>If a host is found in this way, its contact groups are used for the event, and this is then used to control visibility.</p></li>
<li><p>If the host is <strong>not</strong> found, the contact groups — if <a href="#contactgroups">configured there</a> — are taken from the rule that created the event.</p></li>
<li><p>If no groups are stored there either, the user may only see the event if she has the <span class="guihint">Event Console &gt; See events not related to a known host</span> permission.</p></li>
</ul></div>
<div class="paragraph"><p>You can influence the assignment at one point:
Namely, if contact groups are defined in the rule <strong>and</strong> the host could be assigned, the mapping usually has priority.
You can change this in a rule with the <span class="guihint">Precedence of contact groups</span> option:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_outcome_contact_groups.png" alt="ec outcome contact groups"></div></div>
<div class="paragraph"><p>In addition, you can make settings directly in the rule for the notification.
This makes it possible to prioritize the type of event over the regular responsibilities for a host.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__troubleshooting">
<span class="hidden-anchor sr-only" id="_troubleshooting"></span>4.4. Troubleshooting</h3>
<div class="sect3">
<h4 id="heading__which_rule_applies_and_how_often">
<span class="hidden-anchor sr-only" id="_which_rule_applies_and_how_often"></span>Which rule applies, and how often?</h4>
<div class="paragraph"><p>Both for the rule packs  …​</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_pack_hits.png" alt="ec pack hits"></div></div>
<div class="paragraph"><p>…  as well as for the individual rules  …​</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_hits.png" alt="ec rule hits"></div></div>
<div class="paragraph"><p>… in the <span class="guihint">Hits</span> column you will find the information on how often the package or rule has already matched a message.
This helps you to eliminate or repair ineffective rules.
But this can also be interesting for rules that match very often.
For optimal performance of the EC, these should be at the beginning of the rule chain.
This way you can reduce the number of rules that the EC has to test on <em>every</em> message.</p></div>
<div class="paragraph"><p>You can reset the counters at any time with the <span class="guihint">Event Console &gt; Reset counters</span> menu item.</p></div>
</div>
<div class="sect3">
<h4 id="heading__debugging_rule_evaluation">
<span class="hidden-anchor sr-only" id="_debugging_rule_evaluation"></span>Debugging rule evaluation</h4>
<div class="paragraph"><p>At <a href="#eventsimulator">Trying out a rule</a> you have already seen how you can use the <span class="guihint">Event Simulator</span> to check the evaluations of your rules.
You can get similar information at runtime for <em>all</em> messages, if in the <a href="#globalsettings">Event Console settings</a> you set the value from <span class="guihint">Debug rule execution</span> to <span class="guihint">on</span>.</p></div>
<div class="paragraph"><p>The Event Console log file can be found at <code>var/log/mkeventd.log</code>, in which you will find the exact reason why any rule that was checked did not take effect:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1481020022.001612] Processing message from ('10.40.21.11', 57123): '&lt;22&gt;Dec  6 11:27:02 myserver123 exim[1468]: Delivery complete, 4 message(s) remain.'
[1481020022.001664] Parsed message:
 application:    exim
 facility:       2
 host:           myserver123
 ipaddress:      10.40.21.11
 pid:            1468
 priority:       6
 text:           Delivery complete, 4 message(s) remain.
 time:           1481020022.0
[1481020022.001679] Trying rule test/myrule01...
[1481020022.001688]   Text:   Delivery complete, 4 message(s) remain.
[1481020022.001698]   Syslog: 2.6
[1481020022.001705]   Host:   myserver123
[1481020022.001725]   did not match because of wrong application 'exim' (need 'security')
[1481020022.001733] Trying rule test/myrule02n...
[1481020022.001739]   Text:   Delivery complete, 4 message(s) remain.
[1481020022.001746]   Syslog: 2.6
[1481020022.001751]   Host:   myserver123
[1481020022.001764]   did not match because of wrong text</code></pre></div>
</div>
<div class="paragraph"><p>It goes without saying that you should use this intensive logging only when needed and with caution.
In an only slightly more complex environment <em>huge</em> volumes of data will be generated!</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_rules">
<span class="hidden-anchor sr-only" id="rules"></span>5. The full power of the rules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__the_conditions">
<span class="hidden-anchor sr-only" id="_the_conditions"></span>5.1. The conditions</h3>
<div class="paragraph"><p>The most important part of an EC rule is of course the condition (<span class="guihint">Matching Criteria</span>).
Only if a message meets all the conditions stored in the rule, the actions defined in the rule are executed and the evaluation of the message is thus completed.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_matching_criteria.png" alt="ec matching criteria"></div></div>
<div class="sect3">
<h4 id="heading__general_information_on_text_comparisons">
<span class="hidden-anchor sr-only" id="_general_information_on_text_comparisons"></span>General information on text comparisons</h4>
<div class="paragraph"><p>For all conditions involving text fields, the comparison text is always treated as a <a href="regexes.html">regular expression</a>.
The comparison always takes place <em>ignoring upper/lower case</em>.
The latter is an exception to Checkmk conventions in other modules.
However, this makes the formulation of the rules more robust, especially since host names in events are not necessarily consistent in their spelling if they have been configured on each host locally rather than centrally.
This exception is thus very useful here.</p></div>
<div class="paragraph"><p>Furthermore, an <em>infix match</em> always applies — i.e. a check for a <em>content</em> of the search text.
So you can save a <code>.*</code> at the beginning or at the end of the search text.</p></div>
<div class="paragraph"><p>There is one <strong>exception</strong> however:
If <strong>no regular expression</strong> is used in the match to the host name, rather <strong>an explicit host name,</strong> it will be checked for an <strong>exact</strong> match and <strong>not</strong> for being contained.</p></div>
<div class="paragraph"><p><strong>Attention:</strong> If the search text contains a dot (.), it will be considered a regular expression and the infix search will apply, for example <em>myhost.com</em> will then also match e.g. <code>notmyhostide</code>!</p></div>
</div>
<div class="sect3">
<h4 id="heading_matchgroups">
<span class="hidden-anchor sr-only" id="matchgroups"></span>Match groups</h4>
<div class="paragraph"><p>Very important and useful here is the concept of <a href="regexes.html#matchgroups">match groups</a> in the <span class="guihint">Text to match</span> field.
This refers to the text sections that match parenthesized expressions in the regular expression.</p></div>
<div class="paragraph"><p>Suppose you want to monitor the following type of message in the log file for a database:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>Database instance WP41 has failed</code></pre></div></div>
<div class="paragraph"><p>The <code>WP41</code> is of course variable and you surely do not want to formulate a separate rule for each different instance.
Therefore you use <code>.*</code> in the regular expression, which stands for any string:</p></div>
<div class="paragraph"><p><code>Database instance .* has failed</code></p></div>
<div class="paragraph"><p>If you now enclose the variable part in round brackets, the Event Console will <strong>memorize</strong> (<em>capture</em>) the actual value for any future actions:</p></div>
<div class="paragraph"><p><code>Database instance <strong>(.*)</strong> has failed</code></p></div>
<div class="paragraph"><p>After a successful match of the rule, the first match group is now set to the value <code>WP41</code> (or whichever instance produced the error).</p></div>
<div class="paragraph"><p>You can see these match groups in the <span class="guihint">Event Simulator</span> if you move the cursor over the green ball:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_match_groups_1.png" alt="ec match groups 1"></div></div>
<div class="paragraph"><p>You can also see the groups in the details of the generated event:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_match_groups_2.png" alt="ec match groups 2" width="700"></div></div>
<div class="paragraph"><p>Among other things, the match groups are used for:</p></div>
<div class="ulist"><ul>
<li><p><a href="#rewriting">Rewriting</a> events</p></li>
<li><p>Automatically <a href="#cancelling">cancelling</a> events</p></li>
<li><p>The <a href="#counting">counting</a> of messages</p></li>
</ul></div>
<div class="paragraph"><p>At this point, a tip:
There are situations where you need to group something in the regular expression but you do <strong>not</strong> want to create a match group.
You can do this by placing a <code>?:</code> directly following the opening parenthesis.
Example: The expression <code>one (.*) two (?:.*) three</code> creates for a match on <code>one 123 two 456 three</code> only the one match group <code>123</code>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__ip_address">
<span class="hidden-anchor sr-only" id="_ip_address"></span>IP address</h4>
<div class="paragraph"><p>In the <span class="guihint">Match original source IP address</span> field you can match the IPv4 address of the message sender.
Specify either an exact address or a network in the notation X.X.X.X/Y, e.g. <code>192.168.8.0/24</code> to match all addresses in the network <code>192.168.8.</code>X.</p></div>
<div class="paragraph"><p>Note that the match on the IP address only works if the monitored systems send directly to the Event Console.
If another connected intermediate syslog server is forwarding the messages, its address will appear instead as the sender in the message.</p></div>
</div>
<div class="sect3">
<h4 id="heading_syslogfacility">
<span class="hidden-anchor sr-only" id="syslogfacility"></span>Syslog priority and facility</h4>
<div class="paragraph"><p>The <span class="guihint">Match syslog priority</span> and <span class="guihint">Match syslog facility</span> fields are standardized information, originally defined by Syslog information.
Internally, an 8-bit field is divided into 5 bits for the facility (32 possibilities) and 3 bits for the priority (8 possibilities).</p></div>
<div class="paragraph"><p>The 32 predefined facilities were once meant for something such as an application.
But the selection was not made very forward-looking at that time.
One of the facilities is <code>uucp</code> — a protocol which by the early 90s of the last millennium was already nearly obsolete.</p></div>
<div class="paragraph"><p>But it is a fact that every message that comes via syslog carries one of these facilities.
In some cases you can also assign these freely when sending the message, in order to be able to filter them later.
This is quite useful.</p></div>
<div class="paragraph"><p>The use of facility and priority also has a performance aspect.
If you define a rule that in any case only applies to messages that all have the same facility or priority, you should define these additionally in the rule’s filters.
The Event Console can then bypass these rules very efficiently when a message with different values is received.
The more rules that have these filters set, the fewer rule comparisons are needed.</p></div>
</div>
<div class="sect3">
<h4 id="heading__inverting_a_match">
<span class="hidden-anchor sr-only" id="_inverting_a_match"></span>Inverting a match</h4>
<div class="paragraph"><p>The <span class="guihint">Negate match: Execute this rule if the upper conditions are not fulfilled.</span> checkbox causes the rule to take effect only when <em>none</em> of the conditions are fulfilled.
This is actually only useful in the context of two rule types (<span class="guihint">Rule type</span> in the <span class="guihint">Outcome &amp; Action</span> box of the rule):</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Do not perform any action, drop this message, stop processing</span>.</p></li>
<li><p><span class="guihint">Skip this rule pack, continue rule execution with next pack</span></p></li>
</ul></div>
<div class="paragraph"><p>You can learn more about the rule packs <a href="#rulepacks">below</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_outcome">
<span class="hidden-anchor sr-only" id="outcome"></span>5.2. Effect of the rule</h3>
<div class="sect3">
<h4 id="heading__rule_type_cancel_or_create_an_event">
<span class="hidden-anchor sr-only" id="_rule_type_cancel_or_create_an_event"></span>Rule type: Cancel or create an event</h4>
<div class="paragraph"><p>When a rule matches, it specifies what should happen with the message.
This is done in the <span class="guihint">Outcome &amp; Action</span> box:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_outcome.png" alt="ec outcome"></div></div>
<div class="paragraph"><p>The <span class="guihint">Rule type</span> can be used to abort the evaluation at the point entirely or for the current rule package.
Especially the first option should be used to get rid of most of the useless 'noise' using a few specific rules at the very beginning.
Only with the 'normal' rules are the other options in this box actually evaluated.</p></div>
</div>
<div class="sect3">
<h4 id="heading__setting_the_status">
<span class="hidden-anchor sr-only" id="_setting_the_status"></span>Setting the status</h4>
<div class="paragraph"><p>With <span class="guihint">State</span> the rule sets the status of the event in the monitoring.
In the rule this state will be <span class="state1">WARN</span> or <span class="state2">CRIT</span>.
Rules that generate <span class="state0">OK</span> events can be interesting in exceptions to represent certain events in a purely informative way.
In such a case a combination with an automatic <a href="#timing">expiration</a> of these events is then interesting.</p></div>
<div class="paragraph"><p>As well as setting an explicit status, there are two more dynamic options.
The <span class="guihint">(set by syslog)</span> setting takes over the classification based on the syslog priority.
This only works if the message has already been classified usable by the sender.
Messages received directly by syslog will contain one of eight RFC priorities, which are mapped as follows:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 55%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Priority</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Definition according to syslog</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emerg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system is unusable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">immediate action required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">critical condition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">err</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">warning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state1">WARN</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">warning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">normal, but significant information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">purely informational</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug message</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>In addition to syslog messages, messages from the Windows Event Log, and messages from text files that have already been classified with the Checkmk <a href="#logwatch">Logwatch</a> plug-in on the target system, provide ready-made states.
For SNMP traps this is unfortunately not available.</p></div>
<div class="paragraph"><p>A completely different method is to classify the message based on the text itself.
This can be done with the <span class="guihint">(set by message text)</span> setting:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_state_by_text.png" alt="ec state by text"></div></div>
<div class="paragraph"><p>The match to the texts configured here happens only after checking for <span class="guihint">Text to match</span> and the other rule conditions have been checked, so that you do not have to repeat those checks.</p></div>
<div class="paragraph"><p>If none of the configured patterns is found, the event returns the <span class="state3">UNKNOWN</span> state.</p></div>
</div>
<div class="sect3">
<h4 id="heading_servicelevel">
<span class="hidden-anchor sr-only" id="servicelevel"></span>Service levels</h4>
<div class="paragraph"><p>The idea behind the <span class="guihint">Service Level</span> field is that every host and every service in an organization has a certain level of importance.
This can be associated  with a specific service agreement for the host or service.
In Checkmk, you can use <a href="glossar.html#rule">rules</a> to assign such service levels to your hosts and services and then, for example, make the notification or self-defined dashboards depend on it.</p></div>
<div class="paragraph"><p>Since events do not necessarily correlate with hosts or services, the Event Console allows you to assign a service level to an event using a rule.
You can then later filter the event views using this level.</p></div>
<div class="paragraph"><p>By default, Checkmk defines four levels: 0 (no level), 10 (silver), 20 (gold), and 30 (platinum).
You can change this selection as required in the <span class="guihint">Global settings &gt; Notifications &gt; Service Levels</span>.
Decisive are the numbers designating the levels, since the levels are sorted by these numbers and also compared according to the relative importance.</p></div>
</div>
<div class="sect3">
<h4 id="heading_contactgroups">
<span class="hidden-anchor sr-only" id="contactgroups"></span>Contact groups</h4>
<div class="paragraph"><p>The contact groups used for the <a href="#visibility">visibility</a> will also be used for the <a href="#notifications">notification</a> of events. Here you can use rules to assign contact groups explicitly to events. Details
can be found in the <a href="#visibility%20">chapter on monitoring</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__actions">
<span class="hidden-anchor sr-only" id="_actions"></span>Actions</h4>
<div class="paragraph"><p>Actions are very similar to <a href="alert_handlers.html">Alert Handlers</a> for hosts and services.
Here you can have a self-defined script executed when an event is opened.
Full details describing the actions can be found below in a separate <a href="#actions">section</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__automatic_deletion_archiving">
<span class="hidden-anchor sr-only" id="_automatic_deletion_archiving"></span>Automatic deletion (archiving)</h4>
<div class="paragraph"><p>Automatic deletion (= archiving), which you can set with <span class="guihint">Delete event immediately after the actions</span> ensures that an event is not visible in the monitoring at all.
This is useful if you only want to trigger some actions automatically or if you only want to archive certain events so that you can search for them later.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_rewriting">
<span class="hidden-anchor sr-only" id="rewriting"></span>5.3. Automated rewriting of texts</h3>
<div class="paragraph"><p>With the <span class="guihint">Rewriting</span> function, an EC rule can automatically rewrite text fields in a message and add annotations.
This is configured in a separate box:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rewriting.png" alt="ec rewriting"></div></div>
<div class="paragraph"><p>When rewriting, the <a href="#matchgroups">match groups</a> are particularly important.
These allow you to include parts of the original message in the new text.
You can access the groups when rewriting as follows:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be replaced by the <em>first</em> match group in the original message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be replaced by the <em>second</em> match group in the original message (etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be replaced by the <em>complete</em> original message.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>In the above screenshot the new message text will be coded as <code>Instance \1 has been shut down.</code>
Of course, this only works if the <span class="guihint">Text to match</span> in the <strong>same</strong> rule of the regular search expression also has at least one parenthesis expression.
An example of this would be e.g.:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rewrite_match.png" alt="ec rewrite match"></div></div>
<div class="paragraph"><p>Some further notes on rewriting:</p></div>
<div class="ulist"><ul>
<li><p>Rewriting is done <em>after</em> matching and <em>before</em> performing actions.</p></li>
<li><p>Match, rewrite and actions are always performed in the same rule. It is not possible to rewrite a message and then process it with a later rule.</p></li>
<li><p>The expressions <code>\1</code>, <code>\2</code> etc. can be used in all text fields, not only in <span class="guihint">Rewrite message text</span>.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_cancelling">
<span class="hidden-anchor sr-only" id="cancelling"></span>5.4. Automated cancelling of events</h3>
<div class="paragraph"><p>Some applications or devices are kind enough to later send a suitable OK message as soon as the problem has been solved.
You can configure the EC in such a way that in such a case the event opened by the error will be automatically closed.
This is referred to as <em>cancelling</em>.</p></div>
<div class="paragraph"><p>The following figure shows a rule with which messages containing the text <code>database instance (.*) has failed</code> are searched.
The expression <code>(.*)</code> represents an arbitrary string that is trapped in a <a href="#matchgroups">match group</a>.
The expression <code>database instance (.*) recovery in progress</code>, which is in the <span class="guihint">Text to cancel event(s)</span> field in the same rule, will automatically close events created with this rule when a matching message is received:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_cancelling.png" alt="ec cancelling"></div></div>
<div class="paragraph"><p>Automatic cancellation works as long as</p></div>
<div class="ulist"><ul>
<li><p>a message is received whose text matches <span class="guihint">Text to cancel event(s)</span>,</p></li>
<li><p>the value captured here in the <code>(.*)</code> group is <em>identical</em> to the match group from the original message,</p></li>
<li><p>both messages came from the same host, and</p></li>
<li><p>it is the same application (the <span class="guihint">Syslog application to cancel event</span> field).</p></li>
</ul></div>
<div class="paragraph"><p>The match group principle is very important here.
After all, it would not make much sense if the message <code>database instance TEST recovery in progress</code> would cancel an event that had been generated by the message <code>database instance PROD has failed</code>, would it?</p></div>
<div class="paragraph"><p>Please don’t make the mistake of using the placeholder <code>\1</code> in <span class="guihint">Text to cancel events(s)</span>.
This does <em>NOT</em> work!
These placeholders only work for <a href="#rewriting">rewriting</a>.</p></div>
<div class="paragraph"><p>In some cases it happens that a text is used both to <em>create</em> and to <em>cancel</em> an event.
In such a case, cancelling has priority.</p></div>
<div class="sect3">
<h4 id="heading__perform_actions_when_cancelling">
<span class="hidden-anchor sr-only" id="_perform_actions_when_cancelling"></span>Perform actions when cancelling</h4>
<div class="paragraph"><p>You can also have <a href="#automatic_actions">actions</a> executed automatically when an event is cancelled.
It is important to know that when an event is cancelled, a number of data fields in the event are overwritten by values from the OK message before any actions are executed.
In this way the full data of the OK message is then available in the action script.
Additionally, during this phase the event’s state is flagged as <span class="state0">OK</span>.
In this way an action script can detect an override and you can use the same script for error and OK messages (e.g. when connecting to a ticket system).</p></div>
<div class="paragraph"><p>The following fields are overwritten from OK message data:</p></div>
<div class="ulist"><ul>
<li><p>The message text</p></li>
<li><p>The timestamp</p></li>
<li><p>The time of the last occurrence</p></li>
<li><p>The syslog priority</p></li>
</ul></div>
<div class="paragraph"><p>All other fields remain unchanged — including the event ID.</p></div>
</div>
<div class="sect3">
<h4 id="heading__cancellation_in_combination_with_rewriting">
<span class="hidden-anchor sr-only" id="_cancellation_in_combination_with_rewriting"></span>Cancellation in combination with rewriting</h4>
<div class="paragraph"><p>If you are using <a href="#rewriting">rewrite</a> and cancel in the same rule, you should be careful when rewriting the host name or the application.
When cancelling, the EC always checks whether the cancelling message matches the host name and application of the open event.
But if these were rewritten the cancellation would never work.</p></div>
<div class="paragraph"><p>Therefore, before cancelling the event, the Event Console simulates a rewrite of the host name and application to compare the relevant texts.
This is probably what you would expect.</p></div>
<div class="paragraph"><p>You can also take advantage of this behavior if the application field in the error message and the later OK message do not match.
In this case, simply rewrite the application field to a known fixed value.
This in fact leads to the result that this field will be ignored.</p></div>
</div>
<div class="sect3">
<h4 id="heading__cancellation_based_on_syslog_priority">
<span class="hidden-anchor sr-only" id="_cancellation_based_on_syslog_priority"></span>Cancellation based on syslog priority</h4>
<div class="paragraph"><p>There are (unfortunately) situations where the text of the error and OK messages is absolutely identical.
In most cases the actual status is not coded in the text, but in the in the syslog priority.</p></div>
<div class="paragraph"><p>For this purpose there is the <span class="guihint">Syslog priority to cancel event</span> option.
Here enter the range <code>debug</code> …​ <code>notice</code> for example.
All priorities in this range are normally considered to have an OK status.
When using this option you should <em>still</em> enter a suitable text in the <span class="guihint">Text to cancel event(s)</span> field, otherwise the rule will match on all OK messages that affect the same application.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_counting">
<span class="hidden-anchor sr-only" id="counting"></span>5.5. Counting messages</h3>
<div class="paragraph"><p>In the <span class="guihint">Counting &amp; Timing</span> box you will find options for counting similar messages.
The idea is that some messages are only relevant if they occur <em>too frequently</em> or <em>too rarely</em> within specified time periods.</p></div>
<div class="sect3">
<h4 id="heading__too_frequent_messages">
<span class="hidden-anchor sr-only" id="_too_frequent_messages"></span>Too frequent messages</h4>
<div class="paragraph"><p>You can activate the check for messages that occur too often with the <span class="guihint">Count messages in interval</span> option:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_counting.png" alt="ec counting"></div></div>
<div class="paragraph"><p>Here you first specify a time period at <span class="guihint">Time period for counting</span> and the number of messages which should lead to the opening of an event at <span class="guihint">Count until triggered</span>.
In the example above this is set to 10 messages per hour.
Of course these are not 10 arbitrary messages, rather messages that are matched by the rule.</p></div>
<div class="paragraph"><p>Normally it makes sense not to count all matching messages globally, but only those which refer to the same 'cause'.
To control this, there are the three checkboxes for options prefixed by <span class="guihint">Force separate events for different …​</span>.
These are preset in such a way that messages are only counted together if they match in:</p></div>
<div class="ulist"><ul>
<li><p>host</p></li>
<li><p>application</p></li>
<li><p><a href="#matchgroups">match groups</a></p></li>
</ul></div>
<div class="paragraph"><p>This allows you to formulate rules such as 'If more than 10 messages are received per hour from the same host, the same application and there the same site, then…​'.
Due to the rule this can result in multiple differing events being generated.</p></div>
<div class="paragraph"><p>If, for example, you deselect all three checkboxes, then the counting will be done only globally and the rule will be able to generate only one event in total!</p></div>
<div class="paragraph"><p>By the way, it can make sense to enter 1 as the count.
In this way you can effectively get a grip on 'event storms'. If, for
example in a short time frame 100 messages of the same kind are received, then nevertheless only  one event will be created. You will then see in the event details</p></div>
<div class="ulist"><ul>
<li><p>the time the first message occurred,</p></li>
<li><p>the time the most recent message occurred, and</p></li>
<li><p>the total number of messages combined in this event.</p></li>
</ul></div>
<div class="paragraph"><p>When the case is then closed, via two checkboxes you can define when a new event should be opened.
Normally an acknowledgement of the event creates a situation that if further messages are received, a new count is started and a new event is triggered.
You can disable this function with <span class="guihint">Continue counting when event is acknowledged</span>.</p></div>
<div class="paragraph"><p>The <span class="guihint">Discontinue counting after time has elapsed</span> option ensures that a separate event is always opened for each comparison period.
In the above example a threshold of 10 messages per hour was specified.
If this option is enabled, a maximum of 10 messages of one hour will be added to an already opened event.
As soon as the hour has elapsed, if a sufficient number of messages have been received a new event will be opened.</p></div>
<div class="paragraph"><p>For example, if you set the number to 1 and the time interval to one day, you will only see a maximum of one event of this message type per day.</p></div>
<div class="paragraph"><p>The <span class="guihint">Algorithm</span> setting may be a bit surprising at first sight.
But let’s be realistic:
What do you actually mean by <em>'10 messages per hour'?</em>
Which hour is meant by that?
Always full hours of the time of day?
It could be that in the last minute an one hour nine messages are received, and nine more in the first minute of the next hour.
That then makes 18 messages in only two minutes of elapsed time, but still less than 10 per hour, and so the rule would not apply.
That doesn’t sound very reasonable  …​</p></div>
<div class="paragraph"><p>Since there is no single solution to this problem, Checkmk provides three different definitions of exactly what <em>'10 messages per hour'</em> should mean:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Algorithm</th>
<th class="tableblock halign-left valign-top">Functionality</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Interval</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counting interval starts at the first incoming matching message. An event in the <span class="guihint">counting</span> phase is generated. If the specified time elapses before the count is reached, the event is silently deleted. However, if the count is reached before the time expires, the event is opened <em>immediately</em> (and any configured actions are triggered).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Token Bucket</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This algorithm does not work with fixed time intervals, but implements a method that is often used in networks for traffic shaping. Suppose you have configured 10 messages per hour. That’s an average of one every 6 minutes. The first time a matching message is received, an event is generated in the <span class="guihint">counting</span> phase and the count is set to 1. For each subsequent message, this is increased by 1. And every 6 minutes, the counter is <em>decreased</em> by 1 again — regardless of whether a message has come or not. If the counter drops to 0 again, the event is deleted. So the trigger is fired when the rate of messages <em>on average</em> is permanently above 10 per hour.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Dynamic Token Bucket</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a variant of the <span class="guihint">Token Bucket</span> algorithm, where the smaller the counter is at any given time, the slower it decreases. In the above example, if the counter was 5, it would only decrease every <em>12</em> minutes instead of every 6 minutes. The overall effect of this is that notification rates just above the allowed rate will open an event (and thus be notified) much faster.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>So which algorithm should you choose?</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Interval</span> is the simplest to understand and easier to follow if you later want to perform an exact count in your syslog archive.</p></li>
<li><p><span class="guihint">Token Bucket</span> on the other hand is smarter and 'softer'. There are fewer anomalies at the edges of the intervals.</p></li>
<li><p><span class="guihint">Dynamic Token Bucket</span> makes the system more reactive and generates notifications faster.</p></li>
</ul></div>
<div class="paragraph"><p>Events that have not yet reached the set number, are latent but not automatically visible to the operator.
They are in the <span class="guihint">counting</span> phase.
You can make such events visible with the <span class="guihint">phase</span> filter in the event view:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_phase_filter_counting.png" alt="ec phase filter counting" width="440"></div></div>
</div>
<div class="sect3">
<h4 id="heading_expect">
<span class="hidden-anchor sr-only" id="expect"></span>Too infrequent or missing messages</h4>
<div class="paragraph"><p>Just as the arrival of a particular message can mean a problem, so too the <strong>absence</strong> of a message can also mean a problem.
You may expect at least one message per day from a particular job.
If this message does not arrive, the job is probably not running and should be fixed urgently.</p></div>
<div class="paragraph"><p>You can configure something like this under <span class="guihint">Counting &amp; Timing &gt; Expect regular messages</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_expect_messages.png" alt="ec expect messages"></div></div>
<div class="paragraph"><p>As with counting, you need to specify a time period in which you expect the message(s) to appear.
Here, however, a completely different algorithm is used, which makes much more sense at this point.
The time period is always aligned exactly to defined positions.
For example, the interval <span class="guihint">hour</span> always starts at minute and second zero.
You have the following options:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Interval</th>
<th class="tableblock halign-left valign-top">Alignment</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">10 seconds</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On a number of seconds divisible by 10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">minute</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On the full minute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">5 minutes</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At 0:00, 0:05, 0:10, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">15 minutes</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At 0:00, 0:15, 0:30, 0:45, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">hour</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At the beginning of every full hour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">day</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exactly at 00:00, but in a configurable time zone. This also allows you to say that you expect a message between 12:00 and 12:00 the next day. For example, if you are in the <span class="guihint">UTC+1</span> time zone yourself, specify <span class="guihint">UTC-11</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">two days</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At the beginning of a full hour. You can specify a time zone offset from 0 to 47 here, referring to 1970-01-01 00:00:00 UTC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">week</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At 00:00 on Thursday morning in the UTC time zone plus the offset, which you can output in hours. Thursday because 1/1/1970 — the start of the "epoch", was on a Thursday.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Why is this so complicated?
This is to avoid false alarms.
Do you expect one message from a backup per day for instance?
Surely there will be slight differences in the runtime of the backup, so that the messages are not received exactly 24 hours apart.
For example, if you expect the message to arrive around midnight, give or take an hour or two, an interval from 12:00 to 12:00 will be much more realistic than one from 00:00 to 00:00.
However, should the message fail to appear you will only receive a notification at 12:00 o’clock midday.</p></div>
</div>
<div class="sect3">
<h4 id="heading__multiple_occurrences_of_the_same_problem">
<span class="hidden-anchor sr-only" id="_multiple_occurrences_of_the_same_problem"></span>Multiple occurrences of the same problem</h4>
<div class="paragraph"><p>The <span class="guihint">Merge with open event</span> option is preset in such a way that in the case of the same message appearing repeatedly, the existing event will be updated.
You can alter this so that a new event is opened each time.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_timing">
<span class="hidden-anchor sr-only" id="timing"></span>5.6. Timing</h3>
<div class="paragraph"><p>Under <span class="guihint">Counting &amp; Timing</span> there are two options which affect the opening and/or automatic closing of events.</p></div>
<div class="paragraph"><p>The <span class="guihint">Delay event creation</span> option is useful if you are working with the automatic <a href="#cancelling">cancelling</a> of events.</p></div>
<div class="paragraph"><p>Set e.g. a delay of 5 minutes, then in the case of an error message the event created will remain in the <span class="guihint">delayed</span> state for 5 minutes — in the hope that the OK message will arrive within this time.
If this is the case, the event is closed automatically and without fuss, and does not appear in the monitoring.
If the time expires, however, the event will be opened and any of its possibly defined actions will be executed:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_delay.png" alt="ec delay"></div></div>
<div class="paragraph"><p>More or less the opposite is done by <span class="guihint">Limit event lifetime</span>.
With this you can cause events to close automatically after a certain time.
This is useful, for example, for informational events with an <span class="state0">OK</span> status that you would like to display, but for which you do not want the monitoring to generate any activity.
By automatically 'switching out' you save yourself the manual deletion of such messages:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_limit_livetime.png" alt="ec limit livetime"></div></div>
<div class="paragraph"><p>Acknowledging the message will stop the switching out for the time being.
This behavior can be controlled with the two checkboxes.</p></div>
</div>
<div class="sect2">
<h3 id="heading_rulepacks">
<span class="hidden-anchor sr-only" id="rulepacks"></span>5.7. Rule packages</h3>
<div class="paragraph"><p>Rule packages not only have the benefit of making things more manageable, but they can also simplify the configuration of multiple similar rules and at the same time speed up the evaluation.</p></div>
<div class="paragraph"><p>Suppose you have a set of 20 rules that all revolve around the Windows Event Log <span class="guihint">Security</span>.
All of these rules have in common that they check in the condition for a certain text in the application field (the name of this log file is used in the messages from the EC as <span class="guihint">Application</span>).
In such a case, proceed as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Create your own rule package.</p></li>
<li><p>Create the 20 rules for <span class="guihint">Security</span> in this package or move them there (selection list <span class="guihint">Move to pack…​</span> on the right side of the rules table).</p></li>
<li><p>Remove the condition on the application from all of these rules.</p></li>
<li><p>Create <strong>as the first rule</strong> in the package a rule by which messages leave the package immediately if the application is <em>not</em> <span class="guihint">Security</span>.</p></li>
</ol></div>
<div class="paragraph"><p>This exclusion rule is structured as follows:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Matching Criteria &gt; Match syslog application (tag)</span> on <code>Security</code>.</p></li>
<li><p><span class="guihint">Matching Criteria &gt; Invert matching</span> on <span class="guihint">Negate match: Execute this rule if the upper conditions are not fulfilled.</span></p></li>
<li><p><span class="guihint">Outcome &amp; Action &gt; Rule type</span> on <span class="guihint">Skip this rule pack, continue rule execution with next rule pack</span></p></li>
</ul></div>
<div class="paragraph"><p>Any message that does not come from the security log will be 'rejected' by the first rule in this package.
This not only simplifies the rest of the rules in the package, but also speeds up the processing, since in most cases the other rules do not have to be checked at all.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_actions">
<span class="hidden-anchor sr-only" id="actions"></span>6. Actions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__types_of_actions">
<span class="hidden-anchor sr-only" id="_types_of_actions"></span>6.1. Types of actions</h3>
<div class="paragraph"><p>The Event Console includes three types of actions, which you can execute either manually or when opening or <a href="#cancelling">cancelling</a> events:</p></div>
<div class="ulist"><ul>
<li><p>Executing self-written shell scripts.</p></li>
<li><p>Sending self-defined emails</p></li>
<li><p>Generating Checkmk <a href="#notifications">notifications</a></p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__shell_scripts_and_emails">
<span class="hidden-anchor sr-only" id="_shell_scripts_and_emails"></span>6.2. Shell scripts and emails</h3>
<div class="paragraph"><p>You must first define emails and scripts in the <a href="#globalsettings">Event Console settings</a>.
You can find these under the <span class="guihint">Actions (Emails &amp; Scripts)</span> entry:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_add_action.png" alt="ec add action"></div></div>
<div class="sect3">
<h4 id="heading__executing_shell_scripts">
<span class="hidden-anchor sr-only" id="_executing_shell_scripts"></span>Executing shell scripts</h4>
<div class="paragraph"><p>With the <span class="guihint">Add new action</span> button you can create a new action.
The following example shows how to create a simple shell script as an action of the <span class="guihint">Execute Shell Script</span> type.
Details for the events are available to the script via environment variables,
for example the <code>$CMK_ID</code> of the event, the <code>$CMK_HOST</code>, full text <code>$CMK_TEXT</code> or the first match group as <code>$CMK_MATCH_GROUP_1</code>.
For a complete list of available environment variables, see the <span class="image-inline"><img src="../images/icons/icon_help.png" alt="icon help"></span> inline help.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_define_action.png" alt="ec define action"></div></div>
<div class="paragraph"><p>Older versions of Checkmk allowed environment variables as well as macros such as <code>$TEXT$</code> which were replaced before the script was executed.
Because of the danger that an attacker could inject commands via a specially crafted UDP packet that is executed with the privileges of the Checkmk process, you should not make use of macros.
Macros are currently still supported for for compatibility reasons, but we reserve the right to remove them in a future version of Checkmk.</p></div>
<div class="paragraph"><p>The sample script shown in the screenshot creates the file <code>tmp/test.out</code> in the site directory in which it writes a text containing the concrete values for the variables for the respective last event:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>cat &lt;&lt; EOF &gt; ${OMD_ROOT}/tmp/test.out
Something happened:

Event-ID: $CMK_ID
Host: $CMK_HOST
Application: $CMK_APPLICATION
Message: $CMK_TEXT
EOF</code></pre></div></div>
<div class="paragraph"><p>The scripts are executed under the following environment:</p></div>
<div class="ulist"><ul>
<li><p><code>/bin/bash</code> is used as the interpreter.</p></li>
<li><p>The script runs as the site user with the site’s home directory (e.g. <code>/omd/sites/mysite</code>).</p></li>
<li><p>While the script is running processing of other events is stopped!</p></li>
</ul></div>
<div class="paragraph"><p>If your script possibly contains wait times, you can make it run asynchronously using the <code>at</code> Linux spooler.
To do this, create the script in a separate <code>local/bin/myaction</code> file and start it with the <code>at</code> command, e.g.:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>echo "$OMD_ROOT/local/bin/myaction '$HOST$' '$TEXT$' | at now</code></pre></div></div>
</div>
<div class="sect3">
<h4 id="heading__sending_emails">
<span class="hidden-anchor sr-only" id="_sending_emails"></span>Sending emails</h4>
<div class="paragraph"><p>The <span class="guihint">Send Email</span> action type sends a simple text email.
You could actually also do this with a script, for instance by using the <code>mail</code> command line command.
But this way it is more convenient.
Please note that placeholders are also allowed in the <span class="guihint">Recipient email address</span> and <span class="guihint">Subject</span> fields.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_define_action_email.png" alt="ec define action email"></div></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_notifications">
<span class="hidden-anchor sr-only" id="notifications"></span>6.3. Notifications through Checkmk</h3>
<div class="paragraph"><p>In addition to executing scripts and sending (simple) emails, the EC has a third type of action: sending notifications via the Checkmk <a href="glossar.html#notification#">notification system</a>.
Notifications can be generated by the EC in the same way as the host and service notifications from the active monitoring.
The advantages compared to the simple emails as described above are obvious:</p></div>
<div class="ulist"><ul>
<li><p>Notification is configured for active and event-based monitoring together in a central location.</p></li>
<li><p>Features such as <a href="notifications.html#bulk">bulk notifications</a>, HTML emails and other useful functions are available.</p></li>
<li><p>Custom notification rules, turning off notifications and the like work as usual.</p></li>
</ul></div>
<div class="paragraph"><p>The <span class="guihint">Send monitoring notification</span> action type always processes automatically and does not need to be configured.</p></div>
<div class="paragraph"><p>Since events differ somewhat from the 'normal' hosts or services, there are some peculiarities in their notifications, which you can learn about in more detail in the following section.</p></div>
<div class="sect3">
<h4 id="heading__assignment_to_existing_hosts">
<span class="hidden-anchor sr-only" id="_assignment_to_existing_hosts"></span>Assignment to existing hosts</h4>
<div class="paragraph"><p>Events can come from any host — regardless of whether they are configured in the active monitoring or not.
After all, the syslog and SNMP ports are open to all hosts on the network.
As a result the extended host attributes such as alias, host tags, contacts, etc. are initially not available.
This in particular is why <em>conditions</em> in notification rules do not necessarily work as you would expect them to.</p></div>
<div class="paragraph"><p>For example, when notifying, the EC attempts to find a host within the active monitoring that matches the event.
This is done using the same procedure is used as that for <a href="#visibility">visibility of events</a>.
If such a host can be found, the following data is taken from this host:</p></div>
<div class="ulist"><ul>
<li><p>The correct spelling of the host name.</p></li>
<li><p>The host alias</p></li>
<li><p>The primary IP address configured in Checkmk.</p></li>
<li><p>The host tags</p></li>
<li><p>The folder in the Setup GUI</p></li>
<li><p>The list of contacts and contact groups</p></li>
</ul></div>
<div class="paragraph"><p>As a result, the host name in the processed notification may not exactly match the host name in the original message.
The coding of notification texts that conform with those from the active monitoring, however, simplifies the formulation of uniform notification rules which include conditions that apply to the host name.</p></div>
<div class="paragraph"><p>The mapping is done in real time by sending an <a href="glossar.html#Livestatus">livestatus</a> query to the monitoring core which runs in the same site as the EC that received the message.
Of course this only works if the syslog messages, SNMP traps etc. are always sent to the Checkmk site on which the host is being actively monitored!</p></div>
<div class="paragraph"><p>If the query does not work or the host cannot be found, substitute data will be accepted:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Host name</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name from the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Host alias</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name will be used as alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">IP-Address</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address field contains the address of the original sender of the message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Host tags</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host will not receive a host tag. If you have host tag groups with empty tags, the host adopts those tags, but otherwise it has no tags from the group. Please keep this in mind when you define conditions referring to host tags in the notification rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Setup-GUI Folder</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No folder. All conditions that go to a specific folder are thus unfulfillable — even in the case of the main folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Contacts</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of contacts is empty. If fallback contacts are present, they will be entered.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>If the host cannot be assigned in the active monitoring, this can of course lead to problems with the notifications.
On the one hand because of the conditions, which may then no longer apply, and also because of the contact selection.
For such cases you can modify your notification rules so that notifications from the Event Console are handled specifically using their own rules.
For this purpose there is a separate condition with which you can either match positively only to EC notifications, or vice versa exclude them:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_notification_condition.png" alt="ec notification condition"></div></div>
</div>
<div class="sect3">
<h4 id="heading__remaining_notification_fields">
<span class="hidden-anchor sr-only" id="_remaining_notification_fields"></span>Remaining notification fields</h4>
<div class="paragraph"><p>In order for notifications from the EC to pass through the active monitoring’s notification system, the EC must be adapted to to conform to its scheme.
In the process the typical data fields for a notification are filled as effectively as possible.
We have just described how the host’s data is determined.
Further fields are:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Notification type</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EC notifications are always considered to be <em>Service messages.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Service description</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the content of the event’s <span class="guihint">Application</span> field. If this field is empty, <code>Event Console</code> will be entered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Notification</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is fixed to <code>1</code>, so no escalation is possible in this case, likewise for when multiple consecutive events of the same kind happen independently from each other. Currently the EC does not support repeated notification when an event has not been acknowledged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">date/time</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For events that are <a href="#counting">counted</a>, this is the time of the <em>latest</em> occurrence of a message associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Pluginoutput</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The text content of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">ServiceState</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State of the event, i.e. <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> or <span class="state3">UNKNOWN</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Previous state</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since events have no previous state, <span class="state0">OK</span> is always entered here for normal events, and <span class="state2">CRIT</span> is always entered here when <a href="#cancelling%20">cancelling an event</a>. This rule is closest to what is needed for notification rules that have a condition on the exact state change.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__manually_defining_contact_groups">
<span class="hidden-anchor sr-only" id="_manually_defining_contact_groups"></span>Manually defining contact groups</h4>
<div class="paragraph"><p>As described above, it may not be possible to determine the contacts for an event automatically.
In such cases you can specify contact groups directly in the EC rule which is to be used for the notification.
It is important that you do not forget to check the <span class="guihint">Use in notifications</span> box:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_set_contact_groups.png" alt="ec set contact groups"></div></div>
</div>
<div class="sect3">
<h4 id="heading__global_switch_for_notifications">
<span class="hidden-anchor sr-only" id="_global_switch_for_notifications"></span>Global switch for notifications</h4>
<div class="paragraph"><p>There is a central switch for notifications in the <span class="guihint">Master control</span> snapin.
This also applies to notifications forwarded by the EC:</p></div>
<div class="imageblock"><div class="content"><img src="../images/master_control_notifications_off.png" alt="master control notifications off" width="400"></div></div>
<div class="paragraph"><p>Just as with the host assignment, querying the switch by the EC requires Livestatus access to the local monitoring core.
A successful query can be seen in the log file from the Event Console:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482142567.147669] Notifications are currently disabled. Skipped notification for event 44</code></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="heading__host_scheduled_downtimes">
<span class="hidden-anchor sr-only" id="_host_scheduled_downtimes"></span>Host scheduled downtimes</h4>
<div class="paragraph"><p>The Event Console is able to detect hosts that are currently in a <a href="glossar.html#scheduled_downtime">scheduled downtime</a> and does not send notifications in such situations.
In the log file it will look like this:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482144021.310723] Host myserver123 is currently in scheduled downtime. Skipping notification of event 433.</code></pre></div>
</div>
<div class="paragraph"><p>Of course, this also requires the host to be successfully found in the active monitoring.
If this is not successful, it is assumed that the host is <em>not</em> in downtime and a notification will in any case be generated.</p></div>
</div>
<div class="sect3">
<h4 id="heading__additional_macros">
<span class="hidden-anchor sr-only" id="_additional_macros"></span>Additional macros</h4>
<div class="paragraph"><p>When you write your own <a href="notifications.html#scripts">notification scripts</a>, especially for notifications coming from the Event Console a number of additional variables will be available that describe the original event (accessed as usual with the prefix <code>NOTIFY_</code>):</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_RULE_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the rule that created the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog priority as a number from <code>0</code> (<code>emerg</code>) to <code>7</code> (<code>debug</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_FACILITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog facility — also as a number. The value range is from <code>0</code> (<code>kern</code>) to <code>32</code> (<code>snmptrap</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PHASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Phase of the event. Since only open events trigger actions, this should be <code>open</code>. For a manual notification of an already acknowledged event, <code>ack</code> should be here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_COMMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The comment field of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_OWNER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <span class="guihint">Owner</span> field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_CONTACT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The comment field with the event-specific contact information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the process which sent the message (for syslog events).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_MATCH_GROUPS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The match groups from matches in the rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_CONTACT_GROUPS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional manually defined contact groups in the rule.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="heading_automatic_actions">
<span class="hidden-anchor sr-only" id="automatic_actions"></span>6.4. Executing actions</h3>
<div class="paragraph"><p>Above in <a href="#commands">Commands</a> you have already learned about the manual execution of actions by the operator.
More exciting is the automatic execution of actions, which you can configure with EC rules in the <span class="guihint">Outcome &amp; Action</span> section:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_actions.png" alt="ec rule actions"></div></div>
<div class="paragraph"><p>Here you can select one or more actions that will be executed whenever an event is <em>opened</em> or <a href="#cancelling">cancelled</a> based on the rule.
For the latter you can use the <span class="guihint">Do cancelling actions</span> list to specify whether the action should only be executed if the cancelled event has already reached the <span class="guihint">open</span> phase.
When using <a href="#counting">counting</a> or <a href="#timing">delay</a> it can happen that events that are still in the waiting state and not yet visible to the user are cancelled .</p></div>
<div class="paragraph"><p>The execution of actions is recorded in the log file <code>var/log/mkeventd.log</code>:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1481120419.712534] Executing command: ACTION;1;cmkadmin;test
[1481120419.718173] Exitcode: 0</code></pre></div>
</div>
<div class="paragraph"><p>These are also written in the <a href="#archive">archive</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_snmp">
<span class="hidden-anchor sr-only" id="snmp"></span>7. SNMP traps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__setting_up_snmp_trap_reception">
<span class="hidden-anchor sr-only" id="_setting_up_snmp_trap_reception"></span>7.1. Setting up SNMP trap reception</h3>
<div class="paragraph"><p>Since the Event Console has its own built-in SNMP engine, setting the reception of SNMP traps is very simple.
You do not need <code>snmptrapd</code> from the operating system!
If you already have this running, please stop it.</p></div>
<div class="paragraph"><p>As described in the section about the <a href="#setup">setup</a> of the Event Console, use <code>omd config</code> to enable the trap receiver in this site:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_config_traps.png" alt="ec config traps" width="360"></div></div>
<div class="paragraph"><p>Since on each server the UDP port for the traps can be used by only one process, this may only be done in one Checkmk site per computer.
When starting the site, in the line containing <code>mkeventd</code> you can check whether the trap reception has been enabled:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Starting mkeventd (builtin: snmptrap)...OK</span>
<span class="tok-go">Starting liveproxyd...OK</span>
<span class="tok-go">Starting mknotifyd...OK</span>
<span class="tok-go">Starting rrdcached...OK</span>
<span class="tok-go">Starting cmc...OK</span>
<span class="tok-go">Starting apache...OK</span>
<span class="tok-go">Starting dcd...OK</span>
<span class="tok-go">Starting redis...OK</span>
<span class="tok-go">Initializing Crontab...OK</span></code></pre></div></div>
<div class="paragraph"><p>For SNMP traps to work, the sender and receiver must agree on certain <span class="guihint">credentials</span>.
In the case of SNMP version 1 and 2c this is a simple password, which is known as a 'Community'.
With Version 3 you need a few more credentials.
You configure these credentials in the <a href="#globalsettings">Event Console settings</a> under <span class="guihint">Credentials for processing SNMP traps</span>.
You can use the <span class="guihint">Add new element</span> button to set up several different credentials which can be used as alternatives by the devices:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_credentials.png" alt="ec trap credentials"></div></div>
<div class="paragraph"><p>The much more complex part is now, of course, to specify the target address for all the devices that are to be monitored and to configure the credentials here as well configure the credentials.</p></div>
</div>
<div class="sect2">
<h3 id="heading__testing">
<span class="hidden-anchor sr-only" id="_testing"></span>7.2. Testing</h3>
<div class="paragraph"><p>Unfortunately very few devices offer meaningful testing capabilities.
At least you can easily test the reception of traps manually using the Event Console itself by sending a test trap — preferably from another Linux system.
This can be done with the <code>snmptrap</code> command.
The following example sends a trap to <code>192.168.178.11</code>.
The sender’s own host name is specified after <code>.1.3.6.1</code> and must be resolvable or be specified as an IP address (here <code>192.168.178.30</code>):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>snmptrap<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-m">1</span><span class="tok-w"> </span>-c<span class="tok-w"> </span>public<span class="tok-w"> </span><span class="tok-m">192</span>.168.178.11<span class="tok-w"> </span>.1.3.6.1<span class="tok-w"> </span><span class="tok-m">192</span>.168.178.30<span class="tok-w"> </span><span class="tok-m">6</span><span class="tok-w"> </span><span class="tok-m">17</span><span class="tok-w"> </span><span class="tok-s1">''</span><span class="tok-w"> </span>.1.3.6.1<span class="tok-w"> </span>s<span class="tok-w"> </span><span class="tok-s2">"Just kidding"</span></code></pre></div></div>
<div class="paragraph"><p>If you have set the <span class="guihint">Log level</span> to <span class="guihint">Verbose logging</span> in the settings, you will be able to see the reception and evaluation of the traps in the EC’s log file:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482387549.481439] Trap received from 192.168.178.30:56772. Checking for acceptance now.
[1482387549.485096] Trap accepted from 192.168.178.30 (ContextEngineId "0x80004fb8054b6c617070666973636816893b00", ContextName "")
[1482387549.485136] 1.3.6.1.2.1.1.3.0                        = 329887
[1482387549.485146] 1.3.6.1.6.3.1.1.4.1.0                    = 1.3.6.1.0.17
[1482387549.485186] 1.3.6.1.6.3.18.1.3.0                     = 192.168.178.30
[1482387549.485219] 1.3.6.1.6.3.18.1.4.0                     =
[1482387549.485238] 1.3.6.1.6.3.1.1.4.3.0                    = 1.3.6.1
[1482387549.485258] 1.3.6.1                                  = Just kidding</code></pre></div>
</div>
<div class="paragraph"><p>In the event of incorrect credentials, you will only see a single line:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482387556.477364] Trap received from 192.168.178.30:56772. Checking for acceptance now.</code></pre></div>
</div>
<div class="paragraph"><p>And this is how an event generated by such a trap looks like:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event.png" alt="ec trap event"></div></div>
</div>
<div class="sect2">
<h3 id="heading__turning_numbers_into_text_translating_traps">
<span class="hidden-anchor sr-only" id="_turning_numbers_into_text_translating_traps"></span>7.3. Turning numbers into text: Translating traps</h3>
<div class="paragraph"><p>SNMP is a binary protocol and it is very sparing with its textual descriptions of the messages.
The trap type is communicated internally by a sequence of numbers in the so-called OIDs.
These are displayed as sequences of numbers separated by points (e.g. <code>1.3.6.1.6.3.18.1.3.0</code>).</p></div>
<div class="paragraph"><p>With the help of so-called MIB files the Event Console can translate these numeric sequences into texts.
So, for example, <code>1.3.6.1.6.3.18.1.3.0</code> becomes the text <code>SNMPv2-MIB::sysUpTime.0</code>.</p></div>
<div class="paragraph"><p>The translation of the traps can be enabled in the Event Console settings:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_translate_traps.png" alt="ec translate traps"></div></div>
<div class="paragraph"><p>The test trap from above now generates a slightly different event:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event_translated.png" alt="ec trap event translated"></div></div>
<div class="paragraph"><p>If you have activated the <span class="guihint">Add OID descriptions</span> option, the whole thing gets much more detailed — and more confusing.
It does however help to better understand what a trap actually does:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event_translated2.png" alt="ec trap event translated2"></div></div>
</div>
<div class="sect2">
<h3 id="heading__uploading_your_own_mibs">
<span class="hidden-anchor sr-only" id="_uploading_your_own_mibs"></span>7.4. Uploading your own MIBs</h3>
<div class="paragraph"><p>Regrettably, the advantages of open source have not yet spread to the authors of MIB files, and so we from the Checkmk project are unfortunately not able to deliver vendor specific MIB files.
Only a small collection of free basic MIBs is preinstalled, which for exanmple provides for a translation of <code>sysUpTime</code>.</p></div>
<div class="paragraph"><p>You can however add these files to the Event Console in the <span class="guihint">SNMP MIBs for trap translation</span> module via the menu entry <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add one or multiple MIBs</span> to upload your own MIB files, as the following has done with some MIBs from <em>Netgear Smart Switches</em>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_mibs_for_translation.jpg" alt="ec mibs for translation"></div></div>
<div class="paragraph"><p>Notes on the MIBs:</p></div>
<div class="ulist"><ul>
<li><p>The uploaded files are stored under <code>local/share/snmp/mibs</code>. You can also store them there manually if the method via the GUI is too cumbersome for you.</p></li>
<li><p>Instead of single files you can also upload ZIP files with MIB collections in a single action.</p></li>
<li><p>MIBs have dependencies amongst each other. Missing MIBs will be shown to you by Checkmk.</p></li>
<li><p>The uploaded MIBs are also used on the command line by <code>cmk --snmptranslate</code>.</p></li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_logwatch">
<span class="hidden-anchor sr-only" id="logwatch"></span>8. Monitoring log files</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Checkmk agent is able to analyze log files via the <span class="guihint">Logwatch</span> plug-in.
This plug-in first of all provides its own monitoring of log files independently of the Event Console — including the possibility of acknowledging messages directly in the monitoring.
There is also the possibility of transfering the messages found by the plug-in 1:1 into the Event Console.</p></div>
<div class="paragraph"><p>In the Windows agent, the log file monitoring is permanently integrated — in the form of a plug-in for the evaluation of text files and one for the evaluation of Windows Event Logs.
The Python-coded plug-in <code>mk_logwatch</code> is available or Linux and Unix.
All three can be accessed via the <a href="wato_monitoringagents.html#bakery">Agent Bakery</a> for their set up or configuration.
Use the following rulesets to do so:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Text logfiles (Linux, Solaris, Windows)</span></p></li>
<li><p><span class="guihint">Finetune Windows Eventlog monitoring</span></p></li>
</ul></div>
<div class="paragraph"><p>The precise configuration of the Logwatch plug-in is not the subject of this article.
What is important, however, is that you still perform the best possible pre-filtering of the messages in the Logwatch plug-in itself and do not just send the complete contents of the text files to the Event Console.</p></div>
<div class="paragraph"><p>Please don’t confuse this with the <em>subsequent</em> reclassification via the <span class="guihint">Logfile patterns</span> rule set.
This can only change the status of messages that have already been sent by the agent.
However, if you have already set up these templates and want to simply switch from Logwatch to the Event Console, you can keep the patterns.
For this purpose, the forwarding rules (<span class="guihint">Logwatch Event Console Forwarding</span>) include the option <span class="guihint">Reclassify messages before forwarding them to the EC</span>.</p></div>
<div class="paragraph"><p>In this case, all messages pass through a total of <strong>three</strong> rule chains:
on the agent, through reclassification and in the Event Console!</p></div>
<div class="paragraph"><p>Now change Logwatch in a way that the messages found by the plug-ins are no longer monitored with the normal Logwatch check, instead simply forwarded 1:1 to the Event Console and processed there.
This is done with the <span class="guihint">Logwatch Event Console Forwarding</span> rule set:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_logwatch_forwarding.png" alt="ec logwatch forwarding"></div></div>
<div class="paragraph"><p>A few notes in this regard:</p></div>
<div class="paragraph"><p>If you have a distributed environment where each site does not have its own Event Console, the remote sites must forward their messages to the central site via syslog.
The default for this is UDP, however, this is not a secure protocol.
A better solution is to use syslog via TCP, but you will have to <a href="#setup">enable</a> this in the central site (<code>omd config</code>).</p></div>
<div class="paragraph"><p>When forwarding, specify any <span class="guihint">Syslog facility</span>.
By means of this you can easily recognize the forwarded messages in the EC.
Well suited for this are <code>local0</code> to <code>local7</code>.</p></div>
<div class="paragraph"><p>With <span class="guihint">List of expected logfiles</span> you can monitor the list of expected logfiles and be warned if certain files are not found as expected.</p></div>
<div class="paragraph"><p><strong>Important:</strong> Saving the rule alone does not accomplish anything.
This rule only becomes active during a service discovery.
Only when you run it again, will the previous logwatch services be removed, and instead <em>one</em> new service  named <span class="guihint">Log Forwarding</span> is created for each host.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_log_forwarding_check.png" alt="ec log forwarding check"></div></div>
<div class="paragraph"><p>This check will also later show you should any problems occur when forwarding to the Event Console.</p></div>
<div class="sect2">
<h3 id="heading__service_level_and_syslog_priorities">
<span class="hidden-anchor sr-only" id="_service_level_and_syslog_priorities"></span>8.1. Service level and syslog priorities</h3>
<div class="paragraph"><p>Since forwarded log files often lack syslog classification depending on the format used, you can define the reclassification in the <span class="guihint">Logwatch Event Console Forwarding</span> rule set under <span class="guihint">Log Forwarding</span>.
Additionally, in the rule sets you define as a part of the <span class="guihint">Rule packs</span> it is always possible to <a href="#outcome">set the status and service levels</a> individually.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_eventsgostate">
<span class="hidden-anchor sr-only" id="eventsgostate"></span>9. Event status in active monitoring</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you also want to see which hosts in the active monitoring currently have open problematic events, you can add an <a href="glossar.html#active_check">active check</a> for each host which summarizes the host’s current event status.
For a host with no open events, it will look like this:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_none.png" alt="ec events check none"></div></div>
<div class="paragraph"><p>If there are only events in the <span class="state0">OK</span> state, the check shows their number, but remains green:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_ok.png" alt="ec events check ok"></div></div>
<div class="paragraph"><p>Here is an example of a case with open events in the <span class="state2">CRIT</span> state:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_crit.png" alt="ec events check crit"></div></div>
<div class="paragraph"><p>You create this active check using a rule in the <span class="guihint">Check event state in Event Console</span> rule set.
You can also specify whether or not events that have already been acknowledged should still contribute to the status:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_check_remote.png" alt="ec check remote"></div></div>
<div class="paragraph"><p>With the <span class="guihint">Application (regular expression)</span> option you can restrict the check to events that have a specific text in the application field.
In this case it may make sense to have more than one event check on a host and to separate the checks by application.
So that these are distinguished by name, you also need the <span class="guihint">Item (used in service description)</span> option, which adds a text you specify to the service name.</p></div>
<div class="paragraph"><p>If your Event Console is not running on the same Checkmk site as the one that is also monitoring the host, you need to set <span class="guihint">Access to Event Console</span> for a remote access via TCP:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check.png" alt="ec events check"></div></div>
<div class="paragraph"><p>For this to work, the Event Console must allow access via TCP.
You can configure this in the <a href="#globalsettings">Event Console settings</a> that is to be accessed:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_remote_access.png" alt="ec remote access"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_archive">
<span class="hidden-anchor sr-only" id="archive"></span>10. The archive</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__how_the_archive_functions">
<span class="hidden-anchor sr-only" id="_how_the_archive_functions"></span>10.1. How the archive functions</h3>
<div class="paragraph"><p>The Event Console keeps a log of all changes that an event undergoes.
This log can be found in two ways:</p></div>
<div class="ulist"><ul>
<li><p>In the <span class="guihint">Recent event history</span> global view, which you can find in <span class="guihint">Monitor &gt; Event Console</span>.</p></li>
<li><p>In the details of an event via the <span class="guihint">Event Console Event &gt; History of Event</span> menu item.</p></li>
</ul></div>
<div class="paragraph"><p>In the global view there is a filter that only shows the events of the last 24 hours.
However, as usual you can customize the filters.</p></div>
<div class="paragraph"><p>The following figure shows the history of event 33, which has undergone a total of four changes.
First the event was created (<code>NEW</code>),
then the state was manually changed from <span class="state0">OK</span> to <span class="state1">WARN</span> (<code>CHANGESTATE</code>),
then acknowledged with an added comment (<code>UPDATE</code>), and
finally the event was archived/deleted (<code>DELETE</code>):</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_history.png" alt="ec history"></div></div>
<div class="paragraph"><p>The archive contains the following action types which are displayed in the <span class="guihint">Action</span> column:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Action type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was newly created (due to a message received or due to a rule expecting a message that failed to appear).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was edited by the operator (change to comment, contact info, acknowledgement).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was archived.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CANCELLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically <a href="#cancelling">cancelled</a> by an OK message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANGESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The state of the event was changed by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ARCHIVED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived because no rule was applied and <span class="guihint">Force message archiving</span> was enabled in the global settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORPHANED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived because while it was in the <span class="guihint">counting</span> phase, its associated rule was deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNTREACHED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was moved from <span class="guihint">counting</span> to <span class="guihint">open</span> because the configured number of messages was reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNTFAILED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived because the required number of messages was not reached in <span class="guihint">counting</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOCOUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived because while it was in the <span class="guihint">counting</span> phase, its associated rule was changed to 'do not count'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELAYOVER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was opened because the <a href="#timing">delay</a> configured in the rule expired.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXPIRED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived because its configured <a href="#timing">lifetime</a> had expired.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EMAIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An email was sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRIPT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An automatic action (script) was executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTODELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event was automatically archived immediately after opening, because this was configured in its corresponding rule.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__location_of_the_archive">
<span class="hidden-anchor sr-only" id="_location_of_the_archive"></span>10.2. Location of the archive</h3>
<div class="paragraph"><p>As mentioned above, the Event Console archive has not been designed as a fully-fledged syslog archive.
To keep the implementation and especially the administration as simple as possible, a database backend has been omitted.
Instead the archive is written to simple text files.
Each entry consists of one line of text, which contains columns separated by tabs.
You can find the files in <code>~/var/mkeventd/history</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>var/mkeventd/history/
<span class="tok-go">total 1328</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable 131 Dec 4 23:59 1480633200.log</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable 1123368 Dec 5 23:39 1480892400.log</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable 219812 Dec 6 09:46 1480978800.log</span></code></pre></div></div>
<div class="paragraph"><p>By default, a new file is started automatically every day.
In the <a href="#globalsettings%20">Event Console settings</a> you can customize the rotation of the file.
The <span class="guihint">Event history logfile rotation</span> setting allows you to switch to a weekly rotation.</p></div>
<div class="paragraph"><p>The file names conform to the Unix timestamp from the time of of the file creation (seconds since 1/1/1970 UTC).</p></div>
<div class="paragraph"><p>The files are kept for 365 days unless you change this in the <span class="guihint">Event history lifetime</span> setting.
In addition, the files are also recorded by the central disk space management of Checkmk, which can be configured in the Global settings under <span class="guihint">Site management</span>.
In this case, the <em>shorter</em> time limit set in each case applies.
The global management has the advantage that should free disk space become marginal it automatically deletes Checkmk’s historical data <strong>consistently</strong>, starting with the oldest.</p></div>
<div class="paragraph"><p>If you run into space problems, you can also simply delete the files in the directory manually or swap them out.
Do <em>not</em> put zipped or any other files in this directory.</p></div>
</div>
<div class="sect2">
<h3 id="heading__automatic_archiving">
<span class="hidden-anchor sr-only" id="_automatic_archiving"></span>10.3. Automatic archiving</h3>
<div class="paragraph"><p>Despite the limitations of the text files, it is theoretically possible to archive a large number of messages in the Event Console.
Writing to the archive’s text files is very performant — but at the cost of a less efficient later search.
Since the files have only the request period as their index, for any request all relevant files have to be read and searched fully.</p></div>
<div class="paragraph"><p>Normally the EC will only write such messages to the archive, for which an event has actually been opened.
You can do this in two different ways to extend this to <em>all</em> events:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>You create a rule that matches all (further) events and in <span class="guihint">Outcome &amp; actions</span> activate the <span class="guihint">Delete event immediately after the actions</span> option.</p></li>
<li><p>You activate the <span class="guihint">Force message archiving</span> switch in the Event Console settings.</p></li>
</ol></div>
<div class="paragraph"><p>The latter ensures that messages which are not subject to any rule are nevertheless written into the (action type <code>ARCHIVED</code>) archive.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_tuning">
<span class="hidden-anchor sr-only" id="tuning"></span>11. Performance and tuning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__message_processing">
<span class="hidden-anchor sr-only" id="_message_processing"></span>11.1. Message processing</h3>
<div class="paragraph"><p>Even in times when servers have 64 cores and 2 TB of main memory, the performance of software still plays a role.
Especially in the processing of events, incoming messages can be lost in extreme situations.</p></div>
<div class="paragraph"><p>The reason is that none of the protocols used (Syslog, SNMP traps, etc.) provides for flow control.
If thousands of hosts are simultaneously sending messages every second, the receiver has no chance of slowing them down.</p></div>
<div class="paragraph"><p>Therefore, in somewhat larger environments, it is important that you keep an eye on the processing times for messages.
This depends on how many rules you have defined and how these are structured.</p></div>
<div class="sect3">
<h4 id="heading_ecperformance">
<span class="hidden-anchor sr-only" id="ecperformance"></span>Measuring the performance</h4>
<div class="paragraph"><p>To measure your performance there is a separate snapin for the <a href="user_interface.html#sidebar">sidebar</a> with the name <span class="guihint">Event Console Performance</span>.
You can include this as usual with <span class="image-inline"><img src="../images/icons/button_sidebar_add_snapin.png" alt="button sidebar add snapin"></span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_performance.png" alt="ec performance" width="400"></div></div>
<div class="paragraph"><p>The values shown here are averages over about the last minute.
An event storm that lasts only a few seconds cannot be read here directly, but the numbers have been somewhat smoothed out and are thus easier to read.</p></div>
<div class="paragraph"><p>To test the maximum performance, you can artificially generate a storm of unclassified messages (please only in the test system!), for example, in a shell loop by continuously writing the contents of a text file into the events pipe.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-nb">true</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">do</span><span class="tok-w"> </span>cat<span class="tok-w"> </span>/etc/services<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>tmp/run/mkeventd/events<span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">done</span></code></pre></div></div>
<div class="paragraph"><p>The most important readings from the snapin have the following meaning:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Received messages</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of messages currently received per second.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule tries</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rules that are tried. This provides valuable information about the efficiency of the rule chain — especially together with the next parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule hits</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rules per second that are currently <em>hitting</em>. These can also be rules that discard messages or which simply count. Therefore not every rule hit results in an event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule hit ratio</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ratio of <span class="guihint">Rule tries</span> and <span class="guihint">Rule hits</span>. In other words: How many rules does the EC have to try before one (finally) takes effect. In the example from the screenshot the rate is alarmingly small.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Created events</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of new events created per second. Since the Event Console should only show <em>relevant problems</em> (comparable to host and service problems from monitoring), the number <code>0.73/s</code> from the screenshot would of course be too high in practice!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Processing time per message</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here you can read how much time it took to process a message. Caution: In general this is <strong>not</strong> the inverse of <span class="guihint">Received messages</span>. Because the times in which the Event Console had nothing to do are still missing, simply because no messages came in. Here you really measure the pure real elapsed time between the arrival of a message and the final completion of processing. You can see approximately how many messages the EC <em>can</em> handle in a given time.
Note also that this is not <em>CPU time</em>, but <em>real</em> time. On a system with enough free CPUs, these times are about the same. But as soon as the system is so under load that not all processes always get a CPU, the real time can become much higher.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__tuning_tips">
<span class="hidden-anchor sr-only" id="_tuning_tips"></span>Tuning tips</h4>
<div class="paragraph"><p>You can see how many messages the Event Console can process per second from the <span class="guihint">Processing time per message</span>.
This time is generally related to the number of rules that have to be tried before a message is processed.
You have several options for optimization here:</p></div>
<div class="ulist"><ul>
<li><p>Rules that exclude very many messages should be placed as far as possible at the beginning of the rule chain.</p></li>
<li><p>Work with <a href="#rulepacks">rule packs</a> to group sets of related rules together.
The first rule in each package should leave the package immediately if the common base condition is not met.</p></li>
</ul></div>
<div class="paragraph"><p>Furthermore, there is an optimization in the EC based on the <a href="#syslogfacility]">syslog priority and facility</a>.</p></div>
<div class="paragraph"><p>For each combination of priority and facility, a separate rule chain is created internally in which only such rules that are relevant for messages of this combination are included.</p></div>
<div class="paragraph"><p>Each rule that contains a condition on the priority, the facility or preferably both, will not be included in all of these rule chains, instead optimally only in one.
This means that the rule does not need to be checked for messages with a different syslog classification.</p></div>
<div class="paragraph"><p>Following a restart, in <code>~/var/log/mkeventd.log</code> you will see an overview of the optimized rule chains:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[8488808306.233330]  kern        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233343]  user        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233355]  mail        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233367]  daemon      : emerg(120) alert(89) crit(89) err(89) warning(89) notice(89) info(89) debug(89)
[8488808306.233378]  auth        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233389]  syslog      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233408]  lpr         : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233482]  news        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233424]  uucp        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233435]  cron        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233446]  authpriv    : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233457]  ftp         : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233469]  (unused 12) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233480]  (unused 13) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233498]  (unused 13) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233502]  (unused 14) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233589]  local0      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233538]  local1      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233542]  local2      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233552]  local3      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233563]  local4      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233574]  local5      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233585]  local6      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233595]  local7      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233654]  snmptrap    : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)</code></pre></div>
</div>
<div class="paragraph"><p>In the above example you can see that in any case there are 67 rules that must be checked.
For messages from the <code>daemon</code> facility 89 rules are relevant, only for the combination <code>daemon</code>/<code>emerg</code> 120 rules have to be checked.
Each rule which gets a condition on priority or facility further reduces the number from 67.</p></div>
<div class="paragraph"><p>Of course you can set these conditions only if you are sure that they are fulfilled by the relevant messages!</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__the_count_of_current_events">
<span class="hidden-anchor sr-only" id="_the_count_of_current_events"></span>11.2. The count of current events</h3>
<div class="paragraph"><p>The number of events currently present can also affect the performance of the EC — that is, when it gets seriously out of control.
As mentioned earlier, the EC should not be seen as a substitute for a syslog archive, rather only for displaying 'current problems'.
The Event Console can certainly handle several thousand problems, but that is not its real purpose.</p></div>
<div class="paragraph"><p>As soon as the number of current events exceeds about 5 000, the performance begins to deteriorate noticeably.
On the one hand, this can be seen in the GUI, which reacts more slowly to requests.
On the other hand, the processing also becomes slower, since in some situations, messages have to be compared with all current events.
The memory requirements can also become problematic.</p></div>
<div class="paragraph"><p>For performance reasons, the Event Console always keeps all current events in RAM.
These are written to the <code>~/var/mkeventd/status</code> file once per minute (adjustable) and on a clean completion of processing.
If this becomes very large (e.g. over 50 megabytes), this process also becomes slower and slower.
You can quickly check the current size with <code>ll</code>. (alias for <code>ls -alF</code>):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>-h<span class="tok-w"> </span>var/mkeventd/status
<span class="tok-go">-rw-r--r-- 1 mysite mysite <mark>386K</mark> Dez 14 13:46 var/mkeventd/status</span></code></pre></div></div>
<div class="paragraph"><p>If you have too many current events due to a clumsy rule (e.g. one that matches on everything), a manual deletion via the GUI is not reasonably possible.
In this case simply deleting the status file will help:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>stop<span class="tok-w"> </span>mkeventd
<span class="tok-go">Stopping mkeventd...killing 17436......OK</span>
<span class="tok-gp">OMD[mysite]:~$ </span>rm<span class="tok-w"> </span>var/mkeventd/status
<span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start<span class="tok-w"> </span>mkeventd
<span class="tok-go">Starting mkeventd (builtin: syslog-udp)...OK</span></code></pre></div></div>
<div class="paragraph"><p><strong>Attention:</strong> Of course, <em>all</em> current events will be lost as well as the stored counter and other states.
In particular new events will start with ID 1 again.</p></div>
<div class="sect3">
<h4 id="heading_overflow">
<span class="hidden-anchor sr-only" id="overflow"></span>Automatic overflow protection</h4>
<div class="paragraph"><p>The Event Console has an automatic protection against an 'overflow'.
This limits the number of current events per host, per rule and globally.
Not only open events are counted, but also events in other phases, such as <span class="guihint">delayed</span> or <span class="guihint">counting</span>.
Archived events are not counted.</p></div>
<div class="paragraph"><p>This will protect you in situations where, due to a systematic problem on your network, thousands of critical events are flooding in and the Event Console would 'shut down'.
On the one hand, this prevents a performance degradation of the Event Console, which would have to hold too many events in its main memory.
On the other hand the overview for the operator is (somewhat) protected and events that are not part of the storm remain visible.</p></div>
<div class="paragraph"><p>Once a limit is reached, one of the following actions will occur:</p></div>
<div class="ulist"><ul>
<li><p>Creation of new events is stopped (for this host, rule or globally).</p></li>
<li><p>The same, but in addition an 'overflow event' is created.</p></li>
<li><p>The same, but in addition appropriate contacts are notified.</p></li>
<li><p>As an alternative to the above three variants, you can also have the oldest event deleted to make room for the new one.</p></li>
</ul></div>
<div class="paragraph"><p>The limits as well as the associated effect on reaching them are defined in the <a href="#globalsettings">Event Console settings</a> with <span class="guihint">Limit amount of current events</span>.
The following figure shows the default setting:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_limit_open_events.png" alt="ec limit open events"></div></div>
<div class="paragraph"><p>If you have enabled a value with <span class="guihint">…​create overflow event</span>, when the limit is reached, <em>a single</em> artificial event will be created, informing the operator of the error situation:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_overflow_event.png" alt="ec overflow event"></div></div>
<div class="paragraph"><p>If you have additionally enabled a value with <span class="guihint">…​notify contacts</span>, the appropriate contacts will be notified via Checkmk notification.
That notification will go through the Checkmk <a href="notifications.html#rules">notification rules</a>.
These rules do not have to follow the Event Console’s contact selection, but can modify it.
The following table shows which contacts are selected if you have set <span class="guihint">Notify all contacts of the notified host or service</span> (which is the default):</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Limit</th>
<th class="tableblock halign-left valign-top">Contact selection</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">per host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The contacts to the host, which are determined in the same way as for <a href="#notifications%20">notification of events</a> via Checkmk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">per rule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leave the host name field empty. If contact groups are defined in the rule, they will be selected, otherwise the fallback contacts will apply.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fallback contacts.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="heading__archive_too_large">
<span class="hidden-anchor sr-only" id="_archive_too_large"></span>11.3. Archive too large</h3>
<div class="paragraph"><p>As <a href="#archive">above</a> shows, the Event Console has an archive of all the events and their processing steps.
This is stored in text files for ease of implementation and administration.</p></div>
<div class="paragraph"><p>Text files are hard to beat in terms of performance when <em>writing</em> data — by using databases, for example, only with enormous optimization effort.
This is due to, among other factors, the optimization of this type of access by Linux and the complete memory hierarchy of disks and SANs.
However, this is at the expense of read accesses.
Since text files do not have an index, a complete read is necessary when searching in the files.</p></div>
<div class="paragraph"><p>At its simplest the Event Console uses the filenames of the log files its index for the <em>time</em> of the events.
The further you limit the query period, the faster the search will be.</p></div>
<div class="paragraph"><p>Nevertheless, it is very important that your archive does not become too large.
If you use the Event Console only to process real error messages, this can’t really happen.
If you try to use the EC as a replacement for a real syslog archive, this can lead to very large files.</p></div>
<div class="paragraph"><p>If you run into a situation where your archive has become too large, you can simply delete older files in <code>~/var/mkeventd/history/</code>.
Additionally, in <span class="guihint">Event history lifetime</span> you can generally limit the lifetime of data so that deletion is the default in the future.
By default 365 days are stored.
Maybe you can get by with significantly less.</p></div>
</div>
<div class="sect2">
<h3 id="heading__measuring_performance_over_time">
<span class="hidden-anchor sr-only" id="_measuring_performance_over_time"></span>11.4. Measuring performance over time</h3>
<div class="paragraph"><p>Checkmk automatically starts a service for each Event Console site, which records its performance data in curves and also warns you if <a href="#overflow%20">overflows</a> occur.</p></div>
<div class="paragraph"><p>Provided you have installed a Linux agent on the monitoring server, the check will be automatically found and set up as usual:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_check.png" alt="ec check"></div></div>
<div class="paragraph"><p>The check comes with very many interesting measurement types, e.g. the number of of incoming messages for each period of time and how many of them were discarded:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_message_rate.png" alt="ec graph message rate"></div></div>
<div class="paragraph"><p>The efficiency of your rule chain is represented by a comparison of the rules tested to those that worked:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_rule_efficiency.png" alt="ec graph rule efficiency"></div></div>
<div class="paragraph"><p>This graph shows the average time it takes to process a message:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_processing_time.png" alt="ec graph processing time"></div></div>
<div class="paragraph"><p>There are also quite a few additional graphs.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__distributed_monitoring">
<span class="hidden-anchor sr-only" id="_distributed_monitoring"></span>12. Distributed monitoring</h2>
<div class="sectionbody"><div class="paragraph"><p>Fow to use the Event Console in an installation with multiple Checkmk sites, see the <a href="distributed_monitoring.html#ec">article on distributed monitoring</a>.</p></div></div>
</div>
<div class="sect1">
<h2 id="heading__the_status_interface">
<span class="hidden-anchor sr-only" id="_the_status_interface"></span>13. The status interface</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Event Console via the Unix socket <code>~/tmp/run/mkeventd/status</code> provides both access to the internal status and the facility to execute commands.
The protocol used here is a tightly-restricted subset of <a href="glossar.html#Livestatus">Livestatus</a>.
This interface is accessed by the monitoring core and passes the data through to the GUI in order to provide a <a href="distributed_monitoring.html">distributed monitoring</a> for the Event Console as well.</p></div>
<div class="paragraph"><p>The following restrictions apply to the simplified Livestatus of the Event Console:</p></div>
<div class="ulist"><ul>
<li><p>The only headers allowed are <code>Filter:</code> and <code>OutputFormat:</code>.</p></li>
<li><p>Therefore no Keepalive is possible, only one request can be made per connection.</p></li>
</ul></div>
<div class="paragraph"><p>The following tables are available:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all current events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the <a href="#archive">archive</a>. A query on this table will access the text files of the archive. Be sure to use a filter over the time of the entry to avoid full access to <em>all</em>  files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status and performance values of the EC. This table always has exactly one row.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Commands can be written into the socket using <code>unixcat</code> with a very simple syntax:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">"COMMAND RELOAD"</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>unixcat<span class="tok-w"> </span>tmp/run/mkeventd/status</code></pre></div></div>
<div class="paragraph"><p>The following commands are available:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archives an event. Arguments: event ID and user abbreviation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RELOAD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reload the configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHUTDOWN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exits the Event Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REOPENLOG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reopens the log file. This command is reqired by the log file rotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLUSH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes all current and archived events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYNC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiates an immediate update of the <code>~/var/mkeventd/status</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESETCOUNTERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resets the rule hit counters (corresponds to the <span class="guihint">Event Console &gt; Reset counters</span> menu item in the Setup GUI).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes an update from an event. The arguments are in order event id, user abbreviation, acknowledgement (0/1), comment and contact info.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANGESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the <span class="state0">OK</span> / <span class="state1">WARN</span> / <span class="state2">CRIT</span> / <span class="state3">UNKNOWN</span> states of an event. Arguments are event ID, user abbreviation and status digit (<code>0</code>/<code>1</code>/<code>2</code>/<code>3</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACTION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes a user-defined action on an event. Arguments are event ID, user abbreviation and action ID. The special ID <code>@NOTIFY</code> represents an <a href="#notifications">notification</a> about Checkmk.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="heading__files_and_directories">
<span class="hidden-anchor sr-only" id="_files_and_directories"></span>14. Files and directories</h2>
<div class="sectionbody"><table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">File path</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Working directory of the event daemon.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd/status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complete current state of the Event Console. This mainly includes all currently open events (and those in transition phases like <span class="guihint">counting</span> etc.). In the case of a misconfiguration that leads to a lot of open events, this file can become huge and drastically reduce the performance of the EC. In such a situation you can stop the <code>mkeventd</code> service, delete the file and start the service again to delete all open events at once.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd/history/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location of the <a href="#archive">archive</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/log/mkeventd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file of the Event Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mkeventd.d/wato/global.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The global settings of the Event Console in Python syntax.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mkeventd.d/wato/rules.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All your configured rule packages and rules in Python syntax.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A named pipe where you can write messages directly with <code>echo</code> or other commands to pass them to the EC. Make sure that only one application writes to this pipe at any time, otherwise the message texts may get mixed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/eventsocket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Unix socket that does the same job as the pipe, but allows multiple applications to write to it simultaneously. To write to it, you need the <code>unixcat</code> or <code>socat</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/pid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current process ID of the event daemon while it is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Unix socket that allows querying the current status and sending commands. GUI requests first go to the monitoring core, which then accesses this socket.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local/share/snmp/mibs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIB files uploaded by you for SNMP trap translation.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li>
<a href="#_introduction">1. Introduction</a><ul class="sectlevel1">
<li><a href="#_events_are_not_states">1.1. Events are not states</a></li>
<li><a href="#_the_event_console">1.2. The Event Console</a></li>
<li><a href="#_terminology">1.3. Terminology</a></li>
</ul>
</li>
<li><a href="#setup">2. Setting up the Event Console</a></li>
<li>
<a href="#_the_first_steps_with_the_event_console">3. The first steps with the Event Console</a><ul class="sectlevel1">
<li><a href="#first_steps_rules">3.1. Rules, rules, rules</a></li>
<li>
<a href="#_creating_a_simple_rule">3.2. Creating a simple rule</a><ul class="sectlevel2">
<li><a href="#_activating_the_changes">Activating the changes</a></li>
<li><a href="#eventsimulator">Testing the new rule</a></li>
<li><a href="#_generating_messages_manually_for_testing">Generating messages manually for testing</a></li>
</ul>
</li>
<li><a href="#globalsettings">3.3. Event Console settings</a></li>
<li><a href="#permissions">3.4. Permissions</a></li>
<li><a href="#hostnames">3.5. Host assignment in the Event Console</a></li>
</ul>
</li>
<li>
<a href="#monitoring">4. The Event Console in monitoring</a><ul class="sectlevel1">
<li><a href="#_event_views">4.1. Event views</a></li>
<li>
<a href="#commands">4.2. Commands and workflow of events</a><ul class="sectlevel2">
<li><a href="#_update_and_acknowledge">Update and acknowledge</a></li>
<li><a href="#_change_state">Change state</a></li>
<li><a href="#_custom_action">Custom action</a></li>
<li><a href="#_archive_event">Archive event</a></li>
</ul>
</li>
<li>
<a href="#visibility">4.3. Visibility of events</a><ul class="sectlevel2">
<li><a href="#_the_visibility_problem">The visibility 'problem'</a></li>
<li><a href="#_initially_everyone_can_see_everything">Initially, everyone can see everything</a></li>
<li><a href="#hostmatching">Assignment to hosts</a></li>
</ul>
</li>
<li>
<a href="#_troubleshooting">4.4. Troubleshooting</a><ul class="sectlevel2">
<li><a href="#_which_rule_applies_and_how_often">Which rule applies, and how often?</a></li>
<li><a href="#_debugging_rule_evaluation">Debugging rule evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#rules">5. The full power of the rules</a><ul class="sectlevel1">
<li>
<a href="#_the_conditions">5.1. The conditions</a><ul class="sectlevel2">
<li><a href="#_general_information_on_text_comparisons">General information on text comparisons</a></li>
<li><a href="#matchgroups">Match groups</a></li>
<li><a href="#_ip_address">IP address</a></li>
<li><a href="#syslogfacility">Syslog priority and facility</a></li>
<li><a href="#_inverting_a_match">Inverting a match</a></li>
</ul>
</li>
<li>
<a href="#outcome">5.2. Effect of the rule</a><ul class="sectlevel2">
<li><a href="#_rule_type_cancel_or_create_an_event">Rule type: Cancel or create an event</a></li>
<li><a href="#_setting_the_status">Setting the status</a></li>
<li><a href="#servicelevel">Service levels</a></li>
<li><a href="#contactgroups">Contact groups</a></li>
<li><a href="#_actions">Actions</a></li>
<li><a href="#_automatic_deletion_archiving">Automatic deletion (archiving)</a></li>
</ul>
</li>
<li><a href="#rewriting">5.3. Automated rewriting of texts</a></li>
<li>
<a href="#cancelling">5.4. Automated cancelling of events</a><ul class="sectlevel2">
<li><a href="#_perform_actions_when_cancelling">Perform actions when cancelling</a></li>
<li><a href="#_cancellation_in_combination_with_rewriting">Cancellation in combination with rewriting</a></li>
<li><a href="#_cancellation_based_on_syslog_priority">Cancellation based on syslog priority</a></li>
</ul>
</li>
<li>
<a href="#counting">5.5. Counting messages</a><ul class="sectlevel2">
<li><a href="#_too_frequent_messages">Too frequent messages</a></li>
<li><a href="#expect">Too infrequent or missing messages</a></li>
<li><a href="#_multiple_occurrences_of_the_same_problem">Multiple occurrences of the same problem</a></li>
</ul>
</li>
<li><a href="#timing">5.6. Timing</a></li>
<li><a href="#rulepacks">5.7. Rule packages</a></li>
</ul>
</li>
<li>
<a href="#actions">6. Actions</a><ul class="sectlevel1">
<li><a href="#_types_of_actions">6.1. Types of actions</a></li>
<li>
<a href="#_shell_scripts_and_emails">6.2. Shell scripts and emails</a><ul class="sectlevel2">
<li><a href="#_executing_shell_scripts">Executing shell scripts</a></li>
<li><a href="#_sending_emails">Sending emails</a></li>
</ul>
</li>
<li>
<a href="#notifications">6.3. Notifications through Checkmk</a><ul class="sectlevel2">
<li><a href="#_assignment_to_existing_hosts">Assignment to existing hosts</a></li>
<li><a href="#_remaining_notification_fields">Remaining notification fields</a></li>
<li><a href="#_manually_defining_contact_groups">Manually defining contact groups</a></li>
<li><a href="#_global_switch_for_notifications">Global switch for notifications</a></li>
<li><a href="#_host_scheduled_downtimes">Host scheduled downtimes</a></li>
<li><a href="#_additional_macros">Additional macros</a></li>
</ul>
</li>
<li><a href="#automatic_actions">6.4. Executing actions</a></li>
</ul>
</li>
<li>
<a href="#snmp">7. SNMP traps</a><ul class="sectlevel1">
<li><a href="#_setting_up_snmp_trap_reception">7.1. Setting up SNMP trap reception</a></li>
<li><a href="#_testing">7.2. Testing</a></li>
<li><a href="#_turning_numbers_into_text_translating_traps">7.3. Turning numbers into text: Translating traps</a></li>
<li><a href="#_uploading_your_own_mibs">7.4. Uploading your own MIBs</a></li>
</ul>
</li>
<li>
<a href="#logwatch">8. Monitoring log files</a><ul class="sectlevel1"><li><a href="#_service_level_and_syslog_priorities">8.1. Service level and syslog priorities</a></li></ul>
</li>
<li><a href="#eventsgostate">9. Event status in active monitoring</a></li>
<li>
<a href="#archive">10. The archive</a><ul class="sectlevel1">
<li><a href="#_how_the_archive_functions">10.1. How the archive functions</a></li>
<li><a href="#_location_of_the_archive">10.2. Location of the archive</a></li>
<li><a href="#_automatic_archiving">10.3. Automatic archiving</a></li>
</ul>
</li>
<li>
<a href="#tuning">11. Performance and tuning</a><ul class="sectlevel1">
<li>
<a href="#_message_processing">11.1. Message processing</a><ul class="sectlevel2">
<li><a href="#ecperformance">Measuring the performance</a></li>
<li><a href="#_tuning_tips">Tuning tips</a></li>
</ul>
</li>
<li>
<a href="#_the_count_of_current_events">11.2. The count of current events</a><ul class="sectlevel2"><li><a href="#overflow">Automatic overflow protection</a></li></ul>
</li>
<li><a href="#_archive_too_large">11.3. Archive too large</a></li>
<li><a href="#_measuring_performance_over_time">11.4. Measuring performance over time</a></li>
</ul>
</li>
<li><a href="#_distributed_monitoring">12. Distributed monitoring</a></li>
<li><a href="#_the_status_interface">13. The status interface</a></li>
<li><a href="#_files_and_directories">14. Files and directories</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../lunr.index.en.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
