<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Um Benachrichtigungen zu konfigurieren, sind Zeitpunkt, Methode und die Gruppe der Empfänger essentiell. Lernen Sie hier, wie Sie Ihre Anforderungen in Checkmk umsetzen.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Benachrichtigungen (notifications) - per E-Mail, SMS, Ticketsystem und mehr">
<meta name="og:description" content="Um Benachrichtigungen zu konfigurieren, sind Zeitpunkt, Methode und die Gruppe der Empfänger essentiell. Lernen Sie hier, wie Sie Ihre Anforderungen in Checkmk umsetzen.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Benachrichtigungen (notifications) - per E-Mail, SMS, Ticketsystem und mehr</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/en/notifications.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/de/notifications.html">2.2.0</a><a class="dropdown-item" href="../../latest/de/notifications.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host- und Serviceparameter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Einführung in die Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMWare ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Konfiguration via Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
<li>
<p><a href="web_api.html">Konfiguration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Befehlsreferenz der HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Eigene Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Benachrichtigungen</h1>
<div class="details">
<span id="revdate">Last modified on 13-Oct-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/de/notifications.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">Dies ist eine am 2025-01-07 22:12:14 +0000 für die Offline-Nutzung exportierte Seite. Sie spiegelt möglicherweise nicht den aktuellen Stand der Checkmk Dokumentation wider. Um eine täglich aktualisierte Version dieser Seite anzusehen, rufen Sie bitte <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a> auf.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="basics_ackn.html">Quittierung von Problemen</a>
<a href="commands.html">Kommandos</a>
<a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading_intro">
<span class="hidden-anchor sr-only" id="intro"></span>1. Einleitung</h2>
<div class="sectionbody">
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_notifications.png" alt="Symbol einer Benachrichtigung." width="80"></div></div>
<div class="paragraph"><p>Benachrichtigung bedeutet, dass Benutzer im Falle von Problemen oder anderen Ereignissen im Monitoring von Checkmk aktiv informiert werden.
Im häufigsten Fall geschieht das durch E-Mails.
Es gibt aber auch viele andere Methoden, wie z.B. das Versenden von SMS oder die Weiterleitung an ein Ticketsystem.
Checkmk bietet eine einfache Schnittstelle, um für eigene Benachrichtigungsmethoden Skripte zu schreiben.</p></div>
<div class="paragraph"><p>Ausgangspunkt für jede Benachrichtigung an einen Benutzer ist ein vom Monitoring-Kern gemeldetes Ereignis.
Wir nennen dies im folgenden <strong>Monitoring-Ereignis</strong>, um Verwechslungen mit den Ereignissen zu vermeiden, die von der <a href="ec.html">Event Console</a> verarbeitet werden.
Ein Monitoring-Ereignis bezieht sich immer auf einen bestimmten Host oder Service.
Mögliche Typen von Monitoring-Ereignissen sind:</p></div>
<div class="ulist"><ul>
<li><p>Ein Zustandswechsel, z.B. <span class="state0">OK</span> → <span class="state1">WARN</span></p></li>
<li><p>Der Wechsel zwischen einem stetigen und einem <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="Symbol zur Anzeige des unstetigen Zustands."></span> unstetigen (<em>flapping</em>) Zustand</p></li>
<li><p>Start oder Ende einer <span class="image-inline"><img src="../images/icons/icon_downtime.png" alt="Symbol zur Anzeige der Wartungszeit bei Services."></span> <a href="basics_downtimes.html">Wartungszeit</a></p></li>
<li><p>Die <span class="image-inline"><img src="../images/icons/icon_ack.png" alt="Symbol zur Anzeige der Quittierung."></span> <a href="basics_ackn.html">Quittierung eines Problems</a> durch einen Benutzer</p></li>
<li><p>Eine durch ein <span class="image-inline"><img src="../images/icons/icon_commands.png" alt="Symbol zur Anzeige eines Kommandos."></span> <a href="commands.html">Kommando</a> manuell ausgelöste Benachrichtigung</p></li>
<li><p>Die Ausführung eines <span class="image-inline"><img src="../images/icons/icon_alert_handlers.png" alt="Symbol eines Alert Handlers."></span> <a href="alert_handlers.html">Alert Handlers</a></p></li>
<li><p>Ein Ereignis, das von der <span class="image-inline"><img src="../images/icons/icon_event_console.png" alt="Symbol der Event Console."></span> <a href="ec.html">Event Console</a> zur Benachrichtigung übergeben wurde</p></li>
</ul></div>
<div class="paragraph"><p>Checkmk verfügt über ein regelbasiertes System, mit dem Sie aus diesen Monitoring-Ereignissen Benutzerbenachrichtigungen erstellen lassen können, und mit dem Sie auch sehr anspruchsvolle Anforderungen umsetzen können.
Eine einfache Benachrichtigung per E-Mail — wie sie in vielen Fällen zunächst völlig ausreicht — ist trotzdem schnell eingerichtet.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_notify_or_not">
<span class="hidden-anchor sr-only" id="notify_or_not"></span>2. Benachrichtigen oder (noch) nicht benachrichtigen?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Grundsätzlich sind Benachrichtigungen optional und Sie können Checkmk durchaus auch ohne diese sinnvoll nutzen.
Manche großen Unternehmen haben eine Art Leitstand, in der das Monitoring-Team die Checkmk-Oberfläche ständig im Blick hat und keine zusätzlichen Benachrichtigungen benötigt.
Wenn Sie noch im Aufbau Ihrer Checkmk-Umgebung sind, sollten Sie außerdem bedenken, dass Benachrichtigungen erst dann für Ihre Kollegen eine Hilfe sind, wenn keine oder nur selten <strong>Fehlalarme</strong> (<em>false positives</em>) produziert werden.
Dazu müssen Sie erst einmal die Schwellwerte und alle anderen Einstellungen soweit im Griff haben, dass im Normalfall alle Zustände <span class="state0">OK</span> / <span class="hstate0">UP</span> sind oder mit anderen Worten: alles „grün“ ist.</p></div>
<div class="paragraph"><p>Die Akzeptanz für das neue Monitoring ist schnell dahin, wenn es den Posteingang jeden Tag mit Hunderten nutzloser E-Mails flutet.</p></div>
<div class="paragraph"><p>Folgendes Vorgehen hat sich bewährt:</p></div>
<div class="paragraph"><p><strong>Schritt 1:</strong> Feinjustieren Sie das Monitoring, indem Sie einerseits die durch Checkmk neu aufgedeckten, tatsächlichen Probleme beheben und andererseits Fehlalarme eliminieren.
Tun Sie das, bis im Normalfall alles <span class="state0">OK</span> / <span class="hstate0">UP</span> ist.
Im <a href="intro_finetune.html#filesystems">Leitfaden für Einsteiger</a> finden Sie einige Empfehlungen, um typische Fehlalarme zu reduzieren.</p></div>
<div class="paragraph"><p><strong>Schritt 2:</strong> Schalten Sie Benachrichtigungen zunächst nur für sich selbst ein.
Reduzieren Sie das „Rauschen“, welches durch sporadisch kurz auftretende Probleme verursacht wird.
Passen Sie dazu weitere Schwellwerte an, nutzen Sie ggf. das <a href="predictive_monitoring.html">prognosebasierte Monitoring</a>, erhöhen Sie die <a href="#repeated_check_attempts">Anzahl der Checkversuche</a> oder versuchen Sie es mit der <a href="#delaying">verzögerten Benachrichtigung</a>.
Wenn es sich allerdings um tatsächliche Probleme handelt, sollten Sie deren Ursache finden, um sie in den Griff zu bekommen.</p></div>
<div class="paragraph"><p><strong>Schritt 3:</strong> Erst wenn in Ihrem eigenen Posteingang einigermaßen Ruhe eingekehrt ist, schalten Sie die Benachrichtigungen für Ihre Kollegen ein.
Richten Sie dazu sinnvolle Kontaktgruppen ein, so dass jeder nur solche Benachrichtigungen bekommt, die ihn auch wirklich etwas angehen.</p></div>
<div class="paragraph"><p>Das Ergebnis ist ein sehr nützliches System, das Ihnen und Ihren Kollegen hilft, mit relevanten Informationen Ausfallzeiten zu reduzieren.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_simple_mail">
<span class="hidden-anchor sr-only" id="simple_mail"></span>3. Einfache Benachrichtigung per E-Mail</h2>
<div class="sectionbody">
<div class="paragraph"><p>Eine von Checkmk versendete Benachrichtigung per E-Mail im HTML-Format sieht etwa so aus:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/html_notification.png" alt="Eine Benachrichtigung per E-Mail."></div></div>
<div class="paragraph"><p>Wie im Beispiel zu sehen ist, enthält die E-Mail auch die aktuellen <a href="graphing.html">Messwerte</a> des betroffenen Services.</p></div>
<div class="paragraph"><p>Bevor Sie eine solche E-Mail von Checkmk erhalten, sind ein paar Vorbereitungen notwendig, die im Folgenden beschrieben sind.</p></div>
<div class="sect2">
<h3 id="heading__voraussetzungen">
<span class="hidden-anchor sr-only" id="_voraussetzungen"></span>3.1. Voraussetzungen</h3>
<div class="paragraph"><p>In der Standardkonfiguration von Checkmk erhält ein Benutzer Benachrichtigungen per E-Mail, wenn folgende Voraussetzungen erfüllt sind:</p></div>
<div class="ulist"><ul>
<li><p>Der Checkmk-Server hat ein funktionierendes <a href="#smtp">Setup für das Versenden von E-Mails</a>.</p></li>
<li><p>Für den <a href="wato_user.html#user_config">Benutzer</a> ist eine E-Mail-Adresse konfiguriert.</p></li>
<li><p>Der Benutzer ist Mitglied einer <a href="wato_user.html#contact_groups">Kontaktgruppe</a> und somit ein Kontakt.</p></li>
<li><p>Bei einem Host oder Service, der dieser Kontaktgruppe zugeordnet ist, ereignet sich ein Monitoring-Ereignis, das eine Benachrichtigung auslöst.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_smtp">
<span class="hidden-anchor sr-only" id="smtp"></span>3.2. Einrichten des Mailversands unter Linux</h3>
<div class="paragraph"><p>Damit das Versenden von E-Mails klappt, muss Ihr Checkmk-Server eine
funktionierende Konfiguration des SMTP-Servers haben. Je nach Ihrer
Linux-Distribution kann es sich dabei z.B. um Postfix, Qmail, Exim, Sendmail
oder Nullmailer handeln. Die Konfiguration erfolgt mit den Mitteln Ihrer
Linux-Distribution.</p></div>
<div class="paragraph"><p>In der Regel beschränkt sich die Konfiguration auf das Eintragen eines
„Smarthosts“ (auch SMTP-Relay-Server genannt), an den alle E-Mails
weitergeleitet werden. Dies ist dann Ihr firmeninterner SMTP-Mailserver. Im LAN
benötigen Smarthosts in der Regel keine Authentifizierung, was die Sache einfach
macht. Der Smarthost wird bei manchen Distributionen schon während der
Installation abgefragt. Bei der Checkmk-Appliance können Sie den Smarthost bequem
über die <a href="appliance_usage.html#cma_webconf_system_settings">Weboberfläche</a>
konfigurieren.</p></div>
<div class="paragraph"><p>Sie können das Versenden von E-Mails auf der Kommandozeile mit dem Befehl <code>mail</code>
testen. Da es für diesen Befehl unter Linux zahlreiche unterschiedliche
Implementierungen gibt, liefert Checkmk zur Vereinheitlichung die Variante aus dem
Projekt <a href="http://heirloom.sourceforge.net/mailx.html" target="_blank">Heirloom mailx</a> mit aus — direkt im Suchpfad des Instanzbenutzers als <code>~/bin/mail</code>. Die zugehörige
Konfigurationsdatei ist <code>~/etc/mail.rc</code>. Testen Sie also am besten als
Instanzbenutzer, denn mit den gleichen Rechten laufen später auch die
Benachrichtigungsskripte.</p></div>
<div class="paragraph"><p>Der Inhalt der E-Mail wird von der Standardeingabe gelesen, der Betreff mit <code>-s</code>
angegeben und die Zieladresse einfach als Argument ans Ende der Kommandozeile
gestellt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">"Inhalt"</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>mail<span class="tok-w"> </span>-s<span class="tok-w"> </span>Test-Betreff<span class="tok-w"> </span>harry.hirsch@example.com</code></pre></div></div>
<div class="paragraph"><p>Die E-Mail sollte ohne Verzögerung zugestellt werden. Falls dies nicht klappt,
finden Sie Hinweise in der Log-Datei des SMTP-Server im Verzeichnis <code>/var/log</code>
(siehe <a href="#maillog">Dateien und Verzeichnisse</a>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__e_mail_adresse_und_kontaktgruppe">
<span class="hidden-anchor sr-only" id="_e_mail_adresse_und_kontaktgruppe"></span>3.3. E-Mail-Adresse und Kontaktgruppe</h3>
<div class="paragraph"><p>E-Mail-Adresse und Kontaktgruppe eines Benutzers legen Sie in der
<a href="wato_user.html#user_config">Benutzerverwaltung</a> fest:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_add_user.png" alt="Dialog zur Eingabe von E-Mail-Adresse und Auswahl der Kontaktgruppen."></div></div>
<div class="paragraph"><p>Bei einer frisch erzeugten Checkmk-Instanz gibt es zunächst nur die Kontaktgruppe <span class="guihint">Everything</span>.
Mitglieder dieser Gruppe sind automatisch für <strong>alle</strong> Hosts und Services zuständig und werden bei jedem relevanten Monitoring-Ereignis per E-Mail benachrichtigt.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Falls Ihre Checkmk-Installation mit einer älteren Version erzeugt wurde, kann diese Gruppe auch <span class="guihint">Everybody</span> heißen.
Dies ist aber logisch falsch, denn diese Gruppe beinhaltet ja nicht alle Benutzer, sondern alle Hosts.
Bis auf den unterschiedlichen Namen ist aber die Funktion die gleiche.</p></div>
</div>
<div class="sect2">
<h3 id="heading_notification_testing">
<span class="hidden-anchor sr-only" id="notification_testing"></span>3.4. Test</h3>
<div class="paragraph"><p>Um die Benachrichtigungen zu testen, können Sie einen <span class="state0">OK</span>-Service einfach von Hand auf <span class="state2">CRIT</span> setzen.
Dies geht mit dem <a href="commands.html">Kommando</a> <span class="guihint">Fake check results,</span> das Sie in der Service-Liste im Menü <span class="guihint">Commands</span> finden. Sollten Sie das Kommando in der Liste nicht sehen, klicken Sie bitte vorher noch auf den Knopf <span class="guihint">Show more</span> <span class="image-inline"><img src="../images/icons/button_showmore.png" alt="button showmore"></span>.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_fake_check_results.png" alt="Dialog zum manuellen Zustandswechsel."></div></div>
<div class="paragraph"><p>Das muss dann sofort zu einer E-Mail für dieses Problem führen.
Beim nächsten regulären Check sollte der Service dann wieder auf <span class="state0">OK</span> gehen und eine erneute Benachrichtigung auslösen (diesmal vom Typ Recovery).</p></div>
<div class="paragraph"><p>Beachten Sie bei diesen Tests, dass der Service bei häufigen Wechseln nach einiger Zeit in den Zustand <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="icon flapping"></span> unstetig (<em>flapping</em>) gehen wird.
Weitere Zustandswechsel lösen dann keine Benachrichtigungen mehr aus.
Im Snapin <a href="user_interface.html#master_control">Master control</a> der Seitenleiste können Sie die Erkennung von Unstetigkeiten (<span class="guihint">Flap Detection</span>) vorübergehend ausschalten.</p></div>
<div class="paragraph"><p>Alternativ können Sie auch eine benutzerdefinierte Benachrichtigung (<span class="guihint">Custom notification</span>) auslösen — ebenfalls per Kommando:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_custom.png" alt="Dialog für eine benutzerdefinierte Benachrichtigung."></div></div>
<div class="paragraph"><p>Dabei ändert sich der Status des entsprechenden Services nicht. Allerdings ist
die so erzeugte Benachrichtigung dann von einem anderen Typ und kann sich — abhängig von Ihren Benachrichtigungsregeln — anders verhalten.</p></div>
</div>
<div class="sect2">
<h3 id="heading_finetuning">
<span class="hidden-anchor sr-only" id="finetuning"></span>3.5. Feineinstellungen für HTML-E-Mail</h3>
<div class="paragraph"><p>Wenn Sie HTML-E-Mails verschicken, haben Sie möglicherweise den Wunsch, zusätzliche Informationen hinzuzufügen oder flexibel eine Antwortadresse (<span class="guihint">Reply to</span>) auf einen Kontakt für Rückfragen zu setzen.
Hierfür gibt es die Regel <span class="guihint">Setup &gt; Services &gt; Service monitoring rules &gt; Parameters for HTML Email</span> und in <a href="notifications.html#notification_rule">Benachrichtigungsregeln</a> die Benachrichtigungsmethode HTML-E-Mail.
Mit diesen Regeln können Sie eine Reihe von Parametern wie Antwortadresse, zusätzliche Felder mit Details oder Freitext als HTML formatiert hinzufügen.</p></div>
<div class="paragraph"><p>Beachten Sie, dass im Feld <span class="guihint">Insert HTML section between body and table</span> aus Sicherheitsgründen nur eine kleine Menge an HTML-Tags zugelassen ist.
Diese sind:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 25%;">
<col style="width: 65%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
<th class="tableblock halign-left valign-top">Hinweise</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a" target="_blank">Anchor/Link</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zugelassen, wenn es mit dem Attribut <code>href</code> (verpflichtend) und <code>target</code> (optional) kombiniert ist. Links müssen hierbei entweder relative Pfade enthalten (also mit <code>./</code> oder <code>../</code> beginnen) oder eines der URL-Schemas <code>http</code>, <code>https</code> oder <code>mailto</code> verwenden. Von der Verwendung relativer Pfade raten wir wegen der sehr unterschiedlichen Handhabung durch E-Mail-Clients ab.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h1" target="_blank">Heading 1</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h2" target="_blank">Heading 2</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b" target="_blank">Bring Attention (i.d.R. fett)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/tt" target="_blank">Teletype (diktengleiche Schrift)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated, bitte nicht mehr verwenden!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i" target="_blank">Idiomatic (i.d.R. kursiv)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/u" target="_blank">Unarticulated Annotation (i.d.R. unterstrichen)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/br" target="_blank">Break (Zeilenumbruch)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nobr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/nobr" target="_blank">Text ohne Zeilenumbruch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated, bitte nicht mehr verwenden!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/pre" target="_blank">Pre-formatted</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leerzeichen wie Einrückungen bleiben erhalten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/sup" target="_blank">Superscript</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p" target="_blank">Paragraph</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/hr" target="_blank">Thematic Break (horizontaler Strich)</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>li</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li" target="_blank">List Item</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verwendung nur innerhalb der nachfolgenden Listen:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ul</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul" target="_blank">Unordered List</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ol" target="_blank">Ordered List</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Wie bei allen Regeln in Checkmk üblich, ist eine sehr fein granulierte Anwendung möglich, so dass Sie je nach Bedarf eine detailliert zu bestimmende Menge an Benachrichtigungen zu Hosts und Services individualisieren können.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_rules">
<span class="hidden-anchor sr-only" id="rules"></span>4. Benachrichtigungen per Regeln steuern</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__das_prinzip">
<span class="hidden-anchor sr-only" id="_das_prinzip"></span>4.1. Das Prinzip</h3>
<div class="paragraph"><p>Checkmk ist „ab Werk“ so eingerichtet, dass es bei einem Monitoring-Ereignis an jeden <a href="wato_user.html#contact_groups">Kontakt</a> des betroffenen Hosts oder Services eine Benachrichtigung per E-Mail versendet.
Das ist sicher erst einmal sinnvoll, aber in der Praxis tauchen viele weitergehende Anforderungen auf, z. B.:</p></div>
<div class="ulist"><ul>
<li><p>Unterdrücken bestimmter, wenig nützlicher Benachrichtigungen.</p></li>
<li><p>„Abonnieren“ von Benachrichtigungen zu Services, für die man kein Kontakt ist.</p></li>
<li><p>Benachrichtigen per E-Mail, SMS oder Pager, abhängig von der Tageszeit.</p></li>
<li><p>Eskalieren von Problemen nach einer bestimmten Zeit ohne <a href="basics_ackn.html">Quittierung.</a></p></li>
<li><p>Eventuell keine Benachrichtigungen für <span class="state1">WARN</span> oder <span class="state3">UNKNOWN</span> erhalten.</p></li>
<li><p>und vieles mehr …​</p></li>
</ul></div>
<div class="paragraph"><p>Checkmk bietet Ihnen über einen regelbasierten Mechanismus maximale Flexibilität bei der Umsetzung solcher Anforderungen.
Mit <span class="guihint">Setup &gt; Events &gt;  Notifications</span> steigen Sie in die Konfiguration ein.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Wenn Sie die Seite <span class="guihint">Notification configuration</span> das erste
Mal aufrufen, wird Ihnen eine Warnung zur nicht konfigurierten „fallback email
address" angezeigt. Die Warnung können Sie im Moment ignorieren. Wir gehen
darauf <a href="#fallback">weiter unten</a> ein.</p></div>
<div class="paragraph"><p>In der Benachrichtigungskonfiguration verwalten Sie die <strong>Kette der
Benachrichtigungsregeln,</strong> welche festlegen, <em>wer</em>  <em>wie</em> benachrichtigt werden
soll. Bei jedem Monitoring-Ereignis wird diese Regelkette von <em>oben nach unten</em>
durchlaufen. Jede Regel hat eine Bedingung, die entscheidet, ob die Regel
überhaupt zur Anwendung kommt. Ist die Bedingung erfüllt, legt die Regel zwei
Dinge fest:</p></div>
<div class="ulist"><ul>
<li><p>Eine Auswahl von Kontakten (<em>Wer</em> soll benachrichtigt werden?)</p></li>
<li><p>Eine Benachrichtigungsmethode (<em>Wie</em> soll benachrichtigt werden?), z. B. HTML-E-Mail, und dazu optional Parameter für die Methode</p></li>
</ul></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Anders als bei den <a href="wato_rules.html">Regeln für Hosts und Services</a>
geht die Auswertung hier auch nach einer zutreffenden Regel weiter! Die
nachfolgenden Regeln können weitere Benachrichtigungen hinzufügen. Auch können
Sie Benachrichtigungen wieder <a href="#cancel">löschen</a>, welche vorherige Regeln
generiert haben.</p></div>
<div class="paragraph"><p>Das Endergebnis der Regelauswertung ist eine Tabelle, die etwa folgenden Aufbau hat:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Wer (Kontakt)</th>
<th class="tableblock halign-left valign-top">Wie (Methode)</th>
<th class="tableblock halign-left valign-top">Parameter der Methode</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Reply-To: linux.group@example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Reply-To: linux.group@example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Nun wird pro Eintrag in dieser Tabelle das zur Methode gehörende <a href="#scripts">Benachrichtigungsskript</a> aufgerufen, welches die
eigentliche Benutzerbenachrichtigung durchführt.</p></div>
</div>
<div class="sect2">
<h3 id="heading__vordefinierte_regel">
<span class="hidden-anchor sr-only" id="_vordefinierte_regel"></span>4.2. Vordefinierte Regel</h3>
<div class="paragraph"><p>Wenn Sie Checkmk frisch aufgesetzt haben, dann finden Sie genau eine Regel vordefiniert:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_default_rule.png" alt="Liste mit der vordefinierten Benachrichtigungsregel."></div></div>
<div class="paragraph"><p>Diese eine Regel setzt das oben beschriebene Standardverhalten um. Sie hat folgenden Aufbau:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bedingung</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keine, d. h. die Regel gilt für <strong>alle</strong> Monitoring-Ereignisse.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Methode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versand einer E-Mail im HTML-Format (mit eingebetteten Metrikgraphen)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kontakt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Kontakte des betroffenen Hosts/Services</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Wie gewohnt, können Sie die Regel <span class="image-inline"><img src="../images/icons/icon_edit.png" alt="icon edit"></span> bearbeiten, <span class="image-inline"><img src="../images/icons/icon_clone.png" alt="icon clone"></span> kopieren, <span class="image-inline"><img src="../images/icons/icon_delete.png" alt="Symbol zum Löschen."></span> löschen oder eine neue Regel anlegen.
Sobald Sie mehr als eine Regel haben, können Sie die Reihenfolge der Regeln per Drag &amp; Drop über das Symbol <span class="image-inline"><img src="../images/icons/icon_drag.png" alt="icon drag"></span> verändern.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Änderungen an Benachrichtigungsregeln erfordern <strong>keine</strong> Aktivierung der Änderungen. Sie sind sofort wirksam.</p></div>
</div>
<div class="sect2">
<h3 id="heading_notification_rule">
<span class="hidden-anchor sr-only" id="notification_rule"></span>4.3. Aufbau der Benachrichtigungsregeln</h3>
<div class="paragraph"><p>Im folgenden stellen wir den generellen Aufbau der Benachrichtigungsregeln mit den Festlegungen zu generellen Eigenschaften, Methoden, Kontakten und Bedingungen vor.</p></div>
<div class="sect3">
<h4 id="heading__generelle_eigenschaften">
<span class="hidden-anchor sr-only" id="_generelle_eigenschaften"></span>Generelle Eigenschaften</h4>
<div class="paragraph"><p>Wie bei allen Regeln in Checkmk, können Sie hier eine Beschreibung und einen Kommentar für die Regel hinterlegen sowie die Regel temporär abschalten.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part1.png" alt="Regel mit der Option zur Aktivierung der Abschaltung von Benachrichtigungen durch Benutzer."></div></div>
<div class="paragraph"><p>Die Option <span class="guihint">Overriding by users</span> ist per Default
aktiviert. Sie erlaubt Benutzern, Benachrichtigungen „abzubestellen“, die von dieser Regel erzeugt werden.
Wie das geht, zeigen wir bei den <a href="#personal">benutzerdefinierten Benachrichtigungen.</a></p></div>
</div>
<div class="sect3">
<h4 id="heading__benachrichtigungsmethode">
<span class="hidden-anchor sr-only" id="_benachrichtigungsmethode"></span>Benachrichtigungsmethode</h4>
<div class="paragraph"><p>Die Benachrichtigungsmethode legt fest, auf welchem technischen Weg benachrichtigt werden soll, z. B. mit HTML-E-Mail.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part2.png" alt="Regel mit den Optionen zur Benachrichtigungsmethode."></div></div>
<div class="paragraph"><p>Jede Methode ist durch ein Skript realisiert.
Checkmk liefert bereits <a href="#includedscripts">einige Skripte</a> mit aus.
Sie können aber auch recht einfach <a href="#scripts">eigene Skripte</a> in beliebigen Programmiersprachen schreiben, um speziellere Anforderungen umzusetzen, z. B. die Weiterleitung der Benachrichtigungen an ein eigenes Ticketsystem.</p></div>
<div class="paragraph"><p>Eine Methode kann Parameter anbieten.
Zum Beispiel erlauben es die Methoden für ASCII- und HTML-E-Mails, die Absenderadresse (<code>From:</code>) explizit zu setzen.</p></div>
<div class="paragraph"><p>Bevor Sie hier Einstellungen in der Benachrichtigungsregel machen, sollten Sie wissen, dass Sie Parameter für die Benachrichtigungsmethoden auch in den <a href="wato_rules.html">Regeln für Hosts und Services</a> setzen können:
Unter <span class="guihint">Setup &gt; Services &gt; Service monitoring rules</span> finden Sie im Abschnitt <span class="guihint">Notifications</span> für jede Benachrichtigungsmethode einen Regelsatz, mit dem Sie die gleichen Einstellungen festlegen können — und das wie gewohnt abhängig von Host oder Service.</p></div>
<div class="paragraph"><p>Parameterdefinitionen in Benachrichtigungsregeln dienen dazu, für Einzelfälle von diesen Einstellungen abzuweichen.
So können Sie z. B. global einen bestimmten Betreff für Ihre E-Mail festlegen, aber in einer einzelnen Benachrichtigungsregel einen alternativen Betreff definieren.</p></div>
<div class="paragraph"><p>Anstelle von Parametern können Sie auch <span class="guihint">Cancel previous notifications</span> auswählen.
Dann werden Benachrichtigungen in Form dieser Methode aus früheren Regeln wieder verworfen.
Näheres dazu finden Sie beim Thema <a href="#cancel">Löschen von Benachrichtigungen.</a></p></div>
<div class="paragraph"><p>Hinweis: Für die folgenden Benachrichtigungsmethoden zur Weiterleitung an andere Systeme erhalten Sie genauere Informationen in separaten Artikeln:
<a href="notifications_jira.html">Jira</a>,
<a href="notifications_mattermost.html">Mattermost</a>,
<a href="notifications_pagerduty.html">PagerDuty</a>,
<a href="notifications_pushover.html">Pushover</a>,
<a href="notifications_opsgenie.html">Opsgenie</a>,
<a href="notifications_servicenow.html">ServiceNow</a>,
<a href="notifications_slack.html">Slack</a>,
<a href="notifications_opsgenie.html">Opsgenie</a> und
<a href="notifications_webex.html">Cisco Webex Teams</a></p></div>
</div>
<div class="sect3">
<h4 id="heading__kontaktauswahl">
<span class="hidden-anchor sr-only" id="_kontaktauswahl"></span>Kontaktauswahl</h4>
<div class="paragraph"><p>Der häufigste Fall bei der Festlegung der Kontakte ist, alle Benutzer zu benachrichtigen, die als <a href="wato_user.html#add_host_to_contact_group">Kontakt</a> für den jeweiligen Host/Service eingetragen sind.
Dies ist das „normale“ Verhalten und naheliegend, da über die Kontakte ebenfalls gesteuert wird, welcher Benutzer welche Objekte in der GUI zu sehen bekommt und quasi dafür zuständig ist.</p></div>
<div class="paragraph"><p>Sie können bei der Kontaktauswahl mehrere Optionen ankreuzen und so die Benachrichtigung auf mehr Kontakte ausweiten:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part3.png" alt="Regel mit den Optionen zur Kontaktauswahl."></div></div>
<div class="paragraph"><p>Doppelte Kontakte werden von Checkmk automatisch entfernt.
Damit die Regel sinnvoll ist, muss mindestens eine Auswahl getroffen werden.</p></div>
<div class="paragraph"><p>Die beiden Optionen, die mit <span class="guihint">Restrict by …​</span> beginnen, arbeiten etwas anders.
Hier werden die durch die übrigen Optionen ausgewählten Kontakte wieder <em>eingeschränkt</em>.
Damit können Sie auch eine UND-Verknüpfung zwischen Kontaktgruppen herstellen, um z. B. alle Kontakte zu benachrichtigen, die gleichzeitig Mitglied der Gruppen <code>Linux</code> und <code>Datacenter</code> sind.</p></div>
<div class="paragraph"><p>Durch die Angabe von E-Mail-Adressen (<span class="guihint">Explicit email addresses</span>) können Sie Personen benachrichtigen, die überhaupt nicht als Benutzer in Checkmk hinterlegt sind.
Dies ist natürlich nur bei den Benachrichtigungsmethoden sinnvoll, die E-Mails verschicken.</p></div>
<div class="paragraph"><p>Falls Sie als Methode <span class="guihint">Cancel previous notifications</span> gewählt haben, werden nur Benachrichtigungen an die hier gewählten Kontakte entfernt.</p></div>
</div>
<div class="sect3">
<h4 id="heading_rule_conditions">
<span class="hidden-anchor sr-only" id="rule_conditions"></span>Bedingungen</h4>
<div class="paragraph"><p>Bedingungen legen fest, wann eine Regel Anwendung findet.
Für das Verständnis ist es wichtig, sich daran zu erinnern, dass der Ausgangspunkt immer ein Monitoring-Ereignis von einem ganz konkreten Host oder Service ist.</p></div>
<div class="paragraph"><p>Die Bedingungen befassen sich dabei</p></div>
<div class="ulist"><ul>
<li><p>mit den statischen Eigenschaften des Objekts, z. B. ob der Service-Name den Text <code>/tmp</code> enthält oder ein Host sich in einer bestimmten Host-Gruppe befindet,</p></li>
<li><p>mit dem aktuellen Zustand bzw. der Änderung des Zustands, z. B. ob der Service gerade von <span class="state0">OK</span> nach <span class="state2">CRIT</span> gewechselt hat,</p></li>
<li><p>oder mit ganz anderen Dingen, z. B. ob die <a href="timeperiods.html">Zeitperiode</a> „Arbeitszeit“ gerade aktiv ist.</p></li>
</ul></div>
<div class="paragraph"><p>Bei der Festlegung der Bedingungen gibt es zwei wichtige Punkte zu beachten:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Solange keine Bedingung definiert ist, greift die Regel bei <strong>jedem</strong> Monitoring-Ereignis.</p></li>
<li><p>Sobald Sie auch nur eine einzige Bedingung auswählen, greift die Regel nur, wenn auch wirklich <strong>alle</strong> ausgewählten Bedingungen erfüllt sind.
Alle ausgewählten Bedingungen werden mit UND verknüpft.
Von dieser wichtigen Regel gibt es nur eine Ausnahme, auf die wir später eingehen werden und die wir jetzt nicht betrachten.</p></li>
</ol></div>
<div class="paragraph"><p>Das heißt, dass Sie sehr genau darauf achten sollten, ob die von Ihnen gewählten Bedingungen gleichzeitig erfüllt sein können, damit eine Benachrichtigung auch für den gewünschten Fall ausgelöst wird.</p></div>
<div class="paragraph"><p>Nehmen wir an, eine Benachrichtigung soll erfolgen, wenn ein Monitoring-Ereignis für einen Service, der mit dem Namen <code>NTP</code> beginnt, auf einem Host im Ordner <span class="guihint">Main</span> eintritt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4.png" alt="Regel mit den Bedingungen für die Erstellung einer Benachrichtigung."></div></div>
<div class="paragraph"><p>Nehmen wir weiter an, dass diese Bedingung nun <strong>erweitert</strong> wird, indem auch alle Zustandsänderungen eines Hosts auf den Zustand <span class="hstate1">DOWN</span> eine Benachrichtigung auslösen sollen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_match_host_types.png" alt="Regel mit erweiterten Bedingungen für die Erstellung einer Benachrichtigung."></div></div>
<div class="paragraph"><p>Das Ergebnis dieser Benachrichtigungsregel mit den drei Einzelbedingungen ist, dass <strong>nie</strong> eine Benachrichtigung erfolgen wird, weil kein Monitoring-Ereignis die Zustandsänderung eines Hosts <strong>und</strong> den Service-Namen mit <code>NTP</code> enthalten wird.</p></div>
<div class="paragraph"><p>Den folgenden Hinweis geben wir in diesem Handbuch immer wieder. Im Zusammenhang mit der Konfiguration Ihrer Benachrichtigungen ist er allerdings nochmal besonders hervorzuheben:
Blenden Sie die kontextsensitive Hilfe mit <span class="guihint">Help &gt; Show inline help</span> ein, um Einzelheiten über die Auswirkungen der verschiedenen Bedingungen zu erfahren.
Der folgende Auszug aus der kontextsensitiven Hilfe zur Option <span class="guihint">Match services</span> verdeutlicht das Verhalten sehr gut: „<em>Anmerkung: Auf Host-Benachrichtigungen trifft diese Regel nie zu, wenn diese Option benutzt wird.</em>“.</p></div>
<h4 id="_die_ausnahme_von_der_und_verknüpfung" class="discrete">Die Ausnahme von der UND-Verknüpfung</h4>
<div class="paragraph"><p>Nur wenn ein Monitoring-Ereignis alle konfigurierten Bedingungen erfüllt, kommt die Benachrichtigungsregel zur Anwendung.
Wie bereits erwähnt, gibt es zu dieser allgemeinen Regel eine wichtige Ausnahme: für die Bedingungen <span class="guihint">Match host event type</span> und <span class="guihint">Match service event type</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_match_event_types.png" alt="Die Bedingungen 'Match host event type' und 'Match service event type'."></div></div>
<div class="paragraph"><p>Falls Sie <strong>nur</strong> <span class="guihint">Match host event type</span> auswählen, wird die Regel auf kein einziges Service-Ereignis matchen.
Analog gilt dies auch für die Auswahl von <span class="guihint">Match service event type</span> und Host-Ereignisse.
Falls Sie aber <strong>beide</strong> Bedingungen aktivieren, matcht die Regel, sobald der Ereignistyp in <strong>einer</strong> der beiden Checkboxlisten aktiviert ist.
In diesem Ausnahmefall werden diese beiden Bedingungen also nicht wie üblich mit einem logischen UND verknüpft, sondern mit einem ODER.
So können Sie bequemer Host- und Service-Benachrichtigungen mit einer einzelnen Regel verwalten.</p></div>
<div class="paragraph"><p>Ein Hinweis noch zu den Bedingungen <span class="guihint">Match contacts</span> und <span class="guihint">Match contact groups</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part4_contacts.png" alt="Die Bedingungen 'Match contacts' und 'Match contact groups'."></div></div>
<div class="paragraph"><p>Hier wird als Bedingung geprüft, ob der Host/Service, um den es geht, eine bestimmte Kontaktzuordnung hat.
Damit kann man Dinge umsetzen wie „Host-bezogene Benachrichtigungen in der Kontaktgruppe Linux sollen nie per SMS versendet werden“.
Das hat nichts mit der oben beschriebenen Kontaktauswahl zu tun.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_cancel">
<span class="hidden-anchor sr-only" id="cancel"></span>4.4. Benachrichtigungen durch Regeln löschen</h3>
<div class="paragraph"><p>Wie bei der Auswahl der Benachrichtigungsmethode bereits erwähnt, finden Sie dort auch die Auswahlmöglichkeit <span class="guihint">Cancel previous notifications</span>.
Um die Funktionsweise einer solchen Regel zu verstehen, stellen Sie sich am besten die Benachrichtigungstabelle bildlich vor.
Nehmen wir an, einige Regeln zu einem konkreten Monitoring-Ereignis wurden bereits abgearbeitet.
Dadurch wurden die folgenden drei Benachrichtigungen erzeugt:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Wer (Kontakt)</th>
<th class="tableblock halign-left valign-top">Wie (Methode)</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Nun kommt die nächste Regel mit der Methode <span class="guihint">SMS</span> und der Auswahl <span class="guihint">Cancel previous notifications</span>.
Als Kontakt sind die Mitglieder der Kontaktgruppe „Windows“ ausgewählt, der auch Bruno Weizenkeim angehört.
Als Ergebnis dieser Regel wird der Eintrag „Bruno Weizenkeim / SMS“ aus der Tabelle entfernt, die anschließend so aussieht:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Wer (Kontakt)</th>
<th class="tableblock halign-left valign-top">Wie (Methode)</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Harry Hirsch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruno Weizenkeim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Sollte eine spätere Regel wieder eine SMS-Benachrichtigung für Bruno definieren, so hätte diese Vorrang und die SMS-Benachrichtigung würde wieder in die Tabelle aufgenommen.</p></div>
<div class="paragraph"><p>Zusammengefasst:</p></div>
<div class="ulist"><ul>
<li><p>Regeln können gezielt Benachrichtigungen unterdrücken (löschen).</p></li>
<li><p>Löschregeln müssen nach den Regeln kommen, welche Benachrichtigungen erzeugen.</p></li>
<li><p>Eine Löschregel hebt nicht eine frühere Regel auf, sondern Benachrichtigungen, die aus (möglicherweise verschiedenen) früheren Regeln stammen.</p></li>
<li><p>Spätere Regeln können vormals gelöschte Benachrichtigungen wieder hinzufügen.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_fallback">
<span class="hidden-anchor sr-only" id="fallback"></span>4.5. Was ist, wenn keine Regel greift?</h3>
<div class="paragraph"><p>Wer konfiguriert, kann auch Fehler machen. Ein möglicher Fehler bei der
Benachrichtigungskonfiguration wäre, dass das Monitoring ein kritisches Problem
entdeckt und keine einzige Benachrichtigungsregel greift.</p></div>
<div class="paragraph"><p>Um Sie vor so einem Fall zu schützen, bietet Checkmk die Einstellung <span class="guihint">Fallback email address for notifications</span>.
Diese finden Sie unter <span class="guihint">Setup &gt; General &gt; Global settings</span> im Abschnitt <span class="guihint">Notifications</span>.
Tragen Sie hier eine E-Mail-Adresse ein.
An diese werden Benachrichtigungen verschickt, für die keine einzige Benachrichtigungsregel greift.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Alternativ können Sie auch einen Benutzer in seinen <a href="wato_user.html#user_config_notifications">persönlichen Einstellungen</a> zum Empfänger machen.
Als Fallback-Adresse wird die beim Benutzer hinterlegte E-Mail-Adresse verwendet.</p></div>
<div class="paragraph"><p>Die Fallback-Adresse wird nur dann verwendet, wenn <strong>keine Regel</strong> greift, nicht wenn keine Benachrichtigung erzeugt würde!
Wie wir im vorherigen Kapitel gezeigt haben, ist das explizite Löschen von Benachrichtigungen ja erwünscht und kein Konfigurationsfehler.</p></div>
<div class="paragraph"><p>Die Einrichtung der Fallback-Adresse wird auf der Seite <span class="guihint">Notification configuration</span> durch die folgende Warnung „empfohlen“:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_warning_fallback_email.png" alt="Warnhinweis, dass keine Fallback-E-Mail-Adresse hinterlegt ist."></div></div>
<div class="paragraph"><p>Falls Sie die Fallback-Adresse nicht nutzen wollen, so erzeugen Sie eine neue Regel als <em>erste Regel</em>, die alle bisherigen Benachrichtigungen löscht.
Diese Regel ist für die Benachrichtigungskonfiguration wirkungslos, da ja hier noch keine Benachrichtigungen erzeugt wurden.
Aber damit stellen Sie sicher, dass immer eine Regel greift und lassen somit die Warnung verschwinden.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_personal">
<span class="hidden-anchor sr-only" id="personal"></span>5. Benutzerdefinierte Benachrichtigungen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__übersicht">
<span class="hidden-anchor sr-only" id="_übersicht"></span>5.1. Übersicht</h3>
<div class="paragraph"><p>Eine nützliche Besonderheit des Benachrichtigungssystems von Checkmk ist, dass
Benutzer sich auch ohne Administratorrechte ihre Benachrichtigungen anpassen
können. Benutzer können:</p></div>
<div class="ulist"><ul>
<li><p>Benachrichtigungen hinzufügen, die sie sonst nicht bekommen würden („abonnieren“),</p></li>
<li><p>Benachrichtigungen löschen, die sie sonst bekommen würden (falls nicht gesperrt),</p></li>
<li><p>Parameter von Benachrichtigungen anpassen und</p></li>
<li><p>ihre Benachrichtigungen vorübergehend ganz abschalten.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__benutzerdefinierte_benachrichtigungsregeln">
<span class="hidden-anchor sr-only" id="_benutzerdefinierte_benachrichtigungsregeln"></span>5.2. Benutzerdefinierte Benachrichtigungsregeln</h3>
<div class="paragraph"><p>Der Einstieg aus Sicht des Benutzers ist das <a href="user_interface.html#user_menu">User-Menü</a>, und dort der Eintrag <span class="guihint">Notification rules</span>.
Auf der Seite <span class="guihint">Your personal notification rules</span> kann mit <span class="guihint">Add rule</span> eine neue Regel erzeugt werden.</p></div>
<div class="paragraph"><p>Benutzerdefinierte Regeln sind wie die normalen Regeln aufgebaut — mit einem Unterschied: Sie enthalten keine Kontaktauswahl.
Als Kontakt ist automatisch der Benutzer selbst gewählt.
Dadurch kann ein Benutzer nur für sich selbst Benachrichtigungen hinzufügen oder löschen.</p></div>
<div class="paragraph"><p>Löschen kann der Benutzer Benachrichtigungen allerdings nur dann, wenn in der Regel, die sie erzeugt, die Option <span class="guihint">allow users to deactivate this notification</span> aktiviert ist:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_rule_part1.png" alt="Regel mit der Option zur Aktivierung der Abschaltung von Benachrichtigungen durch Benutzer."></div></div>
<div class="paragraph"><p>In der Reihenfolge der Benachrichtigungsregeln kommen die benutzerdefinierten Regeln immer <em>nach</em> den globalen Regeln und können so die bisher erzeugte Benachrichtigungstabelle anpassen.
Bis auf das gerade beschriebene Sperren der Löschung gelten also die globalen Regeln immer als Standardeinstellung, die vom Benutzer angepasst werden kann.</p></div>
<div class="paragraph"><p>Wenn Sie ein Anpassen ganz unterbinden möchten, können Sie der Benutzerrolle <code>user</code> die <a href="wato_user.html#roles">Berechtigung</a> <span class="guihint">General Permissions &gt; Edit personal notification settings</span> entziehen.</p></div>
<div class="paragraph"><p>Als Administrator können Sie sich alle Benutzerregeln anzeigen lassen, wenn Sie im Menü <span class="guihint">Display &gt; Show user rules</span>
wählen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_show_user_roles.png" alt="Liste der Benutzerregeln aus Administratorensicht."></div></div>
<div class="paragraph"><p>Nach den globalen Regeln werden die Benutzerregeln  aufgelistet, die Sie mit <span class="image-inline"><img src="../images/icons/icon_edit.png" alt="icon edit"></span> auch bearbeiten können.</p></div>
</div>
<div class="sect2">
<h3 id="heading__vorübergehende_abschaltung">
<span class="hidden-anchor sr-only" id="_vorübergehende_abschaltung"></span>5.3. Vorübergehende Abschaltung</h3>
<div class="paragraph"><p>Die komplette Abschaltung der Benachrichtigungen durch einen Benutzer selbst ist mit der <a href="wato_user.html#roles">Berechtigung</a> <span class="guihint">General Permissions &gt; Disable all personal notifications</span> geschützt, die für die Benutzerrolle <code>user</code> per Default auf <code>no</code> gesetzt ist.
Nur wenn Sie der Rolle <code>user</code> dieses Recht explizit zuweisen, bekommt ein Benutzer dafür in seinen persönlichen Einstellungen entsprechende Checkboxen angezeigt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_edit_profile_disable.png" alt="Persönliche Einstellung zur vorübergehende Abschaltung der Benachrichtigungen."></div></div>
<div class="paragraph"><p>Da Sie als Administrator einfachen Zugriff auf die persönlichen Einstellungen der Benutzer haben, können Sie das Abschalten stellvertretend für den Benutzer machen — auch wenn diesem die oben genannte Berechtigung fehlt.
Sie finden diese Einstellung unter <span class="guihint">Setup &gt; Users &gt; Users</span> und dann in den Eigenschaften des Benutzerprofils.
Damit können Sie z. B. während eines Urlaubs eines Kollegen sehr schnell dessen Benachrichtigungen still schalten, ohne an der eigentlichen Konfiguration etwas ändern zu müssen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_conditions">
<span class="hidden-anchor sr-only" id="conditions"></span>6. Wann Benachrichtigungen erzeugt werden und wie man damit umgeht</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__einleitung">
<span class="hidden-anchor sr-only" id="_einleitung"></span>6.1. Einleitung</h3>
<div class="paragraph"><p>Ein großer Teil der Komplexität im Benachrichtigungssystem von Checkmk liegt in den zahlreichen Tuning-Möglichkeiten, mit denen unwichtige Benachrichtigungen vermieden werden können.
Die meisten davon betreffen Situationen, in denen bereits beim Auftreten der Monitoring-Ereignisse Benachrichtigungen verzögert oder
unterdrückt werden.
Auch gibt es eine im Monitoring-Kern eingebaute Intelligenz, die bestimmte Benachrichtigungen von Haus aus unterdrückt.
Alle diese Aspekte wollen wir Ihnen in diesem Kapitel vorstellen.</p></div>
</div>
<div class="sect2">
<h3 id="heading__wartungszeiten">
<span class="hidden-anchor sr-only" id="_wartungszeiten"></span>6.2. Wartungszeiten</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_downtime.png" alt="Symbol einer Wartungszeit." width="50"></div></div>
<div class="paragraph"><p>Während sich ein Host oder Service in einer <a href="basics_downtimes.html">Wartungszeit</a> befindet, sind für dieses Objekt die Benachrichtigungen unterdrückt.
Das ist — neben einer korrekten Berechnung von Verfügbarkeiten — der wichtigste Grund, warum man überhaupt eine Wartungszeit im Monitoring hinterlegt.
Interessant sind dabei folgende Details:</p></div>
<div class="ulist"><ul>
<li><p>Ist ein Host in Wartung, dann gelten automatisch auch alle seine Services als in Wartung, ohne dass man explizit eine Wartung für diese eintragen muss.</p></li>
<li><p>Endet die Wartungszeit eines Objekts, das <em>während</em> der Wartungszeit in einen Problemzustand gewechselt hat, dann werden für dieses Problem exakt beim Ablauf der Wartung <em>nachträglich</em> Benachrichtigungen ausgelöst.</p></li>
<li><p>Der Beginn und das Ende einer Wartungszeit selbst sind auch Monitoring-Ereignisse, für die Benachrichtigungen ausgelöst werden.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__benachrichtigungsperioden">
<span class="hidden-anchor sr-only" id="_benachrichtigungsperioden"></span>6.3. Benachrichtigungsperioden</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_outofnot.png" alt="Symbol einer inaktiven Benachrichtigungsperiode." width="50"></div></div>
<div class="paragraph"><p>Per Konfiguration können Sie für jeden Host und Service eine Benachrichtigungsperiode festlegen.
Dies ist eine <a href="timeperiods.html">Zeitperiode</a>, welche die Zeiträume festlegt, auf die Benachrichtigungen beschränkt werden sollen.</p></div>
<div class="paragraph"><p>Die Konfiguration geschieht über die Regelsätze <span class="guihint">Notification period for hosts</span> bzw. <span class="guihint">Notification period for services</span>, die Sie schnell über die <a href="user_interface.html#search_setup">Suche im Setup-Menü</a> finden können.
Ein Objekt, welches sich gerade <strong>nicht</strong> in seiner Benachrichtigungsperiode befindet, wird durch ein graues Pause-Zeichen <span class="image-inline"><img src="../images/icons/icon_outofnot.png" alt="Symbol einer inaktiven Benachrichtigungsperiode."></span> markiert.</p></div>
<div class="paragraph"><p>Monitoring-Ereignisse zu einem Objekt, das sich gerade außerhalb seiner Benachrichtigungsperiode befindet, lösen keine Benachrichtigungen aus.
Benachrichtigungen werden nachgeholt, wenn die Benachrichtigungsperiode wieder aktiv wird und der Host/Service sich immer noch in einem Problemzustand befindet.
Dabei löst nur der jeweils letzte Zustand eine Benachrichtigung aus, auch wenn es außerhalb der Periode mehrere Zustandswechsel gab.</p></div>
<div class="paragraph"><p>Übrigens gibt es auch bei den Benachrichtigungsregeln die Möglichkeit, Benachrichtigungen auf eine bestimmte Zeitperiode zu beschränken.
Damit können Sie die Zeiträume <em>zusätzlich</em> einschränken.
Allerdings werden Benachrichtigungen, die durch eine Regel mit Zeitbedingung verworfen wurden, später <strong>nicht</strong> automatisch nachgeholt!</p></div>
</div>
<div class="sect2">
<h3 id="heading_state_host">
<span class="hidden-anchor sr-only" id="state_host"></span>6.4. Der Zustand des Hosts, auf dem ein Service läuft</h3>
<div class="paragraph"><p>Wenn ein Host komplett ausfällt oder zumindest für das Monitoring nicht erreichbar ist, können natürlich auch die Services des Hosts nicht mehr überwacht werden.
<a href="active_checks.html">Aktive Checks</a> werden dann in der Regel <span class="state2">CRIT</span> oder <span class="state3">UNKNOWN</span>, weil diese gezielt versuchen, den Host zu erreichen und dabei in einen Fehler laufen.
Alle anderen Checks — also die überwiegende Mehrheit — werden in so einem Fall ausgelassen und verharren in ihrem alten Zustand.
Sie werden mit der Zeit <span class="image-inline"><img src="../images/icons/icon_stale.png" alt="icon stale"></span> <span class="guihint">stale</span>.</p></div>
<div class="paragraph"><p>Natürlich wäre es sehr lästig, wenn alle Probleme von aktiven Checks in so einem Zustand Benachrichtigungen auslösen würden.
Denn wenn z. B. ein Webserver nicht erreichbar ist — und dies auch schon als Benachrichtigung kommuniziert wurde — wäre es wenig informativ, wenn nun auch für jeden einzelnen HTTP-Dienst, den dieser bereit stellt, eine E-Mail generiert würde.</p></div>
<div class="paragraph"><p>Um dies zu vermeiden, erzeugt der Monitoring-Kern für Services grundsätzlich nur dann Benachrichtigungen, wenn der Host den Zustand <span class="hstate0">UP</span> hat.
Das ist auch der Grund, warum die Erreichbarkeit von Hosts separat überprüft wird.
Wenn Sie nichts anderes konfiguriert haben, geschieht dies durch einen <a href="cmc_differences.html#smartping">Smart Ping</a> bzw. Ping.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
Wenn Sie die Raw Edition verwenden (oder eine der Enterprise Editions mit Nagios als Kern), dann kann es in seltenen Fällen bei einem Host-Problem trotzdem zu einer Benachrichtigung aufgrund eines aktiven Services kommen.
Der Grund liegt darin, dass Nagios die Resultate von Host-Checks für eine kurze Zeit in der Zukunft als gültig betrachtet.
Wenn zwischen dem letzten erfolgreichen Ping an den Server und dem nächsten aktiven Check nur wenige Sekunden vergehen, kann es sein, dass Nagios den Host noch als <span class="hstate0">UP</span> wertet, obwohl dieser bereits <span class="hstate1">DOWN</span> ist.
Der <a href="cmc.html">Checkmk Micro Core (CMC)</a> hingegen hält die Service-Benachrichtigung solange in Wartestellung, bis der Zustand des Hosts geklärt ist und vermeidet die unerwünschte Benachrichtigung so zuverlässig.</p></div>
</div>
<div class="sect2">
<h3 id="heading_parents">
<span class="hidden-anchor sr-only" id="parents"></span>6.5. Parent-Hosts</h3>
<div class="paragraph"><p>Stellen Sie sich vor, ein wichtiger Netzwerk-Router zu einem
Unternehmensstandort mit Hunderten von Hosts fällt aus. Alle Hosts sind dann für
das Monitoring nicht mehr erreichbar und gehen auf <span class="hstate1">DOWN</span>. Hunderte
Benachrichtigungen werden ausgelöst. Nicht sehr schön.</p></div>
<div class="paragraph"><p>Um das zu vermeiden, können Sie den Router als <a href="hosts_structure.html#parents">Parent-Host</a> der Hosts definieren.
Wenn es redundante Routen gibt, kann man auch mehrere Parents definieren.
Sobald alle Parents auf <span class="hstate1">DOWN</span> gehen, werden die nicht mehr erreichbaren Hosts auf den Zustand <span class="hstate2">UNREACH</span> gesetzt und die darauf basierenden Benachrichtigungen werden unterdrückt.
Das Problem mit dem Router selbst löst hingegen durchaus eine Benachrichtigung aus.</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Der <a href="cmc.html">CMC</a> verhält sich intern übrigens geringfügig anders als Nagios.
Um Fehlalarme zu vermeiden, richtige Benachrichtigungen aber korrekt abzusetzen, achtet er sehr genau auf die exakten Zeitpunkte der jeweiligen Host-Checks.
Scheitert ein Host-Check, so wartet der Kern zunächst das Ergebnis des Host-Checks der Parent-Hosts ab, bevor eine Benachrichtigung erzeugt wird.
Dieses Warten geschieht asynchron und ohne das übrige Monitoring zu beeinträchtigen.
Benachrichtigungen von Hosts können sich dadurch geringfügig verzögern.</p></div>
</div>
<div class="sect2">
<h3 id="heading__benachrichtigungen_per_regel_abschalten">
<span class="hidden-anchor sr-only" id="_benachrichtigungen_per_regel_abschalten"></span>6.6. Benachrichtigungen per Regel abschalten</h3>
<div class="paragraph"><p>Über die Regelsätze <span class="guihint">Enable/disable notifications for hosts</span> bzw. <span class="guihint">Enable/disable notifications for services</span> können Sie Hosts und Services bestimmen, aufgrund derer grundsätzlich keine Benachrichtigungen erzeugt werden sollen.
Wie oben erwähnt, unterbindet dann bereits der Kern die Benachrichtigungen.
Eine Benachrichtigungsregel für ein „Abonnieren“ solcher Benachrichtigungen wäre wirkungslos, da diese ja gar nicht erzeugt werden.</p></div>
</div>
<div class="sect2">
<h3 id="heading__benachrichtigungen_per_kommando_abschalten">
<span class="hidden-anchor sr-only" id="_benachrichtigungen_per_kommando_abschalten"></span>6.7. Benachrichtigungen per Kommando abschalten</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_notif_man_disabled.png" alt="Symbol einer deaktivierten Benachrichtigung." width="50"></div></div>
<div class="paragraph"><p>Es ist grundsätzlich möglich, die Benachrichtigungen bezogen auf einzelne Hosts und Services auch per <a href="commands.html">Kommando</a> vorübergehend abzuschalten.</p></div>
<div class="paragraph"><p>Voraussetzung dafür ist allerdings, dass die <a href="wato_user.html#roles">Berechtigung</a> <span class="guihint">Commands on host and services &gt; Enable/disable notifications</span> der Benutzerrolle zugewiesen ist. Standardmäßig ist dies für <strong>keine</strong> Rolle der Fall.</p></div>
<div class="paragraph"><p>Mit zugewiesener Berechtigung können Sie Benachrichtigungen auf Basis von Hosts und Services mit dem Kommando <span class="guihint">Commands &gt; Notifications</span> abschalten (und später auch wieder einschalten):</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_commands_disable.png" alt="Kommando zur Aktivierung und Deaktivierung der Benachrichtigungen."></div></div>
<div class="paragraph"><p>Solche Hosts oder Services werden dann mit dem Symbol <span class="image-inline"><img src="../images/icons/icon_notif_man_disabled.png" alt="icon notif man disabled"></span> markiert.
Da Kommandos im Gegensatz zu Regeln weder eine Konfigurationsberechtigung noch ein <a href="wato.html#activate_changes">Aktivieren der Änderungen</a> benötigen, können sie daher eine Lösung sein, um auf eine Situation schnell zu reagieren.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Im Gegensatz zu <span class="image-inline"><img src="../images/icons/icon_downtime.png" alt="icon downtime"></span> Wartungszeiten haben abgeschaltete Benachrichtigungen keinen Einfluss auf die Berechnung der <a href="availability.html">Verfügbarkeit.</a>
Wenn Sie also während eines ungeplanten Ausfalls einfach nur die Benachrichtigungen abschalten, aber Ihre Verfügbarkeitsberechnung nicht verfälschen möchten, sollten Sie keine Wartungszeiten dafür eintragen!</p></div>
</div>
<div class="sect2">
<h3 id="heading_global">
<span class="hidden-anchor sr-only" id="global"></span>6.8. Benachrichtigungen global ausschalten</h3>
<div class="paragraph"><p>Im Snapin <span class="guihint">Master control</span> der Seitenleiste finden Sie einen Hauptschalter für die Benachrichtigungen (<span class="guihint">Notifications</span>):</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_master_control.png" alt="Das Snapin Master control." width="50%"></div></div>
<div class="paragraph"><p>Dieser Schalter ist ausgesprochen nützlich, wenn Sie am System größere Änderungen vornehmen, durch die bei einem Fehler unter Umständen eine Vielzahl von Services auf <span class="state2">CRIT</span> geht.
Sie ersparen sich so den Unmut Ihrer Kollegen über die vielen nutzlosen E-Mails.
Vergessen Sie aber nicht, die Benachrichtigungen später wieder einzuschalten.</p></div>
<div class="paragraph"><p>Im <a href="distributed_monitoring.html">verteilten Monitoring</a> gibt es diesen Schalter einmal pro Instanz.
Ein Abschalten der Benachrichtigungen auf der Zentralinstanz lässt Benachrichtigungen auf den Remote-Instanzen weiterhin aktiviert — selbst wenn diese zur Zentralinstanz weitergeleitet und von dort zugestellt werden.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Benachrichtigungen, die angefallen wären, während die Benachrichtigungen abgeschaltet waren, werden beim Wiedereinschalten <strong>nicht</strong> nachgeholt.</p></div>
</div>
<div class="sect2">
<h3 id="heading_delaying">
<span class="hidden-anchor sr-only" id="delaying"></span>6.9. Benachrichtigungen verzögern</h3>
<div class="paragraph"><p>Vielleicht haben Sie Services, die gelegentlich für kurze Zeit in einen Problemzustand gehen, der aber nur sehr kurz anhält und für Sie nicht kritisch ist.
In solchen Fällen sind Benachrichtigungen sehr lästig, aber auch einfach zu unterdrücken.
Dazu dienen die Regelsätze <span class="guihint">Delay host notifications</span> und <span class="guihint">Delay service notifications.</span></p></div>
<div class="paragraph"><p>Sie legen hier einen Zeitraum fest. Eine Benachrichtigung wird dann solange
zurückgehalten, bis diese Zeit abgelaufen ist. Tritt vorher der <span class="state0">OK</span> /
<span class="hstate0">UP</span>-Zustand wieder ein, so wird keine Benachrichtigung erzeugt. Natürlich
bedeutet das aber dann auch, dass Sie im Falle eines <em>wirklichen</em> Problems erst
mit einer Verzögerung benachrichtigt werden.</p></div>
<div class="paragraph"><p>Viel besser als eine Verzögerung der Benachrichtigungen ist es natürlich, den eigentlichen Grund der sporadischen Probleme loszuwerden. Aber das ist eine andere Geschichte …​</p></div>
</div>
<div class="sect2">
<h3 id="heading_repeated_check_attempts">
<span class="hidden-anchor sr-only" id="repeated_check_attempts"></span>6.10. Mehrere Check-Versuche</h3>
<div class="paragraph"><p>Eine zur Verzögerung der Benachrichtigungen sehr ähnliche Methode ist es, mehrere Check-Versuche zu erlauben, wenn ein Service in einen Problemzustand geht.
Dies geschieht über die Regelsätze <span class="guihint">Maximum number of check attempts for host</span> bzw. <span class="guihint">Maximum number of check attempts for service.</span></p></div>
<div class="paragraph"><p>Wenn Sie hier z. B. eine <code>3</code> einstellen, dann führt ein Check mit dem Resultat <span class="state2">CRIT</span> zunächst zu keiner Benachrichtigung.
Man spricht dann zunächst von einem weichen <span class="state2">CRIT</span>-Zustand (<em>soft state</em>).
Der harte Zustand (<em>hard state</em>) ist dann immer noch <span class="state0">OK</span>.
Erst wenn drei Versuche in Folge zu keinem <span class="state0">OK</span>-Zustand führen, wechselt der Service den harten Zustand und eine Benachrichtigung wird ausgelöst.</p></div>
<div class="paragraph"><p>Im Gegensatz zur verzögerten Benachrichtigung haben Sie hier noch die Möglichkeit, sich Tabellenansichten zu definieren, welche solche Probleme ausblenden.
Auch <a href="bi.html">BI-Aggregate</a> können so gebaut werden, dass nur die harten Zustände berücksichtigt werden, nicht die weichen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_flapping">
<span class="hidden-anchor sr-only" id="flapping"></span>6.11. Unstetige Hosts und Services</h3>
<div class="imageblock inline-image"><div class="content"><img src="../images/notifications_large_icon_flapping.png" alt="Symbol zur Anzeige des unstetigen Zustands." width="50"></div></div>
<div class="paragraph"><p>Wenn ein Host oder Service binnen kurzer Zeit mehrfach den Zustand ändert, so gilt er als unstetig (<em>flapping</em>).
Dies ist sozusagen ein eigener Zustand.
Die Idee dabei ist das Vermeiden von exzessiven Benachrichtigungen in Phasen, in denen ein Service nicht (ganz) stabil läuft.
Auch in der <a href="availability.html">Verfügbarkeitsberechnung</a> können Sie solche Phasen speziell auswerten.</p></div>
<div class="paragraph"><p>Unstetige Objekte werden mit dem Symbol <span class="image-inline"><img src="../images/icons/icon_flapping.png" alt="Symbol zur Anzeige des unstetigen Zustands."></span> markiert.
Während ein Objekt unstetig ist, erzeugen weitere Zustandswechsel keine Benachrichtigungen mehr.
Dafür wird aber jeweils eine Benachrichtigung ausgelöst, wenn das Objekt in den Zustand unstetig ein- oder austritt.</p></div>
<div class="paragraph"><p>Sie können die Erkennung von Unstetigkeiten auf folgende Arten beeinflussen:</p></div>
<div class="ulist"><ul>
<li><p>Die <span class="guihint">Master control</span> hat einen Hauptschalter für die Erkennung von Unstetigkeiten: <span class="guihint">Flap Detection</span></p></li>
<li><p>Über die Regelsätze <span class="guihint">Enable/disable flapping detection for hosts</span> bzw. <span class="guihint">Enable/disable flapping detection for services</span> können Sie Objekte von der Erkennung ausklammern.</p></li>
<li><p>In den <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> können Sie mit <span class="guihint">Global settings &gt; Monitoring Core &gt; Tuning of flap detection</span> die Parameter der Unstetigkeitserkennung festlegen und sie mehr oder weniger empfindlich einstellen:</p></li>
</ul></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_tuning_flap_detection.png" alt="Globale Einstellungen zur Unstetigkeitsbehandlung."></div></div>
<div class="paragraph"><p>Blenden Sie die kontextsensitive Hilfe ein mit <span class="guihint">Help &gt; Show inline help</span> für Details zu den einstellbaren Werten.</p></div>
</div>
<div class="sect2">
<h3 id="heading__periodisch_wiederholte_benachrichtigungen_und_eskalationen">
<span class="hidden-anchor sr-only" id="_periodisch_wiederholte_benachrichtigungen_und_eskalationen"></span>6.12. Periodisch wiederholte Benachrichtigungen und Eskalationen</h3>
<div class="paragraph"><p>Bei manchen Systemen kann es sinnvoll sein, es nicht bei einer einzelnen Benachrichtigung zu belassen, falls das Problem über einen längeren Zeitraum weiterhin besteht, z. B. bei Hosts, deren <a href="glossar.html#host_tag">Host-Merkmal</a> <span class="guihint">Criticality</span> auf <span class="guihint">Business critical</span> gesetzt ist.</p></div>
<div class="sect3">
<h4 id="heading__periodisch_wiederholte_benachrichtigungen_einrichten">
<span class="hidden-anchor sr-only" id="_periodisch_wiederholte_benachrichtigungen_einrichten"></span>Periodisch wiederholte Benachrichtigungen einrichten</h4>
<div class="paragraph"><p>Sie können Checkmk so einrichten, dass es in einem festen Intervall immer weitere Benachrichtigungen versendet, solange bis das Problem entweder <span class="image-inline"><img src="../images/icons/icon_ack.png" alt="Symbol zur Anzeige der Quittierung."></span> <a href="basics_ackn.html">quittiert</a> oder behoben wurde.</p></div>
<div class="paragraph"><p>Die Einstellung dafür finden Sie in den Regelsätzen <span class="guihint">Periodic notifications during host problems</span> bzw. <span class="guihint">Periodic notifications during service problems:</span></p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_periodic.png" alt="Regel für periodisch wiederholte Benachrichtigungen."></div></div>
<div class="paragraph"><p>Sobald diese Option aktiv ist, wird Checkmk für ein fortbestehendes Problem im konfigurierten Intervall weitere Benachrichtigungen erzeugen.
Die Benachrichtigungen bekommen eine laufende Nummer, welche bei 1 (für die erste Benachrichtigung) beginnt.</p></div>
<div class="paragraph"><p>Periodische Benachrichtigungen haben nicht nur den Nutzen, das Problem immer wieder in Erinnerung zu rufen (also den Operator damit zu <em>nerven</em>), sondern sie bilden auch die Grundlage für <em>Eskalationen.</em>
Dies bedeutet, dass nach Ablauf einer bestimmten Zeit die Benachrichtigung an andere Personen eskaliert werden kann.</p></div>
</div>
<div class="sect3">
<h4 id="heading__eskalationen_aufbauen_und_verstehen">
<span class="hidden-anchor sr-only" id="_eskalationen_aufbauen_und_verstehen"></span>Eskalationen aufbauen und verstehen</h4>
<div class="paragraph"><p>Um eine Eskalation einzurichten, erzeugen Sie zusätzlich eine Benachrichtigungsregel, welche die Bedingung <span class="guihint">Restrict to notification number</span> verwendet.</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_escalation.png" alt="Regel zur Einstellung der Häufigkeit von Benachrichtigungen."></div></div>
<div class="paragraph"><p>Tragen Sie hier als Bereich für den Zähler 3 bis 99999 ein, so greift diese Regel ab der dritten Benachrichtigung.
Diese Eskalation kann dann entweder durch die Wahl einer anderen Methode (z.B. SMS) erfolgen oder durch die Benachrichtigung von anderen Personen (Kontaktauswahl).</p></div>
<div class="paragraph"><p>Mit der Option <span class="guihint">Throttle periodic notifications</span> können Sie die Rate der wiederholten Benachrichtigungen nach einer bestimmten Zeit reduzieren. So können Sie z.B. zunächst jede Stunde eine E-Mail senden lassen und später das Ganze auf einmal am Tag beschränken.</p></div>
<div class="paragraph"><p>Mit mehreren Benachrichtigungsregeln können Sie ein Eskalationsmodell aufbauen.
Aber wie läuft diese Eskalation dann ab?
Wer wird wann informiert?
Hierzu ein Beispiel, umgesetzt mit einer Regel für periodisch wiederholte Benachrichtigungen und drei Benachrichtigungsregeln:</p></div>
<div class="ulist"><ul>
<li><p>Ein Service löst im Problemfall alle 60 Minuten eine Benachrichtigung, z.B. in Form einer E-Mail, aus, solange bis das Problem behoben oder bestätigt wird.</p></li>
<li><p>Die Benachrichtigungen eins bis fünf gehen an die zwei zuständigen Mitarbeiter.</p></li>
<li><p>Die Benachrichtigungen sechs bis zehn gehen zusätzlich an den betreffenden Teamleiter.</p></li>
<li><p>Ab Benachrichtigung elf geht stattdessen täglich eine Mail an die Firmenleitung.</p></li>
</ul></div>
<div class="paragraph"><p>Morgens um 9 Uhr tritt im Betrieb ein Problem auf.
Die beiden Mitarbeiter werden benachrichtigt, reagieren aber nicht (aus welchen Gründen auch immer).
So bekommen sie um 10, 11, 12 und 13 Uhr jeweils eine weitere E-Mail.
Ab der sechsten Benachrichtigung um 14 Uhr bekommt nun zusätzlich auch der Teamleiter eine E-Mail — trotzdem ändert sich weiterhin nichts am Problem.
So werden um 15, 16, 17 und 18 Uhr weitere E-Mails an die Mitarbeiter und an den Teamleiter verschickt.</p></div>
<div class="paragraph"><p>Um 19 Uhr greift die dritte Eskalationsstufe:
ab jetzt werden keine E-Mails mehr an die Mitarbeiter oder den Teamleiter verschickt.
Stattdessen bekommt die Firmenleitung bis zur Problembehebung nun täglich um 19 Uhr eine E-Mail.</p></div>
<div class="paragraph"><p>Sobald das Problem behoben ist und der Service in Checkmk wieder auf <span class="state0">OK</span> geht, wird automatisch eine „Entwarnung“ an den zuletzt benachrichtigten Personenkreis versandt:
Im obigen Beispiel also bei einer Problembehebung vor 14 Uhr an die beiden Mitarbeiter, bei einer Problembehebung zwischen 14 und 19 Uhr an die Mitarbeiter und den Teamleiter und nach 19 Uhr nur noch an die Firmenleitung.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_path">
<span class="hidden-anchor sr-only" id="path"></span>7. Der Weg einer Benachrichtigung von Anfang bis Ende</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_history">
<span class="hidden-anchor sr-only" id="history"></span>7.1. Die Benachrichtigungshistorie</h3>
<div class="paragraph"><p>Zum Einstieg zeigen wir Ihnen, wie Sie sich in Checkmk die Historie der Benachrichtigungen auf Host- und Service-Ebene anzeigen lassen und so den Benachrichtigungsprozess nachverfolgen können.</p></div>
<div class="paragraph"><p>Ein Monitoring-Ereignis, das Checkmk veranlasst, eine Benachrichtigung auszulösen, ist z. B. der Zustandswechsel eines Services.
Diesen Zustandswechsel können Sie mit dem Kommando <span class="guihint">Fake check results</span> zu Testzwecken manuell veranlassen, wie wir bereits im Kapitel zum <a href="#notification_testing">Test</a> einer einfachen Benachrichtigung per E-Mail gezeigt haben.</p></div>
<div class="paragraph"><p>Für einen Benachrichtigungstest können Sie einen Service auf diese Weise vom Zustand <span class="state0">OK</span> nach <span class="state2">CRIT</span> versetzen.
Wenn Sie sich jetzt auf der Seite der Service-Details die Benachrichtigungen für diesen Service mit <span class="guihint">Service &gt; Service Notifications</span> anzeigen lassen, sehen Sie die folgenden Einträge:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_list.png" alt="Liste aufgelaufener Benachrichtigungen für einen Service."></div></div>
<div class="paragraph"><p>Der aktuellste Eintrag steht ganz oben in der Liste. Los ging es aber mit dem untersten, daher sehen wir uns die einzelnen Einträge von unten nach oben an:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Der Monitoring-Kern protokolliert das Monitoring-Ereignis des Zustandswechsels. Dabei zeigt das <span class="image-inline"><img src="../images/icons/icon_alert_crit.png" alt="icon alert crit"></span> Symbol in der 1. Spalte den Zustand an (im Beispiel <span class="state2">CRIT</span>).</p></li>
<li><p>Der Monitoring-Kern erzeugt eine <span class="image-inline"><img src="../images/icons/icon_alert_cmk_notify.png" alt="icon alert cmk notify"></span> Rohbenachrichtigung (<em>raw notification</em>). Diese wird vom Kern an das Benachrichtigungsmodul übergeben, welches die Auswertung der Benachrichtigungsregeln durchführt.</p></li>
<li><p>Die Auswertung der Regeln ergibt eine <span class="image-inline"><img src="../images/icons/icon_alert_notify.png" alt="icon alert notify"></span> Benutzerbenachrichtigung (<em>user notification</em>) an den Benutzer <code>hh</code> mit der Methode <code>mail</code>.</p></li>
<li><p>Das <span class="image-inline"><img src="../images/icons/icon_alert_notify_result.png" alt="icon alert notify result"></span> Benachrichtigungsergebnis (<em>notification result</em>) zeigt, dass die E-Mail erfolgreich an den SMTP-Server zur Auslieferung übergeben wurde.</p></li>
</ol></div>
<div class="paragraph"><p>Um die Zusammenhänge von allen Einstellmöglichkeiten und Rahmenbedingungen genau zu verstehen und um eine sinnvolle Fehlerdiagnose zu ermöglichen, wenn mal eine Benachrichtigung nicht wie erwartet erfolgt oder ausbleibt, beschreiben wir im folgenden alle Einzelheiten zum Ablauf einer Benachrichtigung mit allen beteiligten Komponenten.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Die Benachrichtigungshistorie, die wir oben für einen Service gezeigt haben, können Sie sich auch für einen Host anzeigen lassen: auf der Seite der Host-Details im Menü <span class="guihint">Host</span> für den Host selbst (Menüeintrag <span class="guihint">Notifications of host</span>) und auch für den Host mit all seinen Services (<span class="guihint">Notifications of host &amp; services</span>).</p></div>
</div>
<div class="sect2">
<h3 id="heading__die_komponenten">
<span class="hidden-anchor sr-only" id="_die_komponenten"></span>7.2. Die Komponenten</h3>
<div class="paragraph"><p>Im Benachrichtigungssystem von Checkmk sind folgende Komponenten beteiligt:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 45%;">
<col style="width: 25%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Komponente</th>
<th class="tableblock halign-left valign-top">Aufgabe</th>
<th class="tableblock halign-left valign-top">Log-Datei</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nagios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring-Kern der <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong>, der Monitoring-Ereignisse erkennt und Rohbenachrichtigungen erzeugt.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/nagios.log<br>
~/var/nagios/debug.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="cmc.html">Checkmk Micro Core (CMC)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring-Kern der Enterprise Editions, der die gleiche Aufgabe erfüllt wie Nagios in der <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/cmc.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benachrichtigungsmodul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auswertung der Benachrichtigungsregeln, um aus einer Rohbenachrichtigung eine Benutzerbenachrichtigung zu erzeugen. Das Modul ruft die Benachrichtigungsskripte auf.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benachrichtigungs-Spooler (nur Enterprise Editions)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchrone Zustellung von Benachrichtigungen und zentralisierte Benachrichtigungen in verteilten Umgebungen.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mknotifyd.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benachrichtigungsskript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Für jede Benachrichtigungsmethode gibt es ein Skript, welches die eigentliche Zustellung durchführt (z.B. eine HTML-E-Mail generiert und versendet).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__der_monitoring_kern">
<span class="hidden-anchor sr-only" id="_der_monitoring_kern"></span>7.3. Der Monitoring-Kern</h3>
<div class="sect3">
<h4 id="heading__rohbenachrichtigungen">
<span class="hidden-anchor sr-only" id="_rohbenachrichtigungen"></span>Rohbenachrichtigungen</h4>
<div class="paragraph"><p>Wie oben beschrieben, beginnt jede Benachrichtigung mit einem Monitoring-Ereignis im Monitoring-Kern.
Wenn alle Bedingungen erfüllt sind und es grünes Licht für eine Benachrichtigung gibt, erzeugt der Kern eine
<em>Rohbenachrichtigung</em> an den internen Hilfskontakt <span class="guihint">check-mk-notify.</span>
Die Rohbenachrichtigung enthält noch keine Angabe zu den eigentlichen Kontakten oder der Benachrichtigungsmethode.</p></div>
<div class="paragraph"><p>In der Benachrichtigungshistorie des Services sieht eine Rohbenachrichtigung so aus:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_raw.png" alt="Eine Rohbenachrichtigung in der Benachrichtigungshistorie."></div></div>
<div class="ulist"><ul>
<li><p>Das Symbol ist ein <span class="image-inline"><img src="../images/icons/icon_alert_cmk_notify.png" alt="icon alert cmk notify"></span> hellgrauer Lautsprecher.</p></li>
<li><p>Als Kontakt wird <code>check-mk-notify</code> angegeben.</p></li>
<li><p>Als Benachrichtigungskommando wird <code>check-mk-notify</code> angegeben.</p></li>
</ul></div>
<div class="paragraph"><p>Die Rohbenachrichtigung geht dann an das Benachrichtigungsmodul von Checkmk, welches die Auswertung der Benachrichtigungsregeln übernimmt.
Dieses Modul wird von Nagios als externes Programm aufgerufen (<code>cmk --notify</code>).
Der CMC hingegen hält das Modul als permanenten Hilfsprozess in Bereitschaft (<em>notification helper</em>) und vermeidet so das Erzeugen von Prozessen, um Rechenzeit zu sparen.</p></div>
</div>
<div class="sect3">
<h4 id="heading__fehlerdiagnose_im_monitoring_kern_nagios">
<span class="hidden-anchor sr-only" id="_fehlerdiagnose_im_monitoring_kern_nagios"></span>Fehlerdiagnose im Monitoring-Kern Nagios</h4>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CRE.svg" alt="CRE" class="icon-left"></span>
Der in der <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> verwendete Nagios-Kern protokolliert alle Monitoring-Ereignisse nach <code>~/var/log/nagios.log</code>.
Diese Datei ist gleichzeitig der Ort, wo die Benachrichtigungshistorie gespeichert wird, welche Sie auch in der GUI abfragen, wenn Sie z.B. die Benachrichtigungen eines Hosts oder Services sehen möchten.</p></div>
<div class="paragraph"><p>Interessanter sind aber die Meldungen in der Datei <code>~/var/nagios/debug.log</code>, welche Sie bekommen, wenn Sie in <code>etc/nagios/nagios.d/logging.cfg</code> die Variable <code>debug_level</code> auf <code>32</code> setzen.
Nach einem Core-Neustart …​</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>restart<span class="tok-w"> </span>nagios</code></pre></div></div>
<div class="paragraph"><p>… finden Sie nützliche Informationen über Gründe, warum Benachrichtigungen erzeugt oder unterdrückt wurden:</p></div>
<div class="listingblock">
<div class="title">~/var/nagios/debug.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1592405483.152931] [032.0] [pid=18122] ** Service Notification Attempt ** Host: 'localhost', Service: 'backup4', Type: 0, Options: 0, Current State: 2, Last Notification: Wed Jun 17 16:24:06 2020
[1592405483.152941] [032.0] [pid=18122] Notification viability test passed.
[1592405485.285985] [032.0] [pid=18122] 1 contacts were notified.  Next possible notification time: Wed Jun 17 16:51:23 2020
[1592405485.286013] [032.0] [pid=18122] 1 contacts were notified.</code></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="heading__fehlerdiagnose_im_monitoring_kern_cmc">
<span class="hidden-anchor sr-only" id="_fehlerdiagnose_im_monitoring_kern_cmc"></span>Fehlerdiagnose im Monitoring-Kern CMC</h4>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
In den <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> finden Sie in der Log-Datei <code>~/var/log/cmc.log</code> ein Protokoll des Monitoring-Kerns.
In der Standardeinstellung enthält dies keine Angaben zu Benachrichtigungen.
Sie können aber ein sehr detailliertes Logging einschalten, mit <span class="guihint">Global settings &gt; Monitoring Core &gt; Logging of the notification mechanics.</span>
Der Kern gibt dann darüber Auskunft, warum er ein Monitoring-Ereignis für die Benachrichtigung an das Benachrichtigungsmodul weitergibt oder warum (noch) nicht:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tail<span class="tok-w"> </span>-f<span class="tok-w"> </span>var/log/cmc.log
<span class="tok-go">2021-08-26 16:12:37 [5] [core 27532] Executing external command: PROCESS_SERVICE_CHECK_RESULT;mysrv;CPU load;1;test</span>
<span class="tok-go">2021-08-26 16:12:43 [5] [core 27532] Executing external command: LOG;SERVICE NOTIFICATION: hh;mysrv;CPU load;WARNING;mail;test</span>
<span class="tok-go">2021-08-26 16:12:52 [5] [core 27532] Executing external command: LOG;SERVICE NOTIFICATION RESULT: hh;mysrv;CPU load;OK;mail;success 250 - b'2.0.0 Ok: queued as 482477F567B';success 250 - b'2.0.0 Ok: queued as 482477F567B'</span></code></pre></div></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Das eingeschaltete Logging zu Benachrichtigungen kann sehr viele Meldungen erzeugen.
Es ist aber nützlich, wenn man später die Frage beantworten will, warum in einer bestimmten Situation <em>keine</em> Benachrichtigung erzeugt wurde.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__regelauswertung_durch_das_benachrichtigungsmodul">
<span class="hidden-anchor sr-only" id="_regelauswertung_durch_das_benachrichtigungsmodul"></span>7.4. Regelauswertung durch das Benachrichtigungsmodul</h3>
<div class="paragraph"><p>Nachdem der Kern eine Rohbenachrichtigung erzeugt hat, durchläuft diese die Kette der Benachrichtigungsregeln.
Resultat ist die Benachrichtigungstabelle.
Neben den Daten aus der Rohbenachrichtigung enthält jede Benutzerbenachrichtigung folgende zusätzliche Informationen:</p></div>
<div class="ulist"><ul>
<li><p>Der Kontakt, der benachrichtigt werden soll</p></li>
<li><p>Die Methode für die Benachrichtigung</p></li>
<li><p>Die Parameter für diese Methode</p></li>
</ul></div>
<div class="paragraph"><p>Bei einer synchronen Zustellung wird jetzt pro Eintrag in der Tabelle das passende <a href="#scripts">Benachrichtigungsskript</a> aufgerufen.
Bei einer <a href="#async">asynchronen Zustellung</a> wird die Benachrichtigung per Datei an den Benachrichtigungs-Spooler übergeben.</p></div>
<div class="sect3">
<h4 id="heading__analyse_der_regelkette">
<span class="hidden-anchor sr-only" id="_analyse_der_regelkette"></span>Analyse der Regelkette</h4>
<div class="paragraph"><p>Wenn Sie komplexere Regelwerke erstellen, stehen Sie sicher gelegentlich vor der Frage, welche Regeln denn nun für eine bestimmte Benachrichtigung greifen.
Dazu bietet Checkmk auf der Seite <span class="guihint">Notifications configuration</span> eine eingebaute Analysefunktion, welche Sie mit dem Menüeintrag <span class="guihint">Display &gt; Show analysis</span> erreichen.</p></div>
<div class="paragraph"><p>Im Analysemodus werden Ihnen standardmäßig die letzten zehn Rohbenachrichtigungen angezeigt, die das System erzeugt hat und welche die Regeln durchlaufen haben:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_analysis.png" alt="Liste der der letzten 10 Rohbenachrichtigungen im Analysemodus."></div></div>
<div class="paragraph"><p>Sollten Sie für Ihre Analyse eine größere Menge an Rohbenachrichtigungen benötigen, können Sie die Anzahl über <span class="guihint">Global settings &gt; Notifications &gt; Store notifications for rule analysis</span> erhöhen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_storenotifications.png" alt="Globale Einstellung für die Anzahl angezeigter Rohbenachrichtigungen."></div></div>
<div class="paragraph"><p>Für jede dieser Rohbenachrichtigungen stehen Ihnen drei Aktionen zur Verfügung:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_analyze.png" alt="Symbol zum Test der Regelkette."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test der Regelkette, in dem für jede Regel geprüft wird, ob das Monitoring-Ereignis alle Bedingungen der Regel erfüllen würde. Im Anschluss an die Regeln wird dann die daraus resultierende Benachrichtigungstabelle angezeigt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_toggle_context.png" alt="Symbol zur Anzeige des Benachrichtigungskontexts."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzeige des kompletten Benachrichtigungskontexts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_reload_cmk.png" alt="Symbol für die Wiederholung der Rohbenachrichtigung."></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wiederholung der Rohbenachrichtigung, als wäre das Monitoring-Ereignis jetzt aufgetreten. Ansonsten ist die Anzeige gleich wie bei der Analyse. Damit können Sie nicht nur die Bedingungen der Regel überprüfen, sondern auch testen, wie eine Benachrichtigung dann aussieht.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__fehlerdiagnose">
<span class="hidden-anchor sr-only" id="_fehlerdiagnose"></span>Fehlerdiagnose</h4>
<div class="paragraph"><p>Haben Sie den Test der Regelkette (<span class="image-inline"><img src="../images/icons/icon_analyze.png" alt="Symbol zum Test der Regelkette"></span>) durchgeführt, so sehen Sie, welche Regeln auf ein Monitoring-Ereignis <span class="image-inline"><img src="../images/icons/icon_test_green.png" alt="Symbol in grün"></span> angewendet oder eben auch <span class="image-inline"><img src="../images/icons/icon_test_grey.png" alt="Symbol in grau"></span> nicht angewendet wurden:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_test_rules.png" alt="Liste der angewendeten und nicht angewendeten Regeln."></div></div>
<div class="paragraph"><p>Wurde eine Regel nicht angewendet, bewegen Sie die Maus über den grauen Kreis, um den Hinweistext (Mouse-Over-Text) zu sehen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_mouseover.png" alt="Hinweistext bei einer nicht angewendeten Regel." width="72%"></div></div>
<div class="paragraph"><p>Dieser Mouse-Over-Text verwendet jedoch für die Ursachen einer nicht angewendeten Regel Abkürzungen.
Diese beziehen sich auf die <a href="#rule_conditions">Bedingungen</a> <span class="guihint">Match host event type</span> bzw. <span class="guihint">Match service event type</span> der Regel.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 33%;">
<col style="width: 57%;">
</colgroup>
<thead><tr><th class="tableblock halign-left valign-top" colspan="3">Ereignistypen für Hosts</th></tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kürzel</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bedeutung</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beschreibung</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate0">UP</span> auf <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate0">UP</span> auf <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate1">DOWN</span> auf <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">du</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate1">DOWN</span> auf <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNREACHABLE ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate2">UNREACH</span> auf <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNREACHABLE ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Host-Status von <span class="hstate2">UNREACH</span> auf <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Host-Status auf <span class="hstate0">UP</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ DOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Host-Status auf <span class="hstate1">DOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UNREACHABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Host-Status auf <span class="hstate2">UNREACH</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start or end of flapping state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anfang oder Ende eines unstetigen Zustands</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start or end of a scheduled downtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anfang oder Ende einer Wartungszeit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgement of problem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quittierung eines Problems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alert handler execution, successful</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Erfolgreiche Ausführung eines Alert Handlers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">af</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alert handler execution, failed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gescheiterte Ausführung eines Alert Handlers</p></td>
</tr>
</tbody>
</table>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 33%;">
<col style="width: 57%;">
</colgroup>
<thead><tr><th class="tableblock halign-left valign-top" colspan="3">Ereignistypen für Services</th></tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kürzel</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bedeutung</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beschreibung</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state0">OK</span> auf <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state0">OK</span> auf <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state0">OK</span> auf <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state0">OK</span> auf <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state1">WARN</span> auf <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state1">WARN</span> auf <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state1">WARN</span> auf <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state2">CRIT</span> auf <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state2">CRIT</span> auf <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRIT ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state2">CRIT</span> auf <span class="state3">UNKNOWN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state3">UNKNOWN</span> auf <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state3">UNKNOWN</span> auf <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt den Service-Status von <span class="state3">UNKNOWN</span> auf <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Service-Status auf <span class="state0">OK</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Service-Status auf <span class="state1">WARN</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ CRIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Service-Status auf <span class="state2">CRIT</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any ➤ UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt jeden beliebigen Service-Status auf <span class="state3">UNKNOWN</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Basierend auf diesen Hinweisen können Sie Ihre Regeln prüfen und überarbeiten.</p></div>
<div class="paragraph"><p>Eine weitere wichtige Diagnosemöglichkeit ist die Log-Datei <code>~/var/log/notify.log</code>.
Während Tests mit den Benachrichtigungen bietet sich dazu der beliebte Befehl <code>tail -f</code> an:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>tail<span class="tok-w"> </span>-f<span class="tok-w"> </span>var/log/notify.log
<span class="tok-go">2021-08-26 17:11:58,914 [20] [cmk.base.notify] Analysing notification (mysrv;Temperature Zone 7) context with 71 variables</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify] Global rule 'Notify all contacts of a host/service via HTML email'...</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify]  -&gt; matches!</span>
<span class="tok-go">2021-08-26 17:11:58,915 [20] [cmk.base.notify]    - adding notification of hh via mail</span>
<span class="tok-go">2021-08-26 17:11:58,916 [20] [cmk.base.notify] Executing 1 notifications:</span>
<span class="tok-go">2021-08-26 17:11:58,916 [20] [cmk.base.notify]   * would notify hh via mail, parameters: smtp, graphs_per_notification, notifications_with_graphs, bulk: no</span></code></pre></div></div>
<div class="paragraph"><p>Mit <span class="guihint">Global settings &gt; Notifications &gt; Notification log level</span> können Sie die Ausführlichkeit der Meldungen in drei Stufen steuern. Wenn Sie <span class="guihint">Full dump of all variables and command</span> auswählen, so finden Sie in der Log-Datei eine komplette Auflistung aller Variablen, die dem <a href="#scripts">Benachrichtigungsskript</a> bereitgestellt werden:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_log_level.png" alt="Globale Einstellung zur Festlegung der Protokollierungsebene."></div></div>
<div class="paragraph"><p>Dies sieht dann z.B. so aus (Auszug):</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 17:24:54,709 [10] [cmk.base.notify] Raw context:
                    CONTACTS=hh
                    HOSTACKAUTHOR=
                    HOSTACKCOMMENT=
                    HOSTADDRESS=127.0.0.1
                    HOSTALIAS=localhost
                    HOSTATTEMPT=1
                    HOSTCHECKCOMMAND=check-mk-host-smart</code></pre></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="heading_async">
<span class="hidden-anchor sr-only" id="async"></span>7.5. Asynchrone Zustellung durch Benachrichtigungs-Spooler</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Eine mächtige Zusatzfunktion der Enterprise Editions ist der <em>Benachrichtigungs-Spooler</em>.
Dieser ermöglicht eine asynchrone Zustellung von Benachrichtigungen.
Was bedeutet asynchron in diesem Zusammenhang?</p></div>
<div class="ulist"><ul>
<li><p>Synchrone Zustellung: Das Benachrichtigungsmodul wartet, bis das Benachrichtigungsskript fertig ausgeführt wurde. Sollte dies eine längere Ausführungszeit haben, stauen sich weitere Benachrichtigungen auf. Wird das Monitoring angehalten, gehen diese Benachrichtigungen verloren. Außerdem kann sich bei vielen Benachrichtigungen in kurzer Zeit ein Rückstau bis zum Kern bilden, so dass das Monitoring dadurch ins Stocken gerät.</p></li>
<li><p>Asynchrone Zustellung: Jede Benachrichtigung wird in einer Spool-Datei unter <code>~/var/check_mk/notify/spool</code> abgelegt. Es kann sich kein Stau bilden. Bei einem Stopp des Monitorings bleiben die Spool-Dateien erhalten und Benachrichtigungen werden später korrekt zugestellt. Das Abarbeiten der Spool-Dateien übernimmt der Benachrichtigungs-Spooler.</p></li>
</ul></div>
<div class="paragraph"><p>Eine synchrone Zustellung ist dann vertretbar, wenn das Benachrichtigungsskript schnell läuft und vor allem nicht in irgendeinen Timeout geraten kann.
Bei Benachrichtigungsmethoden, die auf vorhandene Spooler zurückgreifen, ist das gegeben.
Insbesondere bei E-Mail und SMS kommen Spool-Dienste vom System zum Einsatz.
Das Benachrichtigungsskript übergibt eine Datei an den System-Spooler, wobei keine Wartezustände auftreten können.</p></div>
<div class="paragraph"><p>Bei Verwendung der <a href="#syncsmtp">nachvollziehbaren Zustellung per SMTP</a> oder anderer Skripte, welche Netzwerkverbindungen aufbauen, sollten Sie <strong>auf jeden Fall</strong> die asynchrone Zustellung einstellen.
Dazu gehören auch Skripte, welche per HTTP Textnachrichten (SMS) über das Internet versenden.
Die Timeouts bei der Verbindung zu einem Netzwerkdienst können bis zu mehrere Minuten lang sein und den oben beschriebenen Stau auslösen.</p></div>
<div class="paragraph"><p>Die gute Nachricht: Die asynchrone Zustellung ist in Checkmk standardmäßig aktiviert.
Zum einen wird der Benachrichtigungs-Spooler  (<code>mknotifyd</code>) beim Start der Instanz mitgestartet, was Sie mit dem folgenden Kommando überprüfen können:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>status<span class="tok-w"> </span>mknotifyd
<span class="tok-go">mknotifyd:      <span class="green">running</span></span>
<span class="tok-go">-----------------------</span>
<span class="tok-go">Overall state:  <span class="green">running</span></span></code></pre></div></div>
<div class="paragraph"><p>Zum anderen ist in den globalen Einstellungen (<span class="guihint">Global settings &gt; Notifications &gt; Notification Spooling</span>) die asynchrone Zustellung (<span class="guihint">Asynchronous local delivery by notification spooler</span>) ausgewählt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_spooling.png" alt="Globale Einstellung zur Zustellungsmethode des Benachrichtigungs-Spoolers."></div></div>
<div class="sect3">
<h4 id="heading__fehlerdiagnose_2">
<span class="hidden-anchor sr-only" id="_fehlerdiagnose_2"></span>Fehlerdiagnose</h4>
<div class="paragraph"><p>Der Benachrichtigungs-Spooler pflegt eine eigene Log-Datei: <code>~/var/log/mknotifyd.log</code>.
Diese verfügt über drei Log-Levels, die Sie unter <span class="guihint">Global settings &gt; Notifications &gt; Notification Spooler Configuration</span> mit dem Parameter <span class="guihint">Verbosity of logging</span> auswählen können.
Der Default steht auf <span class="guihint">Normal logging (only startup, shutdown and errors</span>.
Bei der mittleren Stufe, <span class="guihint">Verbose logging (also spooled notifications),</span> können Sie das Bearbeiten der Spool-Dateien
sehen:</p></div>
<div class="listingblock">
<div class="title">~/var/log/mknotifyd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 18:05:02,928 [15] [cmk.mknotifyd] processing spoolfile: /omd/sites/mysite/var/check_mk/notify/spool/dad64e2e-b3ac-4493-9490-8be969a96d8d
2021-08-26 18:05:02,928 [20] [cmk.mknotifyd] running cmk --notify --log-to-stdout spoolfile /omd/sites/mysite/var/check_mk/notify/spool/dad64e2e-b3ac-4493-9490-8be969a96d8d
2021-08-26 18:05:05,848 [20] [cmk.mknotifyd] got exit code 0
2021-08-26 18:05:05,850 [20] [cmk.mknotifyd] processing spoolfile dad64e2e-b3ac-4493-9490-8be969a96d8d successful: success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9'
2021-08-26 18:05:05,850 [20] [cmk.mknotifyd] sending command LOG;SERVICE NOTIFICATION RESULT: hh;mysrv;CPU load;OK;mail;success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9';success 250 - b'2.0.0 Ok: queued as 1D4FF7F58F9'</code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_bulk">
<span class="hidden-anchor sr-only" id="bulk"></span>8. Sammelbenachrichtigung (Bulk notifications)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__übersicht_2">
<span class="hidden-anchor sr-only" id="_übersicht_2"></span>8.1. Übersicht</h3>
<div class="paragraph"><p>Jeder, der mit Monitoring arbeitet, hat schon einmal erlebt, dass ein isoliertes
Problem eine ganze Flut von (Folge-)Benachrichtigungen losgetreten hat. Mit den
<a href="#parents">Parent-Hosts</a> lässt sich dies in bestimmten Fällen vermeiden,
leider aber nicht in allen.</p></div>
<div class="paragraph"><p>Nehmen Sie ein Beispiel aus dem Checkmk-Projekt selbst: Einmal pro Tag bauen wir
für jede unterstützte Linux-Distribution Installationspakete von Checkmk. Unser
eigenes Checkmk-Monitoring ist so eingerichtet, dass wir für jede Distribution
einen Service haben, der nur dann <span class="state0">OK</span> ist, wenn die richtige Anzahl von Paketen
korrekt gebaut wurde. Nun kommt es gelegentlich vor, dass ein genereller Fehler
in der Software das Paketieren verhindert und so gleichzeitig 43 Services auf
<span class="state2">CRIT</span> gehen.</p></div>
<div class="paragraph"><p>Die Benachrichtigungen sind bei uns so konfiguriert, dass in so einem Fall nur
eine einzige E-Mail versendet wird, welche alle 43 Benachrichtigungen
nacheinander auflistet. Das ist natürlich viel übersichtlicher als 43 einzelne
E-Mails und verhindert, dass man im Eifer des Gefechts eine 44ste E-Mail
übersieht, die zu einem ganz anderen Problem gehört.</p></div>
<div class="paragraph"><p>Die Funktionsweise dieser <em>Sammelbenachrichtigung</em> ist sehr einfach.
Wenn eine Benachrichtigung auftritt, so wird diese zunächst eine kurze Zeit lang zurückgehalten.
Weitere Benachrichtigungen, die während dieser Zeit kommen, werden dann gleich mit in dieselbe E-Mail gepackt.
Das Sammeln stellen Sie <em>pro Regel</em> ein.
So können Sie z. B. tagsüber mit Einzel-E-Mails arbeiten, nachts aber mit einer Sammelbenachrichtigung.
Wird in einer Regel die Sammelbenachrichtigung aktiviert, so erhalten Sie folgende Optionen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_bulk.png" alt="Benachrichtigungsregel mit den Optionen zur Sammelbenachrichtigung."></div></div>
<div class="paragraph"><p>Die Wartezeit können Sie beliebig konfigurieren.
In vielen Fällen genügt eine Minute, da spätestens dann alle verwandten Probleme aufschlagen sollten.
Sie können natürlich auch einen größeren Zeitraum einstellen. Dadurch entsteht aber eine grundsätzliche Verzögerung der Benachrichtigung.</p></div>
<div class="paragraph"><p>Da es keinen Sinn ergibt, alles in einen Topf zu werfen, können Sie bestimmen, welche Gruppen von Problemen jeweils gemeinsam
benachrichtigt werden sollen.
Üblicherweise wird die Option <span class="guihint">Host</span> gewählt, die dafür sorgt, dass nur Benachrichtigungen vom gleichen Host zusammengefasst werden.</p></div>
<div class="paragraph"><p>Hier noch ein paar Fakten zur Sammelbenachrichtigung:</p></div>
<div class="ulist"><ul>
<li><p>Wenn das Sammeln in einer Regel eingeschaltet ist, kann es mit einer späteren Regel auch wieder ausgeschaltet werden — und umgekehrt.</p></li>
<li><p>Die Sammelbenachrichtigung geschieht immer pro Kontakt. Jeder hat quasi seinen privaten „Sammeltopf“.</p></li>
<li><p>Sie können die Größe des Topfs limitieren (<span class="guihint">Maximum bulk size</span>). Bei Erreichen dieses Maximums wird die Sammelbenachrichtigung sofort verschickt.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__sammelbenachrichtigungen_und_zeitperioden">
<span class="hidden-anchor sr-only" id="_sammelbenachrichtigungen_und_zeitperioden"></span>8.2. Sammelbenachrichtigungen und Zeitperioden</h3>
<div class="paragraph"><p>Was ist eigentlich, wenn eine Benachrichtigung innerhalb der Benachrichtigungsperiode liegt, die Sammelbenachrichtigung, die ihn enthält — die ja etwas später kommt — dann aber schon außerhalb liegt?
Und auch der umgekehrte Fall ist ja möglich …​</p></div>
<div class="paragraph"><p>Hier gilt ein ganz einfaches Prinzip:
Alle Konfigurationen, die Benachrichtigungen auf Zeitperioden eingrenzen, gelten immer nur <strong>für die eigentliche Benachrichtigung</strong>.
Die später folgende Sammelbenachrichtigung wird immer <strong>unabhängig</strong> von sämtlichen Zeitperioden zugestellt.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_syncsmtp">
<span class="hidden-anchor sr-only" id="syncsmtp"></span>9. Nachvollziehbare Zustellung per SMTP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__e_mail_ist_nicht_zuverlässig">
<span class="hidden-anchor sr-only" id="_e_mail_ist_nicht_zuverlässig"></span>9.1. E-Mail ist nicht zuverlässig</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Das Monitoring ist nur nützlich, wenn man sich auch darauf verlassen kann.
Dazu gehört, dass Benachrichtigungen <em>zuverlässig</em> und <em>zeitnah</em> ankommen.
Nun ist die Zustellung von E-Mails hier leider nicht ganz ideal.
Denn der Versand geschieht üblicherweise durch Übergabe der E-Mail an den lokalen SMTP-Server.
Dieser versucht dann die E-Mail selbständig und asynchron zuzustellen.</p></div>
<div class="paragraph"><p>Bei einem vorübergehenden Fehler (z.B. falls der empfangende SMTP-Server nicht erreichbar ist) wird die E-Mail in eine Warteschlange versetzt und später ein erneuter Zustellversuch gestartet.
Dieses „später“ ist dann in der Regel frühestens in 15-30 Minuten.
Aber dann kann die Benachrichtigung eventuell schon viel zu spät sein!</p></div>
<div class="paragraph"><p>Ist die E-Mail gar nicht zustellbar, so erzeugt der SMTP-Server eine hübsche Fehlermeldung in seiner Log-Datei und versucht, an den „Absender“ eine E-Mail über die gescheiterte Zustellung zu generieren.
Aber das Monitoring-System ist kein richtiger Absender und kann auch keine E-Mails empfangen.
In der Folge gehen solche Fehler dann einfach unter und Benachrichtigungen bleiben aus.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Für <a href="#bulk">Sammelbenachrichtigungen</a> steht die nachvollziehbare Benachrichtigung nicht zur Verfügung!</p></div>
</div>
<div class="sect2">
<h3 id="heading__smtp_auf_direktem_weg_ermöglicht_fehlerauswertung">
<span class="hidden-anchor sr-only" id="_smtp_auf_direktem_weg_ermöglicht_fehlerauswertung"></span>9.2. SMTP auf direktem Weg ermöglicht Fehlerauswertung</h3>
<div class="paragraph"><p>Die <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> bieten die Möglichkeit einer <em>nachvollziehbaren</em> Zustellung per SMTP.
Dabei wird bewusst auf eine Hilfe des lokalen Mailservers verzichtet.
Anstelle dessen sendet Checkmk selbst die E-Mail direkt via SMTP zu Ihrem Smarthost und wertet die SMTP-Antwort auch selbst aus.</p></div>
<div class="paragraph"><p>Dabei werden nicht nur SMTP-Fehler intelligent behandelt, es wird auch eine korrekte Zustellung genau protokolliert.
Es ist ein bisschen wie ein Einschreiben: Checkmk bekommt quasi vom SMTP-Smarthost (empfangender Server) eine Quittung, dass die E-Mail übernommen wurde — inklusive einer Mail-ID.</p></div>
</div>
<div class="sect2">
<h3 id="heading__synchrone_zustellung_für_html_e_mails">
<span class="hidden-anchor sr-only" id="_synchrone_zustellung_für_html_e_mails"></span>9.3. Synchrone Zustellung für HTML-E-Mails</h3>
<div class="paragraph"><p>Die nachvollziehbare Zustellung per SMTP können Sie für die Benachrichtigungsmethode HTML-E-Mail auswählen und konfigurieren, indem Sie den Smarthost (mit Name und Portnummer) und die Zugangsdaten und Verschlüsselungsmethode eintragen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_enable_sync_smtp.png" alt="Benachrichtigungsregel mit den Optionen für die synchrone E-Mail-Zustellung."></div></div>
<div class="paragraph"><p>In der Historie des betroffenen Services können Sie das dann die Zustellung genau nachverfolgen.
Hier ist ein Beispiel, in dem ein Service testweise von Hand auf <span class="state2">CRIT</span> gesetzt wurde.
Folgende Abbildung zeigt die Benachrichtigungen für diesen Service, die Sie sich auf der Seite mit den Service-Details mit <span class="guihint">Service &gt; Service Notifications</span> anzeigen lassen können:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_smtp_success.png" alt="Liste aufgelaufener Benachrichtigungen für eine erfolgreiche E-Mail-Zustellung."></div></div>
<div class="paragraph"><p>Sie sehen dabei die vier Einzelschritte in der zeitlichen Abfolge von unten nach oben, wie wir sie bereits im Kapitel zur <a href="#history">Benachrichtigungshistorie</a> vorgestellt haben.
Der wichtige Unterschied ist, dass jetzt im <span class="image-inline"><img src="../images/icons/icon_alert_notify_result.png" alt="icon alert notify result"></span> obersten Eintrag zu sehen ist, dass die E-Mail erfolgreich an den Smarthost übergeben wurde und dessen Antwort <code>success</code> ist.</p></div>
<div class="paragraph"><p>Die einzelnen Schritte können Sie auch in der Log-Datei <code>notify.log</code> nachverfolgen.
Die folgenden Zeilen gehören zum letzten Schritt und enthalten die Antwort des SMTP-Servers:</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-26 10:02:22,016 [20] [cmk.base.notify] Got spool file d3b417a5 (mysrv;CPU load) for local delivery via mail
2021-08-26 10:02:22,017 [20] [cmk.base.notify]      executing /omd/sites/mysite/share/check_mk/notifications/mail
2021-08-26 10:02:29,538 [20] [cmk.base.notify]      Output: success 250 - b'2.0.0 Ok: queued as 1BE667EE7D6'</code></pre></div>
</div>
<div class="paragraph"><p>Die Message-ID <code>1BE667EE7D6</code> wird in der Log-Datei des Smarthosts auftauchen.
Dort können Sie dann im Zweifel recherchieren, wo die E-Mail verblieben ist.
Auf jeden Fall können Sie so belegen, das und wann Sie von Checkmk korrekt übergeben wurde.</p></div>
<div class="paragraph"><p>Wiederholen wir den Test von oben, jedoch diesmal mit einem falsch konfigurierten Passwort für die SMTP-Übergabe an den Smarthost.
Hier sieht man im Klartext die SMTP-Fehlermeldung <code>Error: authentication failed</code> vom Smarthost:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_smtp_failed.png" alt="Liste aufgelaufener Benachrichtigungen für eine gescheiterte E-Mail-Zustellung."></div></div>
<div class="paragraph"><p>Doch was tun bei gescheiterten Benachrichtigungen?
Diese wiederum per E-Mail zu benachrichtigen ist augenscheinlich keine gute Lösung.
Anstelle dessen zeigt Checkmk einen deutlichen Warnhinweis mit roter Hintergrundfarbe im <a href="user_interface.html#overview">Overview</a> an:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_overview_failed.png" alt="Anzeige gescheiterter Benachrichtigungen im Snapin 'Overview'." width="50%"></div></div>
<div class="paragraph"><p>Hier können Sie:</p></div>
<div class="ulist"><ul>
<li><p>durch Klick auf den Text <span class="guihint">…​ failed notifications</span> zu einer Liste der fehlgeschlagenen Benachrichtigungen kommen und</p></li>
<li><p>durch Klick auf <span class="image-inline"><img src="../images/icons/icon_delete.png" alt="Symbol zum Löschen."></span> diese Meldungen bestätigen und mit einem Klick auf <span class="image-inline"><img src="../images/icons/icon_confirm.png" alt="Symbol zur Bestätigung."></span> <span class="guihint">Confirm</span> in der sich öffnenden Übersicht den Hinweis wieder entfernen.</p></li>
</ul></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Beachten Sie, dass die direkte Zustellung per SMTP in Fehlersituationen dazu führen kann, dass das Benachrichtigungsskript sehr lange läuft und am Ende in einen Timeout gerät.
Deswegen ist es unbedingt ratsam, dass Sie den Benachrichtigungs-Spooler verwenden und eine <a href="#async">asynchrone Zustellung</a> von Benachrichtigungen einstellen.</p></div>
<div class="paragraph"><p>Das Verhalten bei wiederholbaren Fehlern (wie einem SMTP-Timeout) können Sie mit <span class="guihint">Global settings &gt; Notifications &gt; Notification spooler configuration</span> pro Benachrichtigungsmethode einstellen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_plugin_timing_settings.png" alt="Globale Timer-Einstellung für eine Benachrichtigungsmethode."></div></div>
<div class="paragraph"><p>Neben einem optionalen Timeout (Default ist 1  Minute) und einer maximalen Anzahl von Wiederholversuchen können Sie mit <span class="guihint">Maximum concurrent executions</span> festlegen, ob das Skript mehrfach parallel laufen und so gleichzeitig mehrere Benachrichtigungen versenden darf.
Ist das Benachrichtigungsskript sehr langsam, kann eine parallele Ausführung sinnvoll sein.
Allerdings muss es dann auch so programmiert sein, dass eine Mehrfachausführung sauber läuft (und nicht das Skript z.B. bestimmte Dateien für sich beansprucht).</p></div>
<div class="paragraph"><p>Eine mehrfache parallele Zustellung per SMTP ist unproblematisch, da der Zielserver mehrere parallele Verbindungen verwalten kann.
Bei der Zustellung von SMS direkt über ein Modem ohne weiteren Spooler ist das sicher nicht der Fall und Sie sollten dann bei der Einstellung 1 bleiben.</p></div>
</div>
<div class="sect2">
<h3 id="heading__sms_und_andere_benachrichtigungsmethoden">
<span class="hidden-anchor sr-only" id="_sms_und_andere_benachrichtigungsmethoden"></span>9.4. SMS und andere Benachrichtigungsmethoden</h3>
<div class="paragraph"><p>Eine synchrone Zustellung inklusive Fehlermeldung und Nachvollziehbarkeit ist aktuell nur für HTML-E-Mails implementiert.
Wie Sie in einem eigenen Benachrichtigungsskript einen Fehlerstatus zurückgeben können, erfahren Sie im Kapitel über <a href="#scripts">das Schreiben von eigenen Skripten</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_distributed">
<span class="hidden-anchor sr-only" id="distributed"></span>10. Benachrichtigungen in verteilten Systemen</h2>
<div class="sectionbody">
<div class="paragraph"><p>In verteilten Umgebungen — also solchen mit mehr als einer Checkmk-Instanz — stellt sich die Frage, was mit Benachrichtigungen geschehen soll, die auf Remote-Instanzen erzeugt werden.
Hier gibt es grundsätzlich zwei Möglichkeiten:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Lokale Zustellung</p></li>
<li><p>Zentrale Zustellung auf der Zentralinstanz (nur Enterprise Editions)</p></li>
</ol></div>
<div class="paragraph"><p>Einzelheiten dazu finden Sie im Artikel über das <a href="distributed_monitoring.html#notifications">verteilte Monitoring</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_scripts">
<span class="hidden-anchor sr-only" id="scripts"></span>11. Benachrichtigungsskripte</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__das_prinzip_2">
<span class="hidden-anchor sr-only" id="_das_prinzip_2"></span>11.1. Das Prinzip</h3>
<div class="paragraph"><p>Benachrichtigungen können auf sehr vielfältige und individuelle Weise geschehen.
Typische Fälle sind:</p></div>
<div class="ulist"><ul>
<li><p>Übergabe von Benachrichtigungen an ein Ticket- oder externes Benachrichtigungssystem</p></li>
<li><p>Versand von SMS über verschiedene Internetdienste</p></li>
<li><p>Automatisierte Anrufe</p></li>
<li><p>Weiterleitung an ein übergeordnetes Monitoring-System</p></li>
</ul></div>
<div class="paragraph"><p>Aus diesem Grund bietet Checkmk eine sehr einfache Schnittstelle, mit der Sie selbst eigene Benachrichtigungsskripte schreiben können.
Sie können diese in jeder von Linux unterstützten Programmiersprache schreiben — auch wenn Shell, Perl und Python zusammen hier sicher 95% „Marktanteil“ haben.</p></div>
<div class="paragraph"><p>Die von Checkmk <a href="#includedscripts">mitgelieferten Skripte</a> liegen unter <code>~/share/check_mk/notifications</code>.
Dieses Verzeichnis ist Teil der Software und nicht für Änderungen vorgesehen.
Legen Sie eigene Skripte stattdessen in <code>~/local/share/check_mk/notifications</code> ab.
Achten Sie darauf, dass sie ausführbar sind (<code>chmod +x</code>).
Sie werden dann automatisch gefunden und bei den Benachrichtigungsregeln als Methode zur Auswahl angeboten.</p></div>
<div class="paragraph"><p>Möchten Sie ein mitgeliefertes Skript anpassen, so kopieren Sie es einfach von <code>~/share/check_mk/notifications</code> nach <code>~/local/share/check_mk/notifications</code> und machen dort Ihre Änderungen.
Wenn Sie dabei den Dateinamen beibehalten, ersetzt Ihr Skript automatisch die Originalversion und Sie müssen keine bestehenden Benachrichtigungsregeln anpassen.</p></div>
<div class="paragraph"><p>Einige weitere Beispielskripte werden unter <code>~/share/doc/check_mk/treasures/notifications</code> mitgeliefert.
Sie können diese als Vorlage nehmen und anpassen.
Die Konfiguration wird meist direkt im Skript vorgenommen — Hinweise dazu finden Sie dort in den Kommentaren.</p></div>
<div class="paragraph"><p>Im Falle einer Benachrichtigung wird Ihr Skript mit den Rechten des Instanzbenutzers aufgerufen.
In <strong>Umgebungsvariablen</strong>, die mit <code>NOTIFY_</code> beginnen, bekommt es alle Informationen über den betreffenden Host/Service, das Monitoring-Ereignis, den zu benachrichtigenden Kontakt und die Parameter, die in der Benachrichtigungsregel angegeben wurden.</p></div>
<div class="paragraph"><p>Texte, die das Skript in die <strong>Standardausgabe</strong> schreibt (mit <code>print</code>, <code>echo</code>, etc.), erscheinen in der Log-Datei des Benachrichtigungsmoduls <code>~/var/log/notify.log</code>.</p></div>
</div>
<div class="sect2">
<h3 id="heading__nachvollziehbare_benachrichtigungen">
<span class="hidden-anchor sr-only" id="_nachvollziehbare_benachrichtigungen"></span>11.2. Nachvollziehbare Benachrichtigungen</h3>
<div class="paragraph"><p>Benachrichtigungsskripte haben die Möglichkeit, über den Exit Code mitzuteilen, ob ein wiederholbarer Fehler aufgetreten ist oder ein endgültiger:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Exit Code</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Skript wurde erfolgreich ausgeführt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein temporärer Fehler ist aufgetreten. Die Ausführung soll nach kurzer Zeit erneut probiert werden, bis die konfigurierte maximale Anzahl von Versuchen erreicht ist. Beispiel: HTTP-Verbindung zu SMS-Dienst konnte nicht aufgebaut werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> und höher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein endgültiger Fehler ist aufgetreten. Die Benachrichtigungen werden nicht wiederholt. Auf der GUI wird ein Benachrichtigungsfehler angezeigt. Der Fehler wird in der Historie des Hosts/Services angezeigt. Beispiel: der SMS-Dienst meldet den Fehler „Ungültige Authentifizierung“.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Zudem wird in allen Fällen die Standardausgabe des Benachrichtigungsskripts zusammen mit dem Status in die Benachrichtigungshistorie des Hosts/Services eingetragen und ist somit über die GUI sichtbar.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Für <a href="#bulk">Sammelbenachrichtigungen</a> steht die nachvollziehbare Benachrichtigung nicht zur Verfügung!</p></div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Die Behandlung von Benachrichtigungsfehlern aus Sicht des Benutzers wird im Kapitel über die <a href="#syncsmtp">nachvollziehbare Zustellung per SMTP</a> erklärt.</p></div>
</div>
<div class="sect2">
<h3 id="heading_example">
<span class="hidden-anchor sr-only" id="example"></span>11.3. Ein einfaches Beispielskript</h3>
<div class="paragraph"><p>Als Beispiel können Sie ein Skript erstellen, das alle Informationen zu der Benachrichtigung in eine Datei schreibt.
Als Sprache kommt die Bash Linux-Shell zum Einsatz:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/foobar</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# Foobar Teleprompter

env | grep NOTIFY_ | sort &gt; $OMD_ROOT/tmp/foobar.out
echo "Successfully written $OMD_ROOT/tmp/foobar.out"
exit 0</code></pre></div>
</div>
<div class="paragraph"><p>Danach machen Sie das Skript ausführbar:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>local/share/check_mk/notifications/foobar</code></pre></div></div>
<div class="paragraph"><p>Hier einige Erklärungen zum Skript:</p></div>
<div class="ulist"><ul>
<li><p>In der ersten Zeile stehen <code>#!</code> und der Pfad zum Interpreter der Skriptsprache (hier <code>/bin/bash</code>).</p></li>
<li><p>In der zweiten Zeile steht nach dem Kommentarzeichen <code>#</code> ein <strong>Titel</strong> für das Skript. Dieser wird bei der Auswahl der Benachrichtigungsmethode in der Regel angezeigt.</p></li>
<li><p>Der Befehl <code>env</code> gibt alle Umgebungsvariablen aus, die das Skript bekommen hat.</p></li>
<li><p>Mit <code>grep NOTIFY_</code> werden die Variablen von Checkmk herausgefiltert …​</p></li>
<li><p>… und mit <code>sort</code> alphabetisch sortiert.</p></li>
<li><p><code>&gt; $OMD_ROOT/tmp/foobar.out</code> schreibt das Ergebnis in die Datei <code>~/tmp/foobar.out</code> im Instanzverzeichnis.</p></li>
<li><p>Das <code>exit 0</code> wäre an dieser Stelle eigentlich überflüssig, da die Shell immer den Exit Code des letzten Befehls übernimmt. Dieser ist hier <code>echo</code> und immer erfolgreich. Aber explizit ist immer besser.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_example_test">
<span class="hidden-anchor sr-only" id="example_test"></span>11.4. Beispielskript testen</h3>
<div class="paragraph"><p>Damit das Skript verwendet wird, müssen Sie es in einer Benachrichtigungsregel als Methode einstellen.
Selbstgeschriebene Skripte haben keine Parameterdeklaration.
Daher fehlen die ganzen Checkboxen, wie sie z.B. bei der Methode <span class="guihint">HTML Email</span> angeboten werden.
Anstelle dessen können Sie eine Liste von Texten als Parameter angeben, die dem Skript als <code>NOTIFY_PARAMETER_1</code>, <code>NOTIFY_PARAMETER_2</code> usw. bereitgestellt werden.
Für den Test übergeben Sie die Parameter <code>Fröhn</code>, <code>Klabuster</code> und <code>Feinbein</code>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/notifications_method_foobar.png" alt="Regel mit Auswahl des Beispielskripts als Benachrichtigungsmethode."></div></div>
<div class="paragraph"><p>Nun setzen Sie zum Test den Service <code>CPU load</code> auf dem Host <code>myserver</code> auf <span class="state2">CRIT</span> — mit dem Kommando <span class="guihint">Fake check results</span>, wie es bereits <a href="#notification_testing">weiter oben</a> beschrieben wurde.
In der Log-Datei des Benachrichtigungsmoduls <code>~/var/log/notify.log</code> sehen Sie die Ausführung des Skripts samt Parametern und der erzeugten Spool-Datei:</p></div>
<div class="listingblock">
<div class="title">~/var/log/notify.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>2021-08-25 13:01:23,887 [20] [cmk.base.notify] Executing 1 notifications:
2021-08-25 13:01:23,887 [20] [cmk.base.notify]   * notifying hh via foobar, parameters: Fröhn, Klabuster, Feinbein, bulk: no
2021-08-25 13:01:23,887 [20] [cmk.base.notify] Creating spoolfile: /omd/sites/mysite/var/check_mk/notify/spool/e1b5398c-6920-445a-888e-f17e7633de60</code></pre></div>
</div>
<div class="paragraph"><p>Die Datei <code>~/tmp/foobar.out</code> enthält nun eine alphabetische Liste aller Checkmk-Umgebungsvariablen, die Informationen über die Benachrichtigung beinhalten.
Dort können Sie sich orientieren, was für Werte für Ihr Skript zur Verfügung stehen. Hier die ersten zehn Zeilen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>head<span class="tok-w"> </span>tmp/foobar.out
<span class="tok-go">NOTIFY_ALERTHANDLERNAME=debug</span>
<span class="tok-go">NOTIFY_ALERTHANDLEROUTPUT=Arguments:</span>
<span class="tok-go">NOTIFY_ALERTHANDLERSHORTSTATE=OK</span>
<span class="tok-go">NOTIFY_ALERTHANDLERSTATE=OK</span>
<span class="tok-go">NOTIFY_CONTACTALIAS=Harry Hirsch</span>
<span class="tok-go">NOTIFY_CONTACTEMAIL=<a href="mailto:harryhirsch@example.com">harryhirsch@example.com</a></span>
<span class="tok-go">NOTIFY_CONTACTNAME=hh</span>
<span class="tok-go">NOTIFY_CONTACTPAGER=</span>
<span class="tok-go">NOTIFY_CONTACTS=hh</span>
<span class="tok-go">NOTIFY_DATE=2021-08-25</span></code></pre></div></div>
<div class="paragraph"><p>Auch die Parameter lassen sich hier wiederfinden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>grep<span class="tok-w"> </span>PARAMETER<span class="tok-w"> </span>tmp/foobar.out
<span class="tok-go">NOTIFY_PARAMETERS=Fröhn Klabuster Feinbein</span>
<span class="tok-go">NOTIFY_PARAMETER_1=Fröhn</span>
<span class="tok-go">NOTIFY_PARAMETER_2=Klabuster</span>
<span class="tok-go">NOTIFY_PARAMETER_3=Feinbein</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__umgebungsvariablen">
<span class="hidden-anchor sr-only" id="_umgebungsvariablen"></span>11.5. Umgebungsvariablen</h3>
<div class="paragraph"><p>Im obigen Beispiel haben Sie einige Umgebungsvariablen gesehen, die dem Skript übergeben wurden.
Welche Variablen genau bereitstehen, hängt von der Art der Benachrichtigung und auch von der verwendeten Checkmk-Version und -Edition
ab.
Neben dem Trick mit dem Kommando <code>env</code> gibt es noch zwei weitere Wege zu einer vollständigen Liste aller Variablen:</p></div>
<div class="ulist"><ul>
<li><p>Das Hochschalten des Log-Levels für <code>~/var/log/notify.log</code> über <span class="guihint">Global settings &gt; Notifications &gt; Notification log level</span>.</p></li>
<li><p>Bei Benachrichtigungen per <span class="guihint">HTML Email</span> gibt es eine Checkbox <span class="guihint">Information to be displayed in the email body</span> und dort die Option <span class="guihint">Complete variable list (for testing)</span>.</p></li>
</ul></div>
<div class="paragraph"><p>Folgendes sind die wichtigsten Variablen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Umgebungsvariable</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_ROOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home-Verzeichnis der Instanz, z.B. <code>/omd/sites/mysite</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OMD_SITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name der Instanz, z.B. <code>mysite</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_WHAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei Host-Benachrichtigungen das Wort <code>HOST</code>, sonst <code>SERVICE</code>. Damit können Sie Ihr Skript so intelligent machen, dass es in beiden Fällen sinnvolle Informationen meldet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benutzername (Login) des Kontakts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTEMAIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail-Adresse des Kontakts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_CONTACTPAGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eintrag im Feld <span class="guihint">Pager</span> des Benutzerprofils des Kontakts. Da das Feld meist nicht für einen bestimmten Zweck belegt ist, können Sie es einfach nutzen, um eine für die Benachrichtigung nötige Information pro Benutzer zu speichern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datum der Benachrichtigung im ISO-8601-Format, z.B. <code>2021-08-25</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_LONGDATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datum und Uhrzeit in der nicht-lokalisierten Standarddarstellung des Linux-Systems, z.B. <code>Wed Aug 25 15:18:58 CEST 2021</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SHORTDATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datum und Uhrzeit im ISO-Format, z.B. <code>2021-08-25 15:18:58</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des betroffenen Hosts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTOUTPUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ausgabe des Check-Plugins des Host-Checks, z.B. <code>Packet received via smart PING</code>. Diese Ausgabe ist nur bei Host-Benachrichtigungen interessant, aber auch bei Service-Benachrichtigungen vorhanden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_HOSTSTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eines der Worte <code>UP</code>, <code>DOWN</code> oder <code>UNREACH</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_NOTIFICATIONTYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typ der Benachrichtigung, wie in der <a href="#intro">Einleitung dieses Artikels</a> beschrieben. Er wird durch eines der folgenden Worte ausgedrückt:<br>
<code>PROBLEM</code>: Normales Host-/Service-Problem<br>
<code>RECOVERY</code>: Host/Service kehrt zurück zum Zustand <span class="hstate0">UP</span> / <span class="state0">OK</span><br>
<code>ACKNOWLEDGEMENT (…​)</code>: <a href="basics_ackn.html">Quittierung</a> eines Problems<br>
<code>FLAPPINGSTART</code>: Host/Service beginnt unstetig zu sein<br>
<code>FLAPPINGSTOP</code>: Ende der Unstetigkeit<br>
<code>DOWNTIMESTART</code>: Beginn einer <a href="basics_downtimes.html">Wartungszeit</a><br>
<code>DOWNTIMEEND</code>: Normales Ende einer Wartungszeit<br>
<code>DOWNTIMECANCELLED</code>: Vorzeitiger Abbruch einer Wartungszeit<br>
<code>CUSTOM</code>: Mit <a href="commands.html">Kommando</a> manuell ausgelöste Benachrichtigung<br>
<code>ALERTHANDLER (…​)</code>: Alert Handler-Ausführung (nur Enterprise Editions)<br>
Bei den Typen mit <code>(…​)</code> stehen in der Klammer weitere Informationen über die Art der Benachrichtigung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alle Parameter des Skripts durch Leerzeichen getrennt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETER_1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Erster Parameter des Skripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_PARAMETER_2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zweiter Parameter des Skripts, usw.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICEDESC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des betroffenen Services. Bei Host-Benachrichtigungen ist diese Variable nicht vorhanden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICEOUTPUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ausgabe des Check-Plugins des Service-Checks (nicht bei Host-Benachrichtigungen)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOTIFY_SERVICESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eines der Worte <code>OK</code>, <code>WARN</code>, <code>CRIT</code> oder <code>UNKNOWN</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__sammelbenachrichtigungen">
<span class="hidden-anchor sr-only" id="_sammelbenachrichtigungen"></span>11.6. Sammelbenachrichtigungen</h3>
<div class="paragraph"><p>Wenn Ihr Skript <a href="#bulk">Sammelbenachrichtigungen</a> unterstützen soll, müssen Sie es speziell dafür präparieren, da hier dem Skript <em>mehrere Benachrichtigungen auf einmal</em> übergeben werden.
Aus diesem Grund funktioniert dann auch die Übergabe per Umgebungsvariablen nicht mehr sinnvoll.</p></div>
<div class="paragraph"><p>Deklarieren Sie Ihr Skript in der <em>dritten Zeile</em> im Kopf wie folgt, dann sendet das Benachrichtigungsmodul die Benachrichtigungen auf der <em>Standardeingabe:</em></p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/mybulk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# My Bulk Notification
# Bulk: yes</code></pre></div>
</div>
<div class="paragraph"><p>Auf der Standardeingabe werden dem Skript Blöcke von Variablen gesendet.
Jede Zeile hat die Form <code>NAME=VALUE</code>.
Blöcke werden getrennt durch Leerzeilen.
Das ASCII-Zeichen mit dem Code 1 (<code>\a</code>) wird verwendet, um innerhalb der Texte Zeilenumbrüche (<em>newlines</em>) darzustellen.</p></div>
<div class="paragraph"><p>Der erste Block enthält eine Liste von allgemeinen Variablen (z.B. Aufrufparameter).
Jeder weitere Block fasst die Variablen zu einer Benachrichtigung zusammen.</p></div>
<div class="paragraph"><p>Am besten, Sie probieren das Ganze erst einmal mit einem einfachen Test aus, der die kompletten Daten in eine Datei schreibt und sehen sich an, wie die Daten gesendet werden.
Dazu können Sie z.B. das folgende Benachrichtigungsskript nutzen:</p></div>
<div class="listingblock">
<div class="title">~/local/share/check_mk/notifications/mybulk</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
# My Bulk Notification
# Bulk: yes

cat &gt; $OMD_ROOT/tmp/mybulktest.out</code></pre></div>
</div>
<div class="paragraph"><p>Testen Sie das Skript wie <a href="#example_test">oben beschrieben</a> und aktivieren Sie zusätzlich in der Benachrichtigungsregel die Sammelbenachrichtigung (<span class="guihint">Notification Bulking</span>).</p></div>
</div>
<div class="sect2">
<h3 id="heading_includedscripts">
<span class="hidden-anchor sr-only" id="includedscripts"></span>11.7. Mitgelieferte Benachrichtigungsskripte</h3>
<div class="paragraph"><p>Im Auslieferungszustand stellt Checkmk bereits eine ganze Reihe Skripte bereit zur Anbindung an beliebte und weit verbreitete Instant-Messaging-Dienste, Incident-Management-Plattformen und Ticketsysteme.
Wie Sie diese Skripte nutzen können, erfahren Sie in den folgenden Artikeln:</p></div>
<div class="ulist"><ul>
<li><p><a href="notifications_jira.html">Jira</a></p></li>
<li><p><a href="notifications_mattermost.html">Mattermost</a></p></li>
<li><p><a href="notifications_pagerduty.html">PagerDuty</a></p></li>
<li><p><a href="notifications_pushover.html">Pushover</a></p></li>
<li><p><a href="notifications_opsgenie.html">Opsgenie</a></p></li>
<li><p><a href="notifications_servicenow.html">ServiceNow</a></p></li>
<li><p><a href="notifications_slack.html">Slack</a></p></li>
<li><p><a href="notifications_opsgenie.html">Opsgenie</a></p></li>
<li><p><a href="notifications_webex.html">Cisco Webex Teams</a></p></li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_files">
<span class="hidden-anchor sr-only" id="files"></span>12. Dateien und Verzeichnisse</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__pfade_von_checkmk">
<span class="hidden-anchor sr-only" id="_pfade_von_checkmk"></span>12.1. Pfade von Checkmk</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/cmc.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des <a href="cmc.html">CMC</a>. Falls das Debugging für Notifications eingeschaltet ist, finden Sie hier genaue Angaben, warum Benachrichtigungen (nicht) erzeugt wurden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/notify.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des Benachrichtigungsmoduls</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mknotifyd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des Benachrichtigungs-Spoolers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/log/mknotifyd.state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aktueller Zustand des Benachrichtigungs-Spoolers. Das ist hauptsächlich bei  <a href="distributed_monitoring.html#notifications">Benachrichtigungen in verteilten Umgebungen</a> relevant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/nagios/debug.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug-Log-Datei von Nagios. Schalten Sie Debug-Meldungen in <code>etc/nagios/nagios.d/logging.cfg</code> in der Variablen <code>debug_level</code> ein.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/spool/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ablage der Spool-Dateien, die der Benachrichtigungs-Spooler bearbeiten soll.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/deferred/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei temporären Fehlern verschiebt der Benachrichtigungs-Spooler die Dateien hierher und probiert es erst nach ein paar Minuten nochmal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/var/check_mk/notify/corrupted/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defekte Spool-Dateien werden hierher verschoben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/share/check_mk/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Von Checkmk mitgelieferte Benachrichtigungsskripte. Ändern Sie hier nichts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/local/share/check_mk/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ablageort für eigene Benachrichtigungsskripte. Möchten Sie ein mitgeliefertes Skript anpassen, so kopieren Sie es von <code>~/share/check_mk/notifications</code> hierher und behalten dessen Dateinamen bei.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/share/doc/check_mk/treasures/notifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Weitere Benachrichtigungsskripte, die Sie geringfügig anpassen und verwenden können.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_maillog">
<span class="hidden-anchor sr-only" id="maillog"></span>12.2. Log-Dateien des SMTP-Servers</h3>
<div class="paragraph"><p>Die Log-Dateien des SMTP-Servers sind Systemdateien und werden hier folglich
mit absoluten Pfaden angegeben. Wo die Log-Datei genau liegt, hängt von Ihrer
Linux-Distribution ab.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/mail.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des SMTP-Servers unter Debian und Ubuntu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/mail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des SMTP-Servers unter SUSE Linux Enterprise Server (SLES)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/maillog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei des SMTP-Servers unter Red Hat Enterprise Linux (RHEL)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#intro">1. Einleitung</a></li>
<li><a href="#notify_or_not">2. Benachrichtigen oder (noch) nicht benachrichtigen?</a></li>
<li>
<a href="#simple_mail">3. Einfache Benachrichtigung per E-Mail</a><ul class="sectlevel1">
<li><a href="#_voraussetzungen">3.1. Voraussetzungen</a></li>
<li><a href="#smtp">3.2. Einrichten des Mailversands unter Linux</a></li>
<li><a href="#_e_mail_adresse_und_kontaktgruppe">3.3. E-Mail-Adresse und Kontaktgruppe</a></li>
<li><a href="#notification_testing">3.4. Test</a></li>
<li><a href="#finetuning">3.5. Feineinstellungen für HTML-E-Mail</a></li>
</ul>
</li>
<li>
<a href="#rules">4. Benachrichtigungen per Regeln steuern</a><ul class="sectlevel1">
<li><a href="#_das_prinzip">4.1. Das Prinzip</a></li>
<li><a href="#_vordefinierte_regel">4.2. Vordefinierte Regel</a></li>
<li>
<a href="#notification_rule">4.3. Aufbau der Benachrichtigungsregeln</a><ul class="sectlevel2">
<li><a href="#_generelle_eigenschaften">Generelle Eigenschaften</a></li>
<li><a href="#_benachrichtigungsmethode">Benachrichtigungsmethode</a></li>
<li><a href="#_kontaktauswahl">Kontaktauswahl</a></li>
<li><a href="#rule_conditions">Bedingungen</a></li>
</ul>
</li>
<li><a href="#cancel">4.4. Benachrichtigungen durch Regeln löschen</a></li>
<li><a href="#fallback">4.5. Was ist, wenn keine Regel greift?</a></li>
</ul>
</li>
<li>
<a href="#personal">5. Benutzerdefinierte Benachrichtigungen</a><ul class="sectlevel1">
<li><a href="#_%C3%BCbersicht">5.1. Übersicht</a></li>
<li><a href="#_benutzerdefinierte_benachrichtigungsregeln">5.2. Benutzerdefinierte Benachrichtigungsregeln</a></li>
<li><a href="#_vor%C3%BCbergehende_abschaltung">5.3. Vorübergehende Abschaltung</a></li>
</ul>
</li>
<li>
<a href="#conditions">6. Wann Benachrichtigungen erzeugt werden und wie man damit umgeht</a><ul class="sectlevel1">
<li><a href="#_einleitung">6.1. Einleitung</a></li>
<li><a href="#_wartungszeiten">6.2. Wartungszeiten</a></li>
<li><a href="#_benachrichtigungsperioden">6.3. Benachrichtigungsperioden</a></li>
<li><a href="#state_host">6.4. Der Zustand des Hosts, auf dem ein Service läuft</a></li>
<li><a href="#parents">6.5. Parent-Hosts</a></li>
<li><a href="#_benachrichtigungen_per_regel_abschalten">6.6. Benachrichtigungen per Regel abschalten</a></li>
<li><a href="#_benachrichtigungen_per_kommando_abschalten">6.7. Benachrichtigungen per Kommando abschalten</a></li>
<li><a href="#global">6.8. Benachrichtigungen global ausschalten</a></li>
<li><a href="#delaying">6.9. Benachrichtigungen verzögern</a></li>
<li><a href="#repeated_check_attempts">6.10. Mehrere Check-Versuche</a></li>
<li><a href="#flapping">6.11. Unstetige Hosts und Services</a></li>
<li>
<a href="#_periodisch_wiederholte_benachrichtigungen_und_eskalationen">6.12. Periodisch wiederholte Benachrichtigungen und Eskalationen</a><ul class="sectlevel2">
<li><a href="#_periodisch_wiederholte_benachrichtigungen_einrichten">Periodisch wiederholte Benachrichtigungen einrichten</a></li>
<li><a href="#_eskalationen_aufbauen_und_verstehen">Eskalationen aufbauen und verstehen</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#path">7. Der Weg einer Benachrichtigung von Anfang bis Ende</a><ul class="sectlevel1">
<li><a href="#history">7.1. Die Benachrichtigungshistorie</a></li>
<li><a href="#_die_komponenten">7.2. Die Komponenten</a></li>
<li>
<a href="#_der_monitoring_kern">7.3. Der Monitoring-Kern</a><ul class="sectlevel2">
<li><a href="#_rohbenachrichtigungen">Rohbenachrichtigungen</a></li>
<li><a href="#_fehlerdiagnose_im_monitoring_kern_nagios">Fehlerdiagnose im Monitoring-Kern Nagios</a></li>
<li><a href="#_fehlerdiagnose_im_monitoring_kern_cmc">Fehlerdiagnose im Monitoring-Kern CMC</a></li>
</ul>
</li>
<li>
<a href="#_regelauswertung_durch_das_benachrichtigungsmodul">7.4. Regelauswertung durch das Benachrichtigungsmodul</a><ul class="sectlevel2">
<li><a href="#_analyse_der_regelkette">Analyse der Regelkette</a></li>
<li><a href="#_fehlerdiagnose">Fehlerdiagnose</a></li>
</ul>
</li>
<li>
<a href="#async">7.5. Asynchrone Zustellung durch Benachrichtigungs-Spooler</a><ul class="sectlevel2"><li><a href="#_fehlerdiagnose_2">Fehlerdiagnose</a></li></ul>
</li>
</ul>
</li>
<li>
<a href="#bulk">8. Sammelbenachrichtigung (Bulk notifications)</a><ul class="sectlevel1">
<li><a href="#_%C3%BCbersicht_2">8.1. Übersicht</a></li>
<li><a href="#_sammelbenachrichtigungen_und_zeitperioden">8.2. Sammelbenachrichtigungen und Zeitperioden</a></li>
</ul>
</li>
<li>
<a href="#syncsmtp">9. Nachvollziehbare Zustellung per SMTP</a><ul class="sectlevel1">
<li><a href="#_e_mail_ist_nicht_zuverl%C3%A4ssig">9.1. E-Mail ist nicht zuverlässig</a></li>
<li><a href="#_smtp_auf_direktem_weg_erm%C3%B6glicht_fehlerauswertung">9.2. SMTP auf direktem Weg ermöglicht Fehlerauswertung</a></li>
<li><a href="#_synchrone_zustellung_f%C3%BCr_html_e_mails">9.3. Synchrone Zustellung für HTML-E-Mails</a></li>
<li><a href="#_sms_und_andere_benachrichtigungsmethoden">9.4. SMS und andere Benachrichtigungsmethoden</a></li>
</ul>
</li>
<li><a href="#distributed">10. Benachrichtigungen in verteilten Systemen</a></li>
<li>
<a href="#scripts">11. Benachrichtigungsskripte</a><ul class="sectlevel1">
<li><a href="#_das_prinzip_2">11.1. Das Prinzip</a></li>
<li><a href="#_nachvollziehbare_benachrichtigungen">11.2. Nachvollziehbare Benachrichtigungen</a></li>
<li><a href="#example">11.3. Ein einfaches Beispielskript</a></li>
<li><a href="#example_test">11.4. Beispielskript testen</a></li>
<li><a href="#_umgebungsvariablen">11.5. Umgebungsvariablen</a></li>
<li><a href="#_sammelbenachrichtigungen">11.6. Sammelbenachrichtigungen</a></li>
<li><a href="#includedscripts">11.7. Mitgelieferte Benachrichtigungsskripte</a></li>
</ul>
</li>
<li>
<a href="#files">12. Dateien und Verzeichnisse</a><ul class="sectlevel1">
<li><a href="#_pfade_von_checkmk">12.1. Pfade von Checkmk</a></li>
<li><a href="#maillog">12.2. Log-Dateien des SMTP-Servers</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
