<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Egal, ob Syslog, weitergeleitete Text-Logs oder Traps über SNMP - hier erfahren Sie, wie Sie diese Ereignisse in der Checkmk Event Console verarbeiten können.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Die Event Console - Logs und SNMP-Traps in Checkmk verarbeiten">
<meta name="og:description" content="Egal, ob Syslog, weitergeleitete Text-Logs oder Traps über SNMP - hier erfahren Sie, wie Sie diese Ereignisse in der Checkmk Event Console verarbeiten können.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Die Event Console - Logs und SNMP-Traps in Checkmk verarbeiten</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/en/ec.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/de/ec.html">2.2.0</a><a class="dropdown-item" href="../../latest/de/ec.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host- und Serviceparameter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Einführung in die Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMWare ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Konfiguration via Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
<li>
<p><a href="web_api.html">Konfiguration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Befehlsreferenz der HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Eigene Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Die Event Console</h1>
<div class="details">
<span id="revdate">Last modified on 02-Dec-2021</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/de/ec.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">Dies ist eine am 2025-01-07 22:12:14 +0000 für die Offline-Nutzung exportierte Seite. Sie spiegelt möglicherweise nicht den aktuellen Stand der Checkmk Dokumentation wider. Um eine täglich aktualisierte Version dieser Seite anzusehen, rufen Sie bitte <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a> auf.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a>
<a href="wato_rules.html">Host- und Serviceparameter</a>
<a href="livestatus.html">Statusdaten abrufen via Livestatus</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__einleitung">
<span class="hidden-anchor sr-only" id="_einleitung"></span>1. Einleitung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__ereignisse_sind_keine_zustände">
<span class="hidden-anchor sr-only" id="_ereignisse_sind_keine_zustände"></span>1.1. Ereignisse sind keine Zustände</h3>
<div class="paragraph"><p>Die Hauptaufgabe von Checkmk ist das aktive Überwachen von <em>Zuständen.</em>
Zu jedem Zeitpunkt hat jeder überwachte Service einen der Zustände <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> oder <span class="state3">UNKNOWN</span>.
Durch regelmäßige Abfragen aktualisiert das Monitoring ständig sein Bild von der Lage.</p></div>
<div class="paragraph"><p>Eine ganz andere Art des Monitorings ist das Arbeiten mit <em>Ereignissen</em> (<em>events</em>).
Ein Beispiel für ein Ereignis ist eine Exception, die in einer Anwendung auftritt.
Die Anwendung läuft eventuell korrekt weiter und hat nach wie vor den Zustand <span class="state0">OK</span> — aber irgendetwas <em>ist passiert.</em></p></div>
</div>
<div class="sect2">
<h3 id="heading__die_event_console">
<span class="hidden-anchor sr-only" id="_die_event_console"></span>1.2. Die Event Console</h3>
<div class="paragraph"><p>Checkmk verfügt mit der <strong>Event Console</strong> (kurz EC) über ein voll integriertes System zur Überwachung von Ereignissen aus Quellen wie Syslog, SNMP-Traps, Windows Event Logs, Log-Dateien und eigenen Anwendungen.
Dabei werden aus Ereignissen nicht einfach Zustände gemacht, sondern sie bilden eine eigene Kategorie und werden von Checkmk sogar im <span class="guihint">Overview</span> der <a href="user_interface.html#sidebar">Seitenleiste</a> mit angezeigt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/tactical_overview_events.png" alt="tactical overview events" width="400"></div></div>
<div class="paragraph"><p>Intern werden Ereignisse nicht durch den Monitoring-Kern, sondern von einem eigenen Dienst verarbeitet — dem Event Daemon (<code>mkeventd</code>).</p></div>
<div class="paragraph"><p>Die Event Console verfügt auch über ein Archiv, in dem Sie über Ereignisse in der Vergangenheit recherchieren können.
Gleich vorweg sei allerdings gesagt:
Dies ist kein Ersatz für ein echtes Log-Archiv.
Die Aufgabe der Event Console ist das intelligente Herausfiltern einer <em>kleinen</em> Zahl von <em>relevanten</em> Meldungen aus einem großen Strom.
Sie ist optimiert auf Einfachheit, Robustheit und Durchsatz — nicht auf Speicherung großer Datenmengen.</p></div>
<div class="paragraph"><p>Ein kurzer Abriss der Funktionalität der EC:</p></div>
<div class="ulist"><ul>
<li><p>Sie kann Meldungen per Syslog oder SNMP-Traps <em>direkt</em> empfangen.
Eine Konfiguration der entsprechenden Linux-Systemdienste ist daher nicht notwendig.</p></li>
<li><p>Sie kann mithilfe der Checkmk Agenten auch textbasierte Log-Dateien und Windows Event Logs auswerten.</p></li>
<li><p>Sie klassifiziert Meldungen anhand einer Kette von benutzerdefinierten Regeln.</p></li>
<li><p>Sie kann Meldungen korrelieren, zusammenfassen, zählen, annotieren, umschreiben und auch deren zeitliche Zusammenhänge berücksichtigen.</p></li>
<li><p>Sie kann automatisiert Aktionen ausführen und über Checkmk <a href="notifications.html">Benachrichtigungen</a> versenden.</p></li>
<li><p>Sie ist voll in die Oberfläche von Checkmk integriert.</p></li>
<li><p>Sie ist in jedem aktuellen Checkmk System enthalten und sofort einsatzfähig.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__begriffe">
<span class="hidden-anchor sr-only" id="_begriffe"></span>1.3. Begriffe</h3>
<div class="paragraph"><p>Die Event Console empfängt <strong>Meldungen</strong> (meist in Form von <em>Log Messages</em>).
Eine Meldung ist eine Zeile Text mit einer Reihe von möglichen Zusatzattributen, wie z.B. einem Zeitstempel, einem Host-Namen usw.
Wenn die Meldung relevant ist, wird daraus direkt ein <strong>Event</strong> mit den gleichen Attributen, aber:</p></div>
<div class="ulist"><ul>
<li><p>Nur wenn eine Regel greift, wird aus einer Meldung ein Event erzeugt.</p></li>
<li><p>Regeln können den Text und andere Attribute von Meldungen verändern.</p></li>
<li><p>Mehrere Meldungen können zu einem Event zusammengefasst werden.</p></li>
<li><p>Meldungen können aktuelle Events wieder <a href="#cancelling">aufheben</a>.</p></li>
<li><p>Künstliche Events können erzeugt werden, wenn bestimmte <a href="#expect">Meldungen ausbleiben</a>.</p></li>
</ul></div>
<div class="paragraph"><p>Ein Event kann verschiedene <strong>Phasen</strong> durchlaufen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>open</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der „normale“ Zustand: Etwas ist passiert: der Operator soll sich kümmern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>acknowledged</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Problem wurde quittiert — dies ist analog zu Host- und Service-Problemen aus dem statusbaserten Monitoring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>counting</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Es ist noch nicht die erforderliche Anzahl von bestimmten Meldungen eingetroffen: die Situation ist noch unproblematisch. Das Ereignis wird dem Operator deswegen noch nicht angezeigt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>delayed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Störmeldung ist eingegangen, aber die Event Console wartet noch, ob in einer konfigurierten Zeit die passende <span class="state0">OK</span>-Meldung eingeht. Erst danach wird das Event dem Operator angezeigt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>closed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde vom Operator oder automatisch geschlossen und ist nur noch im Archiv.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Ein Event hat ferner einen <strong>Zustand.</strong>
Genau genommen ist hier aber nicht der Zustand des Events selbst gemeint, sondern des Dienstes oder Gerätes, der/das den Event gesendet hat.
Um eine Analogie zum statusbasierten Monitoring zu schaffen, ist auch ein Event als <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> oder <span class="state3">UNKNOWN</span> eingestuft.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_setup">
<span class="hidden-anchor sr-only" id="setup"></span>2. Die Event Console aufsetzen</h2>
<div class="sectionbody">
<div class="paragraph"><p>Das Einrichten der Event Console ist sehr einfach, da die Event Console  fester Bestandteil von Checkmk ist und automatisch aktiviert wird.</p></div>
<div class="paragraph"><p>Falls Sie jedoch über das Netzwerk Syslog-Meldungen oder SNMP-Traps empfangen möchten, so müssen Sie dies separat aktivieren.
Der Grund ist, dass beide Dienste einen UDP-Port mit einer jeweils bestimmten bekannten Portnummer öffnen müssen.
Und da dies pro System nur eine Checkmk Instanz machen kann, ist der Empfang über das Netzwerk per Default abgeschaltet.
Die Portnummern sind:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Protokoll</th>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Dienst</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">162</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP-Traps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog via TCP</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Syslog via TCP wird nur selten verwendet, hat aber den Vorteil, dass die Übertragung der Meldungen hier abgesichert wird.
Bei UDP ist niemals garantiert, dass Pakete wirklich ankommen.
Und weder Syslog noch SNMP-Traps bieten Quittungen oder einen ähnlichen Schutz vor verlorengegangen Meldungen.
Damit Sie Syslog via TCP verwenden können, muss natürlich auch das sendende System dazu in der Lage sein, Meldungen über diesen Port zu verschicken.</p></div>
<div class="paragraph"><p>In der Checkmk Appliance können Sie den Empfang von Syslog/SNMP-Traps in der Instanzkonfiguration einschalten.
Ansonsten verwenden Sie einfach <code>omd config</code>.
Sie finden die benötigte Einstellung unter <span class="guihint">Addons</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_omd_config.png" alt="ec omd config" width="360"></div></div>
<div class="paragraph"><p>Beim <code>omd start</code> sehen Sie in der Zeile mit <code>mkeventd</code>, welche externen Schnittstellen Ihre EC offen hat:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Starting mkeventd (builtin: syslog-udp,snmptrap)...OK</span>
<span class="tok-go">Starting liveproxyd...OK</span>
<span class="tok-go">Starting mknotifyd...OK</span>
<span class="tok-go">Starting rrdcached...OK</span>
<span class="tok-go">Starting cmc...OK</span>
<span class="tok-go">Starting apache...OK</span>
<span class="tok-go">Starting dcd...OK</span>
<span class="tok-go">Starting redis...OK</span>
<span class="tok-go">Initializing Crontab...OK</span></code></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__erste_schritte_mit_der_event_console">
<span class="hidden-anchor sr-only" id="_erste_schritte_mit_der_event_console"></span>3. Erste Schritte mit der Event Console</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_first_steps_rules">
<span class="hidden-anchor sr-only" id="first_steps_rules"></span>3.1. Regeln, Regeln, Regeln</h3>
<div class="paragraph"><p>Eingangs wurde erwähnt, dass die EC dazu dient, <em>relevante</em> Meldungen herauszufischen und anzuzeigen.
Nun ist es leider so, dass die meisten Meldungen — egal ob aus Textdateien, dem Windows Event Log oder dem Syslog — ziemlich unwichtig sind.
Und da hilft es auch nichts, wenn Meldungen seitens des Verursachers bereits voreingestuft sind.</p></div>
<div class="paragraph"><p>Zum Beispiel gibt es in Syslog und im Windows Event Log eine Klassifizierung der Meldungen in etwas Ähnliches wie OK, WARN und CRIT.
Aber was jetzt WARN und CRIT ist, hat dabei der jeweilige Programmierer subjektiv festgelegt.
Und es ist noch nicht einmal gesagt, dass die Anwendung, welche die Meldung produziert hat, auf diesem Rechner überhaupt wichtig ist.
Kurzum: Sie kommen nicht drumherum, selbst zu konfigurieren, welche Meldungen für Sie nach einem Problem aussehen und welche einfach verworfen werden können.</p></div>
<div class="paragraph"><p>Wie überall in Checkmk erfolgt auch hier die Konfiguration über <a href="glossar.html#rule">Regeln,</a> welche bei jeder eingehenden Meldung von der EC nach dem „first match“-Prinzip abgearbeitet werden.
Die erste Regel, die auf eine eingehende Meldung greift, entscheidet also über deren Schicksal.
Greift keine Regel, so wird die Meldung einfach lautlos verworfen.</p></div>
<div class="paragraph"><p>Da man bei der EC mit der Zeit gewöhnlich sehr viele Regeln aufbaut, sind die Regeln hier in <em>Paketen</em> organisiert.
Die Abarbeitung geschieht Paket für Paket und innerhalb eines Pakets von oben nach unten.
Damit ist auch die Reihenfolge der Pakete wichtig.</p></div>
</div>
<div class="sect2">
<h3 id="heading__anlegen_einer_einfachen_regel">
<span class="hidden-anchor sr-only" id="_anlegen_einer_einfachen_regel"></span>3.2. Anlegen einer einfachen Regel</h3>
<div class="paragraph"><p>Die Konfiguration der EC finden Sie wenig überraschend im <span class="guihint">Setup</span>-Menü unter <span class="guihint">Events &gt; Event Console</span>.
Ab Werk finden Sie dort nur das <span class="guihint">Default rule pack</span>, das aber keine Regeln enthält.
Eingehende Meldungen werden demnach, wie bereits erwähnt, verworfen und auch nicht geloggt.
Das Modul präsentiert sich so:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_wato_module.png" alt="ec wato module"></div></div>
<div class="paragraph"><p>Legen Sie nun mit <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add rule pack</span> als Erstes ein neues Regelpaket an:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_new_rule_pack.png" alt="ec new rule pack"></div></div>
<div class="paragraph"><p>Wie immer gilt die ID als interne Referenz und kann später nicht mehr geändert werden.
Nach dem Speichern finden Sie den neuen Eintrag in der Liste Ihrer Regelpakete:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_pack_list.png" alt="ec rule pack list"></div></div>
<div class="paragraph"><p>Dort können Sie jetzt mit <span class="image-inline"><img src="../images/icons/icon_ec_rules.png" alt="icon ec rules"></span> in das noch leere Paket wechseln und mit <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add rule</span> eine neue Regel anlegen.
Füllen Sie hier lediglich den ersten Kasten mit der Überschrift <span class="guihint">Rule Properties</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_first_rule.png" alt="ec first rule"></div></div>
<div class="paragraph"><p>Einzig notwendig ist eine eindeutige <span class="guihint">Rule ID</span>.
Diese ID werden Sie später auch in Log-Dateien finden, und sie wird bei den erzeugten Events mit gespeichert.
Es ist also nützlich, die IDs systematisch zu vergeben.
Alle weiteren Kästen sind optional.
Das gilt insbesondere für die Bedingungen.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Die neue Regel ist erst einmal nur zum Testen und greift vorerst auf <em>jedes</em> Ereignis.
Daher ist es auch wichtig, dass Sie diese später wieder entfernen oder zumindest deaktivieren!
Andernfalls wird ihre Event Console mit jeder nur erdenklichen unnützen Meldung geflutet und so ziemlich nutzlos werden.</p></div>
<div class="sect3">
<h4 id="heading__aktivieren_der_änderungen">
<span class="hidden-anchor sr-only" id="_aktivieren_der_änderungen"></span>Aktivieren der Änderungen</h4>
<div class="paragraph"><p>Wie immer in Checkmk, müssen Sie zuerst <a href="glossar.html#activate_changes">Änderungen aktivieren</a>, damit diese wirksam werden.
Das ist nicht von Nachteil:
Denn so können Sie bei Änderungen, die mehrere zusammengehörige Regeln betreffen, genau festlegen, wann diese „live“ gehen sollen.
Und Sie können mit dem <span class="guihint">Event Simulator</span> zuvor testen, ob alles passt.</p></div>
<div class="paragraph"><p>Klicken Sie zuerst rechts oben auf der Seite auf die Zahl der aufgelaufenen Änderungen.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_activate_changes.png" alt="ec activate changes"></div></div>
<div class="paragraph"><p>Klicken Sie anschließend auf <span class="guihint">Activate on selected sites</span> um die Änderung zu aktivieren.
Die Event Console ist so konstruiert, dass diese Aktion absolut <em>unterbrechungsfrei</em> abläuft.
Der Empfang von eingehenden Meldungen wird zu jeder Zeit sichergestellt, so dass durch den Prozess keine Meldungen verlorengehen können.</p></div>
<div class="paragraph"><p>Das Aktivieren von Änderungen in der EC ist nur Administratoren erlaubt.
Gesteuert wird das über die <a href="wato_user.html#roles">Berechtigung</a> <span class="guihint">Activate changes for event console</span>.</p></div>
</div>
<div class="sect3">
<h4 id="heading_eventsimulator">
<span class="hidden-anchor sr-only" id="eventsimulator"></span>Ausprobieren der neuen Regel</h4>
<div class="paragraph"><p>Für das Testen könnten Sie jetzt natürlich Meldungen per Syslog oder SNMP senden.
Das sollten Sie später auch tun.
Für einen ersten Test ist aber der in der EC eingebaute <span class="guihint">Event Simulator</span> praktischer:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_simulator.png" alt="ec simulator"></div></div>
<div class="paragraph"><p>Hier haben Sie zwei Möglichkeiten:
<span class="guihint">Try out</span> berechnet anhand der simulierten Meldung, welche der Regeln matchen würden.
Befinden Sie sich in der obersten Ebene der Setup-GUI für die EC, so werden die Regelpakete markiert.
Befinden Sie sich innerhalb eines Regelpakets, so werden die einzelnen Regeln markiert.
Jedes Paket bzw. jede Regel wird mit einem der folgenden drei Symbole gekennzeichnet:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulematch.png" alt="icon rulematch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese Regel ist die erste, die auf die Meldung greift und legt folglich deren Schicksal fest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulepmatch.png" alt="icon rulepmatch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese Regel würde zwar greifen, aber die Meldung wurde schon von einer früheren Regel bearbeitet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image-inline"><img src="../images/icons/icon_rulenmatch.png" alt="icon rulenmatch"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese Regel greift nicht. Sehr praktisch: Wenn Sie mit der Maus über die graue Kugel fahren, bekommen Sie eine Erklärung, aus welchem Grund die Regel nicht greift.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Ein Klick auf <span class="guihint">Generate event</span> macht fast das Gleiche wie <span class="guihint">Try out</span>, nur wird jetzt die Meldung <strong>tatsächlich erzeugt.</strong>
Eventuell definierte <a href="#actions">Aktionen</a> werden tatsächlich ausgeführt.
Und das Event taucht dann auch in den offenen Events im Monitoring auf.
Den Quelltext der erzeugten Meldung sehen Sie in der Bestätigung:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_event_generated.png" alt="ec event generated"></div></div>
<div class="paragraph"><p>Das so erzeugte Event taucht im <span class="guihint">Monitor</span>-Menü unter <span class="guihint">Event Console &gt; Events</span> auf:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_one_open_event.png" alt="ec one open event"></div></div>
</div>
<div class="sect3">
<h4 id="heading__meldungen_testweise_von_hand_erzeugen">
<span class="hidden-anchor sr-only" id="_meldungen_testweise_von_hand_erzeugen"></span>Meldungen testweise von Hand erzeugen</h4>
<div class="paragraph"><p>Für einen ersten echten Test über das Netzwerk können Sie sehr einfach von einem anderen Linux-Rechner aus per Hand eine Syslog-Meldung versenden.
Da das Protokoll so einfach ist, brauchen Sie dafür nicht einmal ein spezielles Programm, sondern können die Daten einfach per <code>netcat</code> oder <code>nc</code> via UDP versenden.
Der Inhalt des UDP-Pakets besteht aus einer Zeile Text.
Wenn diese einem bestimmten Aufbau entspricht, werden die Bestandteile von der Event Console sauber zerlegt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'&lt;78&gt;Dec 18 10:40:00 myserver123 MyApplication: It happened again.'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>nc<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-m">0</span><span class="tok-w"> </span>-u<span class="tok-w"> </span><span class="tok-m">10</span>.1.1.94<span class="tok-w"> </span><span class="tok-m">514</span></code></pre></div></div>
<div class="paragraph"><p>Sie können aber auch einfach <em>irgendetwas</em> senden.
Die EC wird das dann trotzdem annehmen und einfach als Meldungstext auswerten.
Zusatzinformation wie z.B. die Anwendung, die Priorität etc. fehlen dann natürlich.
Als Status wird zur Sicherheit <span class="state2">CRIT</span> angenommen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'This is no syslog message'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>nc<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-m">0</span><span class="tok-w"> </span>-u<span class="tok-w"> </span><span class="tok-m">10</span>.1.1.94<span class="tok-w"> </span><span class="tok-m">514</span></code></pre></div></div>
<div class="paragraph"><p>Innerhalb der Checkmk Instanz, auf der die EC läuft, gibt es eine <em>named Pipe</em>, in die Sie Textmeldungen lokal per <code>echo</code> schreiben können.
Dies ist eine sehr einfache Methode, um eine lokale Anwendung anzubinden und ebenfalls eine Möglichkeit, das Verarbeiten von Meldungen zu testen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">'Local application says hello'</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>tmp/run/mkeventd/events</code></pre></div></div>
<div class="paragraph"><p>Auch hier ist es übrigens möglich, im Syslog-Format zu senden, damit alle Felder des Events sauber befüllt werden.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_globalsettings">
<span class="hidden-anchor sr-only" id="globalsettings"></span>3.3. Einstellungen der Event Console</h3>
<div class="paragraph"><p>Die Event Console hat ihre eigenen globalen Einstellungen, welche Sie nicht bei denen der anderen Module finden, sondern unter <span class="guihint">Setup &gt; Events &gt; Event Console</span> mit dem Knopf <span class="guihint">Settings.</span></p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_settings.png" alt="ec settings"></div></div>
<div class="paragraph"><p>Die Bedeutung der einzelnen Einstellungen erfahren Sie wie immer aus der <a href="user_interface.html#inline_help">Inline-Hilfe</a> und an den jeweils passenden Stellen in diesem Artikel.</p></div>
<div class="paragraph"><p>Der Zugriff auf die Einstellungen ist über die Berechtigung <span class="guihint">Configuration of Event Console</span> geschützt, welche per Default nur in der Rolle <code>admin</code> enthalten ist.</p></div>
</div>
<div class="sect2">
<h3 id="heading_permissions">
<span class="hidden-anchor sr-only" id="permissions"></span>3.4. Berechtigungen</h3>
<div class="paragraph"><p>Auch bei den <a href="wato_user.html#roles">Rollen und Berechtigungen</a> hat die Event Console einen eigenen Abschnitt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_permissions.png" alt="ec permissions"></div></div>
<div class="paragraph"><p>Auf einige der Berechtigungen werden wir an passenden Stellen im Artikel näher eingehen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_hostnames">
<span class="hidden-anchor sr-only" id="hostnames"></span>3.5. Host-Zuordnung in der Event Console</h3>
<div class="paragraph"><p>Eine Besonderheit der Event Console ist, dass im Gegensatz zum statusbasierten Monitoring nicht Hosts im Zentrum stehen:
Events können ohne explizite Host-Zuordnung auftreten, was oft sogar gewünscht ist.
Allerdings sollte bei Hosts, die sich bereits im aktiven Monitoring befinden, eine leichte Zuordnung möglich sein, um im Monitoring bei Auftreten eines Events schnell zur Statusübersicht zu gelangen. Spätestens, wenn aus Events <a href="#eventsgostate">Zustände</a> werden sollen, ist die korrekte Zuordnung zwingend.</p></div>
<div class="paragraph"><p>Grundsätzlich gilt bei per Syslog empfangenen Meldungen, dass der in der Meldung verwendete Host-Name dem Host-Namen im Monitoring entsprechen sollte.
Dies erreichen Sie durch Verwendung des <em>fully qualified domain name</em> (FQDN) / <em>fully qualified host name</em> (FQHN) sowohl in Ihrer Syslog-Konfiguration als auch in der Benennung der Hosts in Checkmk.
In Rsyslog erreichen Sie dies über die globale Direktive <code>$PreserveFQDN on</code>.</p></div>
<div class="paragraph"><p>Checkmk versucht die Host-Namen aus den Events denen aus dem aktiven Monitoring so gut es geht <a href="#hostmatching">automatisch zuzuordnen.</a>
Neben dem Host-Namen wird auch der Host-Alias ausprobiert.
Steht hier der per Syslog übertragene Kurzname, erfolgt die Zuordnung korrekt.</p></div>
<div class="paragraph"><p>Eine Rückwärtsauflösung der IP-Adresse wäre hier wenig sinnvoll, da häufig zwischengeschaltete Log-Server genutzt werden.
Ist die Umstellung der Host-Namen auf FQDN/FQHN oder das Nachtragen vieler Aliase zu aufwendig, können Sie in den <a href="#globalsettings">Einstellungen der Event Console</a> mit <span class="guihint">Hostname translation for incoming messages</span> Host-Namen bereits direkt beim Empfang von Meldungen umschreiben.
Dabei haben Sie zahlreiche Möglichkeiten:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_hostname_translation.png" alt="ec hostname translation"></div></div>
<div class="paragraph"><p>Am flexibelsten ist die Arbeit mit <a href="regexes.html">regulären Ausdrücken</a>, welche intelligentes Suchen und Ersetzen in den Host-Namen erlauben.
Insbesondere, wenn zwar Host-Namen eineindeutig sind, aber nur der in Checkmk mitverwendete Domain-Teil fehlt, hilft eine simple Regel: <code>(.*)</code> wird zu <code>\1.mydomain.test</code>.
In Fällen, wo das alles nicht genügt, können Sie noch mit <span class="guihint">Explicit hostname mapping</span> eine Tabelle von einzelnen Namen und deren jeweiliger Übersetzung angeben.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Die Namensumwandlung geschieht bereits <strong>vor</strong> dem Prüfen der Regelbedingungen und somit lange vor einem möglichen Umschreiben des Host-Namens durch die Regelaktion <span class="guihint">Rewrite hostname</span> beim <a href="#rewriting">automatisches Umschreiben von Texten.</a></p></div>
<div class="paragraph"><p>Etwas einfacher ist die Zuordnung bei <a href="snmp.html">SNMP</a>.
Hier wird die IP-Adresse des Senders mit den gecacheten IP-Adressen der Hosts im Monitoring verglichen, d.h. sobald regelmäßige aktive Checks vorhanden sind, wie Erreichbarkeitsprüfung des Telnet- oder SSH-Ports eines Switches, werden per SNMP versandte Statusmeldungen dieses Gerätes dem korrekten Host zugeordnet werden.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_monitoring">
<span class="hidden-anchor sr-only" id="monitoring"></span>4. Die Event Console im Monitoring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__event_ansichten">
<span class="hidden-anchor sr-only" id="_event_ansichten"></span>4.1. Event-Ansichten</h3>
<div class="paragraph"><p>Von der Event Console erzeugte Events werden analog zu Hosts und Services in der <a href="glossar.html#monitoring_environment">Monitoring-Umgebung</a> angezeigt.
Den Einstieg dazu finden Sie im <span class="guihint">Monitor</span>-Menü unter <span class="guihint">Event Console &gt; Events:</span></p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_open_events_hilites.png" alt="ec open events hilites"></div></div>
<div class="paragraph"><p>Die angezeigte Ansicht <span class="guihint">Events</span> können Sie genauso anpassen wie alle anderen.
Sie können die angezeigten Events filtern, Kommandos ausführen usw.
Einzelheiten erfahren Sie im Artikel über die <a href="views.html">Ansichten</a>.
Wenn Sie neue Event-Ansichten erstellen, stehen Ihnen Events sowie <a href="#archive">Event-Historie</a> als Datenquellen zur Verfügung.</p></div>
<div class="paragraph"><p>Ein Klick auf die ID des Events (hier z.B. <code>27</code>) bringt Sie zu dessen Details:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_event_details.png" alt="ec event details"></div></div>
<div class="paragraph"><p>Wie Sie sehen können, hat ein Event eine ganze Menge von Datenfeldern, deren Bedeutung wir in diesem Artikel nach und nach erklären werden.
Die wichtigsten Felder sollen trotzdem bereits hier kurz erwähnt werden:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Feld</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">State (severity) of event</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wie in der Einleitung erwähnt. wird jeder Event als <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> oder <span class="state3">UNKNOWN</span> eingestuft. Events vom Status <span class="state0">OK</span> sind eher ungewöhnlich. Denn die EC ist gerade dafür gedacht, nur die <em>Probleme</em> herauszufiltern. Es gibt aber Situationen, in denen ein <span class="state0">OK</span>-Event durchaus Sinn machen kann.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Text/Message of the event</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der eigentliche Inhalt des Events: Eine Textmeldung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Hostname</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Name des Hosts, der die Meldung gesendet hat. Dieser muss nicht unbedingt ein mit Checkmk aktiver überwachter Host sein. Falls ein Host dieses Namens jedoch im Monitoring existiert, stellt die EC automatisch eine <a href="#hostnames">Verknüpfung</a> her. In diesem Fall sind dann auch die Felder <span class="guihint">Host alias</span>, <span class="guihint">Host contacts</span> und <span class="guihint">Host icons</span> gefüllt und der Host erscheint in der gleichen Schreibweise wie im aktiven Monitoring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule-ID</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die ID der Regel, welche diesen Event erzeugt hat. Ein Klick auf diese ID bringt Sie direkt zu den Details der Regel. Übrigens bleibt die ID auch dann erhalten, wenn die Regel inzwischen nicht mehr existiert.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Wie eingangs erwähnt, werden Events direkt im <span class="guihint">Overview</span> der Seitenleiste angezeigt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/tactical_overview_events.png" alt="tactical overview events" width="400"></div></div>
<div class="paragraph"><p>Dabei sehen Sie drei Zahlen:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Events</span> — alle offenen und quittierten Events (entspricht der Ansicht <span class="guihint">Event Console &gt; Events</span>)</p></li>
<li><p><span class="guihint">Problems</span> — davon nur diejenigen mit dem Zustand <span class="state1">WARN</span> / <span class="state2">CRIT</span> / <span class="state3">UNKNOWN</span></p></li>
<li><p><span class="guihint">Unhandled</span> — davon wiederum nur die noch nicht quittierten (dazu gleich mehr)</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_commands">
<span class="hidden-anchor sr-only" id="commands"></span>4.2. Kommandos und Workflow von Events</h3>
<div class="paragraph"><p>Analog zu den Hosts und Services wird auch für Events ein einfacher Workflow abgebildet.
Wie gewohnt geschieht das über <a href="commands.html">Kommandos</a>, welche Sie im Menü <span class="guihint">Commands</span> finden.
Durch Einblenden und Auswahl mit Checkboxen können Sie ein Kommando auf vielen Events gleichzeitig ausführen.
Als Besonderheit gibt es das häufig gebrauchte <em>Archivieren</em> eines einzelnen Events direkt über das Symbol <span class="image-inline"><img src="../images/icons/icon_archive_event.png" alt="icon archive event"></span>.</p></div>
<div class="paragraph"><p>Für jedes der Kommandos gibt es eine <a href="#permissions">Berechtigung</a>, über die Sie steuern können, welcher Rolle das Ausführen des Kommandos erlaubt ist.
Per Default sind alle Kommandos für Mitglieder der Rollen <code>admin</code> und <code>user</code> freigeschaltet.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_commands_menu.png" alt="ec commands menu" width="550"></div></div>
<div class="paragraph"><p>Folgende Kommandos stehen zur Verfügung:</p></div>
<div class="sect3">
<h4 id="heading__aktualisieren_und_quittieren">
<span class="hidden-anchor sr-only" id="_aktualisieren_und_quittieren"></span>Aktualisieren und quittieren</h4>
<div class="paragraph"><p>Das Kommando <span class="guihint">Update &amp; Acknowledge</span> blendet den folgenden Bereich oberhalb der Event-Liste ein:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_commands.png" alt="ec commands" width="550"></div></div>
<div class="paragraph"><p>Mit dem Knopf <span class="guihint">Update</span> können Sie in einem einzigen Arbeitsschritt einen Kommentar an das Event hängen, eine Kontaktperson eintragen und das Event quittieren.
Das Feld <span class="guihint">Change contact</span> ist bewusst Freitext.
Hier können Sie auch Dinge wie Telefonnummern eintragen.
Das Feld hat insbesondere keinen Einfluss auf die Sichtbarkeit des Events in der GUI.
Es ist ein reines Kommentarfeld.</p></div>
<div class="paragraph"><p>Die Checkbox <span class="guihint">Set event to acknowledged</span> führt dazu, dass das Event von der Phase <span class="guihint">open</span> übergeht nach <span class="guihint">acknowledged</span> und fortan als <span class="guihint">handled</span> gilt.
Dies ist analog zu dem <a href="basics_ackn.html">Quittieren</a> von Host-und Service-Problemen.</p></div>
<div class="paragraph"><p>Ein späteres erneutes Aufrufen des Kommando mit nicht gesetzter Checkbox <em>entfernt</em> die Quittierung wieder.</p></div>
</div>
<div class="sect3">
<h4 id="heading__zustand_ändern">
<span class="hidden-anchor sr-only" id="_zustand_ändern"></span>Zustand ändern</h4>
<div class="paragraph"><p>Das Kommando <span class="guihint">Change State</span> erlaubt den manuellen Zustandswechsel von Events — z.b. von <span class="state2">CRIT</span> auf <span class="state1">WARN</span>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__aktionen_ausführen">
<span class="hidden-anchor sr-only" id="_aktionen_ausführen"></span>Aktionen ausführen</h4>
<div class="paragraph"><p>Mit dem Kommando <span class="guihint">Custom Action</span> können Sie auf Events frei definierbare <a href="#actions">Aktionen</a> ausführen lassen.
Zunächst ist nur die Aktion <span class="guihint">Send monitoring notification</span> verfügbar.
Diese sendet eine Checkmk Benachrichtigung, die genauso behandelt wird wie die von einem aktiv überwachten Service.
Diese durchläuft die <a href="notifications.html#rules">Benachrichtigungsregeln</a> und führt dann entsprechend zu E-Mails, SMS oder was auch immer Sie konfiguriert haben.
Einzelheiten zur Benachrichtigung durch die EC erfahren Sie <a href="#notifications">weiter unten</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__archivieren">
<span class="hidden-anchor sr-only" id="_archivieren"></span>Archivieren</h4>
<div class="paragraph"><p>Das Kommando <span class="guihint">Archive Event</span> löscht das Event endgültig aus der Liste der offenen Events.
Da alle Aktionen auf Events — inklusive dieses Löschvorgangs — auch im <a href="#archive">Archiv</a> aufgezeichnet werden, können Sie später immer noch auf alle Informationen des Events zugreifen.
Deswegen sprechen wir nicht von Löschen, sondern von Archivieren.</p></div>
<div class="paragraph"><p>Das Archivieren von einzelnen Events erreichen Sie auch aus der Event-Liste bequem über das Symbol <span class="image-inline"><img src="../images/icons/icon_archive_event.png" alt="icon archive event"></span>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_visibility">
<span class="hidden-anchor sr-only" id="visibility"></span>4.3. Sichtbarkeit von Events</h3>
<div class="sect3">
<h4 id="heading__problematik_der_sichtbarkeit">
<span class="hidden-anchor sr-only" id="_problematik_der_sichtbarkeit"></span>Problematik der Sichtbarkeit</h4>
<div class="paragraph"><p>Für die Sichtbarkeit von Hosts und Services im Monitoring für normale Benutzer werden von Checkmk <a href="wato_user.html#contact_groups">Kontaktgruppen</a> verwendet.
Diese werden per Setup-GUI, Regel oder Ordnerkonfiguration den Hosts und Service zugeordnet.</p></div>
<div class="paragraph"><p>Nun ist es aber bei der Event Console so, dass so eine Zuordnung von Events zu Kontaktgruppen erst einmal nicht existiert.
Denn im Vorhinein ist gar nicht bekannt, welche Meldungen überhaupt empfangen werden können.
Nicht einmal die Liste der Hosts ist bekannt, denn die Sockets für Syslog und SNMP sind ja von überall aus erreichbar.
Deswegen gibt es bei der Sichtbarkeit in der Event Console ein paar Besonderheiten.</p></div>
</div>
<div class="sect3">
<h4 id="heading__erst_einmal_dürfen_alle_alles_sehen">
<span class="hidden-anchor sr-only" id="_erst_einmal_dürfen_alle_alles_sehen"></span>Erst einmal dürfen alle alles sehen</h4>
<div class="paragraph"><p>Zunächst einmal gibt es bei der Konfiguration der <a href="wato_user.html#roles">Benutzerrollen</a> die Berechtigung <span class="guihint">Event Console &gt; See all events</span>.
Diese ist per Default an, so dass <strong>auch normale Benutzer alle Events sehen dürfen!</strong>
Dies ist bewusst so eingestellt, damit nicht aufgrund fehlerhafter Konfiguration wichtige Fehlermeldungen unter den Tisch fallen.
Der erste Schritt zu einer genaueren Steuerung der Sichtbarkeit ist also das Entfernen dieser Berechtigung aus der Rolle <code>user</code>.</p></div>
</div>
<div class="sect3">
<h4 id="heading_hostmatching">
<span class="hidden-anchor sr-only" id="hostmatching"></span>Zuordnung zu Hosts</h4>
<div class="paragraph"><p>Damit die Sichtbarkeit von Events möglichst konsistent mit dem übrigen Monitoring ist, versucht die Event Console so gut wie möglich die Hosts, von denen sie Events empfängt, ihren per Setup-GUI konfigurierten Hosts zuzuordnen.
Was einfach klingt ist trickreich im Detail.
Denn teils fehlt im Event eine Angabe zum Host-Namen und nur die IP-Adresse ist bekannt.
In anderen Fällen hat der Host-Name eine andere Schreibweise als in der Setup-GUI.</p></div>
<div class="paragraph"><p>Die Zuordnung erfolgt konkret wie folgt:</p></div>
<div class="ulist"><ul>
<li><p>Ist im Event kein Host-Name bekannt, so wird anstelle dessen seine IP-Adresse als Host-Name verwendet.</p></li>
<li><p>Der Host-Name im Event wird dann <em>ohne Berücksichtigung von Groß-/Kleinschreibung</em> mit allen Host-Namen, Host-Aliassen und IP-Adressen der Hosts aus dem Monitoring verglichen.</p></li>
<li><p>Wird so ein Host gefunden, werden dessen Kontaktgruppen für den Event übernommen, und darüber wird dann die Sichtbarkeit gesteuert.</p></li>
<li><p>Wird der Host jedoch <strong>nicht</strong> gefunden, so werden die Kontaktgruppen — falls <a href="#contactgroups">dort konfiguriert</a> — aus der Regel übernommen, welche den Event erzeugt hat.</p></li>
<li><p>Sind auch dort keine Gruppen hinterlegt, so darf der Benutzer den Event nur dann sehen, wenn er die Berechtigung <span class="guihint">Event Console &gt; See events not related to a known host</span> hat.</p></li>
</ul></div>
<div class="paragraph"><p>Sie können die Zuordnung an einer Stelle beeinflussen:
Falls nämlich in der Regel Kontaktgruppen definiert sind <strong>und</strong> der Host zugeordnet werden konnte, hat normalerweise die Zuordnung Vorrang.
Dies können Sie in einer Regel mit der Option <span class="guihint">Precedence of contact groups</span> umstellen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_outcome_contact_groups.png" alt="ec outcome contact groups"></div></div>
<div class="paragraph"><p>Zudem können Sie direkt in der Regel Einstellungen für die Benachrichtigung vornehmen.
Dies ermöglicht es, die Art des Events gegenüber den regulären Zuständigkeiten für einen Host zu priorisieren.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__fehlersuche">
<span class="hidden-anchor sr-only" id="_fehlersuche"></span>4.4. Fehlersuche</h3>
<div class="sect3">
<h4 id="heading__welche_regel_greift_wie_oft">
<span class="hidden-anchor sr-only" id="_welche_regel_greift_wie_oft"></span>Welche Regel greift wie oft?</h4>
<div class="paragraph"><p>Sowohl bei den Regelpaketen  …​</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_pack_hits.png" alt="ec pack hits"></div></div>
<div class="paragraph"><p>…  als auch bei den einzelnen Regeln  …​</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_hits.png" alt="ec rule hits"></div></div>
<div class="paragraph"><p>… finden Sie in der Spalte <span class="guihint">Hits</span> die Angabe, wie oft das Paket bzw. die Regel schon auf eine Meldung gepasst hat.
Dies hilft Ihnen zum einen dabei, unwirksame Regeln zu eliminieren oder zu reparieren.
Aber auch bei Regeln, die sehr oft matchen, kann dies interessant sein.
Für die optimale Performance der EC sollten diese möglichst am Anfang der Regelkette stehen.
So können Sie die Anzahl von Regeln reduzieren, die die EC bei jeder Meldung ausprobieren muss.</p></div>
<div class="paragraph"><p>Die Zählerstände können Sie jederzeit mit dem Menüpunkt <span class="guihint">Event Console &gt; Reset counters</span>  zurücksetzen.</p></div>
</div>
<div class="sect3">
<h4 id="heading__regelauswertung_debuggen">
<span class="hidden-anchor sr-only" id="_regelauswertung_debuggen"></span>Regelauswertung debuggen</h4>
<div class="paragraph"><p>Beim <a href="#eventsimulator">Ausprobieren einer Regel</a> haben Sie schon gesehen, wie Sie mit dem <span class="guihint">Event Simulator</span> die Auswertungen Ihrer Regeln prüfen können.
Ähnliche Informationen bekommen Sie zur Laufzeit für <em>alle</em> Meldungen, wenn Sie in den <a href="#globalsettings">Einstellungen der Event Console</a> den Wert von <span class="guihint">Debug rule execution</span> auf <span class="guihint">on</span> umstellen.</p></div>
<div class="paragraph"><p>Die Log-Datei der Event Console finden Sie unter <code>var/log/mkeventd.log</code>.
Für jede Regel, die geprüft wird, aber nicht greift, erfahren Sie den genauen Grund:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1481020022.001612] Processing message from ('10.40.21.11', 57123): '&lt;22&gt;Dec  6 11:27:02 myserver123 exim[1468]: Delivery complete, 4 message(s) remain.'
[1481020022.001664] Parsed message:
 application:    exim
 facility:       2
 host:           myserver123
 ipaddress:      10.40.21.11
 pid:            1468
 priority:       6
 text:           Delivery complete, 4 message(s) remain.
 time:           1481020022.0
[1481020022.001679] Trying rule test/myrule01...
[1481020022.001688]   Text:   Delivery complete, 4 message(s) remain.
[1481020022.001698]   Syslog: 2.6
[1481020022.001705]   Host:   myserver123
[1481020022.001725]   did not match because of wrong application 'exim' (need 'security')
[1481020022.001733] Trying rule test/myrule02n...
[1481020022.001739]   Text:   Delivery complete, 4 message(s) remain.
[1481020022.001746]   Syslog: 2.6
[1481020022.001751]   Host:   myserver123
[1481020022.001764]   did not match because of wrong text</code></pre></div>
</div>
<div class="paragraph"><p>Es versteht sich wohl von selbst, dass Sie dieses intensive Logging nur bei Bedarf und mit Bedacht verwenden sollten.
Bei einer nur etwas komplexeren Umgebung werden <em>Unmengen</em> von Daten erzeugt!</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_rules">
<span class="hidden-anchor sr-only" id="rules"></span>5. Die ganze Mächtigkeit der Regeln</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__die_bedingung">
<span class="hidden-anchor sr-only" id="_die_bedingung"></span>5.1. Die Bedingung</h3>
<div class="paragraph"><p>Der wichtigste Teil einer EC-Regel ist die <em>Bedingung</em> (<span class="guihint">Matching Criteria</span>).
Nur wenn eine Meldung alle in der Regel hinterlegten Bedingungen erfüllt, werden die in der Regel definierten Aktionen ausgeführt und die Auswertung der Meldung damit abgeschlossen.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_matching_criteria.png" alt="ec matching criteria"></div></div>
<div class="sect3">
<h4 id="heading__allgemeines_zu_textvergleichen">
<span class="hidden-anchor sr-only" id="_allgemeines_zu_textvergleichen"></span>Allgemeines zu Textvergleichen</h4>
<div class="paragraph"><p>Bei allen Bedingungen, die Textfelder betreffen, wird der Vergleichstext grundsätzlich als <a href="regexes.html">regulärer Ausdruck</a> behandelt.
Der Vergleich findet hier immer <em>ohne Unterscheidung von Groß-/Kleinschreibung</em> statt.
Letzteres ist eine Ausnahme von Checkmk Konventionen in anderen Modulen.
Es macht aber das Formulieren der Regeln robuster.
Auch sind gerade Host-Namen in Events nicht unbedingt konsistent in ihrer Schreibweise, falls diese nicht zentral, sondern auf jedem Host selbst konfiguriert werden.
Daher ist diese Ausnahme hier sehr sinnvoll.</p></div>
<div class="paragraph"><p>Ferner gilt immer ein <em>Infix-Match</em> — also eine Überprüfung auf ein <em>Enthaltensein</em> des Suchtextes.
Ein <code>.*</code> am Anfang oder am Ende des Suchtexts können Sie sich also sparen.</p></div>
<div class="paragraph"><p>Davon gibt es allerdings eine <strong>Ausnahme:</strong>
Wird beim Match auf den Host-Namen <strong>kein regulärer Ausdruck</strong> verwendet, sondern ein <strong>fester Host-Name,</strong> so wird dieser auf <strong>exaktes</strong> Übereinstimmen geprüft und <strong>nicht</strong> auf ein Enthaltensein.</p></div>
<div class="paragraph"><p><strong>Achtung:</strong> Sobald der Suchtext einen Punkt enthält, wird dieser als regulärer Ausdruck gewertet und es gilt die Infix-Suche.
<code>myhost.de</code> matcht dann auch z.B. auf <code>notmyhostide</code>!</p></div>
</div>
<div class="sect3">
<h4 id="heading_matchgroups">
<span class="hidden-anchor sr-only" id="matchgroups"></span>Match-Gruppen</h4>
<div class="paragraph"><p>Sehr wichtig und nützlich ist hier das Konzept <a href="regexes.html#matchgroups">Match-Gruppen</a> beim Feld <span class="guihint">Text to match</span>.
Damit sind die Textabschnitte gemeint, die beim Matchen mit geklammerten Ausdrücken im regulären Ausdruck übereinstimmen.</p></div>
<div class="paragraph"><p>Nehmen Sie an, Sie möchten folgende Art von Meldung in der Log-Datei einer Datenbank überwachen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>Database instance WP41 has failed</code></pre></div></div>
<div class="paragraph"><p>Das <code>WP41</code> ist dabei natürlich variabel und Sie möchten sicher nicht für jede unterschiedliche Instanz ein eigene Regel formulieren.
Daher verwenden Sie im regulären Ausdruck <code>.*</code>, was für eine beliebige Zeichenfolge steht:</p></div>
<div class="paragraph"><p><code>Database instance .* has failed</code></p></div>
<div class="paragraph"><p>Wenn Sie jetzt den variablen Teil in runde Klammern setzen, wird sich die Event Console den tatsächlichen Wert beim Matchen für weitere Aktionen <strong>merken</strong> (<em>capturing</em>):</p></div>
<div class="paragraph"><p><code>Database instance <strong>(.*)</strong> has failed</code></p></div>
<div class="paragraph"><p>Nach einem erfolgreichen Match der Regel ist jetzt die erste Match-Gruppe auf den Wert <code>WP41</code> gesetzt (oder welche Instanz auch immer den Fehler produziert hat).</p></div>
<div class="paragraph"><p>Diese Match-Gruppen können Sie im <span class="guihint">Event Simulator</span> sehen, wenn Sie mit der Maus über die grüne Kugel fahren:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_match_groups_1.png" alt="ec match groups 1"></div></div>
<div class="paragraph"><p>Auch in den Details des erzeugten Events können Sie die Gruppen sehen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_match_groups_2.png" alt="ec match groups 2" width="700"></div></div>
<div class="paragraph"><p>Die Match-Gruppen finden unter anderem Anwendung bei:</p></div>
<div class="ulist"><ul>
<li><p>Umschreiben von Events (<a href="#rewriting">Rewriting</a>)</p></li>
<li><p>Automatisches Aufheben von Events (<a href="#cancelling">Cancelling</a>)</p></li>
<li><p>Zählen von Meldungen (<a href="#counting">Counting</a>)</p></li>
</ul></div>
<div class="paragraph"><p>An dieser Stelle noch ein Tipp:
Es gibt Situationen, in denen Sie im regulären Ausdruck etwas gruppieren müssen, aber <strong>keine</strong> Match-Gruppe erzeugen möchten.
Dies können Sie durch ein <code>?:</code> direkt nach der öffnenden Klammer erreichen.
Beispiel: Der Ausdruck <code>one (.*) two (?:.*) three</code> erzeugt bei einem Match auf <code>one 123 two 456 three</code> nur die eine Match-Gruppe <code>123</code>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__ip_adresse">
<span class="hidden-anchor sr-only" id="_ip_adresse"></span>IP-Adresse</h4>
<div class="paragraph"><p>Im Feld <span class="guihint">Match original source IP address</span> können Sie auf die IPv4-Adresse des Senders der Meldung matchen.
Geben Sie entweder eine exakte Adresse an oder ein Netzwerk in der Notation X.X.X.X/Y, also z.B. <code>192.168.8.0/24</code>, um alle Adressen im Netzwerk <code>192.168.8.</code>X zu matchen.</p></div>
<div class="paragraph"><p>Beachten Sie, dass der Match auf die IP-Adresse nur dann funktioniert, wenn die überwachten Systeme direkt an die Event Console senden.
Ist noch ein anderer Syslog-Server dazwischen geschaltet, der die Meldungen weiterleitet, wird stattdessen dessen Adresse als Absender in der Meldung erscheinen.</p></div>
</div>
<div class="sect3">
<h4 id="heading_syslogfacility">
<span class="hidden-anchor sr-only" id="syslogfacility"></span>Syslog-Priorität und -Facility</h4>
<div class="paragraph"><p>Die Felder <span class="guihint">Match syslog priority</span> und <span class="guihint">Match syslog facility</span> sind ursprünglich von Syslog definierte, standardisierte Informationen.
Intern wird dabei ein 8-Bit-Feld in 5 Bits für die Facility (ergibt 32 Möglichkeiten) und 3 Bits für die Priorität (8 Möglichkeiten) aufgeteilt.</p></div>
<div class="paragraph"><p>Die 32 vordefinierten Facilities waren mal für so etwas wie eine Anwendung gedacht.
Nur ist die Auswahl damals nicht sehr zukunftsweisend gemacht worden.
Eine der Facilities ist z.B. <code>uucp</code> — ein Protokoll das schon in den 90er Jahren des vergangenen Jahrtausends kaum noch verwendet wurde.</p></div>
<div class="paragraph"><p>Fakt ist aber, dass jede Meldung, die per Syslog kommt, eine der Facilities trägt.
Teilweise können Sie diese beim Senden auch frei vergeben, um später darauf gezielt zu filtern.
Das ist durchaus nützlich.</p></div>
<div class="paragraph"><p>Die Verwendung von Facility und Priorität hat auch einen Performance-Aspekt.
Wenn Sie eine Regel definieren, die sowieso nur auf Meldungen greift, die alle die gleiche Facility oder Priorität haben, sollten Sie diese zusätzlich in den Filtern der Regel setzen.
Die Event Console kann diese Regeln dann sehr effizient sofort umgehen, wenn eine Meldung mit abweichenden Werten eingeht.
Je mehr Regeln diese Filter gesetzt haben, desto weniger Regelvergleiche werden benötigt.</p></div>
</div>
<div class="sect3">
<h4 id="heading__invertieren_des_matches">
<span class="hidden-anchor sr-only" id="_invertieren_des_matches"></span>Invertieren des Matches</h4>
<div class="paragraph"><p>Die Checkbox <span class="guihint">Negate match: Execute this rule if the upper conditions are not fulfilled.</span> führt dazu, dass die Regel genau dann greift, wenn die Bedingungen <em>nicht</em> alle erfüllt sind.
Dies ist eigentlich nur nützlich im Zusammenhang mit zwei Regelarten (<span class="guihint">Rule type</span> im Kasten <span class="guihint">Outcome &amp; Action</span> der Regel):</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Do not perform any action, drop this message, stop processing</span></p></li>
<li><p><span class="guihint">Skip this rule pack, continue rule execution with next pack</span></p></li>
</ul></div>
<div class="paragraph"><p>Zu den Regelpaketen erfahren Sie <a href="#rulepacks">weiter unten</a> mehr.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_outcome">
<span class="hidden-anchor sr-only" id="outcome"></span>5.2. Auswirkung der Regel</h3>
<div class="sect3">
<h4 id="heading__regeltyp_abbrechen_oder_event_erzeugen">
<span class="hidden-anchor sr-only" id="_regeltyp_abbrechen_oder_event_erzeugen"></span>Regeltyp: Abbrechen oder Event erzeugen</h4>
<div class="paragraph"><p>Wenn eine Regel matcht, legt sie fest, was mit der Meldung geschehen soll.
Das geschieht im Kasten <span class="guihint">Outcome &amp; Action</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_outcome.png" alt="ec outcome"></div></div>
<div class="paragraph"><p>Mit dem <span class="guihint">Rule type</span> kann die Auswertung an der Stelle ganz oder für das aktuelle Regelpaket abgebrochen werden.
Gerade die erste Möglichkeit sollten Sie nutzen, um den größten Teil des nutzlosen „Rauschens“ durch ein paar gezielte Regeln ganz am Anfang loszuwerden.
Nur bei den „normalen“ Regeln werden die anderen Optionen in diesem Kasten überhaupt ausgewertet.</p></div>
</div>
<div class="sect3">
<h4 id="heading__festlegen_des_status">
<span class="hidden-anchor sr-only" id="_festlegen_des_status"></span>Festlegen des Status</h4>
<div class="paragraph"><p>Mit <span class="guihint">State</span> legt die Regel den Monitoring-Status des Events fest.
In der Regel wird diese <span class="state1">WARN</span> oder <span class="state2">CRIT</span> sein.
Regeln, die <span class="state0">OK</span>-Events erzeugen, können in Ausnahmen interessant sein, um bestimmte Ereignisse rein informativ darzustellen.
Hier ist dann eine Kombination mit einem automatischen <a href="#timing">Herausaltern</a> dieser Events interessant.</p></div>
<div class="paragraph"><p>Neben dem Festlegen eines expliziten Status gibt es noch zwei dynamischere Möglichkeiten.
Die Einstellung <span class="guihint">(set by syslog)</span> übernimmt die Einstufung anhand der Syslog-Priorität.
Dies funktioniert allerdings nur, wenn die Meldung bereits vom Absender nutzbar klassifiziert wurde.
Meldungen, die direkt per Syslog empfangen wurden, enthalten eine von acht per RFC festgelegten Prioritäten, die wie folgt abgebildet werden:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 55%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Priorität</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Zustand</th>
<th class="tableblock halign-left valign-top">Definition laut Syslog</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emerg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das System ist unbrauchbar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sofortige Aktion erforderlich</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kritischer Zustand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">err</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state2">CRIT</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fehler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">warning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state1">WARN</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warnung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal, aber signifikante Information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reine Information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="state0">OK</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug-Meldung</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Neben Syslog-Meldungen bieten auch Meldungen aus dem Windows Event Log und Meldungen aus Textdateien, die bereits mit dem Checkmk Plugin <a href="#logwatch">Logwatch</a> auf dem Zielsystem klassifiziert wurden, vorbereitete Zustände.
Bei SNMP-Traps gibt es diese leider nicht.</p></div>
<div class="paragraph"><p>Eine ganze andere Methode ist, die Einstufung der Meldung anhand des Texts selbst zu machen.
Dies geht mit der Einstellung <span class="guihint">(set by message text)</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_state_by_text.png" alt="ec state by text"></div></div>
<div class="paragraph"><p>Der Match auf die hier konfigurierten Texte geschieht erst, nachdem auf <span class="guihint">Text to match</span> und auf die anderen Regelbedingungen geprüft wurde.
Diese müssen Sie also hier nicht wiederholen.</p></div>
<div class="paragraph"><p>Falls keines der konfigurierten Patterns gefunden wird, nimmt das Event den Zustand <span class="state3">UNKNOWN</span> an.</p></div>
</div>
<div class="sect3">
<h4 id="heading_servicelevel">
<span class="hidden-anchor sr-only" id="servicelevel"></span>Service-Level</h4>
<div class="paragraph"><p>Hinter dem Feld <span class="guihint">Service Level</span> steckt die Idee, dass jeder Host und jeder Service im Unternehmen eine bestimmte Wichtigkeit hat.
Damit kann eine konkrete Service-Vereinbarung verbunden sein.
In Checkmk können Sie per <a href="glossar.html#rule">Regeln</a> Ihren Hosts und Services solche Level zuordnen und dann z.B. die Benachrichtigung oder selbstdefinierte Dashboards davon abhängig machen.</p></div>
<div class="paragraph"><p>Da Events erst einmal nicht unbedingt mit Hosts oder Services korrelieren, erlaubt die Event Console, dass Sie einem Event per Regel ebenfalls einen Service-Level zuordnen.
Sie können die Event-Ansichten dann später nach diesem Level filtern.</p></div>
<div class="paragraph"><p>Ab Werk definiert Checkmk die vier Level 0 (kein Level), 10 (Silber), 20 (Gold) und 30 (Platin).
Diese Auswahl können Sie in den <span class="guihint">Global settings &gt; Notifications &gt; Service Levels</span> beliebig anpassen.
Entscheidend sind hierbei die Zahlen der Levels, dann nach diesen werden sie sortiert und auch nach der Wichtigkeit verglichen.</p></div>
</div>
<div class="sect3">
<h4 id="heading_contactgroups">
<span class="hidden-anchor sr-only" id="contactgroups"></span>Kontaktgruppen</h4>
<div class="paragraph"><p>Die Kontaktgruppen für die <a href="#visibility">Sichtbarkeit</a> werden auch bei der <a href="#notifications">Benachrichtigung</a> von Events verwendet.
Sie können hier per Regel Events explizit Kontaktgruppen zuordnen.
Einzelheiten erfahren Sie im <a href="#visibility">Kapitel über das Monitoring</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__aktionen">
<span class="hidden-anchor sr-only" id="_aktionen"></span>Aktionen</h4>
<div class="paragraph"><p>Aktionen sind den <a href="alert_handlers.html">Alert Handlern</a> für Hosts und Services sehr ähnlich.
Hier können Sie beim Öffnen eines Events ein selbst definiertes Skript ausführen lassen.
Alle Einzelheiten zu den Aktionen erfahren Sie weiter unten in einem eigenen <a href="#actions">Abschnitt</a>.</p></div>
</div>
<div class="sect3">
<h4 id="heading__automatisches_löschen_archivieren">
<span class="hidden-anchor sr-only" id="_automatisches_löschen_archivieren"></span>Automatisches Löschen (Archivieren)</h4>
<div class="paragraph"><p>Das automatische Löschen (= Archivieren), welches Sie mit <span class="guihint">Delete event immediately after the actions</span> einstellen können, sorgt letztlich dafür, dass ein Event im Monitoring überhaupt nicht sichtbar wird.
Das ist dann sinnvoll, wenn Sie lediglich automatisch Aktionen auslösen oder nur bestimmte Events archivieren möchten, damit Sie später danach recherchieren können.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_rewriting">
<span class="hidden-anchor sr-only" id="rewriting"></span>5.3. Automatisches Umschreiben von Texten (Rewriting)</h3>
<div class="paragraph"><p>Mit dem <span class="guihint">Rewriting</span> kann eine EC-Regel Textfelder in der Meldung automatisch umschreiben und Anmerkungen anfügen.
Dies wird in einem eigenen Kasten konfiguriert:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rewriting.png" alt="ec rewriting"></div></div>
<div class="paragraph"><p>Beim Umschreiben sind die <a href="#matchgroups">Match-Gruppen</a> besonders wichtig.
Denn Sie erlauben es, Teile der Originalmeldung gezielt in den neuen Text einzubauen.
Sie können bei den Ersetzungen auf die Gruppen wie folgt zugreifen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wird durch die <em>erste</em> Match-Gruppe der Originalmeldung ersetzt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wird durch die <em>zweite</em> Match-Gruppe der Originalmeldung ersetzt (usw.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wird durch die <em>komplette</em> Originalmeldung ersetzt.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>In obigem Screenshot wird der neue Meldungstext auf <code>Instance \1 has been shut down.</code> gesetzt.
Das klappt natürlich nur, wenn beim <span class="guihint">Text to match</span> in der <strong>gleichen</strong> Regel der reguläre Suchausdruck auch mindestens einen Klammerausdruck hat.
Ein Beispiel dafür wäre z.B.:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rewrite_match.png" alt="ec rewrite match"></div></div>
<div class="paragraph"><p>Einige weitere Hinweise zum Umschreiben:</p></div>
<div class="ulist"><ul>
<li><p>Das Umschreiben geschieht <em>nach</em> dem Matchen und <em>vor</em> dem Ausführen von Aktionen.</p></li>
<li><p>Match, Umschreiben und Aktionen geschehen immer in der gleichen Regel. Es ist nicht möglich, eine Meldung umzuschreiben, um sie dann mit einer späteren Regel zu bearbeiten.</p></li>
<li><p>Die Ausdrücke <code>\1</code>, <code>\2</code> usw. können in allen Textfeldern verwendet werden, nicht nur im <span class="guihint">Rewrite message text</span>.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_cancelling">
<span class="hidden-anchor sr-only" id="cancelling"></span>5.4. Automatisches Aufheben von Events (Cancelling)</h3>
<div class="paragraph"><p>Manche Anwendungen oder Geräte sind so nett, nach einer Störmeldung später eine passende OK-Meldung zu senden, sobald das Problem wieder behoben ist.
Sie können die EC so konfigurieren, dass in so einem Fall das durch die Störung geöffnete Event automatisch wieder geschlossen wird.
Dies nennt man <em>Aufheben</em> (<em>cancelling</em>).</p></div>
<div class="paragraph"><p>Folgende Abbildung zeigt eine Regel, in der nach Meldungen mit dem Text <code>database instance (.*) has failed</code> gesucht wird.
Der Ausdruck <code>(.*)</code> steht für eine beliebige Zeichenfolge, die in einer <a href="#matchgroups">Match-Gruppe</a> eingefangen wird.
Der Ausdruck <code>database instance (.*) recovery in progress</code>, welcher im Feld <span class="guihint">Text to cancel event(s)</span> in der gleichen Regel eingetragen ist, sorgt für ein automatisches Schließen von mit dieser Regel erzeugten Events, wenn eine passende Meldung eingeht:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_cancelling.png" alt="ec cancelling"></div></div>
<div class="paragraph"><p>Das automatische Aufheben funktioniert genau dann, wenn</p></div>
<div class="ulist"><ul>
<li><p>eine Meldung eingeht, deren Text auf <span class="guihint">Text to cancel event(s)</span> passt,</p></li>
<li><p>der hier in der Gruppe <code>(.*)</code> eingefangene Wert <em>identisch</em> mit der Match-Gruppe aus der ursprünglichen Meldung ist,</p></li>
<li><p>beide Meldungen vom gleichen Host kamen und</p></li>
<li><p>es sich um die gleiche Anwendung handelt (Feld <span class="guihint">Syslog application to cancel event</span>).</p></li>
</ul></div>
<div class="paragraph"><p>Das Prinzip der Match-Gruppen ist hier sehr wichtig.
Denn es wäre schließlich wenig sinnvoll, wenn die Meldung <code>database instance TEST recovery in progress</code> ein Event aufheben würde, das von der Meldung <code>database instance PROD has failed</code> stammt, oder?</p></div>
<div class="paragraph"><p>Bitte machen Sie nicht den Fehler, in <span class="guihint">Text to cancel events(s)</span> den Platzhalter <code>\1</code> zu verwenden.
Das funktioniert <em>nicht</em>!
Diese Platzhalter funktionieren nur beim <a href="#rewriting">Rewriting</a>.</p></div>
<div class="paragraph"><p>In einigen Fällen kommt es vor, dass ein Text sowohl zur <em>Erzeugung</em> als auch zum <em>Aufheben</em> eines Events passt.
In diesem Fall erhält das Aufheben Priorität.</p></div>
<div class="sect3">
<h4 id="heading__ausführen_von_aktionen_beim_aufheben">
<span class="hidden-anchor sr-only" id="_ausführen_von_aktionen_beim_aufheben"></span>Ausführen von Aktionen beim Aufheben</h4>
<div class="paragraph"><p>Sie können beim Aufheben eines Events auch automatisch <a href="#automatic_actions">Aktionen</a> ausführen lassen.
Dazu ist es wichtig zu wissen, dass beim Aufheben etliche Datenfelder des Events von Werten der OK-Meldung überschrieben werden, bevor die Aktionen ausgeführt werden.
Auf diese Art sind im Aktionsskript dann die Daten der OK-Meldung vollständig verfügbar.
Auch ist während dieser Phase der Zustand des Events als <span class="state0">OK</span> eingetragen.
Auf diese Art kann ein Aktionsskript ein Aufheben erkennen und Sie können das gleiche Skript für Fehler und OK-Meldung verwenden (z.B. bei der Anbindung an ein Ticketsystem).</p></div>
<div class="paragraph"><p>Folgende Felder werden aus Daten der OK-Meldung überschrieben:</p></div>
<div class="ulist"><ul>
<li><p>Der Meldungstext</p></li>
<li><p>Der Zeitstempel</p></li>
<li><p>Die Zeit des letzten Auftretens</p></li>
<li><p>Die Syslog-Priorität</p></li>
</ul></div>
<div class="paragraph"><p>Alle anderen Felder bleiben unverändert — inklusive der Event-ID.</p></div>
</div>
<div class="sect3">
<h4 id="heading__aufheben_in_kombination_mit_umschreiben">
<span class="hidden-anchor sr-only" id="_aufheben_in_kombination_mit_umschreiben"></span>Aufheben in Kombination mit Umschreiben</h4>
<div class="paragraph"><p>Falls Sie in der gleichen Regel mit <a href="#rewriting">Umschreiben</a> und Aufheben arbeiten, so sollten Sie vorsichtig sein beim Umschreiben des Host-Namens oder der Application.
Beim Aufheben prüft die EC stets, ob die aufhebende Meldung zu Host-Name und Anwendung des offenen Events passt.
Wenn diese aber umgeschrieben wurden, würde das Aufheben nie funktionieren.</p></div>
<div class="paragraph"><p>Daher simuliert die Event Console vor dem Aufheben ein Umschreiben von Host-Name und Anwendung (<em>application</em>), um so die relevanten Texte zu vergleichen.
Das ist wahrscheinlich das, was Sie auch erwarten würden.</p></div>
<div class="paragraph"><p>Dieses Verhalten können Sie auch ausnutzen, wenn das Anwendungsfeld bei der Fehlermeldung und der späteren OK-Meldung nicht übereinstimmen.
Schreiben Sie in diesem Fall einfach das Anwendungsfeld in einen bekannten festen Wert um.
Das führt faktisch dazu, dass dieses Feld beim Aufheben ignoriert wird.</p></div>
</div>
<div class="sect3">
<h4 id="heading__aufheben_anhand_der_syslog_priorität">
<span class="hidden-anchor sr-only" id="_aufheben_anhand_der_syslog_priorität"></span>Aufheben anhand der Syslog-Priorität</h4>
<div class="paragraph"><p>Es gibt (leider) Fälle, in denen der Text der Fehler- und OK-Meldung absolut identisch ist.
Meist ist der eigentliche Status dann nicht im Text, sondern in der Syslog-Priorität kodiert.</p></div>
<div class="paragraph"><p>Dazu gibt es die Option <span class="guihint">Syslog priority to cancel event</span>.
Geben Sie hier z.B. den Bereich <code>debug</code> …​ <code>notice</code> an.
Alle Prioritäten in diesem Bereich werden normalerweise als OK-Status gewertet.
Bei Verwendung dieser Option sollten Sie <em>trotzdem</em> in das Feld <span class="guihint">Text to cancel event(s)</span> einen passenden Text eintragen.
Sonst wird die Regel auf alle OK-Meldungen matchen, welche die gleiche Anwendung betreffen.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_counting">
<span class="hidden-anchor sr-only" id="counting"></span>5.5. Zählen von Meldungen</h3>
<div class="paragraph"><p>Im Kasten <span class="guihint">Counting &amp; Timing</span> finden Sie Optionen zum Zählen von gleichartigen Meldungen.
Die Idee ist, dass manche Meldungen erst dann relevant sind, wenn Sie in bestimmten Zeiträumen <em>zu häufig</em> oder <em>zu selten</em> auftreten.</p></div>
<div class="sect3">
<h4 id="heading__zu_häufige_meldungen">
<span class="hidden-anchor sr-only" id="_zu_häufige_meldungen"></span>Zu häufige Meldungen</h4>
<div class="paragraph"><p>Das Prüfen auf zu oft auftretende Meldungen aktivieren Sie mit der Option <span class="guihint">Count messages in interval</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_counting.png" alt="ec counting"></div></div>
<div class="paragraph"><p>Hier geben Sie zunächst einen Zeitraum bei <span class="guihint">Time period for counting</span> und eine Anzahl von Meldungen bei <span class="guihint">Count until triggered</span> vor, die zum Öffnen eines Events führen sollen.
Im Beispiel in der Abbildung ist das auf 10 Meldungen pro Stunde eingestellt.
Natürlich handelt es sich dabei nicht um 10 beliebige Meldungen, sondern um solche, die von der Regel gematcht werden.</p></div>
<div class="paragraph"><p>Normalerweise ist es hier aber sinnvoll, nicht einfach global alle passenden Meldungen zu zählen, sondern nur diejenigen, die sich auf die gleiche „Ursache“ beziehen.
Um das zu steuern, gibt es die drei Checkboxen mit dem Titel <span class="guihint">Force separate events for different …​</span>.
Diese sind so voreingestellt, dass Meldungen nur dann zusammengezählt werden, wenn sie übereinstimmen in:</p></div>
<div class="ulist"><ul>
<li><p>Host</p></li>
<li><p>Anwendung</p></li>
<li><p><a href="#matchgroups">Match-Gruppen</a></p></li>
</ul></div>
<div class="paragraph"><p>Damit können Sie Regeln formulieren wie „Wenn vom gleichen Host, der gleichen Anwendung und dort der gleichen Instanz mehr als 10 Meldungen pro Stunde kommen, dann…​“.
Dadurch kann es dann auch sein, dass aufgrund der Regel mehrere unterschiedliche Events erzeugt werden.</p></div>
<div class="paragraph"><p>Wählen Sie z.B. alle drei Checkboxen ab, so wird nur noch global gezählt und die Regel kann auch nur insgesamt ein einziges Event generieren!</p></div>
<div class="paragraph"><p>Es kann übrigens durchaus sinnvoll sein, als Anzahl eine 1 einzutragen.
Damit können Sie „Event-Stürme“ effektiv in den Griff bekommen.
Kommen z.B. in kurzer Zeit 100 Meldungen der gleichen Art, so wird dafür dann trotzdem nur ein einziges Event erzeugt.
Sie sehen dann in den Event-Details</p></div>
<div class="ulist"><ul>
<li><p>den Zeitpunkt des Auftretens der ersten Meldung,</p></li>
<li><p>den Zeitpunkt der jüngsten Meldung und</p></li>
<li><p>die Gesamtzahl an Meldungen, die in diesem Event zusammengefasst sind.</p></li>
</ul></div>
<div class="paragraph"><p>Wann der Fall dann „abgeschlossen“ ist und bei erneuten Meldungen wieder ein neues Event aufgemacht werden soll, legen Sie über zwei Checkboxen fest.
Normalerweise führt eine Quittierung des Events dazu, dass bei weiteren Meldungen eine neue Zählung mit einem neuen Event angefangen wird.
Das können Sie mit <span class="guihint">Continue counting when event is acknowledged</span> abschalten.</p></div>
<div class="paragraph"><p>Die Option <span class="guihint">Discontinue counting after time has elapsed</span> sorgt dafür, dass für jeden Vergleichszeitraum immer ein separates Event geöffnet wird.
In obigem Beispiel war eine Schwelle von 10 Meldungen pro Stunde eingestellt.
Ist diese Option aktiviert, so werden auf ein bereits geöffnetes Event maximal 10 Meldungen einer Stunde aufgerechnet.
Sobald die Stunde abgelaufen ist, wird (bei ausreichender Zahl von Meldungen) wieder ein neues Event geöffnet.</p></div>
<div class="paragraph"><p>Setzen Sie z.B. die Anzahl auf 1 und das Zeitintervall auf einen Tag, so werden Sie pro Tag von diesem Meldungstyp nur noch maximal ein Event sehen.</p></div>
<div class="paragraph"><p>Die Einstellung <span class="guihint">Algorithm</span> ist auf den ersten Blick vielleicht etwas überraschend.
Aber mal ehrlich:
Was meint man eigentlich mit „10 Meldungen pro Stunde“?
Welche Stunde ist damit gemeint?
Immer volle Stunden der Tageszeit?
Dann könnte es sein, dass in der letzten Minute einer Stunde neun Meldungen kommen und in der ersten Minute der nächsten nochmal neun.
Macht insgesamt 18 Meldungen in zwei Minuten.
Aber trotzdem weniger als 10 pro Stunde und die Regel würde nicht greifen.
Das klingt nicht so sinnvoll  …​</p></div>
<div class="paragraph"><p>Weil es dazu nicht nur eine einzige Lösung gibt, bietet Checkmk drei verschiedene Definitionen an, was denn „10 Meldungen pro Stunde“ genau bedeuten soll:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Algorithmus</th>
<th class="tableblock halign-left valign-top">Funktionsweise</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Interval</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Zählintervall startet bei der ersten eingehenden passenden Meldung. Ein Event in der Phase <span class="guihint">counting</span> wird erzeugt. Vergeht nun die eingestellte Zeit, bevor die Anzahl erreicht wird, wird das Event stillschweigend gelöscht. Wird die Anzahl aber schon vor Ablauf der Zeit erreicht, wird das Event <em>sofort</em> geöffnet (und eventuell konfigurierte Aktionen ausgelöst).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Token Bucket</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dieser Algorithmus arbeitet nicht mit festen Zeitintervallen, sondern implementiert ein Verfahren, das bei Netzwerken oft zum Trafficshaping eingesetzt wird. Angenommen, Sie haben 10 Meldungen pro Stunde konfiguriert. Das sind im Schnitt eine alle 6 Minuten. Wenn zum ersten Mal eine passende Meldung eingeht, wird ein Event in der Phase <span class="guihint">counting</span> erzeugt und die Anzahl auf 1 gesetzt. Bei jeder weiteren Meldung wird diese um 1 erhöht. Und alle 6 Minuten wird der Zähler wieder um 1 <em>verringert</em> — egal, ob eine Meldung gekommen ist oder nicht. Fällt der Zähler wieder auf 0, wird das Event gelöscht. Der Trigger wird also dann ausgelöst, wenn die Rate der Meldungen <em>im Schnitt</em> dauerhaft über 10 pro Stunde liegt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Dynamic Token Bucket</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dies ist eine Variante des <span class="guihint">Token Bucket</span>-Algorithmus, bei der der Zähler umso langsamer verringert wird, je kleiner er gerade ist. In obigem Beispiel würde der Zähler bei Stand von 5 nur alle <em>12</em> statt alle 6 Minuten verringert. Das führt insgesamt dazu, dass Meldungsraten, die nur knapp über der erlaubten Rate liegen, deutlich schneller ein Event öffnen (und damit benachrichtigt werden).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Welchen Algorithmus sollten Sie also wählen?</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Interval</span> ist am einfachsten zu verstehen und leichter nachzuvollziehen, wenn Sie später in Ihrem Syslog-Archiv genau nachzählen möchten.</p></li>
<li><p><span class="guihint">Token Bucket</span> dagegen ist intelligenter und „weicher“. Es kommt zu weniger Anomalien an den Rändern der Intervalle.</p></li>
<li><p><span class="guihint">Dynamic Token Bucket</span> macht das System reaktiver und erzeugt schneller Benachrichtigungen.</p></li>
</ul></div>
<div class="paragraph"><p>Events, die die eingestellte Anzahl noch nicht erreicht haben, sind latent schon vorhanden aber für den Operator nicht automatisch sichtbar.
Sie befinden sich in der Phase <span class="guihint">counting</span>.
Sie können solche Events mit dem Filter <span class="guihint">Phase</span> in der Event-Ansicht sichtbar machen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_phase_filter_counting.png" alt="ec phase filter counting" width="440"></div></div>
</div>
<div class="sect3">
<h4 id="heading_expect">
<span class="hidden-anchor sr-only" id="expect"></span>Zu seltene oder ausbleibende Meldungen</h4>
<div class="paragraph"><p>Genauso wie das Eingehen einer bestimmten Meldung kann auch das <strong>Ausbleiben</strong> ein Problem bedeuten.
Eventuell erwarten Sie pro Tag mindestens eine Meldung von einem bestimmten Job.
Bleibt diese aus, ist der Job wahrscheinlich nicht gelaufen und sollte dringend repariert werden.</p></div>
<div class="paragraph"><p>So etwas können Sie unter <span class="guihint">Counting &amp; Timing &gt; Expect regular messages</span> konfigurieren:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_expect_messages.png" alt="ec expect messages"></div></div>
<div class="paragraph"><p>Wie beim Zählen müssen Sie auch hier einen Zeitraum angeben, in dem Sie die Meldung(en) erwarten.
Hier kommt allerdings ein ganz anderer Algorithmus zur Anwendung, der an dieser Stelle viel sinnvoller ist.
Der Zeitraum wird hier nämlich immer exakt an definierten Stellen ausgerichtet.
So wird z.B. beim Interval <span class="guihint">hour</span> immer bei Minute und Sekunde Null begonnen. Sie haben folgende Optionen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Interval</th>
<th class="tableblock halign-left valign-top">Ausrichtung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">10 seconds</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei einer durch 10 teilbaren Sekundenzahl</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">minute</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auf der vollen Minute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">5 minutes</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei 0:00, 0:05, 0:10, usw.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">15 minutes</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei 0:00, 0:15, 0:30, 0:45, usw.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">hour</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auf dem Beginn jeder vollen Stunde</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">day</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exakt bei 00:00 Uhr, allerdings in einer konfigurierbaren Zeitzone. Damit können Sie auch sagen, dass Sie eine Meldung zwischen 12:00 Uhr und 12:00 Uhr am nächsten Tag erwarten. Wenn Sie selbst z.B. in der Zeitzone <span class="guihint">UTC+1</span> sind, geben Sie dazu <span class="guihint">UTC-11</span> an.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">two days</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zu Beginn einer vollen Stunde. Sie können hier einen Zeitzonenoffset von 0 bis 47 angeben, der sich auf 1970-01-01 00:00:00 UTC bezieht.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">week</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um 00:00 Uhr am Donnerstag morgen in der Zeitzone UTC plus das Offset, das Sie in Stunden ausgeben können. Donnerstag deswegen, weil der 1.1.1970 — der Beginn der „Epoche“, an einem Donnerstag war.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Warum ist das so kompliziert?
Das soll Fehlalarme vermeiden.
Erwarten Sie z.B. eine Meldung vom Backup pro Tag?
Sicher wird es leichte Unterschiede in der Laufzeit des Backups geben, so dass die Meldungen nicht exakt 24 Stunden auseinander liegen.
Erwarten Sie die Meldung z.B. ungefähr gegen Mitternacht plus/minus ein oder zwei Stunden, so ist ein Intervall von 12:00 bis 12:00 Uhr viel robuster, als eines von 00:00 bis 00:00 Uhr.
Allerdings bekommen Sie dann auch erst um 12:00 Uhr eine Benachrichtigung, wenn die Meldung ausbleibt.</p></div>
</div>
<div class="sect3">
<h4 id="heading__mehrfaches_auftreten_des_gleichen_problems">
<span class="hidden-anchor sr-only" id="_mehrfaches_auftreten_des_gleichen_problems"></span>Mehrfaches Auftreten des gleichen Problems</h4>
<div class="paragraph"><p>Die Option <span class="guihint">Merge with open event</span> ist so voreingestellt, dass bei einem mehrfachen hintereinander Ausbleiben der gewünschten Meldung, das bestehende Event aktualisiert wird.
Dies können Sie so umschalten, dass jedes Mal ein neues Event aufgemacht wird.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_timing">
<span class="hidden-anchor sr-only" id="timing"></span>5.6. Timing</h3>
<div class="paragraph"><p>Unter <span class="guihint">Counting &amp; Timing</span> gibt es zwei Optionen, welche das Öffnen bzw. automatische Schließen von Events betreffen.</p></div>
<div class="paragraph"><p>Die Option <span class="guihint">Delay event creation</span> ist nützlich, wenn Sie mit dem automatischen <a href="#cancelling">Aufheben</a> von Events arbeiten.
Setzen Sie z.B. eine Verzögerung von 5 Minuten, so verharrt bei einer Störmeldung das so erzeugte Event 5 Minuten im Zustand <span class="guihint">delayed</span> — in der Hoffnung, dass in dieser Zeit die OK-Meldung eintrifft.
Ist das der Fall, so wird das Event automatisch und ohne Aufhebens wieder geschlossen und schlägt nicht im Monitoring auf.
Läuft die Zeit aber ab, so wird das Event geöffnet und eventuell eine dafür definierte Aktion ausgeführt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_delay.png" alt="ec delay"></div></div>
<div class="paragraph"><p>In etwa das Gegenteil macht <span class="guihint">Limit event lifetime</span>.
Damit können Sie Events nach einer bestimmten Zeit automatisch schließen lassen.
Das ist z.B. nützlich für informative Events mit <span class="state0">OK</span>-Status, die Sie zwar anzeigen möchten, aber für die das Monitoring keine Aktivitäten nach sich ziehen soll.
Durch das automatische „Herausaltern“ sparen Sie sich das manuelle Löschen solcher Meldungen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_limit_livetime.png" alt="ec limit livetime"></div></div>
<div class="paragraph"><p>Durch ein Quittieren wird das Herausaltern erst einmal gestoppt.
Dieses Verhalten können Sie aber mit den beiden Checkboxen nach Bedarf justieren.</p></div>
</div>
<div class="sect2">
<h3 id="heading_rulepacks">
<span class="hidden-anchor sr-only" id="rulepacks"></span>5.7. Regelpakete</h3>
<div class="paragraph"><p>Regelpakete haben nicht nur den Sinn, Dinge übersichtlicher zu machen, sondern können die Konfiguration vieler ähnlicher Regeln auch deutlich vereinfachen und gleichzeitig die Auswertung beschleunigen.</p></div>
<div class="paragraph"><p>Angenommen, Sie haben einen Satz von 20 Regeln, die sich alle um das Windows Event Log <span class="guihint">Security</span> drehen.
Alle diese Regeln haben gemeinsam, dass sie in der Bedingung auf einen bestimmten Text im Anwendungsfeld prüfen (der Name dieser Log-Datei wird bei den Meldungen von der EC als <span class="guihint">Application</span> eingetragen).
Gehen Sie in so einem Fall wie folgt vor:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Legen Sie ein eigenes Regelpaket an.</p></li>
<li><p>Legen Sie die 20 Regeln für <span class="guihint">Security</span> in diesem Paket an oder ziehen Sie sie dorthin um (Auswahlliste <span class="guihint">Move to pack…​</span> rechts in der Regeltabelle).</p></li>
<li><p>Entfernen Sie aus allen diesen Regeln die Bedingung auf die Anwendung.</p></li>
<li><p>Legen Sie <strong>als erste Regel</strong> in dem Paket eine Regel an, durch die Meldungen das Paket sofort verlassen, wenn die Anwendung <em>nicht</em> <span class="guihint">Security</span> ist.</p></li>
</ol></div>
<div class="paragraph"><p>Diese Ausschlussregel ist wie folgt aufgebaut:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Matching Criteria &gt; Match syslog application (tag)</span> auf <code>Security</code></p></li>
<li><p><span class="guihint">Matching Criteria &gt; Invert matching</span> auf <span class="guihint">Negate match: Execute this rule if the upper conditions are not fulfilled.</span></p></li>
<li><p><span class="guihint">Outcome &amp; Action &gt; Rule type</span> auf <span class="guihint">Skip this rule pack, continue rule execution with next rule pack</span></p></li>
</ul></div>
<div class="paragraph"><p>Jede Meldung, die nicht vom Security-Log kommt, wird also bereits von der ersten Regel in diesem Paket „abgewiesen“.
Das vereinfacht nicht nur die weiteren Regeln des Pakets, sondern beschleunigt auch die Abarbeitungen, da diese in den meisten Fällen gar nicht mehr geprüft werden müssen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_actions">
<span class="hidden-anchor sr-only" id="actions"></span>6. Aktionen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__arten_von_aktionen">
<span class="hidden-anchor sr-only" id="_arten_von_aktionen"></span>6.1. Arten von Aktionen</h3>
<div class="paragraph"><p>Die Event Console bietet drei Arten von Aktionen, welche Sie entweder manuell oder beim Öffnen oder <a href="#cancelling">Aufheben</a> von Events ausführen lassen können:</p></div>
<div class="ulist"><ul>
<li><p>Ausführen von selbstgeschriebenen Shell-Skripten</p></li>
<li><p>Versenden von selbstdefinierten E-Mails</p></li>
<li><p>Erzeugen von Checkmk <a href="#notifications">Benachrichtigungen</a></p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__shell_skripte_und_e_mails">
<span class="hidden-anchor sr-only" id="_shell_skripte_und_e_mails"></span>6.2. Shell-Skripte und E-Mails</h3>
<div class="paragraph"><p>E-Mails und Skripte müssen Sie zunächst in den <a href="#globalsettings">Einstellungen der Event Console</a> definieren.
Sie finden diese unter dem Eintrag <span class="guihint">Actions (E-Mails &amp; Scripts)</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_add_action.png" alt="ec add action"></div></div>
<div class="sect3">
<h4 id="heading__shell_skripte_ausführen">
<span class="hidden-anchor sr-only" id="_shell_skripte_ausführen"></span>Shell-Skripte ausführen</h4>
<div class="paragraph"><p>Mit dem Knopf <span class="guihint">Add new action</span> legen Sie eine neue Aktion an.
Folgendes Beispiel zeigt, wie Sie ein einfaches Shell-Skript als Aktion vom Typ <span class="guihint">Execute Shell Script</span> anlegen können.
Dem Skript stehen über Umgebungsvariablen Details zu den Events zur Verfügung,
beispielsweise die <code>$CMK_ID</code> des Events, der <code>$CMK_HOST</code>, Volltext <code>$CMK_TEXT</code> oder die erste Match-Gruppe als <code>$CMK_MATCH_GROUP_1</code>.
Eine vollständige Liste der verfügbaren Umgebungsvariablen erhalten Sie in der <span class="image-inline"><img src="../images/icons/icon_help.png" alt="icon help"></span> Inline-Hilfe.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_define_action.png" alt="ec define action"></div></div>
<div class="paragraph"><p>Ältere Versionen von Checkmk haben neben Umgebungsvariablen auch Makros wie <code>$TEXT$</code> erlaubt, die vor Ausführung des Skriptes ersetzt wurden.
Wegen der Gefahr, dass ein Angreifer über ein eigens angefertigtes UDP-Paket Befehle einschleusen kann, die mit den Rechten des Checkmk Prozesses ausgeführt werden, sollten Sie von Makros keinen Gebrauch machen.
Makros sind derzeit noch aus Kompatibilitätsgründen erlaubt, jedoch behalten wir uns die Entfernung in einer künftigen Checkmk Version vor.</p></div>
<div class="paragraph"><p>Das Beispielskript aus dem Screenshot legt im Instanzverzeichnis die Datei <code>tmp/test.out</code> an und schreibt dort einen Text mit den konkreten Werten der Variablen zu dem jeweils letzten Event:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>cat &lt;&lt; EOF &gt; ${OMD_ROOT}/tmp/test.out
Something happened:

Event-ID: $CMK_ID
Host: $CMK_HOST
Application: $CMK_APPLICATION
Message: $CMK_TEXT
EOF</code></pre></div></div>
<div class="paragraph"><p>Die Skripte werden unter folgender Umgebung ausgeführt:</p></div>
<div class="ulist"><ul>
<li><p>Als Interpreter wird <code>/bin/bash</code> verwendet.</p></li>
<li><p>Das Skript läuft als Instanzbenutzer mit dem Home-Verzeichnis der Instanz (z.B. <code>/omd/sites/mysite</code>).</p></li>
<li><p>Während der Laufzeit des Skripts ist die Verarbeitung weiterer Events angehalten!</p></li>
</ul></div>
<div class="paragraph"><p>Sollte Ihr Skript eventuell Wartezeiten enthalten, können Sie es mithilfe von Linux' <code>at</code>-Spooler asynchron laufen lassen.
Dazu legen Sie das Skript in einer eigenen Datei <code>local/bin/myaction</code> an und starten es mit dem <code>at</code>-Befehl, z.B.:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>echo "$OMD_ROOT/local/bin/myaction '$HOST$' '$TEXT$' | at now</code></pre></div></div>
</div>
<div class="sect3">
<h4 id="heading__versenden_von_e_mails">
<span class="hidden-anchor sr-only" id="_versenden_von_e_mails"></span>Versenden von E-Mails</h4>
<div class="paragraph"><p>Der Aktionstyp <span class="guihint">Send Email</span> versendet eine einfache Text-E-Mail.
Eigentlich könnten Sie das auch über den Umweg mit einem Skript erreichen, in dem Sie z.B. mit dem Kommandozeilenbefehl <code>mail</code> arbeiten.
Aber so ist es komfortabler.
Bitte beachten Sie, dass auch in den Feldern <span class="guihint">Recipient E-Mail address</span> und <span class="guihint">Subject</span> Platzhalter erlaubt sind.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_define_action_email.png" alt="ec define action email"></div></div>
</div>
</div>
<div class="sect2">
<h3 id="heading_notifications">
<span class="hidden-anchor sr-only" id="notifications"></span>6.3. Benachrichtigung durch Checkmk</h3>
<div class="paragraph"><p>Neben dem Ausführen von Skripten und dem Versenden von (einfachen) E-Mails kennt die EC noch eine dritte Art von Aktion:
Das Versenden von Benachrichtigungen über das Checkmk <a href="glossar.html#notification#">Benachrichtigungssystem</a>.
Die dabei von der EC erzeugten Benachrichtigungen gehen den gleichen Weg, wie die Host- und Servicebenachrichtigungen aus dem aktiven Monitoring.
Die Vorteile gegenüber den oben beschriebenen einfachen E-Mails liegen auf der Hand:</p></div>
<div class="ulist"><ul>
<li><p>Die Benachrichtigung wird für aktives und eventbasiertes Monitoring gemeinsam an zentraler Stelle konfiguriert.</p></li>
<li><p>Funktionen wie <a href="notifications.html#bulk">Sammelbenachrichtigungen</a>, HTML-E-Mails und andere nützliche Dinge stehen zur Verfügung.</p></li>
<li><p>Benutzerdefinierte Benachrichtigungsregeln, ein Abschalten der Benachrichtigungen und Ähnliches funktionieren wie gewohnt.</p></li>
</ul></div>
<div class="paragraph"><p>Die Aktionsart <span class="guihint">Send monitoring notification</span>, die das macht, steht immer automatisch zur Verfügung und muss nicht extra konfiguriert werden.</p></div>
<div class="paragraph"><p>Da Events einige Unterschiede zu den „normalen“ Hosts oder Services haben, gibt es ein paar Besonderheiten bei deren Benachrichtigung, welche Sie im Folgenden genauer kennen lernen.</p></div>
<div class="sect3">
<h4 id="heading__zuordnung_zu_bestehenden_hosts">
<span class="hidden-anchor sr-only" id="_zuordnung_zu_bestehenden_hosts"></span>Zuordnung zu bestehenden Hosts</h4>
<div class="paragraph"><p>Events können von beliebigen Hosts kommen — egal, ob diese im aktiven Monitoring konfiguriert sind oder nicht.
Schließlich steht der Syslog- und SNMP-Port allen Hosts im Netzwerk offen.
Daher stehen die erweiterten Host-Attribute wie Alias, Host-Merkmale, Kontakte usw. erst einmal nicht zur Verfügung.
Das bedeutet insbesondere, dass <em>Bedingungen</em> in Benachrichtigungsregeln nicht unbedingt so funktionieren, wie Sie das erwarten würden.</p></div>
<div class="paragraph"><p>Daher versucht die EC bei der Benachrichtigung einen zum Event passenden Host aus dem aktiven Monitoring zu finden.
Dabei wird das gleiche Verfahren wie bei der <a href="#visibility">Sichtbarkeit von Events</a> angewandt.
Kann so ein Host gefunden werden, so werden von diesem folgende Daten übernommen:</p></div>
<div class="ulist"><ul>
<li><p>Die korrekte Schreibweise des Host-Namens</p></li>
<li><p>Der Host-Alias</p></li>
<li><p>Die in Checkmk konfigurierte primäre IP-Adresse</p></li>
<li><p>Die Host-Merkmale (<em>host tags</em>)</p></li>
<li><p>Der Ordner in der Setup-GUI</p></li>
<li><p>Die Liste der Kontakte und Kontaktgruppen</p></li>
</ul></div>
<div class="paragraph"><p>Dadurch kann es dazu kommen, dass der Host-Name in der Benachrichtigung nicht exakt mit dem Host-Namen aus der ursprünglichen Meldung übereinstimmt.
Die Anpassung auf die Schreibweise des aktiven Monitorings vereinfacht aber das Formulieren von einheitlichen Benachrichtigungsregeln, welche Bedingungen auf den Host-Namen enthalten.</p></div>
<div class="paragraph"><p>Die Zuordnung geschieht in Echtzeit durch eine <a href="glossar.html#Livestatus">Livestatus</a>-Abfrage an den Monitoring-Kern, welcher in der gleichen Instanz wie die EC läuft, die die Meldung empfangen hat.
Das klappt natürlich nur, wenn die Syslog-Meldungen, SNMP-Traps usw. immer an diejenige Checkmk Instanz gesendet werden, auf der der Host auch aktiv überwacht wird!</p></div>
<div class="paragraph"><p>Falls die Abfrage nicht klappt oder der Host nicht gefunden werden kann, werden Ersatzdaten angenommen:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Hostname</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Host-Name aus dem Event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Hostalias</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Als Alias wird der Host-Name verwendet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">IP-Adresse</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Feld IP-Adresse enthält die originale Absenderadresse der Meldung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Hostmerkmale</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Host erhält kein Host-Merkmal. Falls Sie Host-Merkmalsgruppen mit leeren Merkmalen haben, nimmt der Host dort diese Merkmale an. Ansonsten hat er kein Merkmal der Gruppe. Bitte beachten Sie das, wenn Sie in den Benachrichtigungsregeln Bedingungen über Host-Merkmale definieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Setup-GUI Ordner</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kein Ordner. Sämtliche Bedingungen, die auf einen bestimmten Ordner gehen, sind damit unerfüllbar — selbst wenn es sich um den Hauptordner handelt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Kontakte</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Liste der Kontakte ist leer. Sind Fallback-Kontakte vorhanden, werden diese eingetragen.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Wenn der Host im aktiven Monitoring nicht zugeordnet werden kann, kann das natürlich zu Problemen bei der Benachrichtigung führen.
Zum einen wegen der Bedingungen, die dann evtl. nicht mehr greifen, zum anderen wegen der Kontaktauswahl.
Für solche Fälle können Sie Ihre Benachrichtigungsregeln so anpassen, dass Benachrichtigungen aus der Event Console mit einer eigenen Regel gezielt behandelt werden.
Dazu gibt es eine eigene Bedingung, mit der Sie entweder positiv nur auf EC-Benachrichtigungen matchen oder umgekehrt diese ausschließen können:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_notification_condition.png" alt="ec notification condition"></div></div>
</div>
<div class="sect3">
<h4 id="heading__restliche_felder_der_benachrichtigung">
<span class="hidden-anchor sr-only" id="_restliche_felder_der_benachrichtigung"></span>Restliche Felder der Benachrichtigung</h4>
<div class="paragraph"><p>Damit Benachrichtigungen aus der EC das Benachrichtigungssystem des aktiven Monitorings durchlaufen können, muss sich die EC an dessen Schema anpassen.
Dabei werden die typischen Datenfelder einer Benachrichtigung so sinnvoll wie möglich gefüllt.
Wie die Daten des Hosts ermittelt werden, haben wir gerade beschrieben.
Weitere Felder sind:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Benachrichtigungstyp</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EC-Benachrichtigungen gelten immer als <em>Servicenachricht.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Service description</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier wird der Inhalt des Felds <span class="guihint">Application</span> aus dem Event eingetragen. Falls das leer ist, wird <code>Event Console</code> eingetragen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Benachrichtigungsnummer</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diese ist fest auf <code>1</code> eingestellt. Damit ist hier auch keine Eskalation möglich. Selbst mehrere aufeinanderfolgende Events der gleichen Art geschehen voneinander unabhängig. Aktuell unterstützt die EC keine wiederholte Benachrichtigung für den Fall, dass ein Event nicht quittiert wird.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Datum/Uhrzeit</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bei Events, die <a href="#counting">zählen</a>, ist das der Zeitpunkt des <em>letzten</em> Auftretens einer zum Event gehörigen Meldung.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Pluginoutput</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Textinhalt des Events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Servicezustand</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zustand des Events, also <span class="state0">OK</span>, <span class="state1">WARN</span>, <span class="state2">CRIT</span> oder <span class="state3">UNKNOWN</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Vorheriger Zustand</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Da Events keinen früheren Status haben, wird hier bei normalen Events immer <span class="state0">OK</span>, beim <a href="#cancelling">Aufhebung eines Events</a> immer <span class="state2">CRIT</span> eingetragen. Diese Regelung kommt dem am nächsten, was man für Benachrichtigungsregeln braucht, die eine Bedingung auf den genauen Zustandswechsel haben.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__kontaktgruppen_manuell_festlegen">
<span class="hidden-anchor sr-only" id="_kontaktgruppen_manuell_festlegen"></span>Kontaktgruppen manuell festlegen</h4>
<div class="paragraph"><p>Wie oben beschrieben, können zu einem Event eventuell nicht die passenden Kontakte automatisch ermittelt werden.
Für solche Fälle können Sie direkt in der EC-Regel Kontaktgruppen angeben, welche für die Benachrichtigung verwendet werden sollen.
Wichtig ist, dass Sie den Haken bei <span class="guihint">Use in notifications</span> nicht vergessen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_set_contact_groups.png" alt="ec set contact groups"></div></div>
</div>
<div class="sect3">
<h4 id="heading__globaler_schalter_für_benachrichtigungen">
<span class="hidden-anchor sr-only" id="_globaler_schalter_für_benachrichtigungen"></span>Globaler Schalter für Benachrichtigungen</h4>
<div class="paragraph"><p>Im Snapin <span class="guihint">Master control</span> gibt es einen zentralen Schalter für Benachrichtigungen.
Dieser gilt auch für Benachrichtigungen, die von der EC weitergeleitet werden:</p></div>
<div class="imageblock"><div class="content"><img src="../images/master_control_notifications_off.png" alt="master control notifications off" width="400"></div></div>
<div class="paragraph"><p>Ebenso wie die Host-Zuordnung erfordert die Abfrage des Schalters durch die EC einen Livestatus-Zugriff auf den lokalen Monitoring-Kern.
Eine erfolgreiche Abfrage sehen Sie in der Log-Datei der Event Console:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482142567.147669] Notifications are currently disabled. Skipped notification for event 44</code></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="heading__wartungszeiten_von_hosts">
<span class="hidden-anchor sr-only" id="_wartungszeiten_von_hosts"></span>Wartungszeiten von Hosts</h4>
<div class="paragraph"><p>Die Event Console erkennt Hosts, die gerade in einer <a href="glossar.html#scheduled_downtime">Wartungszeit</a> sind und versendet in diesem Fall keine Benachrichtigungen.
In der Log-Datei sieht das so aus:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482144021.310723] Host myserver123 is currently in scheduled downtime. Skipping notification of event 433.</code></pre></div>
</div>
<div class="paragraph"><p>Auch das setzt natürlich ein erfolgreiches Finden des Hosts im aktiven Monitoring voraus.
Falls dies nicht gelingt, wird angenommen, dass sich der Host <em>nicht</em> in Wartung befindet und die Benachrichtigung auf jeden Fall generiert.</p></div>
</div>
<div class="sect3">
<h4 id="heading__zusätzliche_makros">
<span class="hidden-anchor sr-only" id="_zusätzliche_makros"></span>Zusätzliche Makros</h4>
<div class="paragraph"><p>Falls Sie ein eigenes <a href="notifications.html#scripts">Benachrichtigungsskript</a> schreiben, haben Sie speziell bei Benachrichtigungen, die aus der Event Console kommen, etliche zusätzliche Variablen
zur Verfügung, die den ursprünglichen Event beschreiben (Zugriff wie gewohnt mit Präfix <code>NOTIFY_</code>):</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event-ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_RULE_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID der Regel, die das Event erzeugt hat.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog-Priorität als Zahl von <code>0</code> (<code>emerg</code>) bis <code>7</code> (<code>debug</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_FACILITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslog Facility — ebenfalls als Zahl. Der Wertebereich geht von <code>0</code> (<code>kern</code>) bis <code>32</code> (<code>snmptrap</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PHASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Phase des Events. Da nur offene Events Aktionen auslösen, sollte hier <code>open</code> stehen. Bei einer manuellen Benachrichtigung eines bereits quittierten Events steht hier <code>ack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_COMMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Kommentarfeld des Events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_OWNER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Feld <span class="guihint">Owner</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_CONTACT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Kommentarfeld mit der Event-spezifischen Kontaktinformation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_PID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die ID des Prozesses, der die Meldung gesendet hat (bei Syslog-Events).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_MATCH_GROUPS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Match-Gruppen vom Matchen in der Regel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EC_CONTACT_GROUPS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die optional manuell in der Regel definierten Kontaktgruppen.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="heading_automatic_actions">
<span class="hidden-anchor sr-only" id="automatic_actions"></span>6.4. Aktionen ausführen</h3>
<div class="paragraph"><p>Das manuelle Ausführen von Aktionen durch den Operator haben Sie schon weiter oben bei den <a href="#commands">Kommandos</a> gesehen.
Spannender ist das automatische Ausführen von Aktionen, welches Sie in EC-Regeln im Abschnitt <span class="guihint">Outcome &amp; Action</span> konfigurieren können:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_rule_actions.png" alt="ec rule actions"></div></div>
<div class="paragraph"><p>Hier können Sie eine oder mehrere Aktionen auswählen, die immer dann ausgeführt werden, wenn aufgrund der Regel ein Event <em>geöffnet</em> oder <a href="#cancelling">aufgehoben</a> wird.
Bei Letzterem können Sie über die Liste <span class="guihint">Do cancelling actions</span> noch festlegen, ob die Aktion nur dann ausgeführt werden soll, wenn das aufgehobene Event schon die Phase <span class="guihint">open</span> erreicht hat.
Bei Verwendung von <a href="#counting">Zählen</a> oder <a href="#timing">Verzögerung</a> kann es nämlich dazu kommen, dass Events aufgehoben werden, die quasi noch im Wartezustand und für den Benutzer noch nicht sichtbar
waren.</p></div>
<div class="paragraph"><p>Die Ausführung von Aktionen wird in der Log-Datei <code>var/log/mkeventd.log</code> vermerkt:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1481120419.712534] Executing command: ACTION;1;cmkadmin;test
[1481120419.718173] Exitcode: 0</code></pre></div>
</div>
<div class="paragraph"><p>Auch in das <a href="#archive">Archiv</a> werden diese geschrieben.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_snmp">
<span class="hidden-anchor sr-only" id="snmp"></span>7. SNMP-Traps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__empfang_von_snmp_traps_aufsetzen">
<span class="hidden-anchor sr-only" id="_empfang_von_snmp_traps_aufsetzen"></span>7.1. Empfang von SNMP-Traps aufsetzen</h3>
<div class="paragraph"><p>Da die Event Console eine eingebaute eigene SNMP-Engine hat, ist das Aufsetzen des Empfangs von SNMP-Traps sehr einfach.
Sie benötigen keinen <code>snmptrapd</code> vom Betriebssystem!
Falls Sie diesen bereits am Laufen haben, so beenden Sie ihn bitte.</p></div>
<div class="paragraph"><p>Wie im Abschnitt über das <a href="#setup">Aufsetzen</a> der Event Console beschrieben, aktivieren Sie mit <code>omd config</code> den Trap-Empfänger in dieser Instanz:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_config_traps.png" alt="ec config traps" width="360"></div></div>
<div class="paragraph"><p>Da auf jedem Server der UDP-Port für die Traps nur von einem Prozess verwendet werden kann, darf das pro Rechner nur in einer einzigen Checkmk Instanz gemacht werden.
Beim Start der Instanz können Sie in der Zeile mit <code>mkeventd</code> kontrollieren, ob der Trap-Empfang eingeschaltet ist:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start
<span class="tok-go">Creating temporary filesystem /omd/sites/mysite/tmp...<span class="green">OK</span></span>
<span class="tok-go">Starting mkeventd (builtin: snmptrap)...OK</span>
<span class="tok-go">Starting liveproxyd...OK</span>
<span class="tok-go">Starting mknotifyd...OK</span>
<span class="tok-go">Starting rrdcached...OK</span>
<span class="tok-go">Starting cmc...OK</span>
<span class="tok-go">Starting apache...OK</span>
<span class="tok-go">Starting dcd...OK</span>
<span class="tok-go">Starting redis...OK</span>
<span class="tok-go">Initializing Crontab...OK</span></code></pre></div></div>
<div class="paragraph"><p>Damit SNMP-Traps funktionieren, müssen sich Sender und Empfänger auf bestimmte <span class="guihint">Credentials</span> einigen.
Im Fall von SNMP Version 1 und 2c ist das ein einfaches Passwort, was hier „Community“ genannt wird.
Bei Version 3 benötigen Sie ein paar mehr Angaben.
Diese Credentials konfigurieren Sie in den <a href="#globalsettings">Einstellungen der Event Console</a> unter <span class="guihint">Credentials for processing SNMP traps</span>.
Dabei können Sie mit dem Knopf <span class="guihint">Add new element</span> mehrere unterschiedliche Credentials einrichten, welche von den Geräten alternativ verwendet werden können:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_credentials.png" alt="ec trap credentials"></div></div>
<div class="paragraph"><p>Der weitaus aufwendigere Teil ist es jetzt natürlich, bei allen Zielgeräten, die überwacht werden sollen, die Zieladresse für Traps einzutragen und auch hier die Credentials zu konfigurieren.</p></div>
</div>
<div class="sect2">
<h3 id="heading__testen">
<span class="hidden-anchor sr-only" id="_testen"></span>7.2. Testen</h3>
<div class="paragraph"><p>Leider bieten die wenigsten Geräte sinnvolle Testmöglichkeiten.
Immerhin können Sie den Empfang der Traps durch die Event Console selbst recht einfach von Hand testen, indem Sie — am besten von einem anderen Linux-Rechner aus — eine Test-Trap senden.
Dies geht mit dem Befehl <code>snmptrap</code>.
Folgendes Beispiel sendet eine Trap an <code>192.168.178.11</code>.
Der eigene Host-Name wird nach dem <code>.1.3.6.1</code> angegeben und muss auflösbar sein oder als IP-Adresse (hier <code>192.168.178.30</code>) angegeben werden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">user@host:~$ </span>snmptrap<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-m">1</span><span class="tok-w"> </span>-c<span class="tok-w"> </span>public<span class="tok-w"> </span><span class="tok-m">192</span>.168.178.11<span class="tok-w"> </span>.1.3.6.1<span class="tok-w"> </span><span class="tok-m">192</span>.168.178.30<span class="tok-w"> </span><span class="tok-m">6</span><span class="tok-w"> </span><span class="tok-m">17</span><span class="tok-w"> </span><span class="tok-s1">''</span><span class="tok-w"> </span>.1.3.6.1<span class="tok-w"> </span>s<span class="tok-w"> </span><span class="tok-s2">"Just kidding"</span></code></pre></div></div>
<div class="paragraph"><p>Falls Sie in den Einstellungen das <span class="guihint">Log level</span> auf <span class="guihint">Verbose logging</span> eingestellt haben, können Sie den Empfang und die Auswertung der Traps in der Log-Datei der EC sehen:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482387549.481439] Trap received from 192.168.178.30:56772. Checking for acceptance now.
[1482387549.485096] Trap accepted from 192.168.178.30 (ContextEngineId "0x80004fb8054b6c617070666973636816893b00", ContextName "")
[1482387549.485136] 1.3.6.1.2.1.1.3.0                        = 329887
[1482387549.485146] 1.3.6.1.6.3.1.1.4.1.0                    = 1.3.6.1.0.17
[1482387549.485186] 1.3.6.1.6.3.18.1.3.0                     = 192.168.178.30
[1482387549.485219] 1.3.6.1.6.3.18.1.4.0                     =
[1482387549.485238] 1.3.6.1.6.3.1.1.4.3.0                    = 1.3.6.1
[1482387549.485258] 1.3.6.1                                  = Just kidding</code></pre></div>
</div>
<div class="paragraph"><p>Bei falschen Credentials sehen Sie nur eine einzige Zeile:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[1482387556.477364] Trap received from 192.168.178.30:56772. Checking for acceptance now.</code></pre></div>
</div>
<div class="paragraph"><p>Und so sieht ein Event aus, das von solch einer Trap erzeugt wurde:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event.png" alt="ec trap event"></div></div>
</div>
<div class="sect2">
<h3 id="heading__aus_zahlen_werden_texte_traps_übersetzen">
<span class="hidden-anchor sr-only" id="_aus_zahlen_werden_texte_traps_übersetzen"></span>7.3. Aus Zahlen werden Texte: Traps übersetzen</h3>
<div class="paragraph"><p>SNMP ist ein binäres Protokoll und sehr sparsam mit textuellen Beschreibungen der Meldungen.
Um welche Art von Traps es sich handelt, wird intern durch Folgen von Zahlen in sogenannten OIDs übermittelt.
Diese werden als durch Punkte getrennte Zahlenfolgen angezeigt (z.B. <code>1.3.6.1.6.3.18.1.3.0</code>).</p></div>
<div class="paragraph"><p>Mithilfe von sogenannten MIB-Dateien kann die Event Console diese Zahlenfolgen in Texte übersetzen.
So wird dann aus <code>1.3.6.1.6.3.18.1.3.0</code> z.B. der Text <code>SNMPv2-MIB::sysUpTime.0</code>.</p></div>
<div class="paragraph"><p>Die Übersetzung der Traps schalten Sie in den Einstellungen der Event Console ein:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_translate_traps.png" alt="ec translate traps"></div></div>
<div class="paragraph"><p>Die Test-Trap von oben erzeugt jetzt einen etwas anderen Event:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event_translated.png" alt="ec trap event translated"></div></div>
<div class="paragraph"><p>Haben Sie die Option <span class="guihint">Add OID descriptions</span> aktiviert, wird das Ganze wesentlich umfangreicher — und unübersichtlicher.
Es hilft aber besser zu verstehen, was ein Trap genau bedeutet:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_trap_event_translated2.png" alt="ec trap event translated2"></div></div>
</div>
<div class="sect2">
<h3 id="heading__hochladen_eigener_mibs">
<span class="hidden-anchor sr-only" id="_hochladen_eigener_mibs"></span>7.4. Hochladen eigener MIBs</h3>
<div class="paragraph"><p>Leider haben sich die Vorteile von Open Source bei den Autoren von MIB-Dateien noch nicht herumgesprochen, und so sind wir vom Checkmk Projekt leider nicht in der Lage, herstellerspezifische MIB-Dateien mit auszuliefern.
Nur eine kleine Sammlung von freien Basis-MIBs ist vorinstalliert und sorgt z.B. für eine Übersetzung von <code>sysUpTime</code>.</p></div>
<div class="paragraph"><p>Sie können aber in der Event Console im Modul <span class="guihint">SNMP MIBs for trap translation</span> mit dem Menü-Eintrag <span class="image-inline"><img src="../images/icons/icon_new.png" alt="icon new"></span> <span class="guihint">Add one or multiple MIBs</span> eigene MIB-Dateien hochladen, wie das hier mit einigen MIBs von <em>Netgear Smart Switches</em> geschehen ist:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_mibs_for_translation.jpg" alt="ec mibs for translation"></div></div>
<div class="paragraph"><p>Hinweise zu den MIBs:</p></div>
<div class="ulist"><ul>
<li><p>Die hochgeladenen Dateien werden unter <code>local/share/snmp/mibs</code> abgelegt. Dort können Sie sie auch von Hand ablegen, wenn Ihnen der Weg über die GUI zu umständlich ist.</p></li>
<li><p>Anstelle von Einzeldateien können Sie auch ZIP-Dateien mit MIBs-Sammlungen in einem Rutsch hochladen.</p></li>
<li><p>MIBs haben untereinander Abhängigkeiten. Fehlende MIBs werden Ihnen von Checkmk angezeigt.</p></li>
<li><p>Die hochgeladenen MIBs werden auch auf der Kommandozeile von <code>cmk --snmptranslate</code> verwendet.</p></li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_logwatch">
<span class="hidden-anchor sr-only" id="logwatch"></span>8. Überwachen von Log-Dateien</h2>
<div class="sectionbody">
<div class="paragraph"><p>Der Checkmk Agent ist in der Lage, Log-Dateien über das <span class="guihint">Logwatch</span>-Plugin auszuwerten.
Dieses Plugin bietet zunächst einmal eine eigene von der Event Console unabhängige Überwachung von Log-Dateien — inklusive der Möglichkeit, Meldungen direkt im Monitoring zu quittieren.
Es gibt aber auch die Möglichkeit, die vom Plugin gefundenen Meldungen 1:1 in die Event Console weiterzuleiten.</p></div>
<div class="paragraph"><p>Beim Windows-Agenten ist die Log-Dateiüberwachung fest integriert — in Form eines Plugins für die Auswertung von Textdateien und eines für die von Windows Event Logs.
Für Linux und Unix steht das in Python geschriebene Plugin <code>mk_logwatch</code> bereit.
Alle drei können Sie über die <a href="wato_monitoringagents.html#bakery">Agentenbäckerei</a> aufsetzen bzw. konfigurieren.
Verwenden Sie dazu folgende Regelsätze:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Text logfiles (Linux, Solaris, Windows)</span></p></li>
<li><p><span class="guihint">Finetune Windows Eventlog monitoring</span></p></li>
</ul></div>
<div class="paragraph"><p>Die genaue Konfiguration des Logwatch-Plugins ist nicht Thema dieses Artikels.
Wichtig ist allerdings, dass Sie nach wie vor im Logwatch-Plugin selbst bereits eine möglichst gute Vorfilterung der Meldungen vornehmen und nicht einfach die kompletten Inhalte der Textdateien zur Event Console senden.</p></div>
<div class="paragraph"><p>Bitte verwechseln Sie das nicht mit der <em>nachträglichen</em> Umklassifizierung über den Regelsatz <span class="guihint">Logfile patterns</span>.
Diese kann lediglich den Status von Meldungen ändern, die bereits vom Agenten gesendet wurden.
Sollten Sie diese Patterns aber schon eingerichtet haben und möchten einfach nur von Logwatch auf die Event Console umstellen, so können Sie die Patterns beibehalten.
Dazu gibt es bei den Regeln für die Weiterleitung (<span class="guihint">Logwatch Event Console Forwarding</span>) die Option <span class="guihint">Reclassify messages before forwarding them to the EC</span>.</p></div>
<div class="paragraph"><p>In diesem Fall gehen alle Meldungen durch insgesamt <strong>drei</strong> Regelketten:
auf dem Agenten, durch die Reklassifizierung und in der Event Console!</p></div>
<div class="paragraph"><p>Stellen Sie Logwatch nun so um, dass die von den Plugins gefundenen Meldungen nicht mehr mit dem normalen Logwatch-Check überwacht, sondern einfach 1:1 in die Event Console weitergeleitet und dort
verarbeitet werden.
Dazu dient der Regelsatz <span class="guihint">Logwatch Event Console Forwarding</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_logwatch_forwarding.png" alt="ec logwatch forwarding"></div></div>
<div class="paragraph"><p>Dazu einige Hinweise:</p></div>
<div class="paragraph"><p>Falls Sie eine verteilte Umgebung haben, bei der nicht in jeder Instanz eine eigene Event Console läuft, müssen die Remote-Instanzen die Meldungen an die Zentralinstanz per Syslog weiterleiten.
Der Default dafür ist UDP.
Das ist aber kein abgesichertes Protokoll.
Besser ist, Sie verwenden Syslog via TCP, welches Sie allerdings in der Zentralinstanz <a href="#setup">aktivieren</a> müssen (<code>omd config</code>).</p></div>
<div class="paragraph"><p>Bei der Weiterleitung geben Sie eine beliebige <span class="guihint">Syslog facility</span> an.
Anhand dieser können Sie in der EC dann leicht die weitergeleiteten Meldungen erkennen.
Gut geeignet sind dafür <code>local0</code> bis <code>local7</code>.</p></div>
<div class="paragraph"><p>Mit <span class="guihint">List of expected logfiles</span> können Sie die Liste der gefundenen Log-Dateien überwachen lassen und werden so gewarnt, wenn bestimmte erwartete Dateien gar nicht gefunden werden.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Das Speichern der Regel alleine bewirkt noch nichts.
Diese Regel wird lediglich bei der Service-Erkennung aktiv.
Erst wenn Sie diese neu durchführen, werden die bisherigen Logwatch-Services entfernt, und anstelle dessen wird pro Host <em>ein</em> neuer Service mit dem Namen <span class="guihint">Log Forwarding</span> erzeugt.</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_log_forwarding_check.png" alt="ec log forwarding check"></div></div>
<div class="paragraph"><p>Dieser Check zeigt Ihnen später auch an, ob es beim Weiterleiten an die Event Console zu irgendwelchen Problemen kommen sollte.</p></div>
<div class="sect2">
<h3 id="heading__service_level_und_syslog_priorität">
<span class="hidden-anchor sr-only" id="_service_level_und_syslog_priorität"></span>8.1. Service-Level und Syslog-Priorität</h3>
<div class="paragraph"><p>Da weitergeleiteten Log-Dateien je nach verwendetem Format oft die Syslog-Klassifizierung fehlt, können Sie die Neu-Klassifizierung im Regelsatz <span class="guihint">Logwatch Event Console Forwarding</span> unter <span class="guihint">Log Forwarding</span> vornehmen.
Zudem ist in den Regelsätzen, die Sie als Teil von <span class="guihint">Rule packs</span> definieren, immer das individuelle <a href="#outcome">Setzen von Status und Service-Level</a> möglich.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_eventsgostate">
<span class="hidden-anchor sr-only" id="eventsgostate"></span>9. Event-Status im aktiven Monitoring sehen</h2>
<div class="sectionbody">
<div class="paragraph"><p>Wenn Sie auch im aktiven Monitoring sehen möchten, zu welchen Hosts aktuell problematische Events offen sind, können Sie pro Host einen <a href="glossar.html#active_check">aktiven Check</a> hinzufügen lassen, welcher dessen aktuellen Event-Status zusammenfasst.
Bei einem Host ohne offene Events sieht das dann so aus:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_none.png" alt="ec events check none"></div></div>
<div class="paragraph"><p>Sind nur Events im Zustand <span class="state0">OK</span> vorhanden, so zeigt der Check deren Anzahl, bleibt aber immer noch grün:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_ok.png" alt="ec events check ok"></div></div>
<div class="paragraph"><p>Hier ist ein Fall mit offenen Events im Zustand <span class="state2">CRIT</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check_crit.png" alt="ec events check crit"></div></div>
<div class="paragraph"><p>Diesen aktiven Check erzeugen Sie durch eine Regel im Regelsatz <span class="guihint">Check event state in Event Console.</span>
Dabei können Sie auch angeben, ob bereits quittierte Events noch zum Status beitragen sollen oder nicht:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_check_remote.png" alt="ec check remote"></div></div>
<div class="paragraph"><p>Über die Option <span class="guihint">Application (regular expression)</span> können Sie den Check auf solche Events einschränken, die einen bestimmten Text im Anwendungsfeld haben.
In diesem Fall kann es dann Sinn machen, mehr als einen Events-Check auf einem Host zu haben und die Checks nach Anwendungen zu trennen.
Damit sich diese Services vom Namen unterscheiden, benötigen Sie dabei dann noch die Option <span class="guihint">Item (used in service description)</span>, welche einen von Ihnen festgelegten Text in den Namen des Services einbaut.</p></div>
<div class="paragraph"><p>Falls Ihre Event Console nicht auf der gleichen Checkmk Instanz läuft, von der auch der Host überwacht wird, brauchen Sie unter <span class="guihint">Access to Event Console</span> einen Remote-Zugriff per TCP:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_events_check.png" alt="ec events check"></div></div>
<div class="paragraph"><p>Damit dies funktioniert, muss die Event Console den Zugriff per TCP erlauben.
Dies können Sie in den <a href="#globalsettings">Einstellungen der Event Console</a> konfigurieren, auf die zugegriffen werden soll:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_remote_access.png" alt="ec remote access"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_archive">
<span class="hidden-anchor sr-only" id="archive"></span>10. Das Archiv</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__funktionsweise">
<span class="hidden-anchor sr-only" id="_funktionsweise"></span>10.1. Funktionsweise</h3>
<div class="paragraph"><p>Die Event Console führt ein Protokoll von allen Änderungen, die ein Event durchläuft.
Dieses finden Sie über zwei Wege:</p></div>
<div class="ulist"><ul>
<li><p>In der globalen Ansicht <span class="guihint">Recent event history</span>, die Sie in <span class="guihint">Monitor &gt; Event Console</span> finden.</p></li>
<li><p>Bei den Details eines Events mit dem Menüeintrag <span class="guihint">Event Console Event &gt; History of Event</span>.</p></li>
</ul></div>
<div class="paragraph"><p>In der globalen Ansicht greift ein Filter, der nur die Ereignisse der letzten 24 Stunden zeigt.
Sie können die Filter aber wie gewohnt anpassen.</p></div>
<div class="paragraph"><p>Folgende Abbildung zeigt die Historie von Event 33, welches insgesamt vier Änderungen erfahren hat.
Zuerst wurde das Event erzeugt (<code>NEW</code>),
dann der Zustand manuell von <span class="state0">OK</span> auf <span class="state1">WARN</span> geändert (<code>CHANGESTATE</code>),
dann wurde quittiert und ein Kommentar hinzugefügt (<code>UPDATE</code>) und
schließlich archiviert/gelöscht (<code>DELETE</code>):</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_history.png" alt="ec history"></div></div>
<div class="paragraph"><p>Es gibt im Archiv folgende Aktionstypen, die in der Spalte <span class="guihint">Action</span> angezeigt werden:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Aktionstyp</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde neu erzeugt (aufgrund einer Meldung oder aufgrund einer Regel, welche eine Meldung erwartet, die ausgeblieben ist).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde durch den Operator editiert (Änderung an Kommentar, Kontaktinfo, Quittierung).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde archiviert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CANCELLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde durch eine OK-Meldung automatisch <a href="#cancelling">aufgehoben</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANGESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Zustand des Events wurde durch den Operator geändert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ARCHIVED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde automatisch archiviert, da keine Regel gegriffen hat und in den globalen Einstellungen <span class="guihint">Force message archiving</span> aktiviert war.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORPHANED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde automatisch archiviert, da, während es in der Phase <span class="guihint">counting</span> war, die zugehörige Regel gelöscht wurde.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNTREACHED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde von <span class="guihint">counting</span> nach <span class="guihint">open</span> gesetzt, weil die konfigurierte Anzahl von Meldungen erreicht wurde.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNTFAILED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde automatisch archiviert, da in der Phase <span class="guihint">counting</span> die erforderliche Anzahl von Meldungen nicht erreicht wurde.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOCOUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde automatisch archiviert, da, während es in der Phase <span class="guihint">counting</span> war, die zugehörige Regel so umgestellt wurde, dass sie nicht mehr zählt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELAYOVER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde geöffnet, da die in der Regel konfigurierte <a href="#timing">Verzögerung</a> abgelaufen ist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXPIRED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde automatisch archiviert, da seine konfigurierte <a href="#timing">Lebenszeit</a> abgelaufen ist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EMAIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine E-Mail wurde versendet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRIPT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine automatische Aktion (Skript) wurde ausgeführt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTODELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Event wurde direkt nach dem Öffnen sofort automatisch archiviert, da dies in der entsprechenden Regel so konfiguriert war.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading__speicherort_des_archivs">
<span class="hidden-anchor sr-only" id="_speicherort_des_archivs"></span>10.2. Speicherort des Archivs</h3>
<div class="paragraph"><p>Wie eingangs erwähnt, ist die Event Console nicht als vollwertiges Syslog-Archiv konzipiert.
Um die Implementierung und vor allem die Administration so einfach wie möglich zu halten, wurde auf ein Datenbank-Backend verzichtet.
Anstelle dessen wird das Archiv in simple Textdateien geschrieben.
Jeder Eintrag besteht aus einer Zeile Text, welche durch Tabulatoren getrennte Spalten enthält.
Sie finden die Dateien in <code>~/var/mkeventd/history</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>var/mkeventd/history/
<span class="tok-go">total 1328</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable     131 Dez  4 23:59 1480633200.log</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable 1123368 Dez  5 23:39 1480892400.log</span>
<span class="tok-go">-rw-rw-r-- 1 stable stable  219812 Dez  6 09:46 1480978800.log</span></code></pre></div></div>
<div class="paragraph"><p>Per Default wird jeden Tag automatisch eine neue Datei begonnen.
In den <a href="#globalsettings">Einstellungen der Event Console</a> können Sie die Rotation anpassen.
Die Einstellung <span class="guihint">Event history logfile rotation</span> ermöglicht das Umstellen auf eine wöchentliche Rotation.</p></div>
<div class="paragraph"><p>Die Namen der Dateien entsprechen dem Unix-Zeitstempel vom Zeitpunkt der Erzeugung der Datei (Sekunden seit dem 1.1.1970 UTC).</p></div>
<div class="paragraph"><p>Die Dateien werden 365 Tage aufbewahrt, sofern Sie das nicht in der Einstellung <span class="guihint">Event history lifetime</span> umstellen.
Zudem werden die Dateien auch vom zentralen Plattenplatzmanagement von Checkmk erfasst, welches Sie in den globalen Einstellungen unter <span class="guihint">Site management</span> konfigurieren können.
Dabei gilt die jeweils <em>kürzere</em> eingestellte Frist.
Das globale Management hat den Vorteil, dass es automatisch bei Knappheit von Plattenplatz alle historischen Daten von Checkmk <strong>gleichmäßig</strong> beginnend mit den ältesten löschen kann.</p></div>
<div class="paragraph"><p>Wenn Sie in Platzprobleme laufen sollten, können Sie die Dateien in dem Verzeichnis auch einfach von Hand löschen oder auslagern.
Legen Sie jedoch keine gezippten oder irgendwelche anderen Dateien in diesem Verzeichnis ab.</p></div>
</div>
<div class="sect2">
<h3 id="heading__automatisches_archivieren">
<span class="hidden-anchor sr-only" id="_automatisches_archivieren"></span>10.3. Automatisches Archivieren</h3>
<div class="paragraph"><p>Trotz der Limitierung durch die Textdateien ist es theoretisch möglich, in der Event Console sehr viele Meldungen zu archivieren.
Das Schreiben in die Textdateien des Archivs ist sehr performant — allerdings auf Kosten einer späteren Recherche.
Da die Dateien als einzigen Index den Anfragezeitraum haben, müssen bei jeder Anfrage alle relevanten Dateien komplett gelesen und durchsucht werden.</p></div>
<div class="paragraph"><p>Normalerweise wird die EC nur solche Meldungen ins Archiv schreiben, für die auch wirklich ein Event geöffnet wird.
Sie können das auf zwei verschieden Arten auf <em>alle</em> Events ausweiten:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Sie erzeugen eine Regel, die auf alle (weiteren) Events matcht und aktiveren in <span class="guihint">Outcome &amp; actions</span> die Option <span class="guihint">Delete event immediately after the actions</span>.</p></li>
<li><p>Sie aktivieren in den Einstellungen der Event Console den Schalter <span class="guihint">Force message archiving</span>.</p></li>
</ol></div>
<div class="paragraph"><p>Letzterer sorgt dafür, dass Meldungen, auf die keine Regel greift, trotzdem ins Archiv wandern (Aktionstyp <code>ARCHIVED</code>).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_tuning">
<span class="hidden-anchor sr-only" id="tuning"></span>11. Performance und Tuning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__verarbeitung_von_meldungen">
<span class="hidden-anchor sr-only" id="_verarbeitung_von_meldungen"></span>11.1. Verarbeitung von Meldungen</h3>
<div class="paragraph"><p>Auch in Zeiten, da Server 64 Kerne und 2 TB Hauptspeicher haben, spielt Performance von Software noch eine Rolle.
Speziell bei der Verarbeitung von Events kommt hinzu, dass bei nicht ausreichender Leistung bei der Verarbeitung im Extremfall eingehende Meldungen verloren gehen können.</p></div>
<div class="paragraph"><p>Der Grund ist, dass keines der verwendeten Protokolle (Syslog, SNMP-Traps, etc.) eine Flusskontrolle vorsieht.
Wenn tausende Hosts gleichzeitig im Sekundentakt munter drauf los senden, dann hat der Empfänger keinerlei Chance, diese auszubremsen.</p></div>
<div class="paragraph"><p>Deswegen ist es in etwas größeren Umgebungen wichtig, dass Sie ein Auge darauf haben, wie lang die Verarbeitungszeit für eine Meldung ist.
Dies hängt natürlich ganz wesentlich davon ab, wie viele Regeln Sie definiert haben und wie diese aufgebaut sind.</p></div>
<div class="sect3">
<h4 id="heading_ecperformance">
<span class="hidden-anchor sr-only" id="ecperformance"></span>Messen der Performance</h4>
<div class="paragraph"><p>Zum Messen Ihrer Performance gibt es ein eigenes Snapin für die <a href="user_interface.html#sidebar">Seitenleiste</a> mit dem Namen <span class="guihint">Event Console Performance</span>.
Dieses können Sie wie gewohnt mit <span class="image-inline"><img src="../images/icons/button_sidebar_add_snapin.png" alt="button sidebar add snapin"></span> einbinden:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_performance.png" alt="ec performance" width="400"></div></div>
<div class="paragraph"><p>Die hier dargestellten Werte sind Mittelwerte über etwa die letzte Minute.
Einen Event-Sturm, der nur ein paar Sekunden dauert, können Sie hier also nicht direkt ablesen, aber dadurch sind die Zahlen etwas geglättet und daher besser zu lesen.</p></div>
<div class="paragraph"><p>Um die maximale Performance zu testen, können Sie künstlich einen Sturm von unklassifizierten Meldungen erzeugen (bitte nur im Testsystem!), indem Sie z.B. in einer Shell-Schleife fortwährend den Inhalt einer Textdatei in die Events Pipe schreiben:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-nb">true</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">do</span><span class="tok-w"> </span>cat<span class="tok-w"> </span>/etc/services<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>tmp/run/mkeventd/events<span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">done</span></code></pre></div></div>
<div class="paragraph"><p>Die wichtigsten Messwerte aus dem Snapin haben folgende Bedeutung:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Wert</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Received messages</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl der aktuell pro Sekunde eingehenden Meldungen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule tries</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl der Regeln, die ausprobiert werden. Dies liefert wertvolle Informationen über die Effizienz der Regelkette — vor allem zusammen mit dem nächsten Parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule hits</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl der Regeln, die aktuell pro Sekunde <em>greifen</em>. Dies können auch Regeln sein, die Meldungen verwerfen oder einfach nur zählen. Daher resultiert nicht aus jedem Regeltreffer auch ein Event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Rule hit ratio</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Verhältnis aus <span class="guihint">Rule tries</span> und <span class="guihint">Rule hits</span>. Mit anderen Worten: Wie viele Regeln muss die EC ausprobieren, bis (endlich) eine greift. In dem Beispiel aus dem Screenshot ist die Rate bedenklich klein.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Created events</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl der Events, die pro Sekunde neu erzeugt werden. Da die Event Console ja nur <em>relevante Probleme</em> anzeigen soll (also vergleichbar mit Host- und Service-Problemen aus dem Monitoring), wäre in der Praxis die Zahl <code>0.73/s</code> aus der Abbildung natürlich zu hoch!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="guihint">Processing time per message</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier können Sie ablesen, wie viel Zeit denn nun die Verarbeitung einer Meldung gedauert hat. Vorsicht: Im allgemeinen ist dies <strong>nicht</strong> der Kehrwert zu <span class="guihint">Received messages</span>. Denn dabei fehlen ja noch die Zeiten, in denen die Event Console gar nichts zu tun hatte, weil gerade keine Meldungen eingingen. Hier wird wirklich die reine real vergangene Zeit  zwischen dem Eintreffen einer Meldung und dem endgültigen Abschluss der Verarbeitung gemessen. Sie können darin in etwa ablesen, wie viele Meldungen die EC pro Zeit maximal schaffen <em>kann</em>.
Beachten Sie auch, dass es sich hier nicht um <em>CPU-Zeit</em> handelt, sondern um <em>reale</em> Zeit. Bei einem System mit genügend freien CPUs sind diese Zeiten etwa gleich. Sobald aber das System so unter Last ist, dass nicht alle Prozesse immer eine CPU bekommen, kann die reale Zeit deutlich höher werden.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="heading__tipps_für_das_tuning">
<span class="hidden-anchor sr-only" id="_tipps_für_das_tuning"></span>Tipps für das Tuning</h4>
<div class="paragraph"><p>Wie viele Meldungen die Event Console pro Sekunde verarbeiten kann, können Sie in etwa an der <span class="guihint">Processing time per message</span> ablesen.
Generell hängt diese Zeit damit zusammen, wie viele Regeln probiert werden müssen, bis eine Meldung verarbeitet wird.
Sie haben verschiedene Möglichkeiten, hier zu optimieren:</p></div>
<div class="ulist"><ul>
<li><p>Regeln, die sehr viele Meldungen ausschließen, sollten möglichst weit am Anfang der Regelkette stehen.</p></li>
<li><p>Arbeiten Sie mit <a href="#rulepacks">Regelpaketen</a>, um Sätze von verwandten Regeln zusammenzufassen.
Die erste Regel in jedem Paket sollte das Paket sofort verlassen, wenn die gemeinsame Grundbedingung nicht erfüllt ist.</p></li>
</ul></div>
<div class="paragraph"><p>Weiterhin gibt es in der EC eine Optimierung, die auf der <a href="#syslogfacility]">Syslog-Priorität und -Facility</a> basiert.
Dazu wird für jede Kombination von Priorität und Facility intern eine eigene Regelkette gebildet, in die jeweils nur solche Regeln aufgenommen werden, die für Meldungen dieser Kombination relevant sind.</p></div>
<div class="paragraph"><p>Jede Regel, die eine Bedingung auf die Priorität, die Facility oder am besten auf beides enthält, kommt dann nicht mehr in alle diese Regelketten, sondern optimalerweise nur in eine einzige.
Das bedeutet, dass diese Regel bei Meldungen mit einer anderen Syslog-Klassifizierung gar nicht überprüft werden muss.</p></div>
<div class="paragraph"><p>Im <code>~/var/log/mkeventd.log</code> sehen Sie nach einem Neustart eine Übersicht der optimierten Regelketten:</p></div>
<div class="listingblock">
<div class="title">var/log/mkeventd.log</div>
<div class="content"><pre class="pygments highlight"><code><span></span>[8488808306.233330]  kern        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233343]  user        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233355]  mail        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233367]  daemon      : emerg(120) alert(89) crit(89) err(89) warning(89) notice(89) info(89) debug(89)
[8488808306.233378]  auth        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233389]  syslog      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233408]  lpr         : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233482]  news        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233424]  uucp        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233435]  cron        : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233446]  authpriv    : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233457]  ftp         : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233469]  (unused 12) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233480]  (unused 13) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233498]  (unused 13) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233502]  (unused 14) : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233589]  local0      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233538]  local1      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233542]  local2      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233552]  local3      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233563]  local4      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233574]  local5      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233585]  local6      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233595]  local7      : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)
[8488808306.233654]  snmptrap    : emerg(112) alert(67) crit(67) err(67) warning(67) notice(67) info(67) debug(67)</code></pre></div>
</div>
<div class="paragraph"><p>In obigem Beispiel sehen Sie, dass es 67 Regeln gibt, die in jedem Fall geprüft werden müssen.
Bei Meldungen der Facility <code>daemon</code> sind 89 Regeln relevant, nur bei der Kombination <code>daemon</code>/<code>emerg</code> müssen 120 Regeln geprüft werden.
Jede Regel, die eine Bedingung auf Priorität oder Facility bekommt, reduziert die Anzahl von 67 weiter.</p></div>
<div class="paragraph"><p>Natürlich können Sie diese Bedingungen nur dann setzen, wenn Sie sicher sind, dass sie von den relevanten Meldungen auch erfüllt werden!</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__anzahl_aktueller_events">
<span class="hidden-anchor sr-only" id="_anzahl_aktueller_events"></span>11.2. Anzahl aktueller Events</h3>
<div class="paragraph"><p>Auch die Anzahl der aktuell vorhandenen Events kann die Performance der EC beeinflussen — und zwar, wenn diese deutlich aus dem Ruder läuft.
Wie bereits erwähnt, sollte die EC nicht als Ersatz für ein Syslog-Archiv gesehen werden, sondern lediglich „aktuelle Probleme“ anzeigen.
Die Event Console kann zwar durchaus mit mehreren tausend Problemen umgehen, aber der eigentliche Sinn ist das nicht.</p></div>
<div class="paragraph"><p>Sobald die Anzahl der aktuellen Events etwa 5 000 übersteigt, beginnt die Performance spürbar schlechter zu werden.
Das zeigt sich zum einen in der GUI, die langsamer auf Anfragen reagiert.
Zum anderen wird auch die Verarbeitung langsamer, da in manchen Situationen Meldungen mit allen aktuellen Events verglichen werden müssen.
Auch der Speicherbedarf kann problematisch werden.</p></div>
<div class="paragraph"><p>Die Event Console hält aus Gründen der Performance alle aktuellen Events stets im RAM.
Diese werden einmal pro Minute (einstellbar) und beim sauberen Beenden in die Datei <code>~/var/mkeventd/status</code> geschrieben.
Wenn diese sehr groß wird (z.B. über 50 Megabyte), wird dieser Vorgang ebenfalls immer langsamer.
Die aktuelle Größe können Sie schnell mit <code>ll</code> abfragen (Alias für <code>ls -alF</code>):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>-h<span class="tok-w"> </span>var/mkeventd/status
<span class="tok-go">-rw-r--r-- 1 mysite mysite <mark>386K</mark> Dez 14 13:46 var/mkeventd/status</span></code></pre></div></div>
<div class="paragraph"><p>Sollten Sie aufgrund einer ungeschickten Regel (z.B. einer, die auf alles matcht) viel zu viele aktuelle Events haben, ist ein manuelles Löschen über die GUI kaum noch sinnvoll zu schaffen.
In diesem Fall hilft einfach ein Löschen der Statusdatei:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>stop<span class="tok-w"> </span>mkeventd
<span class="tok-go">Stopping mkeventd...killing 17436......OK</span>
<span class="tok-gp">OMD[mysite]:~$ </span>rm<span class="tok-w"> </span>var/mkeventd/status
<span class="tok-gp">OMD[mysite]:~$ </span>omd<span class="tok-w"> </span>start<span class="tok-w"> </span>mkeventd
<span class="tok-go">Starting mkeventd (builtin: syslog-udp)...OK</span></code></pre></div></div>
<div class="paragraph"><p><strong>Achtung:</strong> Natürlich gehen dabei <em>alle</em> aktuellen Events verloren sowie die gespeicherten Zählerstände und andere Zustände.
Insbesondere beginnen neue Events dann wieder mit der ID 1.</p></div>
<div class="sect3">
<h4 id="heading_overflow">
<span class="hidden-anchor sr-only" id="overflow"></span>Automatischer Überlaufschutz</h4>
<div class="paragraph"><p>Die Event Console besitzt einen automatischen Schutz vor einem „Überlaufen“.
Dieser limitiert die Anzahl von aktuellen Events pro Host, pro Regel und global.
Dabei werden nicht nur offene Events gezählt, sondern auch solche in anderen Phasen, wie z.B. <span class="guihint">delayed</span> oder <span class="guihint">counting</span>.
Archivierte Events werden nicht gezählt.</p></div>
<div class="paragraph"><p>Dies schützt Sie in Situationen, in denen aufgrund eines systematischen Problems in Ihrem Netzwerk Tausende von kritischen Events hereinströmen und die Event Console „dicht“ machen würde.
Zum einen verhindert das Performance-Einbrüche der Event Console, die zu viele Events im Hauptspeicher halten müsste.
Zum anderen bleibt so die Übersicht für den Operator (einigermaßen) bewahrt und Events, die nicht Teil des Sturms sind, bleiben sichtbar.</p></div>
<div class="paragraph"><p>Sobald ein Limit erreicht ist, geschieht eine der folgenden Aktionen:</p></div>
<div class="ulist"><ul>
<li><p>Das Erzeugen neuer Events wird gestoppt (für diesen Host, diese Regel bzw. global).</p></li>
<li><p>Das Gleiche, aber zusätzlich wird ein „Overflow Event“ erzeugt.</p></li>
<li><p>Das Gleiche, aber zusätzlich werden passende Kontaktpersonen benachrichtigt.</p></li>
<li><p>Alternativ zu obigen drei Varianten können Sie auch das jeweils älteste Event löschen lassen, um Platz für das Neue zu machen.</p></li>
</ul></div>
<div class="paragraph"><p>Die Limits sowie die verknüpfte Auswirkung beim Erreichen stellen Sie in den <a href="#globalsettings">Einstellungen der Event Console</a> mit <span class="guihint">Limit amount of current events</span> ein.
Folgende Abbildung zeigt die Voreinstellung:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_limit_open_events.png" alt="ec limit open events"></div></div>
<div class="paragraph"><p>Falls Sie einen Wert mit <span class="guihint">…​create overflow event</span> aktiviert haben, wird beim Erreichen des Limits <em>ein</em> künstliches Event erzeugt, das den Operator von der Fehlersituation in Kenntnis setzt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_overflow_event.png" alt="ec overflow event"></div></div>
<div class="paragraph"><p>Falls Sie zusätzlich einen Wert mit <span class="guihint">…​notify contacts</span> aktiviert haben, werden passende Kontaktpersonen per Checkmk Benachrichtigung informiert.
Die Benachrichtigung durchläuft die <a href="notifications.html#rules">Benachrichtigungsregeln</a> von Checkmk.
Diese Regeln müssen sich nicht unbedingt an die Kontaktauswahl der Event Console halten, sondern können diese modifizieren.
Folgende Tabelle zeigt, welche Kontakte ausgewählt werden, falls Sie <span class="guihint">Notify all contacts of the notified host or service</span> eingestellt haben (was der Default ist):</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Limit</th>
<th class="tableblock halign-left valign-top">Kontaktauswahl</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pro Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Kontakte zum Host, welche genauso ermittelt werden, wie bei der <a href="#notifications">Benachrichtigung von Events</a> über Checkmk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pro Regel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hier wird das Feld für den Host-Namen leer gelassen. Falls in der Regel Kontaktgruppen definiert sind, werden diese ausgewählt, ansonsten die Fallback-Kontakte.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Fallback-Kontakte.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="heading__zu_großes_archiv">
<span class="hidden-anchor sr-only" id="_zu_großes_archiv"></span>11.3. Zu großes Archiv</h3>
<div class="paragraph"><p>Wie <a href="#archive">oben</a> gezeigt, hat die Event Console ein Archiv von allen Events und deren Verarbeitungsschritten.
Dieses ist aus Gründen der einfachen Implementierung und Administration in Textdateien abgelegt.</p></div>
<div class="paragraph"><p>Textdateien sind beim <em>Schreiben</em> von Daten in der Performance schwer zu übertreffen — von Datenbanken beispielsweise nur mit enormem Optimierungsaufwand.
Das liegt unter anderem an der Optimierung dieser Zugriffsart durch Linux und der kompletten Speicherhierarchie von Platten und SANs.
Dies geht allerdings zulasten der Lesezugriffe.
Da Textdateien über keinen Index verfügen, ist für das Suchen in den Dateien ein komplettes Einlesen notwendig.</p></div>
<div class="paragraph"><p>Die Event Console verwendet als Index für die <em>Zeit</em> der Ereignisse zumindest die Dateinamen der Log-Dateien.
Je weiter Sie den Anfragezeitraum eingrenzen, desto schneller geht also die Suche.</p></div>
<div class="paragraph"><p>Sehr wichtig ist trotzdem, dass Ihr Archiv nicht zu groß wird.
Wenn Sie die Event Console nur dazu verwenden, wirkliche Fehlermeldungen zu verarbeiten, kann das eigentlich nicht passieren.
Sollten Sie versuchen, die EC als Ersatz für ein echtes Syslog-Archiv einzusetzen, kann dies allerdings zu sehr großen Dateien führen.</p></div>
<div class="paragraph"><p>Wenn Sie in eine Situation geraten, in der Ihr Archiv zu groß geworden ist, können Sie einfach ältere Dateien in <code>~/var/mkeventd/history/</code> löschen.
Auch können Sie in <span class="guihint">Event history lifetime</span> die Lebenszeit der Daten generell begrenzen, so dass das Löschen in Zukunft voreingestellt ist.
Per Default wird 365 Tage gespeichert.
Vielleicht kommen Sie ja mit deutlich weniger aus.</p></div>
</div>
<div class="sect2">
<h3 id="heading__performance_über_die_zeit_messen">
<span class="hidden-anchor sr-only" id="_performance_über_die_zeit_messen"></span>11.4. Performance über die Zeit messen</h3>
<div class="paragraph"><p>Checkmk startet automatisch für jede laufende Instanz der Event Console einen Service, der die Leistungsdaten in Kurven aufzeichnet und Sie auch warnt, wenn es zu <a href="#overflow">Überläufen</a> kommt.</p></div>
<div class="paragraph"><p>Sofern Sie auf dem Monitoring-Server einen Linux-Agenten installiert haben, wird der Check wie gewohnt automatisch gefunden und eingerichtet:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_check.png" alt="ec check"></div></div>
<div class="paragraph"><p>Der Check bringt sehr viele interessante Messarten mit, z.B. die Anzahl der eingehenden Meldungen pro Zeit und wie viele davon verworfen wurden:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_message_rate.png" alt="ec graph message rate"></div></div>
<div class="paragraph"><p>Die Effizienz Ihrer Regelkette wird dargestellt durch einen Vergleich von ausprobierten Regeln zu solchen, die gegriffen haben:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_rule_efficiency.png" alt="ec graph rule efficiency"></div></div>
<div class="paragraph"><p>Dieser Graph zeigt die durchschnittliche Zeit für die Verarbeitung einer Meldung:</p></div>
<div class="imageblock"><div class="content"><img src="../images/ec_graph_processing_time.png" alt="ec graph processing time"></div></div>
<div class="paragraph"><p>Daneben gibt es noch etliche weitere Diagramme.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__verteiltes_monitoring">
<span class="hidden-anchor sr-only" id="_verteiltes_monitoring"></span>12. Verteiltes Monitoring</h2>
<div class="sectionbody"><div class="paragraph"><p>Wie Sie die Event Console in einer Installation mit mehreren Checkmk Instanzen einsetzen, erfahren Sie im <a href="distributed_monitoring.html#ec">Artikel über das verteilte Monitoring</a>.</p></div></div>
</div>
<div class="sect1">
<h2 id="heading__die_statusschnittstelle">
<span class="hidden-anchor sr-only" id="_die_statusschnittstelle"></span>13. Die Statusschnittstelle</h2>
<div class="sectionbody">
<div class="paragraph"><p>Die Event Console bietet über das Unix-Socket <code>~/tmp/run/mkeventd/status</code> sowohl Zugriff auf den internen Status als auch die Möglichkeit, Kommandos auszuführen.
Das hier verwendete Protokoll ist eine stark eingeschränkte Teilmenge von <a href="glossar.html#Livestatus">Livestatus</a>.
Auf diese Schnittstelle greift der Monitoring-Kern zu und reicht die Daten an die GUI durch, um so ein <a href="distributed_monitoring.html">verteiltes Monitoring</a> auch für die Event Console zu ermöglichen.</p></div>
<div class="paragraph"><p>Für den vereinfachten Livestatus der Event Console gelten folgende Einschränkungen:</p></div>
<div class="ulist"><ul>
<li><p>Die einzigen erlaubten Header sind <code>Filter:</code> und <code>OutputFormat:</code>.</p></li>
<li><p>Daher ist kein Keepalive möglich, pro Verbindung ist nur eine Anfrage durchführbar.</p></li>
</ul></div>
<div class="paragraph"><p>Folgende Tabellen sind verfügbar:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liste aller aktuellen Events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff auf das <a href="#archive">Archiv</a>. Eine Anfrage auf diese Tabelle führt zum Zugriff auf die Textdateien des Archivs. Verwenden Sie auf jeden Fall einen Filter über die Zeit des Eintrags, um einen Vollzugriff auf alle Dateien zu vermeiden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status- und Performancewerte der EC. Diese Tabelle hat immer genau eine Zeile.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Kommandos können Sie mithilfe von <code>unixcat</code> mit einer sehr einfachen Syntax in das Socket schreiben:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">"COMMAND RELOAD"</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>unixcat<span class="tok-w"> </span>tmp/run/mkeventd/status</code></pre></div></div>
<div class="paragraph"><p>Folgende Kommandos sind verfügbar:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archiviert ein Event. Argumente: Event-ID und Benutzerkürzel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RELOAD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neuladen der Konfiguration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHUTDOWN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beendet die Event Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REOPENLOG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Log-Datei wird neu geöffnet. Dieses Kommando wird von der Log-Dateirotation benötigt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLUSH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Löscht alle aktuellen und archivierten Events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYNC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Löst ein sofortiges Aktualisieren der Datei <code>~/var/mkeventd/status</code> aus.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESETCOUNTERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setzt die Trefferzähler der Regeln zurück (entspricht dem Menüeintrag <span class="guihint">Event Console &gt; Reset counters</span> in der Setup-GUI).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Führt ein Update von einem Event aus. Die Argumente sind der Reihe nach Event-ID, Benutzerkürzel, Quittierung (0/1), Kommentar und Kontaktinfo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANGESTATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ändert den Status <span class="state0">OK</span> / <span class="state1">WARN</span> / <span class="state2">CRIT</span> / <span class="state3">UNKNOWN</span> eines Events. Argumente sind Event-ID, Benutzerkürzel und Statusziffer (<code>0</code>/<code>1</code>/<code>2</code>/<code>3</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACTION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Führt eine benutzerdefinierte Aktion auf einem Event aus. Argumente sind Event-ID, Benutzerkürzel und Aktions-ID. Die spezielle ID <code>@NOTIFY</code> steht für eine <a href="#notifications">Benachrichtigung</a> über Checkmk.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="heading__dateien_und_verzeichnisse">
<span class="hidden-anchor sr-only" id="_dateien_und_verzeichnisse"></span>14. Dateien und Verzeichnisse</h2>
<div class="sectionbody"><table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbeitsverzeichnis des Event Daemons.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd/status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kompletter aktueller Zustand der Event Console. Dies umfasst vor allem alle aktuell offenen Events (und solche in Übergangsphasen wie <span class="guihint">counting</span> etc.). Im Falle einer Fehlkonfiguration, die zu sehr vielen offenen Events führt, kann diese Datei riesig werden und die Performance der EC drastisch reduzieren. In diesem Fall können Sie den Dienst <code>mkeventd</code> stoppen, die Datei löschen und den Dienst wieder starten, um alle offenen Events auf einmal zu löschen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/mkeventd/history/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ablageort des <a href="#archive">Archivs</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/log/mkeventd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log-Datei der Event Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mkeventd.d/wato/global.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die globalen Einstellungen der Event Console in Python-Syntax.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etc/check_mk/mkeventd.d/wato/rules.mk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ihre ganzen konfigurierten Regelpakete und Regeln in Python-Syntax.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eine Named Pipe, in die Sie mit <code>echo</code> oder anderen Befehlen direkt Meldungen schreiben können, um diese an die EC zu übergeben. Achten Sie darauf, dass zu jedem Zeitpunkt nur eine einzige Anwendung in diese Pipe schreibt, da sich die Texte der Meldungen sonst vermischen können.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/eventsocket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein Unix-Socket, das die gleiche Aufgabe wie die Pipe erfüllt, aber ein gleichzeitiges Schreiben mehrerer Anwendungen ermöglicht. Zum Hineinschreiben benötigen Sie den Befehl <code>unixcat</code> oder <code>socat</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/pid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die aktuelle Prozess-ID des Event Daemons während dieser läuft.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp/run/mkeventd/status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein Unix-Socket, das die Abfrage des aktuellen Status und das Senden von Kommandos erlaubt. Die Anfragen der GUI gehen zunächst zum Monitoring-Kern, der dann auf diesen Socket zugreift.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local/share/snmp/mibs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Von Ihnen hochgeladene MIB-Dateien für die Übersetzung von SNMP-Traps.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li>
<a href="#_einleitung">1. Einleitung</a><ul class="sectlevel1">
<li><a href="#_ereignisse_sind_keine_zust%C3%A4nde">1.1. Ereignisse sind keine Zustände</a></li>
<li><a href="#_die_event_console">1.2. Die Event Console</a></li>
<li><a href="#_begriffe">1.3. Begriffe</a></li>
</ul>
</li>
<li><a href="#setup">2. Die Event Console aufsetzen</a></li>
<li>
<a href="#_erste_schritte_mit_der_event_console">3. Erste Schritte mit der Event Console</a><ul class="sectlevel1">
<li><a href="#first_steps_rules">3.1. Regeln, Regeln, Regeln</a></li>
<li>
<a href="#_anlegen_einer_einfachen_regel">3.2. Anlegen einer einfachen Regel</a><ul class="sectlevel2">
<li><a href="#_aktivieren_der_%C3%A4nderungen">Aktivieren der Änderungen</a></li>
<li><a href="#eventsimulator">Ausprobieren der neuen Regel</a></li>
<li><a href="#_meldungen_testweise_von_hand_erzeugen">Meldungen testweise von Hand erzeugen</a></li>
</ul>
</li>
<li><a href="#globalsettings">3.3. Einstellungen der Event Console</a></li>
<li><a href="#permissions">3.4. Berechtigungen</a></li>
<li><a href="#hostnames">3.5. Host-Zuordnung in der Event Console</a></li>
</ul>
</li>
<li>
<a href="#monitoring">4. Die Event Console im Monitoring</a><ul class="sectlevel1">
<li><a href="#_event_ansichten">4.1. Event-Ansichten</a></li>
<li>
<a href="#commands">4.2. Kommandos und Workflow von Events</a><ul class="sectlevel2">
<li><a href="#_aktualisieren_und_quittieren">Aktualisieren und quittieren</a></li>
<li><a href="#_zustand_%C3%A4ndern">Zustand ändern</a></li>
<li><a href="#_aktionen_ausf%C3%BChren">Aktionen ausführen</a></li>
<li><a href="#_archivieren">Archivieren</a></li>
</ul>
</li>
<li>
<a href="#visibility">4.3. Sichtbarkeit von Events</a><ul class="sectlevel2">
<li><a href="#_problematik_der_sichtbarkeit">Problematik der Sichtbarkeit</a></li>
<li><a href="#_erst_einmal_d%C3%BCrfen_alle_alles_sehen">Erst einmal dürfen alle alles sehen</a></li>
<li><a href="#hostmatching">Zuordnung zu Hosts</a></li>
</ul>
</li>
<li>
<a href="#_fehlersuche">4.4. Fehlersuche</a><ul class="sectlevel2">
<li><a href="#_welche_regel_greift_wie_oft">Welche Regel greift wie oft?</a></li>
<li><a href="#_regelauswertung_debuggen">Regelauswertung debuggen</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#rules">5. Die ganze Mächtigkeit der Regeln</a><ul class="sectlevel1">
<li>
<a href="#_die_bedingung">5.1. Die Bedingung</a><ul class="sectlevel2">
<li><a href="#_allgemeines_zu_textvergleichen">Allgemeines zu Textvergleichen</a></li>
<li><a href="#matchgroups">Match-Gruppen</a></li>
<li><a href="#_ip_adresse">IP-Adresse</a></li>
<li><a href="#syslogfacility">Syslog-Priorität und -Facility</a></li>
<li><a href="#_invertieren_des_matches">Invertieren des Matches</a></li>
</ul>
</li>
<li>
<a href="#outcome">5.2. Auswirkung der Regel</a><ul class="sectlevel2">
<li><a href="#_regeltyp_abbrechen_oder_event_erzeugen">Regeltyp: Abbrechen oder Event erzeugen</a></li>
<li><a href="#_festlegen_des_status">Festlegen des Status</a></li>
<li><a href="#servicelevel">Service-Level</a></li>
<li><a href="#contactgroups">Kontaktgruppen</a></li>
<li><a href="#_aktionen">Aktionen</a></li>
<li><a href="#_automatisches_l%C3%B6schen_archivieren">Automatisches Löschen (Archivieren)</a></li>
</ul>
</li>
<li><a href="#rewriting">5.3. Automatisches Umschreiben von Texten (Rewriting)</a></li>
<li>
<a href="#cancelling">5.4. Automatisches Aufheben von Events (Cancelling)</a><ul class="sectlevel2">
<li><a href="#_ausf%C3%BChren_von_aktionen_beim_aufheben">Ausführen von Aktionen beim Aufheben</a></li>
<li><a href="#_aufheben_in_kombination_mit_umschreiben">Aufheben in Kombination mit Umschreiben</a></li>
<li><a href="#_aufheben_anhand_der_syslog_priorit%C3%A4t">Aufheben anhand der Syslog-Priorität</a></li>
</ul>
</li>
<li>
<a href="#counting">5.5. Zählen von Meldungen</a><ul class="sectlevel2">
<li><a href="#_zu_h%C3%A4ufige_meldungen">Zu häufige Meldungen</a></li>
<li><a href="#expect">Zu seltene oder ausbleibende Meldungen</a></li>
<li><a href="#_mehrfaches_auftreten_des_gleichen_problems">Mehrfaches Auftreten des gleichen Problems</a></li>
</ul>
</li>
<li><a href="#timing">5.6. Timing</a></li>
<li><a href="#rulepacks">5.7. Regelpakete</a></li>
</ul>
</li>
<li>
<a href="#actions">6. Aktionen</a><ul class="sectlevel1">
<li><a href="#_arten_von_aktionen">6.1. Arten von Aktionen</a></li>
<li>
<a href="#_shell_skripte_und_e_mails">6.2. Shell-Skripte und E-Mails</a><ul class="sectlevel2">
<li><a href="#_shell_skripte_ausf%C3%BChren">Shell-Skripte ausführen</a></li>
<li><a href="#_versenden_von_e_mails">Versenden von E-Mails</a></li>
</ul>
</li>
<li>
<a href="#notifications">6.3. Benachrichtigung durch Checkmk</a><ul class="sectlevel2">
<li><a href="#_zuordnung_zu_bestehenden_hosts">Zuordnung zu bestehenden Hosts</a></li>
<li><a href="#_restliche_felder_der_benachrichtigung">Restliche Felder der Benachrichtigung</a></li>
<li><a href="#_kontaktgruppen_manuell_festlegen">Kontaktgruppen manuell festlegen</a></li>
<li><a href="#_globaler_schalter_f%C3%BCr_benachrichtigungen">Globaler Schalter für Benachrichtigungen</a></li>
<li><a href="#_wartungszeiten_von_hosts">Wartungszeiten von Hosts</a></li>
<li><a href="#_zus%C3%A4tzliche_makros">Zusätzliche Makros</a></li>
</ul>
</li>
<li><a href="#automatic_actions">6.4. Aktionen ausführen</a></li>
</ul>
</li>
<li>
<a href="#snmp">7. SNMP-Traps</a><ul class="sectlevel1">
<li><a href="#_empfang_von_snmp_traps_aufsetzen">7.1. Empfang von SNMP-Traps aufsetzen</a></li>
<li><a href="#_testen">7.2. Testen</a></li>
<li><a href="#_aus_zahlen_werden_texte_traps_%C3%BCbersetzen">7.3. Aus Zahlen werden Texte: Traps übersetzen</a></li>
<li><a href="#_hochladen_eigener_mibs">7.4. Hochladen eigener MIBs</a></li>
</ul>
</li>
<li>
<a href="#logwatch">8. Überwachen von Log-Dateien</a><ul class="sectlevel1"><li><a href="#_service_level_und_syslog_priorit%C3%A4t">8.1. Service-Level und Syslog-Priorität</a></li></ul>
</li>
<li><a href="#eventsgostate">9. Event-Status im aktiven Monitoring sehen</a></li>
<li>
<a href="#archive">10. Das Archiv</a><ul class="sectlevel1">
<li><a href="#_funktionsweise">10.1. Funktionsweise</a></li>
<li><a href="#_speicherort_des_archivs">10.2. Speicherort des Archivs</a></li>
<li><a href="#_automatisches_archivieren">10.3. Automatisches Archivieren</a></li>
</ul>
</li>
<li>
<a href="#tuning">11. Performance und Tuning</a><ul class="sectlevel1">
<li>
<a href="#_verarbeitung_von_meldungen">11.1. Verarbeitung von Meldungen</a><ul class="sectlevel2">
<li><a href="#ecperformance">Messen der Performance</a></li>
<li><a href="#_tipps_f%C3%BCr_das_tuning">Tipps für das Tuning</a></li>
</ul>
</li>
<li>
<a href="#_anzahl_aktueller_events">11.2. Anzahl aktueller Events</a><ul class="sectlevel2"><li><a href="#overflow">Automatischer Überlaufschutz</a></li></ul>
</li>
<li><a href="#_zu_gro%C3%9Fes_archiv">11.3. Zu großes Archiv</a></li>
<li><a href="#_performance_%C3%BCber_die_zeit_messen">11.4. Performance über die Zeit messen</a></li>
</ul>
</li>
<li><a href="#_verteiltes_monitoring">12. Verteiltes Monitoring</a></li>
<li><a href="#_die_statusschnittstelle">13. Die Statusschnittstelle</a></li>
<li><a href="#_dateien_und_verzeichnisse">14. Dateien und Verzeichnisse</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
