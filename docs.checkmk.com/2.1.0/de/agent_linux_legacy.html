<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Der Linux-Agent kann im Legacy-Modus ohne Agent Controller betrieben werden, wenn er die Voraussetzungen für den verschlüsselten Pull-Modus nicht erfüllt.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Linux überwachen im Legacy-Modus">
<meta name="og:description" content="Der Linux-Agent kann im Legacy-Modus ohne Agent Controller betrieben werden, wenn er die Voraussetzungen für den verschlüsselten Pull-Modus nicht erfüllt.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Linux überwachen im Legacy-Modus</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/en/agent_linux_legacy.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/de/agent_linux_legacy.html">2.2.0</a><a class="dropdown-item" href="../../latest/de/agent_linux_legacy.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host- und Serviceparameter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Einführung in die Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMWare ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Konfiguration via Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
<li>
<p><a href="web_api.html">Konfiguration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Befehlsreferenz der HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Eigene Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Linux überwachen im Legacy-Modus</h1>
<div class="details">
<span id="revdate">Last modified on 28-Apr-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/de/agent_linux_legacy.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">Dies ist eine am 2025-01-07 22:12:14 +0000 für die Offline-Nutzung exportierte Seite. Sie spiegelt möglicherweise nicht den aktuellen Stand der Checkmk Dokumentation wider. Um eine täglich aktualisierte Version dieser Seite anzusehen, rufen Sie bitte <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a> auf.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="agent_linux.html">Linux überwachen</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__einleitung">
<span class="hidden-anchor sr-only" id="_einleitung"></span>1. Einleitung</h2>
<div class="sectionbody">
<div class="imageblock inline-image"><div class="content"><img src="../images/linux.png" alt="linux" width="120"></div></div>
<div class="paragraph"><p>Seit der Checkmk-Version <span class="new">2.1.0</span> beherrscht der neue Linux-Agent mit dem <strong>Agent Controller</strong> den registrierten, TLS-verschlüsselten und komprimierten <strong>Pull-Modus</strong>.
Allerdings muss dafür der Agent Controller auf dem Host, auf dem er installiert werden soll, als Hintergrundprozess (<em>Daemon</em>) vom init-System gestartet werden.
Derzeit wird diesbezüglich nur <code>systemd</code> auf der x86_64-Plattform unterstützt und für die Einrichtung Paketmanagement für <code>deb</code> oder <code>rpm</code> Pakete vorausgesetzt.</p></div>
<div class="paragraph"><p>Sind alle der folgenden Voraussetzungen erfüllt…</p></div>
<div class="ulist"><ul>
<li><p>Ihr Linux nutzt <code>systemd</code> ab Version 219 als init-System</p></li>
<li><p>Die Rechnerarchitektur ist x86_64</p></li>
<li><p>Pakete werden als <code>deb</code> oder <code>rpm</code> verwaltet</p></li>
</ul></div>
<div class="paragraph"><p>…erfahren Sie im Artikel <a href="agent_linux.html">Linux überwachen</a>, wie Sie den Agenten mit Agent Controller installieren, konfigurieren und erweitern können.</p></div>
<div class="paragraph"><p>Diese Voraussetzungen erfüllen zwar die größte Zahl der Linux-Server und -Desktops, doch sind Jahre lang <em>von Version zu Version aktualisierte Systeme</em>, ältere <em>virtuelle Maschinen</em> mit i686 Instanzen, <em>Distroless Container</em> oder <em>Embedded Linux</em> Systeme eben keine Randerscheinungen, sondern normale Bestandteile vieler Systemlandschaften, für die es Überwachungsbedarf gibt.
Dank der Modularität von Checkmk können Sie solche Linux-Hosts dennoch ins Monitoring aufnehmen.</p></div>
<div class="paragraph"><p>Da der verschlüsselte Transport der Agentendaten per Agent Controller hier nicht in Frage kommt, erklären wir in diesem Artikel, wie Sie entweder den unverschlüsselten Transport über einen <em>Internet Superserver</em> oder die Konfiguration von <em>SSH als verschlüsselten Tunnel</em> vornehmen.</p></div>
<div class="paragraph"><p>Die Themen, für die der Modus des Agenten keine Rolle spielt, können Sie im Artikel über den Linux-Agenten mit Agent Controller nachlesen:</p></div>
<div class="ulist"><ul>
<li><p><a href="agent_linux.html#disabled_sections">Sektionen deaktivieren</a></p></li>
<li><p><a href="agent_linux.html#plugins">Agent um Plugins erweitern</a></p></li>
<li><p><a href="agent_linux.html#e2e_monitoring">Einbinden von klassischen (Nagios-) Check-Plugins</a></p></li>
<li><p><a href="agent_linux.html#hw_monitoring">Hardware überwachen</a></p></li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__installation">
<span class="hidden-anchor sr-only" id="_installation"></span>2. Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Je nach Paketmanagement stehen drei Installationsmöglichkeiten zur Auswahl: Entweder DEB- oder RPM-Pakete für Debian, Ubuntu, RHEL, SLES (und deren Derivate), ein TGZ-Archiv für alle anderen Distributionen (<span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong>) oder ebenfalls für weitere Distributionen ein Shellscript (<span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong>).</p></div>
<div class="sect2">
<h3 id="heading_frompackage">
<span class="hidden-anchor sr-only" id="frompackage"></span>2.1. Installation aus Paketen</h3>
<div class="paragraph"><p>Eine umfangreiche Beschreibung der Installation aus <code>deb</code>- oder  <code>rpm</code>-Paketen zeigen wir im Artikel <a href="agent_linux.html">Linux überwachen</a>.
Daher erklären wir hier nur die Vorgehensweise im Schnelldurchlauf.</p></div>
<div class="paragraph"><p>In der <span class="image-inline"><img src="../images/CRE.svg" alt="CRE" width="20" title="Checkmk Raw Edition"></span> <strong>Checkmk Raw Edition</strong> finden Sie die Linux-Pakete des Agenten über <span class="guihint">Setup &gt; Agents &gt; Linux</span>.
In den <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> gelangen Sie im <span class="guihint">Setup</span>-Menü über <span class="guihint">Agents &gt; Windows, Linux, Solaris, AIX</span> zunächst in die <a href="wato_monitoringagents.html#bakery">Agentenbäckerei</a>, wo Sie die gebackenen Pakete finden.
Von dort aus kommen Sie mit dem Menüeintrag <span class="guihint">Related &gt; Linux, Solaris, AIX files</span> zur Liste der Agentendateien</p></div>
<div class="paragraph"><p>Sie können diese über den Browser herunterladen oder direkt auf dem Host im Monitoring <code>wget</code> oder <code>curl</code> zum Download nutzen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>wget<span class="tok-w"> </span>http://mycmkserver/mysite/check_mk/agents/check-mk-agent-2.1.0b1-1.noarch.rpm</code></pre></div></div>
<div class="paragraph"><p>Auf RHEL, SLES und verwandten Distributionen erfolgt die Installation des RPM-Pakets unter <code>root</code> mit dem Befehl <code>rpm -U</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>rpm<span class="tok-w"> </span>-U<span class="tok-w"> </span>check-mk-agent-2.1.0b1-1.noarch.rpm</code></pre></div></div>
<div class="paragraph"><p>Die Option <code>-U</code> steht übrigens für „Update“, kann aber auch eine Erstinstallation korrekt durchführen.</p></div>
<div class="paragraph"><p>Die Installation des DEB-Pakets auf Debian, Ubuntu oder verwandten Distributionen erfolgt unter <code>root</code> mit dem Befehl <code>dpkg -i</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>dpkg<span class="tok-w"> </span>-i<span class="tok-w"> </span>check-mk-agent_2.1.0b1-1_all.deb
<span class="tok-gp tok-gp-VirtualEnv">(Reading database ... 739920 files and directories currently installed.)</span>
<span class="tok-go">Preparing to unpack .../check-mk-agent_2.1.0b5-1_all.deb ...</span>
<span class="tok-go">Unpacking check-mk-agent (2.1.0b5-1) ...</span>
<span class="tok-go">Setting up check-mk-agent (2.1.0b5-1) ...</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_tarball">
<span class="hidden-anchor sr-only" id="tarball"></span>2.2. Installation aus dem TGZ-Archiv</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span> Für die komfortable distributionsunabhängige Installation benötigen Sie den Linux-Agenten im TGZ-Archivformat ("Tarball"), den Sie in den Enterprise Editions im Setup-Menü über <span class="guihint">Agents &gt; Windows, Linux, Solaris, AIX</span> herunterladen können.
Das TGZ-Archiv enthält die komplette Verzeichnisstruktur des Linux-Agenten zum Entpacken im Wurzelverzeichnis des überwachten Hosts.</p></div>
<div class="imageblock"><div class="content"><img src="../images/agent_linux_legacy_agents.png" alt="agent linux legacy agents"></div></div>
<div class="paragraph"><p>Damit alle Pfade stimmen, ist der Parameter <code>-C</code> ("change directory") beim Entpacken unerlässlich.
Wir verwenden zudem <code>--no-overwrite-dir</code>, damit Berechtigungen von bereits vorhandenen Verzeichnissen nicht verändert werden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>tar<span class="tok-w"> </span>-C<span class="tok-w"> </span>/<span class="tok-w"> </span>--no-overwrite-dir<span class="tok-w"> </span>-xvf<span class="tok-w"> </span>/tmp/check-mk-agent_2.1.0b6.tar.gz</code></pre></div></div>
<div class="paragraph"><p>Wenn Sie alles richtig gemacht haben, muss das Agentenskript jetzt einfach als Befehl ausführbar sein und seine typische Ausgabe erzeugen.
Das <code>| head</code> schneidet hier alles ab der 11. Zeile weg:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>check_mk_agent<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>head
<span class="tok-go">&lt;&lt;&lt;check_mk&gt;&gt;&gt;</span>
<span class="tok-go">Version: 2.1.0b6</span>
<span class="tok-go">AgentOS: linux</span>
<span class="tok-go">Hostname: mycmkserver</span>
<span class="tok-go">AgentDirectory: /etc/check_mk</span>
<span class="tok-go">DataDirectory: /var/lib/check_mk_agent</span>
<span class="tok-go">SpoolDirectory: /var/lib/check_mk_agent/spool</span>
<span class="tok-go">PluginsDirectory: /usr/lib/check_mk_agent/plugins</span>
<span class="tok-go">LocalDirectory: /usr/lib/check_mk_agent/local</span>
<span class="tok-go">&lt;&lt;&lt;df&gt;&gt;&gt;</span></code></pre></div></div>
<div class="paragraph"><p>Wird hier eine Versionsnummer kleiner als <span class="new">2.1.0</span> ausgegeben, haben Sie vermutlich noch eine ältere Version des Agentenskripts als <code>/usr/local/bin/check_mk_agent</code> installiert.
Verschieben Sie dieses alte Skript, oder benennen Sie es um, beispielsweise indem Sie <code>.bak</code> an den Dateinamen anhängen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_manual">
<span class="hidden-anchor sr-only" id="manual"></span>2.3. Manuelle Installation des Agentenskripts</h3>
<div class="paragraph"><p>Die manuelle Installation des Agentenskripts ist zwar selten nötig, aber auch nicht sehr schwierig.
Bei dieser Installationsart wird zunächst nur das Agentenskript installiert, aber noch keine Konfiguration des Zugriffs vorgenommen.
Sie benötigen aus der Seite der Agentendateien dazu den Kasten <span class="guihint">Agents</span>.
Dort finden Sie die Datei <span class="guihint">check_mk_agent.linux</span>:</p></div>
<div class="imageblock"><div class="content"><img src="../images/agent_linux_agents_manual.png" alt="agent linux agents manual"></div></div>
<div class="paragraph"><p>Laden Sie diese Datei auf das Zielsystem und kopieren Sie sie in ein Verzeichnis, das für <code>root</code> ausführbar ist.
Gut eignet sich <code>/usr/local/bin/</code>, da es sich im Suchpfad befindet und für eigene Erweiterungen gedacht ist.
Alternativ können Sie <code>/usr/bin</code> oder ein Unterverzeichnis von <code>/opt</code> verwenden.
Wir verwenden <code>/usr/bin</code>, damit alle Tests den anderen Installationsmethoden entsprechen.
Die Installation können Sie auch direkt mit <code>wget</code> durchführen, sofern vorhanden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span><span class="tok-nb">cd</span><span class="tok-w"> </span>/usr/bin
<span class="tok-gp">root@linux# </span>wget<span class="tok-w"> </span>http://mycmkserver/mysite/check_mk/agents/check_mk_agent.linux
<span class="tok-gp">root@linux# </span>mv<span class="tok-w"> </span>check_mk_agent.linux<span class="tok-w"> </span>check_mk_agent
<span class="tok-gp">root@linux# </span>chmod<span class="tok-w"> </span><span class="tok-m">755</span><span class="tok-w"> </span>check_mk_agent</code></pre></div></div>
<div class="paragraph"><p>Vergessen Sie nicht die letzten beiden Befehle:
Damit entfernen Sie die Endung <code>.linux</code> und machen die Datei ausführbar.
Jetzt muss der Agent als Befehl ausführbar sein und seine typische Ausgabe erzeugen.
Das <code>| head</code> schneidet hier alles ab der 11. Zeile weg:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>check_mk_agent<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>head
<span class="tok-go">&lt;&lt;&lt;check_mk&gt;&gt;&gt;</span>
<span class="tok-go">Version: 2.1.0b6</span>
<span class="tok-go">AgentOS: linux</span>
<span class="tok-go">Hostname: mycmkserver</span>
<span class="tok-go">AgentDirectory: /etc/check_mk</span>
<span class="tok-go">DataDirectory: /var/lib/check_mk_agent</span>
<span class="tok-go">SpoolDirectory: /var/lib/check_mk_agent/spool</span>
<span class="tok-go">PluginsDirectory: /usr/lib/check_mk_agent/plugins</span>
<span class="tok-go">LocalDirectory: /usr/lib/check_mk_agent/local</span>
<span class="tok-go">&lt;&lt;&lt;df&gt;&gt;&gt;</span></code></pre></div></div>
<div class="paragraph"><p>Falls Sie den Agenten konfigurieren oder erweitern möchten, müssen Sie die dafür notwendigen Verzeichnisse selbst anlegen.
Der Ort für die drei notwendigen Verzeichnisse ist im Agenten hart kodiert in Variablen, die mit <code>MK_</code> beginnen und über das Environment auch den Plugins bereitgestellt werden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>grep<span class="tok-w"> </span><span class="tok-s1">'export MK_'</span><span class="tok-w"> </span>check_mk_agent
<span class="tok-go">export MK_LIBDIR="/usr/lib/check_mk_agent"</span>
<span class="tok-go">export MK_CONFDIR="/etc/check_mk"</span>
<span class="tok-go">export MK_VARDIR="/var/lib/check_mk_agent"</span></code></pre></div></div>
<div class="paragraph"><p>Diese drei Verzeichnisse sollten Sie anlegen (mit den Standardrechten 755 und <code>root</code> als Eigentümer):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>mkdir<span class="tok-w"> </span>/usr/lib/check_mk_agent<span class="tok-w"> </span>/etc/check_mk<span class="tok-w"> </span>/var/lib/check_mk_agent</code></pre></div></div>
<div class="paragraph"><p>Falls Sie die Pfade ändern möchten, so editieren Sie einfach <code>/usr/bin/check_mk_agent</code>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_inventory">
<span class="hidden-anchor sr-only" id="inventory"></span>3. Bestandsaufnahme nach Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Prüfen Sie nach der Installation, ob bereits ein Dienst eingerichtet wurde, der auf dem TCP Port 6556 lauscht.
Insbesondere bei Installation über Paketmanager wird ein bereits vorhandener <code>xinetd</code> oder <code>systemd</code> (im Superserver-Modus) verwendet, um eine unverschlüsselte Agentenausgabe auf TCP Port 6556 bereitzustellen.</p></div>
<div class="paragraph"><p>Wir verwenden den Befehl <code>ss</code>.
Sollte er (auf älteren Distributionen) nicht vorhanden sein, steht ersatzweise eines der Programme <code>netstat</code>, <code>sockstat</code> oder <code>lsof</code> zur Verfügung.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>ss<span class="tok-w"> </span>-tulpn<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span><span class="tok-m">6556</span>
<span class="tok-go">tcp	LISTEN 0	64	*:6556	*:*	users:(("xinetd",pid=1573,fd=5))</span></code></pre></div></div>
<div class="paragraph"><p>Erfolgt keine Ausgabe, ist Port 6556 noch nicht geöffnet. Wird eine Zeile ausgegeben, dann ist Port 6556 geöffnet.
Uns interessiert in diesem Fall der Programmname innerhalb der Klammer, hier <code>xinetd</code>.
Merken Sie sich diesen Programmnamen, da sie ihn im weiteren Verlauf noch benötigen – unabhängig von der gewählten Zugriffsmethode.</p></div>
<div class="paragraph"><p>Wenn nach Installation aus DEB- oder RPM-Paket hier als Programmname <code>cmk-agent-ctl</code> ausgegeben wird, können Sie sich freuen:
Ihr Linux (vor allem die verwendete systemd-Version) ist dann doch aktuell genug für die Verwendung des Agent Controllers, wie im Artikel <a href="agent_linux.html">Linux überwachen</a> beschrieben, und Sie können die Registrierung des Agenten vornehmen.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__auswahl_der_zugriffsmethode">
<span class="hidden-anchor sr-only" id="_auswahl_der_zugriffsmethode"></span>4. Auswahl der Zugriffsmethode</h2>
<div class="sectionbody">
<div class="paragraph"><p>An dieser Stelle stehen Sie vor der Entscheidung:</p></div>
<div class="ulist"><ul>
<li><p>Wollen Sie eine einfach einzurichtende unverschlüsselte Verbindung zulassen?</p></li>
<li><p>Oder ist Ihnen die höhere Sicherheit mit Verschlüsselung einen gewissen Mehraufwand wert?</p></li>
</ul></div>
<div class="paragraph"><p>Die hierfür relevanten Aspekte sind, auf welche Informationen ein potentieller Angreifer Zugriff hat und wie groß sein Aufwand ist.
So kann bereits die immer übertragene Prozesstabelle wertvolle Hinweise liefern und eine Liste noch nicht durchgeführter Software-Updates ermöglicht zielgerichtete Angriffe.</p></div>
<div class="paragraph"><p>Wir raten daher im Regelfall zu einer verschlüsselten Datenübertragung über einen <a href="#ssh">SSH-Tunnel</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__unverschlüsselt_einrichtung_von_xinetd">
<span class="hidden-anchor sr-only" id="_unverschlüsselt_einrichtung_von_xinetd"></span>5. Unverschlüsselt: Einrichtung von (x)inetd</h2>
<div class="sectionbody">
<div class="paragraph"><p>Sollten Sie zum Schluss kommen, dass eine unverschlüsselte Datenübertragung ein kalkulierbares Risiko ist, steht die Einrichtung eines <em>Internet Superservers</em> an.
Falls der Test mit <code>ss</code> ergeben hat, dass bereits <code>xinetd</code>, <code>inetd</code> oder <code>systemd</code> auf TCP Port 6556 lauscht, springen Sie weiter zum <a href="#connectiontest">Verbindungstest</a>.</p></div>
<div class="paragraph"><p>Ist dies nicht der Fall, prüfen Sie mit dem <code>ps</code> Befehl, ob bereits ein <code>inetd</code> aktiv ist:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span><strong>ps<span class="tok-w"> </span>ax<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span>inetd</strong>
<span class="tok-go"> 1913 ?        Ss     0:00 /usr/sbin/xinetd -pidfile /run/xinetd.pid -stayalive -inetd_compat -inetd_ipv6</span></code></pre></div></div>
<div class="paragraph"><p>Am ausgeführten Prozess erkennen Sie, ob es sich um den moderneren <code>xinetd</code> oder einen der anderen Internet Superserver (GNU-Inetutils, OpenBSD-Inetd, Busybox-Inetd) handelt.
Ist kein Prozess aktiv, installieren Sie einen <code>xinetd</code> über das Paketmanagement Ihrer Distribution.
Sollte ein "klassischer" <code>inetd</code> aktiv sein, ist es meist sinnvoll, diesen zu nutzen und <a href="#otherinetd">einzurichten</a> statt auf <code>xinetd</code> zu wechseln.</p></div>
<div class="sect2">
<h3 id="heading_xinetd">
<span class="hidden-anchor sr-only" id="xinetd"></span>5.1. xinetd einrichten</h3>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span> Für die Konfiguration eines bereits vorhandenen <code>xinetd</code>, der das Verzeichnis <code>/etc/xinetd.d/</code> zur Konfiguration verwendet, bringen sowohl das TGZ-Archiv als auch die DEB- und RPM-Pakete ein Skript bei, welches in zwei Schritten zuerst die Konfiguration installiert und dann den <code>xinetd</code> die geänderten Einstellungen einlesen lässt.
Das Skript müssen Sie mit vollem Pfad aufrufen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span><strong>/var/lib/cmk-agent/scripts/super-server/1_xinetd/setup<span class="tok-w"> </span>deploy</strong>
<span class="tok-gp">root@linux# </span><strong>/var/lib/cmk-agent/scripts/super-server/1_xinetd/setup<span class="tok-w"> </span>trigger</strong></code></pre></div></div>
<div class="paragraph"><p>Bei manueller Installation des Agentenskriptes legen Sie die Konfigurationsdatei <code>/etc/xinetd.d/check-mk-agent</code> mit dem Editor an.
Als Inhalt genügt:</p></div>
<div class="listingblock">
<div class="title">/etc/xinetd.d/check-mk-agent</div>
<div class="content"><pre class="pygments highlight"><code><span></span>service check_mk
{
        type           = UNLISTED
        port           = 6556
        socket_type    = stream
        protocol       = tcp
        wait           = no
        user           = root
        server         = /usr/local/bin/check_mk_agent
        # only_from    = 10.118.14.5 10.118.14.37
        disable        = no
}</code></pre></div>
</div>
<div class="paragraph"><p>Hier haben wir eine (auskommentierte) Zeile ergänzt, in welcher der Zugriff auf zwei Checkmk-Server eingeschränkt wird.
Weitere Konfigurationsmöglichkeiten zeigt ein Blick in die Datei <code>~/share/check_mk/agents/scripts/super-server/1_xinetd/check-mk-agent</code> auf Ihrem Checkmk-Server.</p></div>
<div class="paragraph"><p>Falls Ihr <code>xinetd</code> das alte Konfigurationsschema mit lediglich einer großen <code>/etc/xinetd.conf</code> nutzt, übertragen Sie die Beispielkonfiguration aus <code>/etc/check_mk/xinetd-service-template.cfg</code> in die <code>/etc/xinetd.conf</code>.</p></div>
<div class="paragraph"><p>Ist die Konfiguration des <code>xinetd</code> abgeschlossen, starten Sie ihn neu:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>service<span class="tok-w"> </span>xinetd<span class="tok-w"> </span>restart</code></pre></div></div>
<div class="paragraph"><p>Sie sind nun bereit für den <a href="#connectiontest">Verbindungstest</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_otherinetd">
<span class="hidden-anchor sr-only" id="otherinetd"></span>5.2. Andere inetd einrichten</h3>
<div class="paragraph"><p>Prüfen Sie zunächst, ob Ihre <code>/etc/services</code> bereits einen Eintrag für Port 6556 enthält:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span><strong>grep<span class="tok-w"> </span><span class="tok-m">6556</span>/<span class="tok-w"> </span>/etc/services</strong></code></pre></div></div>
<div class="paragraph"><p>Ist dies nicht der Fall, muss Checkmk als Dienst bekannt gemacht werden.
Fügen Sie dafür folgende Zeile hinzu. Die Schreibweise entspricht dabei exakt der in der <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?search=checkmk-agent" target="_blank">IANA-Tabelle hinterlegten</a> mit nur einem Bindestrich:</p></div>
<div class="listingblock">
<div class="title">/etc/services</div>
<div class="content"><pre class="pygments highlight"><code><span></span>checkmk-agent        6556/tcp   #Checkmk monitoring agent</code></pre></div>
</div>
<div class="paragraph"><p>Das Format der Konfigurationsdatei <code>/etc/inetd.conf</code> unterscheidet sich zwischen den verschiedenen Varianten.
Entnehmen Sie den Kommentaren in der Konfigurationsdatei und der Manual Page (<code>man 5 inetd.conf</code>) das zu Ihrem <code>inetd</code> passende Format.
Es folgt die Konfiguration passend zum <code>openbsd-inetd</code> mit zwei Zeilen für IPv4- und IPv6-Unterstützung.
Auch hier gilt es, die korrekte Schreibweise zu beachten:</p></div>
<div class="listingblock">
<div class="title">/etc/inetd.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span>checkmk-agent stream tcp  nowait root /usr/bin/check_mk_agent
checkmk-agent stream tcp6 nowait root /usr/bin/check_mk_agent</code></pre></div>
</div>
<div class="paragraph"><p>Nach Änderung der Konfigurationsdatei starten Sie den <code>inetd</code> neu, bspw. mit:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span><strong>/etc/init.d/inetd<span class="tok-w"> </span>restart</strong></code></pre></div></div>
<div class="paragraph"><p>Je nach verwendetem init-System und installiertem Superserver kann dieses Kommando abweichen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_connectiontest">
<span class="hidden-anchor sr-only" id="connectiontest"></span>5.3. Verbindungstest</h3>
<div class="paragraph"><p>Prüfen Sie zunächst, ob der <code>xinetd</code> oder <code>inetd</code> (neu) gestartet werden konnte:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>ss<span class="tok-w"> </span>-tulpn<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span><span class="tok-m">6556</span>
<span class="tok-go">tcp	LISTEN 0	64	*:6556	*:*	users:(("xinetd",pid=1573,fd=5))</span></code></pre></div></div>
<div class="paragraph"><p>Nun können Sie sich mit <code>telnet</code> oder <code>nc</code> (<code>netcat</code>) auf TCP Port 6556 verbinden – zunächst vom Host selbst, später vom Checkmk-Server aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>nc<span class="tok-w"> </span><span class="tok-m">12</span>.34.56.78<span class="tok-w"> </span><span class="tok-m">6556</span>
<span class="tok-go">&lt;&lt;&lt;check_mk&gt;&gt;&gt;</span>
<span class="tok-go">Version: 2.1.0b6</span>
<span class="tok-go">AgentOS: linux</span>
<span class="tok-go">Hostname: myhost123</span>
<span class="tok-go">AgentDirectory: /etc/check_mk</span>
<span class="tok-go">DataDirectory: /var/lib/check_mk_agent</span>
<span class="tok-go">SpoolDirectory: /var/lib/check_mk_agent/spool</span>
<span class="tok-go">PluginsDirectory: /usr/lib/check_mk_agent/plugins</span>
<span class="tok-go">LocalDirectory: /usr/lib/check_mk_agent/local</span></code></pre></div></div>
<div class="paragraph"><p>Erfolgt trotz aktivem <code>(x)inetd</code> ein Hinweis auf eine verweigerte Verbindung, prüfen Sie Ihre Firewall-Einstellungen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_ssh">
<span class="hidden-anchor sr-only" id="ssh"></span>6. Verschlüsselt: Nutzung eines SSH-Tunnels</h2>
<div class="sectionbody">
<div class="paragraph"><p>Die Einrichtung des SSH-Tunnels geschieht in folgenden Schritten:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Erstellen Sie ein SSH-Schlüsselpaar speziell für diesen Zweck.</p></li>
<li><p>Erlauben Sie auf den Zielsystemen den Zugriff auf den Agenten mittels dieses Schlüssels.</p></li>
<li><p>Konfigurieren Sie den Checkmk-Server so, dass er anstelle der TCP-Verbindung auf Port 6556 SSH verwendet.</p></li>
<li><p>Falls vorhanden: Klemmen Sie den Zugriff via <code>(x)inetd</code> ab.</p></li>
</ol></div>
<div class="paragraph"><p>Und das Ganze jetzt Schritt für Schritt mit allen notwendigen Details:</p></div>
<div class="sect2">
<h3 id="heading__ssh_schlüsselpaar_erstellen">
<span class="hidden-anchor sr-only" id="_ssh_schlüsselpaar_erstellen"></span>6.1. SSH-Schlüsselpaar erstellen</h3>
<div class="paragraph"><p>SSH arbeitet mit „Public-Key-Authentifizierung“.
Dazu erzeugt man zunächst ein Paar von aufeinander abgestimmten Schlüsseln, bei denen einer öffentlich (public) ist und einer geheim (private).
Bei der Wahl der Algorithmen können Sie wählen zwischen <code>rsa</code>, <code>ecdsa</code> oder <code>ed25519</code>.
In dem nachfolgenden Beispiel nutzen Sie den Befehl <code>ssh-keygen -t ed25519</code> als Instanzbenutzer:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ssh-keygen<span class="tok-w"> </span>-t<span class="tok-w"> </span>ed25519
<span class="tok-go">Generating public/private ed25519 key pair.</span>
<span class="tok-go">Enter file in which to save the key (/omd/sites/mysite/.ssh/id_ed25519):</span>
<span class="tok-go">Enter passphrase (empty for no passphrase):</span>
<span class="tok-go">Enter same passphrase again:</span>
<span class="tok-go">Your identification has been saved in /omd/sites/mysite/.ssh/id_ed25519.</span>
<span class="tok-go">Your public key has been saved in /omd/sites/mysite/.ssh/id_ed25519.pub.</span>
<span class="tok-go">The key fingerprint is:</span>
<span class="tok-go">cc:87:34:d2:ed:87:ed:f7:1b:ec:58:1f:7c:23:00:e2 mysite@mycmkserver</span>
<span class="tok-go">The key's randomart image is:</span>
<span class="tok-go">+--[ED25519  256--+</span>
<span class="tok-go">|                 |</span>
<span class="tok-go">|       . .       |</span>
<span class="tok-go">|      ..+..      |</span>
<span class="tok-go">|      .=.+.o     |</span>
<span class="tok-go">|       ES +.o    |</span>
<span class="tok-go">|         . o. o  |</span>
<span class="tok-go">|            ...B.|</span>
<span class="tok-go">|             .=.*|</span>
<span class="tok-go">|             . o+|</span>
<span class="tok-go">+-----------------+</span></code></pre></div></div>
<div class="paragraph"><p>Lassen Sie den Dateinamen leer, um den vorgeschlagenen Dateinamen zu verwenden.
Selbstverständlich können Sie einen anderen Pfad angeben, beispielsweise wenn Sie mit <a href="#multiplekeys">verschiedenen Schlüsseln für verschiedene Hosts</a> arbeiten wollen.</p></div>
<div class="paragraph"><p><strong>Wichtig</strong>: Geben Sie <strong>keine</strong> Passphrase an!
Es nützt Ihnen nichts, die Datei mit dem geheimen Schlüssel zu verschlüsseln.
Denn Sie möchten ja sicher nicht jedes Mal beim Start des Checkmk-Servers die Passphrase eingeben müssen…​</p></div>
<div class="paragraph"><p>Das Ergebnis sind zwei Dateien im Verzeichnis <code>.ssh</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ll<span class="tok-w"> </span>.ssh
<span class="tok-go">total 8</span>
<span class="tok-go">-rw------- 1 mysite mysite 1679 Feb 20 14:18 id_ed25519</span>
<span class="tok-go">-rw-r--r-- 1 mysite mysite  398 Feb 20 14:18 id_ed25519.pub</span></code></pre></div></div>
<div class="paragraph"><p>Der private Schlüssel heißt <code>id_ed25519</code> und ist nur für den Instanzbenutzer lesbar (<code>-rw-------</code>) — und das ist auch gut so!
Der öffentliche Schlüssel <code>id_ed25519.pub</code> sieht etwa so aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cat<span class="tok-w"> </span>.ssh/id_ed25519.pub
<span class="tok-go">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGb6AaqRPlbEmDnBkeIW3Q6Emb5lr2QEbWEQLmA5pb48 mysite@mycmkserver</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__zugriff_per_ssh_erlauben">
<span class="hidden-anchor sr-only" id="_zugriff_per_ssh_erlauben"></span>6.2. Zugriff per SSH erlauben</h3>
<div class="paragraph"><p>Der nächste Schritt muss jetzt auf (je-)dem per SSH überwachten Linux-Hosts stattfinden.
Loggen Sie sich dort als <code>root</code> ein und legen Sie in dessen Home-Verzeichnis (<code>/root</code>) das Unterverzeichnis <code>.ssh</code> an, falls es das nicht bereits gibt.
Mit dem folgenden Befehl werden die Zugriffsrechte gleich korrekt auf 700 gesetzt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>mkdir<span class="tok-w"> </span>-m<span class="tok-w"> </span><span class="tok-m">700</span><span class="tok-w"> </span>/root/.ssh</code></pre></div></div>
<div class="paragraph"><p>Öffnen Sie jetzt die Datei <code>authorized_keys</code> mit einem (konsolenbasierten) Texteditor Ihrer Wahl.
Falls die Datei nicht existiert, wird sie der Editor automatisch anlegen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>vim<span class="tok-w"> </span>/root/.ssh/authorized_keys</code></pre></div></div>
<div class="paragraph"><p>Kopieren Sie den Inhalt der öffentlichen Schlüssel in diese Datei.
Das geht z.B. mit der Maus und Copy &amp; Paste.
Seien Sie genau!
Jedes Leerzeichen zählt.
Achten Sie auch darauf, dass <strong>nirgendwo zwei</strong> Leerzeichen hintereinander stehen.
Und: Das ganze ist <strong>eine Zeile!</strong>
Wenn die Datei schon existiert, dann hängen Sie einfach unten eine neue Zeile an.</p></div>
</div>
<div class="sect2">
<h3 id="heading__zugriff_auf_die_ausführung_des_agenten_beschränken">
<span class="hidden-anchor sr-only" id="_zugriff_auf_die_ausführung_des_agenten_beschränken"></span>6.3. Zugriff auf die Ausführung des Agenten beschränken</h3>
<div class="paragraph"><p>Was jetzt kommt, ist sehr wichtig!
Der SSH-Schlüssel soll <strong>ausschließlich</strong> zur Ausführung des Agenten dienen.
SSH bietet so etwas unter dem Namen <em>Command restriction</em> an.
Dazu setzen Sie den Text <code>command="/usr/bin/check_mk_agent"</code> an den Anfang der Zeile, die Sie gerade erzeugt haben — mit <strong>einem</strong> Leerzeichen vom Rest getrennt.
Das sieht dann etwa so aus:</p></div>
<div class="listingblock">
<div class="title">/root/.ssh/authorized_keys</div>
<div class="content"><pre class="pygments highlight"><code><span></span>command="/usr/bin/check_mk_agent" ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGb6AaqRPlbEmDnBkeIW3Q6Emb5lr2QEbWEQLmA5pb48 mysite@mycmkserver</code></pre></div>
</div>
<div class="paragraph"><p>Speichern Sie die Datei und kontrollieren Sie die Rechte.
Nur der Eigentümer darf Schreibrechte auf dieser Datei haben.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>chmod<span class="tok-w"> </span><span class="tok-m">600</span><span class="tok-w"> </span>/root/.ssh/authorized_keys
<span class="tok-gp">root@linux# </span>ll<span class="tok-w"> </span>/root/.ssh/authorized_keys
<span class="tok-gp"><mark></mark></span>-rw-------<span class="tok-w"> </span><span class="tok-m">1</span><span class="tok-w"> </span>root<span class="tok-w"> </span>root<span class="tok-w"> </span><span class="tok-m">1304</span><span class="tok-w"> </span>Feb<span class="tok-w"> </span><span class="tok-m">20</span><span class="tok-w"> </span><span class="tok-m">14</span>:36<span class="tok-w"> </span>authorized_keys</code></pre></div></div>
<div class="paragraph"><p>Testen Sie jetzt den Zugriff auf den Agenten mit dem Befehl <code>ssh</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>ssh<span class="tok-w"> </span>root@myhost23
<span class="tok-go">The authenticity of host 'myhost23 (10.11.12.13)' can't be established.</span>
<span class="tok-go">ECDSA key fingerprint is SHA256:lWgVK+LtsMgjHUbdsA1FK12PdmVQGqaEY4TE8TEps3w.</span>
<span class="tok-go">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span>
<span class="tok-go">&lt;&lt;&lt;check_mk&gt;&gt;&gt;</span>
<span class="tok-go">Version: 2.1.0b6</span>
<span class="tok-go">AgentOS: linux</span>
<span class="tok-go">Hostname: myhost123</span>
<span class="tok-go">AgentDirectory: /etc/check_mk</span>
<span class="tok-go">DataDirectory: /var/lib/check_mk_agent</span>
<span class="tok-go">SpoolDirectory: /var/lib/check_mk_agent/spool</span>
<span class="tok-go">PluginsDirectory: /usr/lib/check_mk_agent/plugins</span>
<span class="tok-go">LocalDirectory: /usr/lib/check_mk_agent/local</span>
<span class="tok-go">&lt;&lt;&lt;df&gt;&gt;&gt;</span></code></pre></div></div>
<div class="paragraph"><p>Beim ersten Mal müssen Sie den Fingerprint des Schlüssels mit der Eingabe von <code>yes</code> bestätigen.
Alle weiteren Zugriffe können dann ohne Nutzerinteraktion erfolgen, so auch die minütliche automatische Abfrage des Agentenskripts durch den Checkmk-Server.</p></div>
<div class="paragraph"><p>Wenn es nicht klappt, überprüfen Sie bitte:</p></div>
<div class="ulist"><ul>
<li><p>Ist der SSH-Server auf dem Zielsystem überhaupt installiert?</p></li>
<li><p>Haben die genannten Dateien und Verzeichnisse die richtigen Berechtigungen?</p></li>
<li><p>Haben Sie die Syntax von <code>authorized_keys</code> korrekt getippt?</p></li>
<li><p>Haben Sie dort den richtigen öffentlichen Schlüssel eingetragen?</p></li>
<li><p>Haben Sie sich als der richtige Benutzer eingeloggt (<code>root@…​</code>)?</p></li>
<li><p>Haben Sie an das <code>command="…​"</code> gedacht?</p></li>
</ul></div>
<div class="paragraph"><p>Bei sehr alten Zielsystemen kann es zudem vorkommen, dass Schlüssel mit elliptischen Kurven (<code>ed25519</code> und <code>ecdsa</code>) nicht bekannt sind.
Erzeugen Sie in diesem Fall zusätzlich einen RSA-Schlüssel und tragen Sie auch diesen in die <code>authorized_keys</code> ein.
SSH wird für die Verbindung dann automatisch den stärksten bekannten Schlüssel verwenden.</p></div>
</div>
<div class="sect2">
<h3 id="heading__zugriff_von_checkmk_auf_ssh_umstellen">
<span class="hidden-anchor sr-only" id="_zugriff_von_checkmk_auf_ssh_umstellen"></span>6.4. Zugriff von Checkmk auf SSH umstellen</h3>
<div class="paragraph"><p>Das Zielsystem ist vorbereitet.
Jetzt fehlt nur noch die Konfiguration von Checkmk selbst.
Das geschieht über den Regelsatz <span class="guihint">Setup &gt; Agents &gt; Other integrations&gt; Custom integrations &gt; Individual program call instead of agent access</span>.
Erstellen Sie hier für die betroffenen Hosts eine Regel und tragen Sie als Befehl <code>ssh -T root@$HOSTNAME$</code> oder  <code>ssh -C -T root@$HOSTNAME$</code> (für zusätzliche Komprimierung der Agentendaten) ein:</p></div>
<div class="imageblock">
<div class="content"><img src="../images/agent_linux_rule_ssh_key.png" alt="Regel zum Aufruf des Agenten über SSH."></div>
<div class="title">Der Aufruf des Agenten über SSH erfolgt per Regel</div>
</div>
<div class="paragraph"><p>Sie können in der GUI unter <span class="guihint">Setup &gt; Hosts &gt; Properties of host &gt; Test connection to host</span> mit dem Button <span class="guihint">Run tests</span> den Verbindungstest durchführen.
Schlägt dieser mit Timeout oder verweigertem Zugriff fehl, überprüfen Sie, ob Sie zum Verbindungstest den Hostnamen in exakt der Schreibweise verwendet haben, die im Monitoring hinterlegt ist — OpenSSH unterscheidet mittlerweile zwischen Hostnamen ohne Domainpart, FQDN und IP-Adresse.
Alternativ können Sie auch über die IP-Adresse zugreifen, müssen dann aber das Macro <code>$HOSTADDRESS$</code> verwenden, welches durch die von Checkmk zwischengespeicherte IP-Adresse ersetzt wird.</p></div>
<div class="paragraph"><p>Nach einem Speichern und einem <a href="glossar.html#activate_changes">Aktivieren der Änderungen</a> ist der Host ins Monitoring aufgenommen.
Im Monitoring wird nun der Dienst <span class="guihint">Check-MK Agent</span> mit dem Hinweis <code>Transport via SSH</code> angezeigt.
Zur weiteren Diagnose bieten sich die Befehle <code>cmk -D</code> und <code>cmk -d</code> an, die im <a href="cmk_commandline.html#cmk">Artikel über die Kommandozeile</a> erklärt werden.</p></div>
</div>
<div class="sect2">
<h3 id="heading_multiplekeys">
<span class="hidden-anchor sr-only" id="multiplekeys"></span>6.5. Mehrere SSH-Schlüssel</h3>
<div class="paragraph"><p>Sie können auch mit mehr als einem SSH-Schlüssel arbeiten.
Legen Sie die Schlüssel in einem beliebigen Verzeichnis ab.
In der Regel <span class="guihint">Individual program call instead of agent access</span> müssen Sie den Pfad zum jeweiligen privaten Schlüssel dann mit der Option <code>-i</code> angeben.
Verwenden Sie hier am besten <code>$OMD_ROOT</code> als Ersatz für den Pfad zum Instanzverzeichnis (<code>/omd/sites/mysite</code>).
Der vollständige Befehl könnte dann <code>ssh -i $OMD_ROOT/.ssh/my_key -T root@$HOSTADDRESS$</code> lauten und damit wäre die Konfiguration auch in einer Instanz mit einem anderen Namen lauffähig:</p></div>
<div class="imageblock">
<div class="content"><img src="../images/agent_linux_rule_multiple_ssh_keys.png" alt="Regel zum Aufruf des Agenten mit mehreren SSH-Schlüsseln."></div>
<div class="title">Um mehrere SSH-Schlüssel zu verwenden, muss das Kommando in der Regel erweitert werden</div>
</div>
<div class="paragraph"><p>Sie können so für verschiedene Gruppen von Hosts verschiedene SSH-Schlüssel verwenden, indem Sie mehrere unterschiedliche Regeln verwenden.</p></div>
</div>
<div class="sect2">
<h3 id="heading__zugriff_auf_port_6556_deaktivieren">
<span class="hidden-anchor sr-only" id="_zugriff_auf_port_6556_deaktivieren"></span>6.6. Zugriff auf Port 6556 deaktivieren</h3>
<div class="paragraph"><p>Um potentielle Angreifer nicht trotz SSH-Tunnels mit Klartextdaten zu versorgen, müssen Sie auf dem Host im Monitoring den eventuell noch möglichen Zugriff auf Port 6556 deaktivieren.
Falls der <a href="#inventory">oben</a> ausgeführte Befehl <code>ss -tulpn | grep 6556</code> keinen Prozess gefunden hat, der an TCP Port 6556 lauscht, sind Sie mit der Einrichtung des SSH-Tunnels fertig.
Wird eine Zeile ausgegeben, muss der gefundene Prozess dauerhaft deaktiviert werden.</p></div>
<div class="sect3">
<h4 id="heading__xinetd">
<span class="hidden-anchor sr-only" id="_xinetd"></span>xinetd</h4>
<div class="paragraph"><p>Um den von <code>xinetd</code> bereitgestellten Port zu schließen, deaktivieren Sie den xinetd-Dienst von Checkmk, indem Sie den Wert von <code>disabled</code> auf <code>yes</code> setzen.
Löschen Sie <em>nicht</em> die ganze Konfigurationsdatei – diese würde in manchen Konstellationen bei Agenten-Updates sonst wieder auftauchen!</p></div>
<div class="paragraph"><p>Das Deaktivieren führen Sie in der Datei <code>/etc/xinetd.d/check-mk-agent</code> durch (bei Systemen mit älterer Agenten-Installation heißt die Datei möglicherweise <code>/etc/xinetd.d/check_mk</code>):</p></div>
<div class="listingblock">
<div class="title">/etc/xinetd.d/check-mk-agent</div>
<div class="content"><pre class="pygments highlight"><code><span></span>service check_mk
{
        type           = UNLISTED
        port           = 6556
        socket_type    = stream
        protocol       = tcp
        wait           = no
        user           = root
        server         = /usr/bin/check_mk_agent
        disable        = yes
}</code></pre></div>
</div>
<div class="paragraph"><p>Danach starten Sie xinetd neu:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/etc/init.d/xinetd<span class="tok-w"> </span>restart</code></pre></div></div>
<div class="paragraph"><p>oder</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>service<span class="tok-w"> </span>xinetd<span class="tok-w"> </span>restart</code></pre></div></div>
<div class="paragraph"><p>Stellen Sie nun sicher, dass <a href="#checksuccess">kein Zugriff über Port 6556</a> mehr möglich ist.</p></div>
</div>
<div class="sect3">
<h4 id="heading__inetd">
<span class="hidden-anchor sr-only" id="_inetd"></span>inetd</h4>
<div class="paragraph"><p>Ist es <code>inetd</code>, der den Zugriff auf Port 6556 regelt, passen Sie die Konfigurationsdatei <code>/etc/inetd.conf</code> an.
Suchen Sie dort die relevante Zeile:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>grep<span class="tok-w"> </span>-n<span class="tok-w"> </span>check.*mk<span class="tok-w"> </span>/etc/inetd.conf</code></pre></div></div>
<div class="paragraph"><p>Kommentieren Sie die Zeile mit einer Raute <code>#</code> aus und starten Sie den Prozess dann neu.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/etc/init.d/inetd<span class="tok-w"> </span>restart</code></pre></div></div>
<div class="paragraph"><p>Prüfen Sie anschließend mit <code>telnet</code> oder <code>nc</code>, <a href="#checksuccess">ob der Zugriff noch möglich</a> ist.</p></div>
</div>
<div class="sect3">
<h4 id="heading__systemd">
<span class="hidden-anchor sr-only" id="_systemd"></span>systemd</h4>
<div class="paragraph"><p>Ergab die Suche, dass <code>systemd</code> TCP Port 6556 geöffnet hat, müssen Sie jetzt den exakten Namen der Konfiguration ermitteln, die den Socket bereitstellt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>systemctl<span class="tok-w"> </span>list-units<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span><span class="tok-s1">'check.*mk.*socket'</span>
<span class="tok-go">  check-mk-agent.socket		loaded active listening CheckMK Agent Socket</span></code></pre></div></div>
<div class="paragraph"><p>Nun können Sie den Dienst zunächst stoppen und dann deaktivieren:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>systemctl<span class="tok-w"> </span>stop<span class="tok-w"> </span>check-mk-agent.socket
<span class="tok-gp">root@linux# </span>systemctl<span class="tok-w"> </span>disable<span class="tok-w"> </span>check-mk-agent.socket
<span class="tok-go">Removed /etc/systemd/system/sockets.target.wants/check-mk-agent.socket.</span></code></pre></div></div>
<div class="paragraph"><p>Jetzt darf <a href="#checksuccess">kein Zugriff auf Port 6556</a> mehr möglich sein.</p></div>
<div class="sect4">
<h5 id="heading_checkconnection">
<span class="hidden-anchor sr-only" id="checkconnection"></span>Erfolgskontrolle</h5>
<div class="paragraph"><p>Vergessen Sie auf keinen Fall einen abschließenden Test.
Eine Verbindung auf Port 6556 darf jetzt nicht mehr möglich sein:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>telnet<span class="tok-w"> </span>myhost123<span class="tok-w"> </span><span class="tok-m">6556</span>
<span class="tok-go">Trying 10.118.15.23...</span>
<span class="tok-go">telnet: Unable to connect to remote host: Connection refused</span></code></pre></div></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__weitere_absicherungsmöglichkeiten">
<span class="hidden-anchor sr-only" id="_weitere_absicherungsmöglichkeiten"></span>7. Weitere Absicherungsmöglichkeiten</h2>
<div class="sectionbody">
<div class="paragraph"><p>Die hier vorgestellten Absicherungsmöglichkeiten beschreiben wir primär aus Gründen der Kompatibilität zu Installationen im Bestand.
In vielen Fällen wird die Übermittlung der Agentenausgabe per SSH den Anforderungen an Zugriffsbeschränkung und Abhörsicherheit genügen.
Dennoch kann es in Einzelfällen sinnvoll sein, die nachfolgend vorgestellten Schutzmechanismen <em>zusätzlich</em> zu verwenden oder dann einzusetzen, wenn kein SSH-Tunnel möglich ist.</p></div>
<div class="sect2">
<h3 id="heading_encryption">
<span class="hidden-anchor sr-only" id="encryption"></span>7.1. Eingebaute (symmetrische) Verschlüsselung</h3>
<div class="paragraph"><p>Das Checkmk Agentenskript kann seine Daten ohne Zusatzmittel selbst verschlüsseln.
Dies ist kein Ersatz für eine Zugangskontrolle.
Da aber ein Angreifer keine Befehle senden und mit verschlüsselten Ausgabedaten nichts anfangen kann, ist das Ziel der Abhörsicherheit meist hinreichend erfüllt.</p></div>
<div class="paragraph"><p>Die Verschlüsselung braucht natürlich sowohl auf dem Agenten als auch auf dem Server eine passende Konfiguration.
Diese kann entweder von Hand erstellt werden (Raw Edition) oder mit der Agentenbäckerei (Enterprise Editions).</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Da die symmetrische Verschlüsselung denselben Schlüssel für Ver- und Entschlüsselung verwendet, kann ein Angreifer, der beispielsweise ein mit der Agentenbäckerei erstelltes Update-Paket mit dort enthaltenem Schlüssel abfängt, Kommunikationsinhalte entschlüsseln.</p></div>
<div class="sect3">
<h4 id="heading__aufsetzen_ohne_agentenbäckerei">
<span class="hidden-anchor sr-only" id="_aufsetzen_ohne_agentenbäckerei"></span>Aufsetzen ohne Agentenbäckerei</h4>
<div class="paragraph"><p>Auch ohne Agentenbäckerei geht der erste Schritt wieder über das <span class="guihint">Setup</span>-Menü und das Anlegen einer Regel im Regelsatz <span class="guihint">Setup &gt; Agents &gt; Access to agents &gt; Checkmk agent &gt; Encryption (Linux, Windows)</span>.
Die Regel soll auf alle Hosts greifen, für die Sie Verschlüsselung einsetzen möchten.
SNMP-Hosts ignorieren diese Einstellung, daher müssen Sie sie nicht explizit ausschließen.</p></div>
<div class="imageblock">
<div class="content"><img src="../images/agent_linux_encrypt.png" alt="Regel zur Konfiguration der eingebauten Verschlüsselung."></div>
<div class="title">Auch die eingebaute Verschlüsselung wird über eine Regel eingerichtet</div>
</div>
<div class="paragraph"><p>Wichtig ist die Einstellung für <span class="guihint">Encryption for Agent</span>.
Solange Sie die Regel auf dem Default <span class="guihint">Disable</span> lassen, bleibt natürlich alles beim Alten.
Sie haben also die Wahl zwischen:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Enable</span>: Verschlüsselung wird aktiviert, aber Daten von Agenten ohne Verschlüsselung werden weiter akzeptiert.</p></li>
<li><p><span class="guihint">Enforce</span>: Verschlüsselung wird aktiviert, nur noch verschlüsselte Daten werden akzeptiert.</p></li>
</ul></div>
<div class="paragraph"><p>Sinnvoll ist es, zunächst mit <span class="guihint">Enable</span> zu beginnen.
Sobald Sie meinen, dass alle Agenten auf Verschlüsselung umgestellt sind, stellen Sie auf <span class="guihint">Enforce</span>, um dadurch Hosts zu finden, die noch Daten im Klartext senden.</p></div>
<div class="paragraph"><p>Die Verschlüsselung funktioniert mit einem gemeinsamen Passwort, das Sie hier angeben und sowohl auf dem Checkmk Server als auch auf dem Agenten im Klartext gespeichert werden muss (<em>shared secret</em>).
Wählen Sie ein zufälliges Passwort aus und halten Sie es parat für den zweiten Schritt: die Konfiguration des Agenten.</p></div>
<div class="paragraph"><p>Dort erzeugen Sie die Datei <code>/etc/check_mk/encryption.cfg</code> mit folgendem Inhalt:</p></div>
<div class="listingblock">
<div class="title">/etc/check_mk/encryption.cfg</div>
<div class="content"><pre class="pygments highlight"><code><span></span>ENCRYPTED=yes
PASSPHRASE='MyPassword'</code></pre></div>
</div>
<div class="paragraph"><p>Natürlich setzen Sie hier bei <code>PASSPHRASE</code> Ihr eigenes Passwort ein.
Und Sie sollten die Datei unbedingt vor Lesezugriffen anderer Benutzer schützen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>chmod<span class="tok-w"> </span><span class="tok-m">600</span><span class="tok-w"> </span>/etc/check_mk/encryption.cfg</code></pre></div></div>
<div class="paragraph"><p>Jetzt können Sie folgende Tests machen (siehe dazu auch den <a href="cmk_commandline.html">Artikel über die Kommandozeile von Checkmk</a>):</p></div>
<div class="ulist"><ul>
<li><p>Der Aufruf von <code>check_mk_agent</code> auf dem Zielsystem muss wirren Zeichensalat ausgeben.</p></li>
<li><p>Der Zugriff via <code>telnet myhost123 6556</code> vom Checkmk Server muss den gleichen Zeichensalat ausgeben.</p></li>
<li><p>Der Befehl <code>cmk -d myhost123</code> auf dem Checkmk Server muss die sauberen Klartextdaten anzeigen.</p></li>
</ul></div>
</div>
<div class="sect3">
<h4 id="heading__aufsetzen_mit_agentenbäckerei">
<span class="hidden-anchor sr-only" id="_aufsetzen_mit_agentenbäckerei"></span>Aufsetzen mit Agentenbäckerei</h4>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Das Aufsetzen der Verschlüsselung mit der Agentenbäckerei ist sehr einfach.
Mit dem Erstellen der gerade beschriebenen Regel sind Sie im Grunde fertig.
Sie brauchen nur noch neue Agenten zu backen und zu verteilen.
Die Datei <code>/etc/check_mk/encryption.cfg</code> wird automatisch für Sie erzeugt und mit in die Agentenpakete eingebaut.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__xinetd_ip_beschränkung">
<span class="hidden-anchor sr-only" id="_xinetd_ip_beschränkung"></span>7.2. xinetd: IP-Beschränkung</h3>
<div class="paragraph"><p>Auch wenn ein Angreifer keine Befehle ausführen kann:
Die Monitoring-Daten des Agenten könnten für ihn bereits nützlich sein, denn sie enthalten unter anderem eine Liste von allen auf dem System laufenden Prozessen.
Am besten ist es daher, wenn die Daten nicht jeder einfach abrufen kann.</p></div>
<div class="paragraph"><p>Wenn Sie den Checkmk Agenten über den <code>xinetd</code> freigeben, ist es sehr einfach und effektiv, den Zugriff auf bestimmte IP-Adressen zu beschränken — und zwar natürlich auf die des Monitoring-Servers.
Das ist über die Direktive <code>only_from</code> der Konfigurationsdatei Ihres <code>xinetd</code> schnell zu erreichen.
Tragen Sie durch Leerzeichen getrennt IP-Adressen oder Adressbereiche (in der Form <code>12.34.56.78/29</code> oder <code>1234::/46</code>) ein.
Zulässig sind auch Host-Namen.
In diesem Fall wird geprüft, ob der durch <em>Rückwärtsauflösung</em> der IP-Adresse des anfragenden Hosts ermittelte Host-Name mit dem eingetragenen übereinstimmt:</p></div>
<div class="listingblock">
<div class="title">/etc/xinetd.d/check-mk-agent</div>
<div class="content"><pre class="pygments highlight"><code><span></span>service check_mk
{
        type           = UNLISTED
        port           = 6556
        socket_type    = stream
        protocol       = tcp
        wait           = no
        user           = root
        server         = /usr/bin/check_mk_agent
        only_from      = 10.118.14.5 10.118.14.37
        disable        = no
}</code></pre></div>
</div>
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
In den Enterprise Editions können Benutzer der Agentenbäckerei die erlaubten IP-Adressen über den Regelsatz <span class="guihint">Allowed agent access via IP address (Linux, Windows)</span> konfigurieren.
Diesen Regelsatz finden Sie über <span class="guihint">Setup &gt; Agents &gt; Windows, Linux, Solaris, AIX &gt; Agent rules &gt; Generic Options</span>.</p></div>
<div class="paragraph"><p>Natürlich kann ein Angreifer sehr leicht seine IP-Adresse fälschen und so eine Verbindung zum Agenten bekommen.
Aber dann ist es sehr wahrscheinlich, dass er die Antwort nicht bekommt — weil diese zum echten Monitoring-Server geht.
Oder er bekommt sie tatsächlich, aber der Checkmk Server bekommt keinerlei Daten und wird sehr bald einen Fehler melden.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__häufige_fehlermeldungen_beim_umgang_mit_ssh">
<span class="hidden-anchor sr-only" id="_häufige_fehlermeldungen_beim_umgang_mit_ssh"></span>8. Häufige Fehlermeldungen beim Umgang mit SSH</h2>
<div class="sectionbody">
<div class="paragraph"><p>Wenn Sie den Checkmk-Agenten über SSH abrufen möchten, kann es mitunter vorkommen, dass eben dieser Abruf nicht klappt und der Service <span class="guihint">Check_MK</span> auf Ihrem Host in den Zustand <span class="state2">CRIT</span> wechselt.
Diese Fehlermeldungen beginnen dann häufig mit <code>Agent exited with code 255</code>.</p></div>
<div class="paragraph"><p>Informationen zur Behebung solcher Fehler können Sie in der <a href="https://checkmk.atlassian.net/wiki/spaces/KB/pages/9473653" target="_blank">Checkmk Knowledge Base</a> finden.</p></div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#_einleitung">1. Einleitung</a></li>
<li>
<a href="#_installation">2. Installation</a><ul class="sectlevel1">
<li><a href="#frompackage">2.1. Installation aus Paketen</a></li>
<li><a href="#tarball">2.2. Installation aus dem TGZ-Archiv</a></li>
<li><a href="#manual">2.3. Manuelle Installation des Agentenskripts</a></li>
</ul>
</li>
<li><a href="#inventory">3. Bestandsaufnahme nach Installation</a></li>
<li><a href="#_auswahl_der_zugriffsmethode">4. Auswahl der Zugriffsmethode</a></li>
<li>
<a href="#_unverschl%C3%BCsselt_einrichtung_von_xinetd">5. Unverschlüsselt: Einrichtung von (x)inetd</a><ul class="sectlevel1">
<li><a href="#xinetd">5.1. xinetd einrichten</a></li>
<li><a href="#otherinetd">5.2. Andere inetd einrichten</a></li>
<li><a href="#connectiontest">5.3. Verbindungstest</a></li>
</ul>
</li>
<li>
<a href="#ssh">6. Verschlüsselt: Nutzung eines SSH-Tunnels</a><ul class="sectlevel1">
<li><a href="#_ssh_schl%C3%BCsselpaar_erstellen">6.1. SSH-Schlüsselpaar erstellen</a></li>
<li><a href="#_zugriff_per_ssh_erlauben">6.2. Zugriff per SSH erlauben</a></li>
<li><a href="#_zugriff_auf_die_ausf%C3%BChrung_des_agenten_beschr%C3%A4nken">6.3. Zugriff auf die Ausführung des Agenten beschränken</a></li>
<li><a href="#_zugriff_von_checkmk_auf_ssh_umstellen">6.4. Zugriff von Checkmk auf SSH umstellen</a></li>
<li><a href="#multiplekeys">6.5. Mehrere SSH-Schlüssel</a></li>
<li>
<a href="#_zugriff_auf_port_6556_deaktivieren">6.6. Zugriff auf Port 6556 deaktivieren</a><ul class="sectlevel2">
<li><a href="#_xinetd">xinetd</a></li>
<li><a href="#_inetd">inetd</a></li>
<li><a href="#_systemd">systemd</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#_weitere_absicherungsm%C3%B6glichkeiten">7. Weitere Absicherungsmöglichkeiten</a><ul class="sectlevel1">
<li>
<a href="#encryption">7.1. Eingebaute (symmetrische) Verschlüsselung</a><ul class="sectlevel2">
<li><a href="#_aufsetzen_ohne_agentenb%C3%A4ckerei">Aufsetzen ohne Agentenbäckerei</a></li>
<li><a href="#_aufsetzen_mit_agentenb%C3%A4ckerei">Aufsetzen mit Agentenbäckerei</a></li>
</ul>
</li>
<li><a href="#_xinetd_ip_beschr%C3%A4nkung">7.2. xinetd: IP-Beschränkung</a></li>
</ul>
</li>
<li><a href="#_h%C3%A4ufige_fehlermeldungen_beim_umgang_mit_ssh">8. Häufige Fehlermeldungen beim Umgang mit SSH</a></li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
