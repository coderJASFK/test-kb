<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Für eine Single-Sign-on-Lösung kann Checkmk mit Active Directory kooperieren. Lesen Sie hier, wie Sie die Authentifizierung mit SAML einrichten.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Anmeldung mit SAML">
<meta name="og:description" content="Für eine Single-Sign-on-Lösung kann Checkmk mit Active Directory kooperieren. Lesen Sie hier, wie Sie die Authentifizierung mit SAML einrichten.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Anmeldung mit SAML</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/en/saml.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/de/saml.html">2.2.0</a><a class="dropdown-item" href="../../latest/de/saml.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host- und Serviceparameter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Einführung in die Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMWare ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Konfiguration via Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
<li>
<p><a href="web_api.html">Konfiguration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Befehlsreferenz der HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Eigene Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Anmeldung mit SAML</h1>
<div class="details">
<span id="revdate">Last modified on 21-Apr-2022</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/de/saml.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="heading__einleitung">
<span class="hidden-anchor sr-only" id="_einleitung"></span>1. Einleitung</h2>
<div class="sectionbody">
<div class="paragraph"><p>In diesem Artikel erfahren Sie, wie Sie eine Anmeldung via <em>Secure Assertion Markup Language</em> (SAML) einrichten.
Die Implementierung in Checkmk läuft auf Apache-Level über <a href="https://github.com/latchset/mod_auth_mellon" target="_blank">mod_auth_mellon</a>, das im SAML-Design die Rolle des Service Providers (SP) übernimmt.</p></div>
<div class="paragraph"><p>Diese Anleitung zeigt ausführlich den Weg mit Active Directory Federation Services (AD FS) als Identity Provider (IDP).
In weiteren Abschnitten bekommen Sie Hinweise zur Konfiguration weiterer IDPs, etwa Azure AD und Micro Focus NetIQ Access Manager.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Dieses Feature wird von den SUSE Linux Enterprise Server (SLES) Versionen 12 SP3, 12 SP4 und 15 aufgrund fehlender Abhängigkeiten nicht unterstützt (ab SLES 15 SP1 ist die Anbindung möglich).</p></div>
<div class="paragraph"><p><strong>Achtung:</strong> Die ganze Thematik Transportverschlüsselung (TLS/SSL) wird in den Beispielen nur in einer simplen, beispielhaften Umsetzung aufgenommen.
In Produktivumgebungen mit eigener CA und sorgfältiger Zertifikatsbehandlung werden sich entsprechende Abweichungen ergeben, die von Ihrer eigenen Infrastruktur abhängen.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__anmeldung_mit_active_directory_federation_services">
<span class="hidden-anchor sr-only" id="_anmeldung_mit_active_directory_federation_services"></span>2. Anmeldung mit Active Directory Federation Services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__voraussetzungen">
<span class="hidden-anchor sr-only" id="_voraussetzungen"></span>2.1. Voraussetzungen</h3>
<div class="paragraph"><p>Die Anmeldung an Checkmk mittels Active Directory ist im Grunde relativ simpel:
AD Federation Service (FS) dient als <em>Identity Provider</em> (IDP), das Apache-Modul <a href="https://github.com/Uninett/mod_auth_mellon" target="_blank">mod_auth_mellon</a> sorgt als Service Provider via <em>Security Assertion Markup Language</em> (SAML) für die Authentifizierung.
Voraussetzungen für diese Anleitung sind entsprechend:</p></div>
<div class="ulist"><ul>
<li><p>Funktionierende LDAP-AD-Integration</p></li>
<li><p>Funktionierendes AD FS als IDP</p></li>
<li><p>Checkmk-Server mit SSL</p></li>
<li><p>Ein unterstütztes Betriebssystem. SLES15 SP4 wird derzeit <em>nicht</em> unterstützt!</p></li>
</ul></div>
<div class="paragraph"><p>Die Einrichtung erfolgt in drei Schritten:</p></div>
<div class="olist arabic"><ol class="arabic">
<li><p>Konfiguration von Apache (ein Ergebnis: XML-Datei mit Metadaten)</p></li>
<li><p>Konfiguration von AD FS: Relying Party Trust mit Mellon-Metadaten einrichten</p></li>
<li><p>Aktivierung des Logins in Checkmk selbst</p></li>
</ol></div>
</div>
<div class="sect2">
<h3 id="heading__apache_konfigurieren">
<span class="hidden-anchor sr-only" id="_apache_konfigurieren"></span>2.2. Apache konfigurieren</h3>
<div class="paragraph"><p>Unter Umständen müssen noch zusätzliche Abhängigkeiten installiert werden, unter Debian/Ubuntu z.B.:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>apt-get<span class="tok-w"> </span>update
<span class="tok-gp">root@linux# </span>apt-get<span class="tok-w"> </span>install<span class="tok-w"> </span>wget<span class="tok-w"> </span>libxmlsec1-openssl</code></pre></div></div>
<div class="paragraph"><p><strong>Hinweis:</strong> In der Checkmk-Appliance ist libxmlsec1-openssl bereits installiert.</p></div>
<div class="paragraph"><p>Es geht hier natürlich um die Konfiguration des Instanz-eigenen Apache-Servers, loggen Sie sich also zunächst dort ein:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>omd<span class="tok-w"> </span>su<span class="tok-w"> </span>mysite</code></pre></div></div>
<div class="paragraph"><p>Erstellen Sie nun ein Verzeichnis für mod_auth_mellon und wechseln Sie in das Verzeichnis:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>mkdir<span class="tok-w"> </span>etc/apache/mellon
<span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>etc/apache/mellon</code></pre></div></div>
<div class="paragraph"><p>Machen Sie nun <code>mellon_create_metadata</code> ausführbar und starten Sie es unter Angabe Ihres Servers sowie Ihrer Instanz mit dem Zusatz <em>mellon</em>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>~/bin/mellon_create_metadata
<span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mellon_create_metadata<span class="tok-w"> </span>https://myserver<span class="tok-w"> </span><span class="tok-s2">"https://myserver/mysite/mellon"</span></code></pre></div></div>
<div class="paragraph"><p>Das Modul erzeugt dabei drei Dateien: Zertifikat (<code>.cert</code>), Schlüssel (<code>.key</code>) und statische Metadaten (<code>.xml</code>).
Die XML-Datei wird nicht benötigt und kann gelöscht werden:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>rm<span class="tok-w"> </span>*.xml</code></pre></div></div>
<div class="paragraph"><p>Benennen Sie und Schlüssel- und Zertifikatsdateien der Einfachheit halber um:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mv<span class="tok-w"> </span><strong>.key<span class="tok-w"> </span>mellon.key
<span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>mv<span class="tok-w"> </span></strong>.cert<span class="tok-w"> </span>mellon.cert</code></pre></div></div>
<div class="paragraph"><p>Nun besorgen Sie die benötigten Metadaten direkt von Ihrem AD-FS-Server (hier <em>myadfs</em>) und speichern sie als <code>idp-metadata.xml</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>wget<span class="tok-w"> </span>--no-check-certificate<span class="tok-w"> </span>-O<span class="tok-w"> </span>./idp-metadata.xml<span class="tok-w"> </span>https://myadfs/FederationMetadata/2007-06/FederationMetadata.xml</code></pre></div></div>
<div class="paragraph"><p>Nun benötigen Sie das öffentliche Zertifikat des AD-FS-Servers, das in der Datei <code>idp-public-key.pem</code> gespeichert wird:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span>-n<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>openssl<span class="tok-w"> </span>s_client<span class="tok-w"> </span>-connect<span class="tok-w"> </span>myadfs:443<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sed<span class="tok-w"> </span>-ne<span class="tok-w"> </span><span class="tok-s1">'/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>openssl<span class="tok-w"> </span>x509<span class="tok-w"> </span>-pubkey<span class="tok-w"> </span>-noout<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>idp-public-key.pem</code></pre></div></div>
<div class="paragraph"><p>Nur für den Fall, dass Sie sich über das <code>echo -n</code> wundern: Darüber wird die folgende SSL-Session terminiert.</p></div>
<div class="paragraph"><p><strong>Hinweis:</strong> Das Zertifikat sollte oder muss gar in den Trust Store hochgeladen werden, für den Fall, dass zum Beispiel der IDP-Service die Zertifikatskette prüft.
Weiter Informationen zum Thema finden Sie im <a href="omd_https.html">HTTPS-Artikel.</a></p></div>
<div class="paragraph"><p>Als letzten Schritt ersetzen Sie die Authentifizierungskonfigurationsdatei <code>~/etc/apache/conf.d/auth.conf</code> mit der folgenden Variante — natürlich unter Angabe Ihres Checkmk-Servers (hier <code>myserver</code>) und Ihrer Instanz (hier <code>mysite</code>):</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span># Set this to the Name of your Checkmk site, e.g.
#Define SITE
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server. auth_mellon uses this
# to generate the needed URLs in the metadata
ServerName https://myserver

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /omd/sites/${SITE}/lib/apache/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
#MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.txt
#MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# cookie provided by the user and whitelist also some other required URLs
	&lt;If "! %{HTTP_COOKIE} =~ /^(.*;)?auth_${SITE}/ &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/webapi.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}/check_mk/automation.py' &amp;&amp; \
		! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
		! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

		MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
		MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
		MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
		MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
		MellonEndpointPath "/${SITE}/mellon"
		MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		AuthName "Checkmk SAML Login"
		MellonEnable auth
		Require valid-user

		# Get Username
		# ADFS sends username as DOMAIN\username pair.
		# Checkmk just wants the username.
		RewriteEngine on
		RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"
		RequestHeader edit X-Remote-User "^.*\\\(.*)$" "$1"

		# When SAML auth fails, show the login page to the user. This should only happen,
		# if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
		# A failed login at the IDP will not return you here at all.

    ErrorDocument 401 '&lt;html&gt; \
      &lt;head&gt; \
        &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
      &lt;/head&gt; \
      &lt;body&gt; \
        SAML authentication failed, redirecting to login page. \
        &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
      &lt;/body&gt; \
    &lt;/html&gt;'

	&lt;/If&gt;

	# This header is also needed after authentication (outside of the If clause)
	RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"
	RequestHeader edit X-Remote-User "^.*\\\(.*)$" "$1"

&lt;/Location&gt;</code></pre></div>
</div>
<div class="paragraph"><p>Anschließend starten Sie Apache neu:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>omd<span class="tok-w"> </span>restart<span class="tok-w"> </span>apache</code></pre></div></div>
<div class="paragraph"><p>Zu guter Letzt laden Sie nun die dynamisch erstellten Mellon-Metadaten als XML-Datei herunter, um sie gleich im AD-Management importieren zu können:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~/etc/apache/mellon$ </span>wget<span class="tok-w"> </span>https://myserver/mysite/mellon/metadata<span class="tok-w"> </span>-o<span class="tok-w"> </span>metadata.xml</code></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading__active_directory_konfigurieren">
<span class="hidden-anchor sr-only" id="_active_directory_konfigurieren"></span>3. Active Directory konfigurieren</h2>
<div class="sectionbody">
<div class="paragraph"><p>Um einen Relying Party Trust in AD FS anzulegen, gehen Sie wie folgt vor:</p></div>
<div class="paragraph"><p>Starten Sie die AD-FS-Oberfläche:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_01.png" alt="saml adfs 01"></div></div>
<div class="paragraph"><p>Klicken Sie auf <span class="guihint">Add Relying Party Trust:</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_02.png" alt="saml adfs 02"></div></div>
<div class="paragraph"><p>Belassen Sie die Option auf <span class="guihint">Claims aware</span> und fahren Sie mit dem Start-Knopf fort:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_03.png" alt="saml adfs 03"></div></div>
<div class="paragraph"><p>Wählen Sie nun <span class="guihint">Import data about the relying party from a file</span> und geben Sie die eben heruntergeladene XML-Datei an:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_04.png" alt="saml adfs 04"></div></div>
<div class="paragraph"><p>Die <span class="guihint">AD FS Management</span>-Warnung können Sie getrost ignorieren:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_05.png" alt="saml adfs 05"></div></div>
<div class="paragraph"><p>Unter <span class="guihint">Specify Display Name</span> geben Sie nun <code>Checkmk</code> als Namen ein:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_06.png" alt="saml adfs 06"></div></div>
<div class="paragraph"><p>Bei der Rechtevergabe können Sie <strong>zum Testen</strong> zunächst für <span class="guihint">Choose Access Control Policy</span> den Wert <span class="guihint">Permit everyone</span> wählen; später sollten Sie nach <span class="guihint">Permit specific group</span> ändern.</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_07.png" alt="saml adfs 07"></div></div>
<div class="paragraph"><p>Bestätigen Sie die Zusammenfassung unter <span class="guihint">Ready to Add Trust</span>:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_08.png" alt="saml adfs 08"></div></div>
<div class="paragraph"><p>Bestätigen Sie abschließend den <span class="guihint">Finish</span>-Dialog und behalten Sie das Häkchen bei <span class="guihint">Configure claims issuance policy for this application:</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_09.png" alt="saml adfs 09"></div></div>
<div class="paragraph"><p>Wählen Sie den eben erstellten Relying Party Trust aus und starten Sie dann den Editor mit <span class="guihint">Edit Claim Issuance Policy…​ :</span></p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_10.png" alt="saml adfs 10"></div></div>
<div class="paragraph"><p>Fügen Sie im folgenden Dialog über <span class="guihint">Add Rule…​</span> eine neue Regel hinzu:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_11.png" alt="saml adfs 11"></div></div>
<div class="paragraph"><p>Im ersten Schritt <span class="guihint">Select Rule Template</span> wählen Sie <span class="guihint">Transform an Incoming Claim</span> und bestätigen:</p></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_12.png" alt="saml adfs 12"></div></div>
<div class="paragraph"><p>Im zweiten Schritt <span class="guihint">Configure Rule</span> setzen Sie folgende Werte:</p></div>
<div class="ulist"><ul>
<li><p><span class="guihint">Incoming claim type:</span> <code>Windows account name</code></p></li>
<li><p><span class="guihint">Outgoing claim type:</span> <code>Name ID</code></p></li>
<li><p><span class="guihint">Outgoing name ID format:</span> <code>Transient Identifier</code></p></li>
</ul></div>
<div class="imageblock border"><div class="content"><img src="../images/saml_adfs_13.png" alt="saml adfs 13"></div></div>
<div class="paragraph"><p>Damit ist auch die AD-FS-Konfiguration abgeschlossen.
FS kann nun aus der Windows-Authentifizierung die Authentifizierung für Checkmk ableiten, das Sie im nächsten Schritt anweisen, Nutzer über HTTP-Anfragen zu authentifizieren.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__checkmk_konfigurieren">
<span class="hidden-anchor sr-only" id="_checkmk_konfigurieren"></span>4. Checkmk konfigurieren</h2>
<div class="sectionbody">
<div class="paragraph"><p>In Checkmk müssen Sie nun nur noch unter <span class="guihint">Setup &gt; General &gt; Global Settings &gt; User Interface &gt; Authenticate users by incoming HTTP requests</span> bei <span class="guihint">Current settings</span> die Option <span class="guihint">Activate HTTP header authentication</span> aktivieren:</p></div>
<div class="imageblock"><div class="content"><img src="../images/saml_adfs_cmk.png" alt="saml adfs cmk"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="heading__weitere_idps">
<span class="hidden-anchor sr-only" id="_weitere_idps"></span>5. Weitere IDPs</h2>
<div class="sectionbody">
<div class="paragraph"><p>Die folgenden Abschnitte beschreiben lediglich die Konfiguration von Mellon/Apache für unterschiedliche, bereits laufende IDPs.
Die Anbindung in Checkmk selbst beschränkt sich jeweils auf den letzten Schritt aus der ausführlichen AD-FS-Anleitung.</p></div>
<div class="sect2">
<h3 id="heading__azure_ad">
<span class="hidden-anchor sr-only" id="_azure_ad"></span>5.1. Azure AD</h3>
<div class="paragraph"><p>Wenn Azure AD als IDP fungiert, ergeben sich einige Änderungen, beispielsweise kann der Nutzername direkt gesetzt werden, ohne umgeschrieben zu werden.</p></div>
<div class="paragraph"><p>Voraussetzungen für die folgende Beispielkonfiguration:</p></div>
<div class="ulist"><ul>
<li><p>UserPrincipalName in LDAP-Verbindung als Identifier setzen (weitere Informationen bei <a href="https://ldapwiki.com/wiki/UserPrincipalName#:~:text=UserPrincipalName%20is%20a%20SINGLE%2DVALUE,the%20Internet%20standard%20RFC%20822.&amp;text=By%20convention%2C%20this%20should%20map%20to%20the%20user%E2%80%99s%20email%20name" target="_blank">LDAPwiki.com</a>).</p></li>
<li><p>Custom Enterprise App in Azure AD mit UserPrincipalName als 'name'-Attribut - mehr in der <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/add-application-portal" target="_blank">Microsoft-Dokumentation</a>).</p></li>
</ul></div>
<div class="paragraph"><p>Hier eine Beispielkonfiguration:</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#Set this to the Name of your Checkmk site, e.g.
# Define SITE mysite
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server.
# auth_mellon uses this to generate the needed URLs in the metadata.
ServerName https://myserver

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /omd/sites/${SITE}/lib/apache/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
# MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.log
# MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# cookie provided by the user and whitelist also some other required URLs.
   &lt;If "! %{HTTP_COOKIE} =~ /^auth_${SITE}/ &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/webapi.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
	! %{REQUEST_URI} = '/${SITE}/check_mk/automation.py' &amp;&amp; \
        ! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
        ! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

        RequestHeader unset X-Remote-User
        MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
        # Azure-AD-specific: Not needed because in metadata:
        #MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
        MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
        MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
        MellonEndpointPath "/${SITE}/mellon"
        MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		MellonEnable auth
		require valid-user

        # Azure-AD-specific:
        # Get Username
        # If your assertion offers the username for Checkmk in an attribute you can set it directly as the remote user (REMOTE_USER):
        MellonUser "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
        RequestHeader set X-Remote-User "%{MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name}e" env=MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name

        # When SAML auth fails, show the login page to the user. This should only happen, if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
        # A failed login at the IDP will not return you here at all.
        ErrorDocument 401 '&lt;html&gt; \
          &lt;head&gt; \
            &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
          &lt;/head&gt; \
          &lt;body&gt; \
            SAML authentication failed, redirecting to login page. \
            &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
          &lt;/body&gt; \
        &lt;/html&gt;'

	&lt;/If&gt;

	# Azure-AD-specific:
	# This header is also needed after authentication (outside of the If clause)
	RequestHeader set X-Remote-User "%{MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name}e" env=MELLON_http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name

&lt;/Location&gt;</code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="heading__netiq_access_manager">
<span class="hidden-anchor sr-only" id="_netiq_access_manager"></span>5.2. NetIQ Access Manager</h3>
<div class="paragraph"><p>Wenn NetIQ Access Manager als IDP fungiert, ergeben sich einige Änderungen, beispielsweise kann der Nutzername direkt gesetzt werden, ohne umgeschrieben zu werden.</p></div>
<div class="paragraph"><p>Hier eine Beispielkonfiguration:</p></div>
<div class="listingblock">
<div class="title">~/etc/apache/conf.d/auth.conf</div>
<div class="content"><pre class="pygments highlight"><code><span></span>
# Set this to the Name of your Checkmk site, e.g.# Define SITE mysite
# Define SITE mysite
Define SITE mysite

# ServerName from listen-ports.conf needs to be overwritten here
# and being set to the URL of the real server. auth_mellon uses this to generate the needed URLs in the metadata.

ServerName https://myserver.mydomain.tld

# Load the module.
&lt;IfModule !mod_auth_mellon.c&gt;

	LoadModule auth_mellon_module /omd/sites/mysite/lib/apache/modules/mod_auth_mellon.so

&lt;/IfModule&gt;

# Only enable this for debugging purposes
#MellonDiagnosticsFile /opt/omd/sites/${SITE}/tmp/mellon_diagnostics.log
#MellonDiagnosticsEnable On

&lt;Location /${SITE}&gt;

	# Use SAML auth only in case there is no Checkmk authentication
	# Cookie provided by the user and whitelist also some other required URLs.

    &lt;If "! %{HTTP_COOKIE} =~ /^auth_${SITE}/ &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/register_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/run_cron.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/deploy_agent.py' &amp;&amp; \
        ! %{REQUEST_URI} = '/${SITE}/check_mk/webapi.py' &amp;&amp; \
        ! %{REQUEST_URI} -strmatch '/${SITE}/check_mk/api/*' &amp;&amp; \
		! %{REQUEST_URI} = '/${SITE}check_mk/ajax_graph_images.py' &amp;&amp; \
        ! %{QUERY_STRING} =~ /(_secret=|auth_|register_agent)/ &amp;&amp; \
		! %{REQUEST_URI} =~ m#^/${SITE}/(omd/|check_mk/((images|themes)/.*\.(png|svg)|login\.py|.*\.(css|js)))# "&gt;

        MellonIdPMetadataFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-metadata.xml
        # NetIQ-specific: Not needed because in metadata:
        #MellonIdPPublicKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/idp-public-key.pem
        MellonSPCertFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.cert
        MellonSPPrivateKeyFile /opt/omd/sites/${SITE}/etc/apache/mellon/mellon.key
        MellonEndpointPath "/${SITE}/mellon"
        MellonDefaultLoginPath "/${SITE}/check_mk/"

		Order allow,deny
		Allow from all

		MellonSecureCookie On
		MellonCookieSameSite None

		AuthType Mellon
		MellonEnable auth
		require valid-user


        # NetIQ-specific:
        # Even though it is set as 'optional' in https://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf
        # a NetIQ Access Manager requires it to be set.
        # Specified in oasis link above - line 396
        MellonOrganizationName "&lt;countrycode&gt;" "&lt;your organisation name&gt;"
        # Specified in oasis link above - line 443 / 452
        MellonOrganizationURL  "&lt;countrycode&gt;" "&lt;your organisation url&gt;"
        # Specified in oasis link above - line 454
        MellonOrganizationDisplayName "&lt;countrycode&gt;" "&lt;your organisation display name&gt;"

        # NetIQ-specific:
        # If your assertion offers the username for Checkmk in an attribute you can set it directly as the remote user (REMOTE_USER)
        MellonUser "myusername"

        # NetIQ-specific:
        # If the assertion does contain the username (and was set to MellonUser) then you can set the header directly.
        RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"

    # When SAML auth fails, show the login page to the user. This should only happen,
    # if e.g. the mellon cookie is lost/rejected or if the IDP is misconfigured.
    # A failed login at the IDP will not return you here at all.
        ErrorDocument 401 '&lt;html&gt; \
          &lt;head&gt; \
            &lt;meta http-equiv="refresh" content="1; URL=/${SITE}/check_mk/login.py"&gt; \
          &lt;/head&gt; \
          &lt;body&gt; \
            SAML authentication failed, redirecting to login page. \
            &lt;a href="/${SITE}/check_mk/login.py"&gt;Click here&lt;/a&gt;. \
          &lt;/body&gt; \
        &lt;/html&gt;'

# This header is also needed after authentication (outside of the If clause)
RequestHeader set X-Remote-User "expr=%{REMOTE_USER}"

&lt;/Location&gt;</code></pre></div>
</div>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#_einleitung">1. Einleitung</a></li>
<li>
<a href="#_anmeldung_mit_active_directory_federation_services">2. Anmeldung mit Active Directory Federation Services</a><ul class="sectlevel1">
<li><a href="#_voraussetzungen">2.1. Voraussetzungen</a></li>
<li><a href="#_apache_konfigurieren">2.2. Apache konfigurieren</a></li>
</ul>
</li>
<li><a href="#_active_directory_konfigurieren">3. Active Directory konfigurieren</a></li>
<li><a href="#_checkmk_konfigurieren">4. Checkmk konfigurieren</a></li>
<li>
<a href="#_weitere_idps">5. Weitere IDPs</a><ul class="sectlevel1">
<li><a href="#_azure_ad">5.1. Azure AD</a></li>
<li><a href="#_netiq_access_manager">5.2. NetIQ Access Manager</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
