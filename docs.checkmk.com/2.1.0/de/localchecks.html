<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" href="/favicon.png">
<meta name="robots" content="noindex">
<meta name="description" content="Checkmk kann auch ohne große Programmierkenntnis sehr einfach erweitert werden. Erfahren Sie hier, wie Sie dem Agenten ein eigenes Skript übergeben.">
<meta name="og:locale" content="de">
<meta name="og:site_name" content="Checkmk Docs">
<meta name="og:title" content="Lokale Checks">
<meta name="og:description" content="Checkmk kann auch ohne große Programmierkenntnis sehr einfach erweitert werden. Erfahren Sie hier, wie Sie dem Agenten ein eigenes Skript übergeben.">
<meta name="og:image" content="https://docs.checkmk.com/assets/images/share_image.png">
<meta name="twitter:site" content="@checkmk">
<meta name="twitter:creator" content="@checkmk">
<title>Lokale Checks</title>
<link rel="stylesheet" href="../../assets/css/checkmk.css?id=4473d2acbb1ea6136428">
<link rel="stylesheet" href="../../assets/css/pygments-monokai.css">
<link rel="stylesheet" href="../../assets/css/addons.css">
<link rel="stylesheet" href="../../assets/css/SourceCodePro.css">
<link rel="search" href="./opensearch.xml" type="application/opensearchdescription+xml" title="Suche auf docs.checkmk.com">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJ3VGL8');</script>
<!-- End Google Tag Manager --><style>
#staticinfo { font-style: italic; }
</style>
</head>
<body class="article toc2 toc-right">
<!-- Cookie Consent (GDPR Compliance) -->

<!-- End Cookie Consent (GDPR Compliance) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ3VGL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><div class="header-top">
<div class="header-top__left">
<a class="header-top__logo d-none d-xl-inline-block" href="/2.1.0/de"><img src="../../assets/images/docs_logo.png" alt="Checkmk"></a><a class="header-top__icon d-inline-block d-xl-none" href="/2.1.0/de"><img src="../../assets/images/logo_icon.svg" alt="Checkmk"></a>
</div>
<div class="header-top__center">
<input type="text" class="header-top__search" placeholder="Search the checkmk docs"><div class="header-top__search__results"></div>
</div>
<div class="header-top__right d-block">
<button class="header-top__search__toggle d-inline-block d-md-none"><img class="header-top__search__toggle__icon" src="../../assets/images/search.svg" alt="Search"></button><div class="dropdown dropdown__language">
                    <button class="btn dropdown-toggle" type="button" id="languageMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">de</button>
                    <div class="dropdown-menu  dropdown-menu-right" aria-labelledby="languageMenuButton"><a class="dropdown-item" href="../../2.1.0/en/localchecks.html">English</a></div>
</div>
<div class="dropdown dropdown__branch">
                        <button class="btn dropdown-toggle" type="button" id="branchMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">2.1.0</button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="branchMenuButton">
<a class="dropdown-item" href="../../2.2.0/de/localchecks.html">2.2.0</a><a class="dropdown-item" href="../../latest/de/localchecks.html">latest (2.3.0)</a>
</div>
</div>
<a class="header-top__back d-none d-lg-inline-block" href="https://checkmk.com">to checkmk.com</a><button class="header-top__toggle d-inline-block d-lg-none"><span class="header-top__toggle__icon"></span></button>
</div>
</div>
<aside><div class="main-nav">
<div class="main-nav__content"><div id="content">
<div class="sect1">
<h2 id="_willkommen_bei_checkmk">
<a class="anchor" href="#_willkommen_bei_checkmk"></a>1. Willkommen bei Checkmk</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="welcome.html">Willkommen im Checkmk Handbuch</a></p>
</li>
<li>
<p><a href="glossar.html">Glossar</a></p>
</li>
<li>
<p><a href="search.html">Suchen in docs.checkmk.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leitfaden_für_einsteiger">
<a class="anchor" href="#_leitfaden_f%C3%BCr_einsteiger"></a>2. Leitfaden für Einsteiger</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="intro_setup.html">Checkmk aufsetzen</a></p>
</li>
<li>
<p><a href="intro_gui.html">Die Checkmk-Oberfläche</a></p>
</li>
<li>
<p><a href="intro_setup_monitor.html">Das Monitoring einrichten</a></p>
</li>
<li>
<p><a href="intro_tools.html">Die Monitoring-Werkzeuge</a></p>
</li>
<li>
<p><a href="intro_monitor.html">Checkmk im Monitoring</a></p>
</li>
<li>
<p><a href="intro_finetune.html">Das Monitoring feinjustieren</a></p>
</li>
<li>
<p><a href="intro_users.html">Mit mehreren Benutzern arbeiten</a></p>
</li>
<li>
<p><a href="intro_notifications.html">Benachrichtigungen einschalten</a></p>
</li>
<li>
<p><a href="intro_extend.html">Das Monitoring weiter ausbauen</a></p>
</li>
<li>
<p><a href="intro_bestpractise.html">Best Practices, Tipps &amp; Tricks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">
<a class="anchor" href="#_installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="install_packages.html">Grundsätzliches zur Installation von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_server_und_vms">
<a class="anchor" href="#_server_und_vms"></a>3.1. Server und VMs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_packages_debian.html">Installation unter Debian und Ubuntu</a></p>
</li>
<li>
<p><a href="install_packages_redhat.html">Installation unter Red Hat und CentOS</a></p>
</li>
<li>
<p><a href="install_packages_sles.html">Installation unter SUSE Linux Enterprise Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_appliance_container_cloud">
<a class="anchor" href="#_appliance_container_cloud"></a>3.2. Appliance, Container, Cloud</h3>
<div class="ulist">
<ul>
<li>
<p><a href="install_appliance_cmk.html">Installation von Checkmk in der Appliance</a></p>
</li>
<li>
<p><a href="introduction_docker.html">Installation als Docker-Container</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updates">
<a class="anchor" href="#_updates"></a>3.3. Updates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="update.html">Updates und Upgrades</a></p>
</li>
<li>
<p><a href="update_major.html">Update auf Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="update_matrix.html">Update-Matrix für Version <span class="new">2.1.0</span></a></p>
</li>
<li>
<p><a href="release_upgrade.html">Linux-Upgrade auf dem Checkmk-Server</a></p>
</li>
<li>
<p><a href="cmk_versions.html">Checkmk-Versionen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration_von_checkmk">
<a class="anchor" href="#_administration_von_checkmk"></a>4. Administration von Checkmk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server">
<a class="anchor" href="#_server"></a>4.1. Server</h3>
<div class="ulist">
<ul>
<li>
<p><a href="saml.html">Anmeldung mit SAML</a></p>
</li>
<li>
<p><a href="kerberos.html">Single Sign-On mit Kerberos</a></p>
</li>
<li>
<p><a href="managing_docker.html">Checkmk-Server im Docker-Container</a></p>
</li>
<li>
<p><a href="security.html">Sicherheit (Security)</a></p>
</li>
<li>
<p><a href="ports.html">Ports</a></p>
</li>
<li>
<p><a href="omd_https.html">Weboberfläche mit HTTPS absichern</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instanzen">
<a class="anchor" href="#_instanzen"></a>4.2. Instanzen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="omd_basics.html">Instanzen (Sites) mit omd verwalten</a></p>
</li>
<li>
<p><a href="cmk_commandline.html">Checkmk auf der Kommandozeile</a></p>
</li>
<li>
<p><a href="license.html">Lizenzen verwalten</a></p>
</li>
<li>
<p><a href="distributed_monitoring.html">Verteiltes Monitoring</a></p>
</li>
<li>
<p><a href="backup.html">Backups</a></p>
</li>
<li>
<p><a href="analyze_configuration.html">Konfiguration der Checkmk Instanz analysieren</a></p>
</li>
<li>
<p><a href="mkps.html">Checkmk Erweiterungspakete (MKPs)</a></p>
</li>
<li>
<p><a href="simulation_mode.html">Der Simulationsmodus</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration">
<a class="anchor" href="#_konfiguration"></a>5. Konfiguration</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato.html">Die Konfiguration von Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_hosts">
<a class="anchor" href="#_hosts"></a>5.1. Hosts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="hosts_setup.html">Verwaltung der Hosts</a></p>
</li>
<li>
<p><a href="hosts_structure.html">Strukturierung der Hosts</a></p>
</li>
<li>
<p><a href="host_tags.html">Host-Merkmale</a></p>
</li>
<li>
<p><a href="dcd.html">Dynamische Host-Konfiguration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services">
<a class="anchor" href="#_services"></a>5.2. Services</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_services.html">Services verstehen und konfigurieren</a></p>
</li>
<li>
<p><a href="clustered_services.html">Cluster-Services überwachen</a></p>
</li>
<li>
<p><a href="piggyback.html">Der Piggyback-Mechanismus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regeln">
<a class="anchor" href="#_regeln"></a>5.3. Regeln</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_rules.html">Host- und Serviceparameter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unterstützende_konfigurationen">
<a class="anchor" href="#_unterst%C3%BCtzende_konfigurationen"></a>5.4. Unterstützende Konfigurationen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="timeperiods.html">Zeitperioden (Time Periods)</a></p>
</li>
<li>
<p><a href="labels.html">Labels</a></p>
</li>
<li>
<p><a href="regexes.html">Reguläre Ausdrücke in Checkmk</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benutzer_und_berechtigungen">
<a class="anchor" href="#_benutzer_und_berechtigungen"></a>5.5. Benutzer und Berechtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="wato_user.html">Benutzer, Zuständigkeiten, Berechtigungen</a></p>
</li>
<li>
<p><a href="ldap.html">Benutzerverwaltung mit LDAP/Active Directory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benachrichtigungen">
<a class="anchor" href="#_benachrichtigungen"></a>5.6. Benachrichtigungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="notifications.html">Einführung in die Benachrichtigungen</a></p>
</li>
<li>
<p><a href="notifications_jira.html">Benachrichtigungen per Jira</a></p>
</li>
<li>
<p><a href="notifications_mattermost.html">Benachrichtigungen per Mattermost</a></p>
</li>
<li>
<p><a href="notifications_pagerduty.html">Benachrichtigungen per PagerDuty</a></p>
</li>
<li>
<p><a href="notifications_pushover.html">Benachrichtigungen per Pushover</a></p>
</li>
<li>
<p><a href="notifications_opsgenie.html">Benachrichtigungen per Opsgenie</a></p>
</li>
<li>
<p><a href="notifications_servicenow.html">Benachrichtigungen per ServiceNow</a></p>
</li>
<li>
<p><a href="notifications_slack.html">Benachrichtigungen per Slack</a></p>
</li>
<li>
<p><a href="notifications_splunkoncall.html">Benachrichtigungen per Splunk On-Call</a></p>
</li>
<li>
<p><a href="notifications_webex.html">Benachrichtigungen per Cisco Webex Teams</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_events">
<a class="anchor" href="#_events"></a>5.7. Events</h3>
<div class="ulist">
<ul>
<li>
<p><a href="ec.html">Die Event Console</a></p>
</li>
<li>
<p><a href="alert_handlers.html">Alert Handler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_überwachung_von_systemen">
<a class="anchor" href="#_%C3%BCberwachung_von_systemen"></a>6. Überwachung von Systemen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="wato_monitoringagents.html">Monitoring-Agenten</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_checkmk_agenten_und_snmp">
<a class="anchor" href="#_checkmk_agenten_und_snmp"></a>6.1. Checkmk-Agenten und SNMP</h3>
<div class="ulist">
<ul>
<li>
<p><a href="agent_deployment.html">Automatische Agenten-Updates</a></p>
</li>
<li>
<p><a href="agent_linux.html">Linux überwachen</a></p>
</li>
<li>
<p><a href="agent_linux_legacy.html">Linux überwachen im Legacy-Modus</a></p>
</li>
<li>
<p><a href="agent_windows.html">Windows überwachen</a></p>
</li>
<li>
<p><a href="agent_freebsd.html">FreeBSD überwachen</a></p>
</li>
<li>
<p><a href="snmp.html">Überwachen via SNMP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_agentenerweiterungen">
<a class="anchor" href="#_agentenerweiterungen"></a>6.2. Agentenerweiterungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="inventory.html">Die HW/SW-Inventur</a></p>
</li>
<li>
<p><a href="mk_filestats.html">Dateien überwachen</a></p>
</li>
<li>
<p><a href="monitoring_oracle.html">Oracle-Datenbanken überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mysql.html">MySQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_mssql.html">MSSQL überwachen</a></p>
</li>
<li>
<p><a href="monitoring_jobs.html">Zeitbasierte Prozesse (Cronjobs) überwachen</a></p>
</li>
<li>
<p><a href="spool_directory.html">Das Spool-Verzeichnis</a></p>
</li>
<li>
<p><a href="localchecks.html">Lokale Checks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_cloud_container">
<a class="anchor" href="#_vm_cloud_container"></a>6.3. VM, Cloud, Container</h3>
<div class="ulist">
<ul>
<li>
<p><a href="datasource_programs.html">Datenquellenprogramme</a></p>
</li>
<li>
<p><a href="monitoring_vmware.html">VMWare ESXi überwachen</a></p>
</li>
<li>
<p><a href="monitoring_aws.html">Amazon Web Services (AWS) überwachen</a></p>
</li>
<li>
<p><a href="monitoring_azure.html">Microsoft Azure überwachen</a></p>
</li>
<li>
<p><a href="monitoring_kubernetes.html">Kubernetes überwachen</a></p>
</li>
<li>
<p><a href="monitoring_docker.html">Docker überwachen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_endpunkte">
<a class="anchor" href="#_endpunkte"></a>6.4. Endpunkte</h3>
<div class="ulist">
<ul>
<li>
<p><a href="active_checks.html">Netzwerkdienste überwachen (Aktive Checks)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dashboards_views_metriken">
<a class="anchor" href="#_dashboards_views_metriken"></a>7. Dashboards, Views, Metriken</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="user_interface.html">Die Benutzeroberfläche</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_allgemein">
<a class="anchor" href="#_allgemein"></a>7.1. Allgemein</h3>
<div class="ulist">
<ul>
<li>
<p><a href="views.html">Ansichten von Hosts und Services (Views)</a></p>
</li>
<li>
<p><a href="dashboards.html">Dashboards</a></p>
</li>
<li>
<p><a href="graphing.html">Messwerte und Graphing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kommandos_in_ansichten">
<a class="anchor" href="#_kommandos_in_ansichten"></a>7.2. Kommandos in Ansichten</h3>
<div class="ulist">
<ul>
<li>
<p><a href="commands.html">Kommandos</a></p>
</li>
<li>
<p><a href="basics_ackn.html">Quittierung von Problemen</a></p>
</li>
<li>
<p><a href="basics_downtimes.html">Wartungszeiten</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auswertungen_und_prognosen">
<a class="anchor" href="#_auswertungen_und_prognosen"></a>8. Auswertungen und Prognosen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auswertungen">
<a class="anchor" href="#_auswertungen"></a>8.1. Auswertungen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="availability.html">Verfügbarkeit (Availability)</a></p>
</li>
<li>
<p><a href="sla.html">Erweiterte Verfügbarkeiten (SLAs)</a></p>
</li>
<li>
<p><a href="bi.html">Business Intelligence (BI)</a></p>
</li>
<li>
<p><a href="reporting.html">Berichte (Reports)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prognosen">
<a class="anchor" href="#_prognosen"></a>8.2. Prognosen</h3>
<div class="ulist">
<ul>
<li>
<p><a href="predictive_monitoring.html">Prognosebasiertes Monitoring</a></p>
</li>
<li>
<p><a href="forecast_graphs.html">Vorhersagegraphen erstellen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anbindung_anderer_applikationen">
<a class="anchor" href="#_anbindung_anderer_applikationen"></a>9. Anbindung anderer Applikationen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_prometheus.html">Prometheus integrieren</a></p>
</li>
<li>
<p><a href="integrating_datadog.html">Datadog integrieren</a></p>
</li>
<li>
<p><a href="nagvis.html">NagVis: Statusdaten auf Karten und Diagrammen</a></p>
</li>
<li>
<p><a href="ntop.html">ntopng in Checkmk integrieren</a></p>
</li>
<li>
<p><a href="grafana.html">Checkmk in Grafana integrieren</a></p>
</li>
<li>
<p><a href="metrics_exporter.html">Metriken an InfluxDB und Graphite senden</a></p>
</li>
<li>
<p><a href="nagstamon.html">Nagstamon mit Checkmk verbinden</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_besonderheiten_in_den_editionen">
<a class="anchor" href="#_besonderheiten_in_den_editionen"></a>10. Besonderheiten in den Editionen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="support_diagnostics.html">Support Diagnostics</a></p>
</li>
<li>
<p><a href="managed.html">Die Managed Services Edition</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisierung_und_programmierung">
<a class="anchor" href="#_automatisierung_und_programmierung"></a>11. Automatisierung und Programmierung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apis_zur_automatisierung">
<a class="anchor" href="#_apis_zur_automatisierung"></a>11.1. APIs zur Automatisierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="rest_api.html">Konfiguration via Checkmk REST-API</a></p>
</li>
<li>
<p><a href="livestatus.html">Statusdaten abrufen via Livestatus</a></p>
</li>
<li>
<p><a href="livestatus_references.html">Livestatus Befehlsreferenz</a></p>
</li>
<li>
<p><a href="web_api.html">Konfiguration via HTTP-API</a></p>
</li>
<li>
<p><a href="web_api_references.html">Befehlsreferenz der HTTP-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_apis_zur_programmierung">
<a class="anchor" href="#_apis_zur_programmierung"></a>11.2. APIs zur Programmierung</h3>
<div class="ulist">
<ul>
<li>
<p><a href="bakery_api.html">Die Bakery-API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_programmierung_von_check_plugins">
<a class="anchor" href="#_programmierung_von_check_plugins"></a>11.3. Programmierung von Check-Plugins</h3>
<div class="ulist">
<ul>
<li>
<p><a href="devel_check_plugins.html">Eigene Check-Plugins schreiben</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzepte">
<a class="anchor" href="#_konzepte"></a>12. Konzepte</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="monitoring_basics.html">Grundlagen des Monitorings mit Checkmk</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_der_checkmk_micro_core_cmc">
<a class="anchor" href="#_der_checkmk_micro_core_cmc"></a>12.1. Der Checkmk Micro Core (CMC)</h3>
<div class="ulist">
<ul>
<li>
<p><a href="cmc.html">Der Checkmk Micro Core (CMC)</a></p>
</li>
<li>
<p><a href="cmc_differences.html">Besonderheiten des CMC</a></p>
</li>
<li>
<p><a href="cmc_migration.html">Migration auf den CMC</a></p>
</li>
<li>
<p><a href="cmc_files.html">Dateien und Verzeichnisse des CMC</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_die_checkmk_appliance">
<a class="anchor" href="#_die_checkmk_appliance"></a>13. Die Checkmk Appliance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="appliance_rack1_quick_start.html">Schnellstart-Anleitung für Checkmk-Racks</a></p>
</li>
<li>
<p><a href="appliance_virt1_quick_start.html">Schnellstart-Anleitung für Checkmk virt1</a></p>
</li>
<li>
<p><a href="appliance_install_virt1.html">Virtuelle Appliance installieren</a></p>
</li>
<li>
<p><a href="appliance_usage.html">Appliance einrichten und nutzen</a></p>
</li>
<li>
<p><a href="appliance_backup.html">Backup in der Appliance</a></p>
</li>
<li>
<p><a href="appliance_cluster.html">Appliance im Cluster-Betrieb</a></p>
</li>
<li>
<p><a href="appliance_rack_config.html">Besonderheiten der Hardware-Appliance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="main-nav__utils">
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="aboutMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About Checkmk</button><div class="dropdown-menu dropup" aria-labelledby="aboutMenuButton">
<a class="dropdown-item" href="https://checkmk.com/product/features" target="_blank">Features</a><a class="dropdown-item" href="https://checkmk.com/product/editions" target="_blank">Editions</a><a class="dropdown-item" href="https://checkmk.com/integrations" target="_blank">Integrations</a><a class="dropdown-item" href="https://checkmk.com/imprint" target="_blank">Imprint</a><a class="dropdown-item" href="copyright.html" target="_blank">Copyright</a>
</div>
</div>
<div class="dropup dropdown__utils">
<button class="btn dropdown-toggle" type="button" id="learnMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Learn</button><div class="dropdown-menu dropup" aria-labelledby="learnMenuButton">
<a class="dropdown-item" href="https://checkmk.com/videos">Videos</a><a class="dropdown-item" href="https://checkmk.com/webinars">Webinars</a><a class="dropdown-item" href="https://checkmk.com/trainings/classes">Trainings</a>
</div>
</div>
<a class="main-nav__utils__link" href="https://forum.checkmk.com">Forum</a>
</div>
</div></aside><main><div id="header">
<h1>Lokale Checks</h1>
<div class="details">
<span id="revdate">Last modified on 22-Jan-2024</span><a class="edit-document" href="https://github.com/Checkmk/checkmk-docs/edit/2.1.0/de/localchecks.asciidoc">Edit this page on GitHub</a>
</div>
</div>
<div id="content">
<div id="preamble">
<div id="staticinfo">Dies ist eine am 2025-01-07 22:12:14 +0000 für die Offline-Nutzung exportierte Seite. Sie spiegelt möglicherweise nicht den aktuellen Stand der Checkmk Dokumentation wider. Um eine täglich aktualisierte Version dieser Seite anzusehen, rufen Sie bitte <a href="https://docs.checkmk.com/" target="_blank">docs.checkmk.com</a> auf.</div>
<div class="sectionbody"><div class="paragraph">
<p></p>
<div class="dropdown dropdown__related">
<button class="btn btn-primary dropdown-toggle" type="button" id="relatedMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Related Articles</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="relatedMenuButton">
<a href="wato_monitoringagents.html">Monitoring-Agenten</a>
<a href="datasource_programs.html">Datenquellenprogramme</a>
<a href="https://checkmk.com/de/integrations" target="_blank">Katalog der Check-Plugins</a>
</div>
</div>
</div></div>
</div>
<div class="sect1">
<h2 id="heading__warum_eigene_checks">
<span class="hidden-anchor sr-only" id="_warum_eigene_checks"></span>1. Warum eigene Checks?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Checkmk überwacht durch die große Anzahl an mitgelieferten Check-Plugins
bereits sehr viele relevante Daten.
Dennoch ist jede IT-Umgebung einzigartig, so dass sich oft sehr individuelle Anforderungen ergeben.
Mit den <strong>lokalen Checks</strong> (<em>local checks</em>) sind Sie in der Lage, den Agenten auf dem Ziel-Host zu erweitern, indem Sie schnell und einfach eigene Services erstellen.</p></div>
<div class="paragraph"><p>Diese lokalen Plugins unterscheiden sich dabei in einem wesentlichen Punkt
von anderen Checks:
Die Berechnung des Status erfolgt direkt auf dem Host, auf dem die Daten auch abgerufen werden.
Dadurch entfällt die komplexe Erstellung von Checks in Python und Sie sind bei der Wahl der Skriptsprache völlig frei.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_simple_check">
<span class="hidden-anchor sr-only" id="simple_check"></span>2. Einen einfachen lokalen Check schreiben</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_syntax">
<span class="hidden-anchor sr-only" id="syntax"></span>2.1. Skript erstellen</h3>
<div class="paragraph"><p>Sie können einen lokalen Check in jeder beliebigen Programmiersprache schreiben, die der Zielhost unterstützt.
Das Skript muss so konstruiert sein, dass es pro Check eine Statuszeile ausgibt, die aus vier Teilen besteht.
Hier ist ein Beispiel:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">0 "My service" myvalue=73 My output text which may contain spaces</span></code></pre></div></div>
<div class="paragraph"><p>Die vier Teile sind durch Leerzeichen getrennt und haben folgende Bedeutung:</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Beispielwert</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Zustand des Services wird als Ziffer angegeben: <code>0</code> für <span class="state0">OK</span>, <code>1</code> für <span class="state1">WARN</span>, <code>2</code> für <span class="state2">CRIT</span> und <code>3</code> für <span class="state3">UNKNOWN</span>. Alternativ ist es möglich, den <a href="#dynamic_state">Status dynamisch berechnen</a> zu lassen: dann wird die Ziffer durch ein <code>P</code> ersetzt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>My service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service-Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Name des Services, wie er in Checkmk angezeigt wird, in der Ausgabe des Checks in doppelten Anführungszeichen. Falls der Service-Name keine Leerzeichen enthält, können Sie sich die Anführungszeichen sparen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myvalue=73;65;75</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wert und Metriken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metrikwerte zu den Daten. Sie finden im Kapitel zu den <a href="#metrics">Metriken</a> näheres zum Aufbau. Alternativ können Sie ein Minuszeichen setzen, wenn der Check keine Metriken ausgibt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>My output text which may contain spaces</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Statusdetail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Details zum Status, wie sie in Checkmk angezeigt werden. Dieser Teil kann auch Leerzeichen enthalten.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Zwischen den einzelnen Teilen der Ausgabe und dem ersten Text des Statusdetails muss immer ein Leerzeichen stehen.
Alles danach wird zum Statusdetail gezählt, weswegen dann auch Leerzeichen erlaubt sind.</p></div>
<div class="paragraph"><p>Wenn Sie wegen einer möglichen Ausgabe unsicher sind, können Sie diese einfach testen, indem Sie ein kleines Skript mit dem Kommando <code>echo</code> schreiben.
Fügen Sie in das <code>echo</code>-Kommando Ihre Ausgabe ein, die Sie testen möchten.
Achten Sie darauf, die Anführungszeichen für den Service-Namen mit <code>\</code> zu maskieren, damit diese Zeichen nicht vom <code>echo</code>-Kommando interpretiert werden:</p></div>
<div class="listingblock">
<div class="title">mylocalcheck</div>
<div class="content"><pre class="pygments highlight"><code><span></span>#!/bin/bash
echo "0 \"My 1st service\" - This static service is always OK"</code></pre></div>
</div>
<div class="paragraph"><p>Für Windows-Hosts sieht so ein Testskript sehr ähnlich aus:</p></div>
<div class="listingblock">
<div class="title">mylocalcheck.bat</div>
<div class="content"><pre class="pygments highlight"><code><span></span>@echo off
echo 0 "My 1st service" - This static service is always OK</code></pre></div>
</div>
<div class="paragraph"><p>Beide Skripte führen in der Ausgabe zum gleichen Ergebnis:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">0 "My 1st service" - This static service is always OK</span></code></pre></div></div>
<div class="paragraph"><p>Für Checkmk ist nur diese Ausgabe relevant, nicht wie Sie diese Ausgabe erzeugt haben.</p></div>
<div class="paragraph"><p>Sie können übrigens beliebig viele Ausgaben in einem Skript erzeugen.
Für jede ausgegebene Zeile wird dann ein eigener Service in Checkmk erstellt.
Daher sind in der Ausgabe auch keine Zeilenumbruchzeichen erlaubt — es sei denn, sie sind maskiert, zum Beispiel für eine <a href="#multi-line">mehrzeilige Ausgabe</a> in Checkmk.</p></div>
<div class="paragraph"><p>Wie Sie prüfen, ob das lokale Skript vom Agenten richtig aufgerufen wird, sehen Sie in der <a href="#diagnose">Fehleranalyse</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_distribute">
<span class="hidden-anchor sr-only" id="distribute"></span>2.2. Skript verteilen</h3>
<div class="paragraph"><p>Nachdem das Skript geschrieben ist, können Sie es an die entsprechenden Hosts verteilen.
Der Pfad unterscheidet sich je nach Betriebssystem.
Eine Liste der Pfade finden Sie in <a href="#folders_script">Dateien und Verzeichnisse</a> weiter unten.</p></div>
<div class="paragraph"><p>Vergessen Sie nicht, das Skript auf unixoiden Systemen ausführbar zu machen.
Der Pfad in dem Beispiel bezieht sich auf Linux:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>chmod<span class="tok-w"> </span>+x<span class="tok-w"> </span>/usr/lib/check_mk_agent/local/mylocalcheck</code></pre></div></div>
<div class="paragraph"><p>Wenn Sie die <a href="wato_monitoringagents.html#bakery">Agentenbäckerei</a> nutzen, können Sie das Skript auch regelbasiert verteilen.
Mehr zur Regelerstellung erfahren Sie im Kapitel <a href="#bakery">Verteilung über die Agentenbäckerei</a>.</p></div>
</div>
<div class="sect2">
<h3 id="heading_add_service">
<span class="hidden-anchor sr-only" id="add_service"></span>2.3. Den Service ins Monitoring aufnehmen</h3>
<div class="paragraph"><p>Bei jedem Aufruf des Checkmk-Agenten wird auch der im Skript enthaltene lokale Check ausgeführt und an die Ausgabe des Agenten angehängt.
Die <a href="wato_services.html#discovery">Service-Erkennung</a> funktioniert also wie bei anderen Services auch automatisch:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_services.png" alt="localchecks services"></div></div>
<div class="paragraph"><p>Nachdem Sie den Service ins Monitoring übernommen und die Änderungen aktiviert haben, ist die Einrichtung eines selbst erstellten Services mit Hilfe eines lokalen Checks bereits abgeschlossen.
Falls es bei der Service-Erkennung zu Problemen kommen sollte, kann Ihnen die <a href="#diagnose">Fehleranalyse</a> weiterhelfen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_extended_functions">
<span class="hidden-anchor sr-only" id="extended_functions"></span>3. Erweiterte Funktionen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_metrics">
<span class="hidden-anchor sr-only" id="metrics"></span>3.1. Metriken</h3>
<div class="paragraph"><p>Sie können in einem lokalen Check auch Metriken festlegen.
Damit diese ausgewertet werden, muss der zurückgelieferte Status <code>P</code> sein.
Die Berechnung des Zustands erfolgt dann durch Checkmk.</p></div>
<div class="paragraph"><p>Die allgemeine Syntax für Metrikdaten ist:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">metricname=value;warn;crit;min;max</span></code></pre></div></div>
<div class="paragraph"><p>wobei <code>value</code> der aktuelle Wert ist, <code>warn</code> und <code>crit</code> die (oberen) Schwellwerte festlegen sowie <code>min</code> und <code>max</code> den Wertebereich fixieren — zum Beispiel so:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">count=73;80;90;0;100</span></code></pre></div></div>
<div class="paragraph"><p>Die Werte werden mit Semikolon getrennt.
Alle Werte mit Ausnahme von <code>value</code> sind optional.
Wird ein Wert nicht benötigt, so bleibt das Feld leer bzw. wird am Ende weggelassen, wie im Folgenden für <code>warn</code>, <code>crit</code> und <code>max</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">count=42;;;0</span></code></pre></div></div>
<div class="paragraph"><p><strong>Hinweis:</strong> In den <span class="image-inline"><img src="../images/CEE.svg" alt="CEE" width="20" title="Checkmk Enterprise Editions"></span> <strong>Checkmk Enterprise Editions</strong> können die Werte für <code>min</code> und <code>max</code> zwar gesetzt werden — aber nur aus Kompatibilitätsgründen.
Die Begrenzung des zugehörigen Graphen auf einen bestimmten Wertebereich hat in den Enterprise Editions keine Auswirkungen.</p></div>
</div>
<div class="sect2">
<h3 id="heading_metricname">
<span class="hidden-anchor sr-only" id="metricname"></span>3.2. Metriknamen</h3>
<div class="paragraph"><p>Bei der Wahl des - hier im Beispiel <code>metricname</code> genannten - Bezeichners dieser Metrik sollten Sie besondere Vorsicht walten lassen.
Wir empfehlen, die Bezeichner mit einem Präfix zu versehen, um Überschneidungen mit bereits in Checkmk vorhandenen Metriken zu verhindern.</p></div>
<div class="paragraph"><p>Statt also beispielsweise eine Metrik, die die Zahl von derzeit wartenden
Anfragen in einer von Ihnen überwachten Queue angibt, einfach 'current' zu nennen,
empfehlen wir hier einen klareren Bezeichner mit einem Präfix - etwa:
<code>mycompany_current_requests</code>.</p></div>
<div class="paragraph"><p>Sollten Sie hier nämlich einen Bezeichner wählen, der bereits in Checkmk vorhanden
ist, würde die Darstellung Ihrer Metriken in Graphen mit den bereits
vorliegenden Definitionen überschrieben.</p></div>
<div class="paragraph"><p>Natürlich können Sie auch absichtlich eine bereits vorhandene Metrik aus Checkmk
wiederverwenden. Eine Metrik für eine elektrische Spannung könnten Sie also
bspw. durch die Verwendung des Bezeichners <code>current</code> ohne weiteres in Ihrem
lokalen Check nutzen. Im Zweifelsfall müssen Sie sich die aktuelle Definition
dieser Metrik aber in <code>~/lib/python3/cmk/gui/plugins/metric</code> selbsttätig
heraussuchen.</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>grep<span class="tok-w"> </span>-r<span class="tok-w"> </span>-A<span class="tok-w"> </span><span class="tok-m">4</span><span class="tok-w"> </span><span class="tok-s1">'metric_info\["current"\]'</span><span class="tok-w"> </span>./lib/python3/cmk/gui/plugins/metrics/</code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading_multiple_metrics">
<span class="hidden-anchor sr-only" id="multiple_metrics"></span>3.3. Mehrere Metriken</h3>
<div class="paragraph"><p>Sie können auch mehrere Metriken ausgeben lassen.
Diese werden dann durch das "Pipe"-Zeichen <code>|</code> getrennt, zum Beispiel so:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">count1=42|count2=23</span></code></pre></div></div>
<div class="paragraph"><p><strong>Achtung:</strong> Auf Windows-Hosts müssen Sie diesen Pipes im Skript noch einen Zirkumflex (<code>^</code>) voranstellen, damit diese Pipes auch in der Ausgabe ankommen.</p></div>
<div class="listingblock">
<div class="title">mylocalcheck.bat</div>
<div class="content"><pre class="pygments highlight"><code><span></span>@echo off
echo 0 "My 2nd service" count1=42^|count2=23 A service with 2 graphs</code></pre></div>
</div>
<div class="paragraph"><p>Eine komplette <strong>Ausgabe</strong> mit zwei Metriken sieht dann etwa so aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/mylocalcheck
<span class="tok-go">0 "My 2nd service" count1=42|count2=23 A service with 2 graphs</span></code></pre></div></div>
<div class="paragraph"><p>Nachdem Sie auch den neuen Service ins Monitoring aufgenommen haben, sehen Sie in der Service-Liste im Feld <span class="guihint">Summary</span> den Text zum Statusdetail.
Nach Anklicken des Services wird die Seite mit den Service-Details gezeigt.
Die Metriken zeigt das Feld <span class="guihint">Details,</span> und darunter sehen Sie die von Checkmk automatisch erzeugten Service-Graphen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_graphs2.png" alt="localchecks graphs2"></div></div>
</div>
<div class="sect2">
<h3 id="heading_dynamic_state">
<span class="hidden-anchor sr-only" id="dynamic_state"></span>3.4. Status dynamisch berechnen lassen</h3>
<div class="paragraph"><p>In den vorherigen Kapiteln haben Sie erfahren, wie man für Metriken Schwellwerte festlegen und diese auch in den Graphen anzeigen lassen kann.
Der nächste naheliegende Schritt ist es nun, diese Schwellwerte für eine dynamische Berechnung des Service-Zustands zu nutzen.
Checkmk bietet genau diese Möglichkeit, um einen lokalen Check auszubauen.</p></div>
<div class="paragraph"><p>Wenn Sie im ersten Feld der Ausgabe, das den Status bestimmt, statt einer Ziffer den Buchstaben <code>P</code> übergeben, wird der Service-Zustand anhand der übergebenen Schwellwerte berechnet.</p></div>
<div class="paragraph"><p>Eine Ausgabe würde dann so aussehen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/mylocalcheck
<span class="tok-go">P "My 1st dynamic service" count=40;30;50 Result is computed from two threshold values</span>
<span class="tok-go">P "My 2nd dynamic service" - Result is computed with no values</span></code></pre></div></div>
<div class="paragraph"><p>… und die Anzeige in einer Service-Ansicht so:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_dynsrv.png" alt="localchecks dynsrv"></div></div>
<div class="paragraph"><p>Die Anzeige unterscheidet sich in zwei Punkten von derjenigen, die bisher zu sehen war:</p></div>
<div class="ulist"><ul>
<li><p>Für Services im Zustand <span class="state1">WARN</span> oder <span class="state2">CRIT</span> zeigt die <span class="guihint">Summary</span> des Services alle wichtigen Informationen der Metriken (Name, Wert, Schwellwerte).
So können Sie immer nachvollziehen, wie dieser Zustand aus einem Wert berechnet wurde.
Für alle anderen Zustände werden die Metrikinformationen nur im Feld <span class="guihint">Details</span> angezeigt.</p></li>
<li><p>Wenn keine Metriken übergeben werden, ist der Service-Zustand immer <span class="state0">OK</span>.</p></li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading_upper_lower_thresholds">
<span class="hidden-anchor sr-only" id="upper_lower_thresholds"></span>3.5. Obere und untere Schwellwerte</h3>
<div class="paragraph"><p>Manche Parameter haben nicht nur obere, sondern auch untere Schwellwerte.
Ein Beispiel dafür ist die Luftfeuchtigkeit.
Für solche Fälle bietet der lokale Check die Möglichkeit, jeweils zwei Schwellwerte für die Zustände <span class="state1">WARN</span> und <span class="state2">CRIT</span> zu übergeben.
Sie werden durch einen Doppelpunkt getrennt und stellen jeweils den unteren und den oberen Schwellwert dar.</p></div>
<div class="paragraph"><p>In der allgemeinen Syntax sieht das so aus:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">metricname=value;warn_lower:warn_upper;crit_lower:crit_upper</span></code></pre></div></div>
<div class="paragraph"><p>… im Beispiel so:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/mylocalcheck
<span class="tok-go">P "My 3rd service" humidity=37;40:60;30:70 A service with lower and upper thresholds</span></code></pre></div></div>
<div class="paragraph"><p>… und in der Anzeige einer Service-Ansicht so:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_lower.png" alt="localchecks lower"></div></div>
<div class="paragraph"><p>Falls es Ihnen nur um untere Schwellwerte geht, lassen Sie die Felder der oberen Schwellwerte weg:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/mylocalcheck
<span class="tok-go">P "My 4th dynamic service" count_lower=37;40:;30: A service with lower thresholds only</span></code></pre></div></div>
<div class="paragraph"><p>Mit dieser Ausgabe legen Sie fest, dass der Service bei einem Wert kleiner 40 <span class="state1">WARN</span> und kleiner 30 <span class="state2">CRIT</span> werden soll: beim festgelegten Wert 37 wird der Service also den <span class="state1">WARN</span>-Zustand erhalten.</p></div>
</div>
<div class="sect2">
<h3 id="heading_multi-line">
<span class="hidden-anchor sr-only" id="multi-line"></span>3.6. Mehrzeilige Ausgaben</h3>
<div class="paragraph"><p>Auch die Option, die Ausgabe über mehrere Zeilen zu verteilen, steht Ihnen
zur Verfügung.
Da Checkmk unter Linux läuft, können Sie mit der Escape-Sequenz <code>\n</code> arbeiten, um einen Zeilenumbruch zu erzwingen.
Auch wenn Sie, bedingt durch die Skriptsprache, den Backslash selbst maskieren müssen, wird das von Checkmk korrekt interpretiert:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/mylocalcheck
<span class="tok-go">P "My service" humidity=37;40:60;30:70 My service output\nA line with details\nAnother line with details</span></code></pre></div></div>
<div class="paragraph"><p>In den Details des Services können Sie dann diese zusätzlichen Zeilen unter der <span class="guihint">Summary</span> sehen:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_srv_details.png" alt="localchecks srv details"></div></div>
</div>
<div class="sect2">
<h3 id="heading_cache">
<span class="hidden-anchor sr-only" id="cache"></span>3.7. Asynchron ausführen und Ausgabe zwischenspeichern</h3>
<div class="paragraph"><p>Die Ausgabe lokaler Checks kann, wie auch die von Agenten-Plugins, zwischengespeichert werden (<em>caching</em>).
Das kann nützlich sein, wenn Skripte längere Zeit zur Ausführung benötigen.
Ein solches Skript wird dann asynchron und nur in einem definierten Zeitintervall ausgeführt und die letzte Ausgabe zwischengespeichert.
Wird der Agent vor Ablauf der Zeit erneut abgefragt, verwendet er für den lokalen Check diesen Cache und liefert ihn in der Agentenausgabe zurück.</p></div>
<div class="paragraph"><p><strong>Hinweis</strong>: Das Caching steht nur für AIX, FreeBSD, Linux, OpenWRT und Windows zur Verfügung.</p></div>
<div class="sect3">
<h4 id="heading__konfiguration_unter_linux">
<span class="hidden-anchor sr-only" id="_konfiguration_unter_linux"></span>Konfiguration unter Linux</h4>
<div class="paragraph"><p>Unter Linux oder einem anderen unixoiden Betriebssystem kann jedes Plugin asynchron ausgeführt werden.
Für einen lokalen Check ist die notwendige Konfiguration sehr ähnlich zu der eines <a href="agent_linux.html#async_plugins">Plugins</a>.
Legen Sie dazu ein Unterverzeichnis an, das so heißt, wie die Anzahl der Sekunden, die die Ausgabe zwischengespeichert werden soll und legen Sie Ihr Skript in diesem Unterverzeichnis ab.</p></div>
<div class="paragraph"><p>In folgenden Beispiel wird der lokale Check nur alle 10 Minuten (600 Sekunden) ausgeführt:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>/usr/lib/check_mk_agent/local/600/mylocalcheck
<span class="tok-go">2 "My cached service" count=4 Some output of a long running script</span></code></pre></div></div>
<div class="paragraph"><p>Die zwischengespeicherten Daten werden in ein <a href="#folders_cache">Cache-Verzeichnis</a> geschrieben.</p></div>
<div class="paragraph"><p>Für einen Service, der zwischengespeicherte Daten liefert, werden die Cache-spezifischen Informationen in der Service-Ansicht hinzugefügt:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_srv_cached.png" alt="localchecks srv cached"></div></div>
</div>
<div class="sect3">
<h4 id="heading__konfiguration_unter_windows">
<span class="hidden-anchor sr-only" id="_konfiguration_unter_windows"></span>Konfiguration unter Windows</h4>
<div class="paragraph"><p>Unter Windows erfolgt die Konfiguration ebenfalls analog zu der eines <a href="agent_windows.html#customizeexecution">Plugins</a>.
Statt mit einem speziellen Unterverzeichnis wie bei Linux &amp; Co werden die Optionen in einer Konfigurationsdatei gesetzt:</p></div>
<div class="listingblock">
<div class="title">C:\ProgramData\checkmk\agent\check_mk.user.yml</div>
<div class="content"><pre class="pygments highlight"><code><span></span>local:
    enabled: yes
    execution:
        - pattern     : $CUSTOM_LOCAL_PATH$\mylocalcheck.bat
          async       : yes
          run         : yes
          cache_age   : 600</code></pre></div>
</div>
<div class="paragraph"><p>Wie Sie oben sehen, können Sie unter Windows die asynchrone Ausführung (mit <code>async</code>) und das Zeitintervall (mit <code>cache_age</code>) getrennt konfigurieren.</p></div>
<div class="paragraph"><p>Alternativ können Sie die Konfiguration unter Windows auch in der <a href="#bakery">Agentenbäckerei</a> durchführen.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_bakery">
<span class="hidden-anchor sr-only" id="bakery"></span>4. Verteilung über die Agentenbäckerei</h2>
<div class="sectionbody">
<div class="paragraph"><p><span class="image-inline"><img src="../images/CEE.svg" alt="CEE" class="icon-left"></span>
Wenn Sie die <a href="wato_monitoringagents.html#bakery">Agentenbäckerei</a> bereits nutzen, können Sie die Skripte mit lokalen Checks auch über diesen Weg an mehrere Hosts verteilen.</p></div>
<div class="paragraph"><p>Erstellen Sie dazu auf dem Checkmk-Server als Instanzbenutzer unterhalb von <code>~/local/share/check_mk/agents/</code> zuerst das Verzeichnis <code>custom</code> und darin für jedes Paket von lokalen Checks einen Unterverzeichnisbaum:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>~/local/share/check_mk/agents
<span class="tok-gp">OMD[mysite]:~$ ~/local/share/check_mk/agents$ </span>mkdir<span class="tok-w"> </span>-p<span class="tok-w"> </span>custom/mycustompackage/lib/local/</code></pre></div></div>
<div class="paragraph"><p>Das Paketverzeichnis im obigen Beispiel ist <code>mycustompackage</code>.
Darunter markiert das <code>lib</code>-Verzeichnis das Skript als Plugin oder lokalen Check.
Das nachfolgende Verzeichnis <code>local</code> ordnet die Datei dann eindeutig zu.
Legen Sie in diesem Verzeichnis das Skript mit dem lokalen Check ab.</p></div>
<div class="paragraph"><p><strong>Wichtig:</strong> Unter Linux können Sie die asynchrone Ausführung analog konfigurieren wie im <a href="#cache">vorherigen Kapitel</a> beschrieben, indem Sie nun unter <code>custom/mycustompackage/lib/local/</code> ein Verzeichnis mit der Sekundenzahl des Ausführungsintervalls erzeugen und dort das Skript ablegen.
Unter Windows können Sie dafür die Regelsätze <span class="guihint">Set execution mode for plugins and local checks</span> und <span class="guihint">Set cache age for plugins and local checks</span> nutzen. Diese und weitere Regelsätze für lokale Checks unter Windows finden Sie in der Agentenbäckerei unter <span class="guihint">Agent rules &gt; Windows Agent</span>.</p></div>
<div class="paragraph"><p>In der Konfigurationsumgebung von Checkmk wird dann das Paketverzeichnis  <code>mycustompackage</code> als neue Option angezeigt:
Öffnen Sie <span class="guihint">Setup &gt; Agents &gt; Windows, Linux, Solaris, AIX</span>, erstellen Sie eine neue Regel mit <span class="guihint">Agents &gt; Agent rules &gt; Generic options &gt; Deploy custom files with agent</span> und wählen Sie das eben erstellte Paket aus:</p></div>
<div class="imageblock"><div class="content"><img src="../images/localchecks_custom.png" alt="localchecks custom"></div></div>
<div class="paragraph"><p>Checkmk wird nun selbstständig den lokalen Check im Installationspaket der jeweiligen Betriebssysteme richtig einordnen.
Nachdem Sie die Änderungen aktiviert und die Agenten gebacken haben, sind Sie mit der Konfiguration auch schon fertig.
Die Agenten müssen nun nur noch neu verteilt werden.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="heading_diagnose">
<span class="hidden-anchor sr-only" id="diagnose"></span>5. Fehleranalyse</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading__skript_testen">
<span class="hidden-anchor sr-only" id="_skript_testen"></span>5.1. Skript testen</h3>
<div class="paragraph"><p>Wenn Sie bei einem selbst geschriebenen Skript auf Probleme stoßen, sollten Sie
die folgenden potentiellen Fehlerquellen prüfen:</p></div>
<div class="ulist"><ul>
<li><p>Liegt das Skript im richtigen <a href="#folders_script">Verzeichnis</a>?</p></li>
<li><p>Ist das Skript ausführbar und stimmen die Zugriffsberechtigungen?
Das ist vor allem relevant, wenn Sie den Agenten oder das Skript nicht als root/System-Benutzer ausführen.</p></li>
<li>
<p>Ist die Ausgabe konform zur vorgegebenen Syntax?
Die Ausgabe des lokalen Checks muss der Syntax entsprechen, wie sie in den Kapiteln <a href="#syntax">Skript erstellen</a> und <a href="#extended_functions">Erweiterte Funktionen</a> beschrieben ist.
Andernfalls kann die fehlerfreie Ausführung nicht garantiert werden.</p>
<div class="paragraph"><p>Probleme und Fehler können insbesondere dann entstehen, wenn ein lokaler Check eine Aufgabe erfüllen soll, die ein vollwertiges <a href="devel_check_plugins.html">Check-Plugin</a> erfordert, beispielsweise, wenn die Ausgabe des lokalen Checks selbst einen Sektionskopf (<em>section header</em>) enthält oder die Definition eines Host-Namens, wie er beim Transport von <a href="piggyback.html">Piggyback-Daten</a> verwendet wird.</p></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="heading__agentenausgabe_auf_dem_ziel_host_testen">
<span class="hidden-anchor sr-only" id="_agentenausgabe_auf_dem_ziel_host_testen"></span>5.2. Agentenausgabe auf dem Ziel-Host testen</h3>
<div class="paragraph"><p>Wenn das Skript selbst korrekt ist, können Sie den Agenten auf dem Host
ausführen.
Bei unixoiden Betriebssystemen, wie Linux, BSD und so weiter, bietet sich
der Befehl <code>grep</code> an, um nach einem bestimmten Textmuster zu suchen.
Mit der Option <code>-A</code> bestimmen Sie die Anzahl der zusätzlichen Zeilen, die nach einem Treffer angezeigt werden sollen.
Sie können diese Zahl entsprechend der Anzahl der erwarteten Ausgabezeilen anpassen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">root@linux# </span>check_mk_agent<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span>-v<span class="tok-w"> </span>grep<span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>grep<span class="tok-w"> </span>-A2<span class="tok-w"> </span><span class="tok-s2">"&lt;&lt;&lt;local"</span>
<span class="tok-go">&lt;&lt;&lt;local:sep(0)&gt;&gt;&gt;</span>
<span class="tok-go">P "My service" humidity=37;40:60;30:70 My service output\nA line with details\nAnother line with details</span>
<span class="tok-go">cached(1618580356,600) 2 "My cached service" count=4 Some output of a long running script</span></code></pre></div></div>
<div class="paragraph"><p>In der letzten Zeile erkennen Sie einen zwischengespeicherten Service an der vorangestellten <code>cache</code>-Information mit der aktuellen Unixzeit und dem Ausführungsintervall in Sekunden.</p></div>
<div class="paragraph"><p>Unter Windows können Sie mit der PowerShell und dem „Cmdlet“ <code>Select-String</code> ein sehr ähnliches Resultat erreichen wie mit dem <code>grep</code>-Befehl unter Linux. Im folgenden Befehl bestimmen die beiden Ziffern hinter dem Parameter <code>Context</code> wie viele Zeilen vor und nach dem Treffer ausgegeben werden sollen:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">PS C:\Program Files (x86)\checkmk\service&gt; ./check_mk_agent.exe test | Select-String -Pattern "&lt;&lt;&lt;local" -Context 0,3</span>
<span class="tok-go">&gt; &lt;&lt;&lt;local:sep(0)&gt;&gt;&gt;</span>
<span class="tok-go">  0 "My 1st service" - This static service is always OK</span>

<span class="tok-go">  cached(1618580520,600) 1 "My cached service on Windows" count=4 Some output of a long running script</span></code></pre></div></div>
</div>
<div class="sect2">
<h3 id="heading__agentenausgabe_auf_dem_checkmk_server_testen">
<span class="hidden-anchor sr-only" id="_agentenausgabe_auf_dem_checkmk_server_testen"></span>5.3. Agentenausgabe auf dem Checkmk-Server testen</h3>
<div class="paragraph"><p>Zuletzt können Sie die Verarbeitung der Skriptausgaben auch auf dem Checkmk-Server mit dem Befehl <code>cmk</code> testen — einmal die Serviceerkennung:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-IIv<span class="tok-w"> </span>--detect-plugins<span class="tok-o">=</span><span class="tok-nb">local</span><span class="tok-w"> </span>mycmkserver
<span class="tok-go">Discovering services and host labels on: mycmkserver</span>
<span class="tok-go">mycmkserver:</span>
<span class="tok-go">...</span>
<span class="tok-go">+ EXECUTING DISCOVERY PLUGINS (1)</span>
<span class="tok-go">  <span class="green">2</span> local</span>
<span class="tok-gp"><span class="green"></span>SUCCESS</span><span class="tok-w"> </span>-<span class="tok-w"> </span>Found<span class="tok-w"> </span><span class="tok-m">2</span><span class="tok-w"> </span>services,<span class="tok-w"> </span>no<span class="tok-w"> </span>host<span class="tok-w"> </span>labels</code></pre></div></div>
<div class="paragraph"><p>… und mit einem ähnlichen Befehl auch die Verarbeitung der Serviceausgabe:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">OMD[mysite]:~$ </span>cmk<span class="tok-w"> </span>-nv<span class="tok-w"> </span>--detect-plugins<span class="tok-o">=</span><span class="tok-nb">local</span><span class="tok-w"> </span>mycmkserver
<span class="tok-go">Checkmk version 2.0.0p2</span>
<span class="tok-go">+ FETCHING DATA</span>
<span class="tok-go">...</span>
<span class="tok-go">+ PARSE FETCHER RESULTS</span>
<span class="tok-go">Received no piggyback data</span>
<span class="tok-go">My cached service    <span class="red">Some output of a long running script(!!), Cache generated 6 minutes 52 seconds ago, Cache interval: 10 minutes 0 seconds, Elapsed cache lifespan: 68.71%</span></span>
<span class="tok-go">My service           <span class="yellow">My service output\, humidity: 37.00 (warn/crit below 40.00/30.00)(!)</span></span></code></pre></div></div>
<div class="paragraph"><p>Für beide Befehle haben wir die Ausgabe um für dieses Thema nicht relevante Zeilen gekürzt.</p></div>
<div class="paragraph"><p>Wenn es in den lokalen Checks Fehler gibt, wird Checkmk Sie in der
Serviceausgabe darauf hinweisen.
Das gilt sowohl für fehlerhafte Metriken, als auch für falsche, unvollständige Informationen in der Skriptausgabe oder einen ungültigen Status.
Diese Fehlermeldungen sollen Ihnen helfen, die Fehler in den Skripten schnell zu identifizieren.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="heading_folders">
<span class="hidden-anchor sr-only" id="folders"></span>6. Dateien und Verzeichnisse</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="heading_folders_script">
<span class="hidden-anchor sr-only" id="folders_script"></span>6.1. Skript-Verzeichnis auf dem Ziel-Host</h3>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 65%;">
<col style="width: 35%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Betriebssystem</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/check_mk/lib/local/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/local/lib/check_mk_agent/local/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeBSD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/lib/check_mk_agent/local/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HP-UX, Linux, OpenBSD, OpenWRT und Solaris</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%ProgramData%\checkmk\agent\local</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="heading_folders_cache">
<span class="hidden-anchor sr-only" id="folders_cache"></span>6.2. Cache-Verzeichnis auf dem Ziel-Host</h3>
<div class="paragraph"><p>Hier werden zwischengespeicherte Daten einzelner Sektionen, u.a. der <code>local</code> Sektion, abgelegt und dem Agenten, solange die Daten gültig sind, bei jeder Ausführung wieder angehängt.</p></div>
<table class="table-responsive table-bordered table tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 65%;">
<col style="width: 35%;">
</colgroup>
<thead><tr>
<th class="tableblock halign-left valign-top">Pfad</th>
<th class="tableblock halign-left valign-top">Betriebssystem</th>
</tr></thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/tmp/check_mk/cache/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/run/check_mk/cache/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeBSD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/check_mk_agent/cache/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux, OpenWRT und Solaris</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></main><div id="toc" class="toc2">
<div id="toctitle">Auf dieser Seite</div>
<ul class="sectlevel1">
<li><a href="#_warum_eigene_checks">1. Warum eigene Checks?</a></li>
<li>
<a href="#simple_check">2. Einen einfachen lokalen Check schreiben</a><ul class="sectlevel1">
<li><a href="#syntax">2.1. Skript erstellen</a></li>
<li><a href="#distribute">2.2. Skript verteilen</a></li>
<li><a href="#add_service">2.3. Den Service ins Monitoring aufnehmen</a></li>
</ul>
</li>
<li>
<a href="#extended_functions">3. Erweiterte Funktionen</a><ul class="sectlevel1">
<li><a href="#metrics">3.1. Metriken</a></li>
<li><a href="#metricname">3.2. Metriknamen</a></li>
<li><a href="#multiple_metrics">3.3. Mehrere Metriken</a></li>
<li><a href="#dynamic_state">3.4. Status dynamisch berechnen lassen</a></li>
<li><a href="#upper_lower_thresholds">3.5. Obere und untere Schwellwerte</a></li>
<li><a href="#multi-line">3.6. Mehrzeilige Ausgaben</a></li>
<li>
<a href="#cache">3.7. Asynchron ausführen und Ausgabe zwischenspeichern</a><ul class="sectlevel2">
<li><a href="#_konfiguration_unter_linux">Konfiguration unter Linux</a></li>
<li><a href="#_konfiguration_unter_windows">Konfiguration unter Windows</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bakery">4. Verteilung über die Agentenbäckerei</a></li>
<li>
<a href="#diagnose">5. Fehleranalyse</a><ul class="sectlevel1">
<li><a href="#_skript_testen">5.1. Skript testen</a></li>
<li><a href="#_agentenausgabe_auf_dem_ziel_host_testen">5.2. Agentenausgabe auf dem Ziel-Host testen</a></li>
<li><a href="#_agentenausgabe_auf_dem_checkmk_server_testen">5.3. Agentenausgabe auf dem Checkmk-Server testen</a></li>
</ul>
</li>
<li>
<a href="#folders">6. Dateien und Verzeichnisse</a><ul class="sectlevel1">
<li><a href="#folders_script">6.1. Skript-Verzeichnis auf dem Ziel-Host</a></li>
<li><a href="#folders_cache">6.2. Cache-Verzeichnis auf dem Ziel-Host</a></li>
</ul>
</li>
</ul>
</div>
<script src="../../assets/js/manifest.js?id=7db827d654313dce4250"></script>
<script src="../../assets/js/vendor.js?id=581a3d4a61b7156d04df"></script>
<script src="../../assets/js/app.js?id=959ccd04b1f8b7b78c5e"></script>
<script src="../../assets/js/lunr.js"></script>
<script src="../../assets/js/lunr.stemmer.support.js"></script>
<script src="../../assets/js/lunr.de.js"></script>
<script src="../lunr.index.de.js"></script>
<script src="../../assets/js/lunr.client.js"></script>
</body>
</html>
